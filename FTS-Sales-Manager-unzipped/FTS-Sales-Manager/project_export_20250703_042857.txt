================================================================================
PROJECT STRUCTURE
================================================================================

PROJECT_ROOT/
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ export_project_improved.py
‚îú‚îÄ‚îÄ fts_sales_cache.db
‚îú‚îÄ‚îÄ project_analysis.json
‚îú‚îÄ‚îÄ project_analysis.txt
‚îú‚îÄ‚îÄ project_analyzer.py
‚îú‚îÄ‚îÄ project_export_20250703_042857.txt
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îî‚îÄ‚îÄ dropdown_cache.json
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ login_config.py
‚îÇ   ‚îú‚îÄ‚îÄ modern_color_palettes.py
‚îÇ   ‚îî‚îÄ‚îÄ settings.yaml
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ app_controller.py
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ airtable_dropdown_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ airtable_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ app_state_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ config_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ constants.py
‚îÇ   ‚îú‚îÄ‚îÄ db_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ event_system.py
‚îÇ   ‚îú‚îÄ‚îÄ language_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îú‚îÄ‚îÄ permissions.py
‚îÇ   ‚îú‚îÄ‚îÄ session_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ state_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ theme_color_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ theme_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ user_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ core/security/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ encryption.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate_limiter.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ two_factor_auth.py
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ login_cache.json
‚îú‚îÄ‚îÄ drafts/
‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îú‚îÄ‚îÄ ar.yaml
‚îÇ   ‚îî‚îÄ‚îÄ en.yaml
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ app.log
‚îÇ   ‚îú‚îÄ‚îÄ logs/logs/
‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îú‚îÄ‚îÄ company_logo.png
‚îÇ   ‚îî‚îÄ‚îÄ fts_icon.ico
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ async_operations.py
‚îÇ   ‚îú‚îÄ‚îÄ error_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ image_utils.py
‚îÇ   ‚îú‚îÄ‚îÄ login_visual_effects.py
‚îÇ   ‚îú‚îÄ‚îÄ threading_utils.py
‚îÇ   ‚îú‚îÄ‚îÄ validators.py
‚îÇ   ‚îî‚îÄ‚îÄ window_manager.py
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ add_edit_window.py
‚îÇ   ‚îú‚îÄ‚îÄ login_window.py
‚îÇ   ‚îú‚îÄ‚îÄ main_window.py
‚îÇ   ‚îú‚îÄ‚îÄ splash_screen.py
‚îÇ   ‚îú‚îÄ‚îÄ views/components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ autocomplete_entry.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ combobox.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_table.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dropdown_dialogs.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu_bar.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quick_test.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ searchable_combobox.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidebar.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status_bar.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toolbar.py

================================================================================
FILE CONTENTS
================================================================================


============================================================
FILE: app.py
SIZE: 6242 characters
============================================================

# -*- coding: utf-8 -*-
"""
app.py

ŸÜŸÇÿ∑ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ© (entry point) ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ FTS Sales Manager.
"""

# ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° Ÿàÿ•ÿØÿßÿ±ÿ™Ÿáÿß
import sys
import traceback
import warnings
import traceback

# ÿ™ÿπÿ∑ŸäŸÑ ÿ™ÿ≠ÿ∞Ÿäÿ± "invalid command name"
warnings.filterwarnings("ignore", message="invalid command name")

# ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ŸÅÿπŸäŸÑ faulthandler ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿØÿπŸàŸÖÿßŸã
try:
    import faulthandler
    # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜŸÜÿß ŸÑÿ≥ŸÜÿß ŸÅŸä IDLE
    if hasattr(sys.stderr, 'fileno') and hasattr(sys.stderr.fileno, '__call__'):
        try:
            sys.stderr.fileno()
            faulthandler.enable()
        except:
            # ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ŸÜÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑÿÆÿ∑ÿ£
            pass
except ImportError:
    # ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ faulthandler ŸÖÿ™ÿßÿ≠ÿßŸã
    pass

# ŸÖÿπÿßŸÑÿ¨ ÿ£ÿÆÿ∑ÿßÿ° ÿπÿßŸÖ ŸÑŸÄ Tkinter
def handle_tk_error(*args):
    import traceback
    import sys

    try:
        # ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ŸàŸÑŸâ: tkinter Ÿäÿ±ÿ≥ŸÑ (exc_type, exc_value, exc_tb)
        if isinstance(args, tuple) and len(args) == 3 and isinstance(args[1], BaseException):
            exc_type, exc_value, exc_tb = args

        # ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©: tkinter Ÿäÿ±ÿ≥ŸÑ ŸÉÿßÿ¶ŸÜ ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑
        elif isinstance(args, tuple) and len(args) == 1 and isinstance(args[0], BaseException):
            exc_type = type(args[0])
            exc_value = args[0]
            exc_tb = args[0].__traceback__ if hasattr(args[0], "__traceback__") else None

        # ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©: (widget, exc_type, exc_value, exc_tb)
        elif isinstance(args, tuple) and len(args) == 4 and isinstance(args[2], BaseException):
            _, exc_type, exc_value, exc_tb = args

        else:
            print("üì¶ ŸÖÿ≠ÿ™ŸàŸâ args ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ™ŸàŸÇÿπ:", args, file=sys.stderr)
            raise ValueError("ÿ™ŸÜÿ≥ŸäŸÇ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿÆÿ∑ÿ£")

        traceback.print_exception(exc_type, exc_value, exc_tb)

    except Exception as e:
        print(f"‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ£ÿ´ŸÜÿßÿ° ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° (ÿØÿßÿÆŸÑŸäŸãÿß): {e}", file=sys.stderr)

# ŸÖÿπÿßŸÑÿ¨ ÿ£ÿÆÿ∑ÿßÿ° ÿ¥ÿßŸÖŸÑ
def handle_exception(exc_type, exc_value, exc_traceback):
    if issubclass(exc_type, KeyboardInterrupt):
        sys.__excepthook__(exc_type, exc_value, exc_traceback)
        return

    # ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ logger ŸáŸÜÿß ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÖÿ®ŸÉÿ±
    from core.logger import logger
    logger.critical("Uncaught exception", exc_info=(exc_type, exc_value, exc_traceback))
    traceback.print_exception(exc_type, exc_value, exc_traceback)

sys.excepthook = handle_exception

# ÿ®ÿßŸÇŸä ÿßŸÑŸàÿßÿ±ÿØÿßÿ™
import os
import tkinter as tk

# ÿ•ÿÆŸÅÿßÿ° ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÅŸàÿ±ÿßŸã ÿ®ÿπÿØ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ tkinter
if tk._default_root:
    tk._default_root.withdraw()

from core.config_manager import ConfigManager
from core.db_manager import DatabaseManager
from core.airtable_manager import AirtableManager, AirtableModel
from core.user_manager import UserManager
from core.logger import logger
from controllers.app_controller import AppController
from views.splash_screen import SplashScreen

# ÿ±ÿ®ÿ∑ ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿ®ŸÄ Tkinter
tk.Tk.report_callback_exception = handle_tk_error


def hide_default_tk_window():
    """ÿ•ÿÆŸÅÿßÿ° ÿ£Ÿä ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
    try:
        # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
        if tk._default_root:
            tk._default_root.withdraw()
            tk._default_root.overrideredirect(True)

        # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£Ÿä ŸÜŸàÿßŸÅÿ∞ tk ŸÖŸÅÿ™Ÿàÿ≠ÿ© Ÿàÿ•ÿÆŸÅÿßÿ§Ÿáÿß
        for widget in tk._default_root.winfo_children() if tk._default_root else []:
            if widget.winfo_class() == 'Tk' and widget.title() == 'tk':
                widget.withdraw()
    except:
        pass


def main() -> None:
    """
    ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.
    """
    # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÖÿÆŸÅŸäÿ© ŸÑŸÄ CTkToplevel
    root = tk.Tk()
    root.withdraw()  # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸàÿ±ÿßŸã
    root.overrideredirect(True)  # ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ

    # ÿ•ÿÆŸÅÿßÿ° ÿ£Ÿä ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ£ÿÆÿ±Ÿâ
    hide_default_tk_window()

    # 1. ÿπÿ±ÿ∂ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÑŸÖÿØÿ© ŸÇÿµŸäÿ±ÿ©
    try:
        splash = SplashScreen(duration=2000, master=root)  # ÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        splash.update()
    except Exception as e:
        logger.warning(f"Failed to show splash screen: {e}", exc_info=True)

    # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ÿ®ÿπÿØ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    hide_default_tk_window()

    # 2. ÿ™ŸáŸäÿ¶ÿ© ConfigManager
    config_mgr = ConfigManager(config_path=os.path.join("config", "settings.yaml"))

    # 3. ÿ™ŸáŸäÿ¶ÿ© DatabaseManager (SQLite ŸÑŸÑŸÉÿßÿ¥ ÿßŸÑŸÖÿ≠ŸÑŸä)
    db_mgr = DatabaseManager(db_path="fts_sales_cache.db")

    # 4. ÿ™ŸáŸäÿ¶ÿ© AirtableModel ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
    users_table = config_mgr.get("airtable_users_table", "Users")
    airtable_users = AirtableModel(
        config_manager=config_mgr,
        db_manager=db_mgr,
        table_name=users_table
    )

    # 5. ÿ™ŸáŸäÿ¶ÿ© AirtableModel ŸÑŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™
    booking_table = config_mgr.get("airtable_booking_table", "List V2")
    airtable_booking = AirtableModel(
        config_manager=config_mgr,
        db_manager=db_mgr,
        table_name=booking_table
    )

    # 6. ÿ™ŸáŸäÿ¶ÿ© UserManager (Ÿäÿ≥ÿ™ÿÆÿØŸÖ airtable_users ŸÅŸÇÿ∑)
    user_mgr = UserManager(airtable_model=airtable_users, db_manager=db_mgr)

    # 7. ÿ™ÿ¥ÿ∫ŸäŸÑ AppController ŸÖÿπ ŸÉŸÑÿß ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ŸäŸÜ
    try:
        app_ctrl = AppController(
            config_mgr=config_mgr,
            db_mgr=db_mgr,
            airtable_users=airtable_users,
            airtable_booking=airtable_booking,
            user_mgr=user_mgr
        )
        app_ctrl.run()
    except Exception as e:
        logger.error(f"Unexpected error in main loop: {e}", exc_info=True)
        raise
    finally:
        # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        try:
            if 'root' in locals() and root:
                root.destroy()
        except:
            pass


if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        logger.critical(f"Fatal error on startup: {e}", exc_info=True)
        # ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        try:
            import tkinter as tk
            from tkinter import messagebox

            # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ŸÖÿ§ŸÇÿ™ÿ© ŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
            error_root = tk.Tk()
            error_root.withdraw()  # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©

            messagebox.showerror(
                "ÿÆÿ∑ÿ£ ŸÅŸä ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ",
                f"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:\n\n{str(e)}\n\nŸäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÑŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ."
            )

            error_root.destroy()
        except:
            pass
        sys.exit(1)

============================================================
FILE: export_project_improved.py
SIZE: 3849 characters
============================================================

import os
import datetime

output_file = f"project_export_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"

# ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿ´ŸÜÿßÿ©
EXCLUDED_DIRS = {'.git', '__pycache__', 'venv', '.venv', 'node_modules', '.idea', '.vscode'}
# ÿßŸÑÿßŸÖÿ™ÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿ´ŸÜÿßÿ©
EXCLUDED_EXTENSIONS = {'.pyc', '.pyo', '.pyd', '.so', '.dll', '.dylib', '.exe'}

with open(output_file, 'w', encoding='utf-8') as out:
    # ŸÉÿ™ÿßÿ®ÿ© ŸáŸäŸÉŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    out.write("=" * 80 + "\n")
    out.write("PROJECT STRUCTURE\n")
    out.write("=" * 80 + "\n\n")

    # ÿ∑ÿ±ŸäŸÇÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ¥ÿ¨ÿ±ÿ©
    for root, dirs, files in os.walk('.'):
        # ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ±ÿ∫Ÿàÿ®ÿ©
        dirs[:] = [d for d in dirs if d not in EXCLUDED_DIRS]

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠
        if root == '.':
            level = 0
            display_path = 'PROJECT_ROOT/'
        else:
            # ÿ•ÿ≤ÿßŸÑÿ© ./ ÿ£Ÿà .\ ŸÖŸÜ ÿßŸÑÿ®ÿØÿßŸäÿ©
            relative_path = os.path.relpath(root, '.')
            level = relative_path.count(os.sep) + 1
            display_path = relative_path.replace(os.sep, '/') + '/'

        # ÿ±ÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸáÿ±ŸÖŸä
        indent = '‚îÇ   ' * (level - 1) + '‚îú‚îÄ‚îÄ ' if level > 0 else ''
        out.write(f'{indent}{display_path}\n')

        # ÿ±ÿ≥ŸÖ ÿßŸÑŸÖŸÑŸÅÿßÿ™
        for i, file in enumerate(files):
            # ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿÆŸÅŸäÿ© ŸàÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖÿ©
            if file.startswith('.') or any(file.endswith(ext) for ext in EXCLUDED_EXTENSIONS):
                continue

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® (ÿ¢ÿÆÿ± ŸÖŸÑŸÅ ÿ£ŸÖ ŸÑÿß)
            is_last = (i == len(files) - 1) and not dirs
            file_indent = '‚îÇ   ' * level + ('‚îî‚îÄ‚îÄ ' if is_last else '‚îú‚îÄ‚îÄ ')
            out.write(f'{file_indent}{file}\n')

    # ŸÉÿ™ÿßÿ®ÿ© ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÑŸÅÿßÿ™
    out.write("\n" + "=" * 80 + "\n")
    out.write("FILE CONTENTS\n")
    out.write("=" * 80 + "\n")

    # ÿßŸÖÿ™ÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ±ÿßÿØ ŸÇÿ±ÿßÿ°ÿ™Ÿáÿß
    READ_EXTENSIONS = {'.py', '.json', '.txt', '.md', '.yml', '.yaml', '.js', '.html', '.css',
                      '.jsx', '.tsx', '.ts', '.vue', '.sql', '.sh', '.bat', '.env.example'}

    files_read = 0
    errors = []

    for root, dirs, files in os.walk('.'):
        dirs[:] = [d for d in dirs if d not in EXCLUDED_DIRS]

        for file in files:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßŸÖÿ™ÿØÿßÿØ
            if any(file.endswith(ext) for ext in READ_EXTENSIONS):
                filepath = os.path.join(root, file)
                relative_path = os.path.relpath(filepath, '.')

                try:
                    with open(filepath, 'r', encoding='utf-8') as f:
                        content = f.read()

                    out.write(f"\n\n{'='*60}\n")
                    out.write(f"FILE: {relative_path}\n")
                    out.write(f"SIZE: {len(content)} characters\n")
                    out.write(f"{'='*60}\n\n")
                    out.write(content)
                    files_read += 1

                except Exception as e:
                    error_msg = f"Error reading {relative_path}: {e}"
                    out.write(f"\n\n{'='*60}\n")
                    out.write(f"ERROR: {error_msg}\n")
                    out.write(f"{'='*60}\n")
                    errors.append(error_msg)

    # ŸÖŸÑÿÆÿµ ÿßŸÑÿ™ÿµÿØŸäÿ±
    out.write(f"\n\n{'='*80}\n")
    out.write("EXPORT SUMMARY\n")
    out.write(f"{'='*80}\n")
    out.write(f"Total files read: {files_read}\n")
    out.write(f"Errors encountered: {len(errors)}\n")
    out.write(f"Export date: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")

    if errors:
        out.write("\nErrors details:\n")
        for error in errors:
            out.write(f"  - {error}\n")

print(f"‚úÖ ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ•ŸÑŸâ: {output_file}")
print(f"üìÅ ÿπÿØÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖŸÇÿ±Ÿàÿ°ÿ©: {files_read}")
if errors:
    print(f"‚ö†Ô∏è  ÿπÿØÿØ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°: {len(errors)}")

============================================================
FILE: project_analysis.json
SIZE: 35687 characters
============================================================

{
  "files": {
    "app": {
      "path": "app.py",
      "size": 6242,
      "lines": 201,
      "local_imports": [
        "core.user_manager",
        "core.config_manager",
        "core.airtable_manager",
        "views.splash_screen",
        "core.logger",
        "controllers.app_controller",
        "core.db_manager"
      ],
      "external_imports": [
        "os",
        "warnings",
        "traceback",
        "tkinter",
        "sys",
        "faulthandler"
      ]
    },
    "project_analyzer": {
      "path": "project_analyzer.py",
      "size": 15466,
      "lines": 401,
      "local_imports": [],
      "external_imports": [
        "os",
        "ast",
        "re",
        "pathlib",
        "typing",
        "json",
        "collections",
        "argparse"
      ]
    },
    "config.login_config": {
      "path": "config\\login_config.py",
      "size": 6796,
      "lines": 217,
      "local_imports": [],
      "external_imports": []
    },
    "config.modern_color_palettes": {
      "path": "config\\modern_color_palettes.py",
      "size": 5867,
      "lines": 202,
      "local_imports": [],
      "external_imports": []
    },
    "controllers.app_controller": {
      "path": "controllers\\app_controller.py",
      "size": 29214,
      "lines": 787,
      "local_imports": [
        "utils.threading_utils",
        "core.user_manager",
        "views.login_window",
        "views.main_window",
        "core.config_manager",
        "core.airtable_manager",
        "views.add_edit_window",
        "core.theme_manager",
        "core.logger",
        "core.language_manager",
        "core.db_manager",
        "core.airtable_dropdown_manager"
      ],
      "external_imports": [
        "typing",
        "threading",
        "datetime",
        "json",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "core.airtable_dropdown_manager": {
      "path": "core\\airtable_dropdown_manager.py",
      "size": 24117,
      "lines": 602,
      "local_imports": [
        "core.airtable_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "json",
        "logging",
        "time",
        "concurrent.futures"
      ]
    },
    "core.airtable_manager": {
      "path": "core\\airtable_manager.py",
      "size": 28862,
      "lines": 774,
      "local_imports": [],
      "external_imports": [
        "os",
        "re",
        "typing",
        "threading",
        "datetime",
        "json",
        "requests",
        "logging",
        "time",
        "concurrent.futures"
      ]
    },
    "core.app_state_manager": {
      "path": "core\\app_state_manager.py",
      "size": 14840,
      "lines": 403,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "typing",
        "threading",
        "datetime",
        "enum",
        "time"
      ]
    },
    "core.config_manager": {
      "path": "core\\config_manager.py",
      "size": 18851,
      "lines": 499,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "os",
        "dotenv",
        "typing",
        "yaml"
      ]
    },
    "core.constants": {
      "path": "core\\constants.py",
      "size": 8556,
      "lines": 295,
      "local_imports": [],
      "external_imports": [
        "typing",
        "enum"
      ]
    },
    "core.db_manager": {
      "path": "core\\db_manager.py",
      "size": 10852,
      "lines": 261,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "sqlite3",
        "typing",
        "threading"
      ]
    },
    "core.event_system": {
      "path": "core\\event_system.py",
      "size": 1015,
      "lines": 31,
      "local_imports": [],
      "external_imports": [
        "queue",
        "typing",
        "threading",
        "datetime"
      ]
    },
    "core.language_manager": {
      "path": "core\\language_manager.py",
      "size": 6614,
      "lines": 166,
      "local_imports": [
        "core.logger",
        "core.config_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "yaml"
      ]
    },
    "core.logger": {
      "path": "core\\logger.py",
      "size": 2118,
      "lines": 62,
      "local_imports": [],
      "external_imports": [
        "os",
        "logging",
        "logging.handlers"
      ]
    },
    "core.permissions": {
      "path": "core\\permissions.py",
      "size": 5411,
      "lines": 176,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "typing",
        "tkinter",
        "functools"
      ]
    },
    "core.session_manager": {
      "path": "core\\session_manager.py",
      "size": 14093,
      "lines": 411,
      "local_imports": [
        "core.security.encryption",
        "core.logger"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "secrets",
        "json",
        "time"
      ]
    },
    "core.state_manager": {
      "path": "core\\state_manager.py",
      "size": 2557,
      "lines": 75,
      "local_imports": [],
      "external_imports": [
        "dataclasses",
        "typing",
        "threading",
        "datetime"
      ]
    },
    "core.theme_color_manager": {
      "path": "core\\theme_color_manager.py",
      "size": 12242,
      "lines": 320,
      "local_imports": [
        "config.modern_color_palettes",
        "core.logger"
      ],
      "external_imports": [
        "typing",
        "customtkinter"
      ]
    },
    "core.theme_manager": {
      "path": "core\\theme_manager.py",
      "size": 25669,
      "lines": 562,
      "local_imports": [
        "core.logger",
        "core.config_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "json",
        "tkinter",
        "customtkinter"
      ]
    },
    "core.user_manager": {
      "path": "core\\user_manager.py",
      "size": 14899,
      "lines": 387,
      "local_imports": [
        "core.airtable_manager",
        "core.db_manager",
        "core.logger"
      ],
      "external_imports": [
        "hmac",
        "base64",
        "typing",
        "secrets",
        "datetime",
        "hashlib"
      ]
    },
    "utils.async_operations": {
      "path": "utils\\async_operations.py",
      "size": 736,
      "lines": 21,
      "local_imports": [],
      "external_imports": [
        "threading",
        "concurrent.futures"
      ]
    },
    "utils.error_handler": {
      "path": "utils\\error_handler.py",
      "size": 1884,
      "lines": 49,
      "local_imports": [
        "utils.window_manager"
      ],
      "external_imports": [
        "typing",
        "logging",
        "traceback",
        "tkinter",
        "functools"
      ]
    },
    "utils.image_utils": {
      "path": "utils\\image_utils.py",
      "size": 8538,
      "lines": 297,
      "local_imports": [],
      "external_imports": [
        "os",
        "PIL",
        "typing",
        "logging",
        "tkinter",
        "customtkinter",
        "sys"
      ]
    },
    "utils.login_visual_effects": {
      "path": "utils\\login_visual_effects.py",
      "size": 11479,
      "lines": 356,
      "local_imports": [],
      "external_imports": [
        "typing",
        "threading",
        "math",
        "customtkinter",
        "time"
      ]
    },
    "utils.threading_utils": {
      "path": "utils\\threading_utils.py",
      "size": 5475,
      "lines": 178,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "tkinter",
        "queue",
        "typing",
        "threading"
      ]
    },
    "utils.validators": {
      "path": "utils\\validators.py",
      "size": 12546,
      "lines": 405,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "re",
        "typing",
        "datetime",
        "string"
      ]
    },
    "utils.window_manager": {
      "path": "utils\\window_manager.py",
      "size": 48019,
      "lines": 1208,
      "local_imports": [],
      "external_imports": [
        "ctypes",
        "platform",
        "weakref",
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "views.add_edit_window": {
      "path": "views\\add_edit_window.py",
      "size": 35739,
      "lines": 861,
      "local_imports": [
        "core.theme_color_manager",
        "core.logger",
        "core.language_manager",
        "views.components.combobox",
        "utils.window_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "json",
        "tkcalendar",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "views.login_window": {
      "path": "views\\login_window.py",
      "size": 91114,
      "lines": 2369,
      "local_imports": [
        "core.constants",
        "core.theme_color_manager",
        "core.security.encryption",
        "utils.validators",
        "core.security.rate_limiter",
        "config.login_config",
        "core.logger",
        "core.theme_manager",
        "core.language_manager",
        "config.modern_color_palettes",
        "utils.window_manager"
      ],
      "external_imports": [
        "os",
        "ctypes",
        "platform",
        "re",
        "typing",
        "threading",
        "secrets",
        "json",
        "datetime",
        "string",
        "tkinter",
        "customtkinter",
        "time",
        "hashlib",
        "queue",
        "functools"
      ]
    },
    "views.main_window": {
      "path": "views\\main_window.py",
      "size": 55631,
      "lines": 1310,
      "local_imports": [
        "views.components.data_table",
        "core.theme_color_manager",
        "views.components.header",
        "utils.image_utils",
        "core.state_manager",
        "core.event_system",
        "core.permissions",
        "views.components.status_bar",
        "core.logger",
        "core.theme_manager",
        "core.language_manager",
        "views.components.toolbar",
        "views.components.menu_bar",
        "views.components.sidebar",
        "utils.async_operations",
        "utils.window_manager"
      ],
      "external_imports": [
        "os",
        "platform",
        "typing",
        "threading",
        "datetime",
        "weakref",
        "tkinter",
        "customtkinter",
        "functools"
      ]
    },
    "views.splash_screen": {
      "path": "views\\splash_screen.py",
      "size": 11100,
      "lines": 363,
      "local_imports": [],
      "external_imports": [
        "os",
        "PIL",
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "core.security.encryption": {
      "path": "core\\security\\encryption.py",
      "size": 6042,
      "lines": 210,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "os",
        "base64",
        "typing",
        "secrets",
        "json",
        "hashlib",
        "cryptography.fernet"
      ]
    },
    "core.security.rate_limiter": {
      "path": "core\\security\\rate_limiter.py",
      "size": 10258,
      "lines": 311,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "json",
        "collections",
        "time"
      ]
    },
    "core.security.two_factor_auth": {
      "path": "core\\security\\two_factor_auth.py",
      "size": 11664,
      "lines": 403,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "io",
        "pyotp",
        "base64",
        "typing",
        "secrets",
        "datetime",
        "json",
        "qrcode",
        "time",
        "hashlib"
      ]
    },
    "venv.Lib.site-packages.pip.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\__main__.py",
      "size": 854,
      "lines": 24,
      "local_imports": [],
      "external_imports": [
        "os",
        "pip._internal.cli.main",
        "sys"
      ]
    },
    "venv.Lib.site-packages.pip._internal.main": {
      "path": "venv\\Lib\\site-packages\\pip\\_internal\\main.py",
      "size": 340,
      "lines": 12,
      "local_imports": [],
      "external_imports": [
        "typing",
        "pip._internal.utils.entrypoints"
      ]
    },
    "venv.Lib.site-packages.pip._internal.cli.main": {
      "path": "venv\\Lib\\site-packages\\pip\\_internal\\cli\\main.py",
      "size": 2817,
      "lines": 80,
      "local_imports": [],
      "external_imports": [
        "os",
        "pip._internal.cli.autocompletion",
        "pip._internal.cli.main_parser",
        "pip._internal.exceptions",
        "typing",
        "pip._internal.utils",
        "logging",
        "warnings",
        "sys",
        "locale",
        "pip._internal.commands"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.certifi.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\certifi\\__main__.py",
      "size": 255,
      "lines": 12,
      "local_imports": [],
      "external_imports": [
        "pip._vendor.certifi",
        "argparse"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.distro.distro": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\distro\\distro.py",
      "size": 49430,
      "lines": 1403,
      "local_imports": [],
      "external_imports": [
        "os",
        "re",
        "typing",
        "json",
        "logging",
        "subprocess",
        "warnings",
        "argparse",
        "sys",
        "shlex",
        "functools"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.distro.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\distro\\__main__.py",
      "size": 64,
      "lines": 4,
      "local_imports": [
        "venv.Lib.site-packages.pip._vendor.distro.distro"
      ],
      "external_imports": []
    },
    "venv.Lib.site-packages.pip._vendor.platformdirs.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\platformdirs\\__main__.py",
      "size": 1505,
      "lines": 55,
      "local_imports": [],
      "external_imports": [
        "__future__",
        "pip._vendor.platformdirs"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.pygments.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\pygments\\__main__.py",
      "size": 353,
      "lines": 17,
      "local_imports": [],
      "external_imports": [
        "pip._vendor.pygments.cmdline",
        "sys"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.rich.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\rich\\__main__.py",
      "size": 8319,
      "lines": 273,
      "local_imports": [],
      "external_imports": [
        "pip._vendor.rich.markdown",
        "pip._vendor.rich.console",
        "io",
        "pip._vendor.rich.style",
        "pip._vendor.rich.pretty",
        "pip._vendor.rich.segment",
        "pip._vendor.rich.measure",
        "pip._vendor.rich",
        "pip._vendor.rich.panel",
        "pip._vendor.rich.color",
        "pip._vendor.rich.syntax",
        "pip._vendor.rich.text",
        "time",
        "colorsys",
        "pip._vendor.rich.table"
      ]
    },
    "views.components.autocomplete_entry": {
      "path": "views\\components\\autocomplete_entry.py",
      "size": 19262,
      "lines": 616,
      "local_imports": [],
      "external_imports": [
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "enum",
        "time",
        "random",
        "dataclasses"
      ]
    },
    "views.components.combobox": {
      "path": "views\\components\\combobox.py",
      "size": 70009,
      "lines": 1855,
      "local_imports": [],
      "external_imports": [
        "typing",
        "traceback",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "views.components.data_table": {
      "path": "views\\components\\data_table.py",
      "size": 20968,
      "lines": 614,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "datetime",
        "typing",
        "tkinter",
        "customtkinter"
      ]
    },
    "views.components.dropdown_dialogs": {
      "path": "views\\components\\dropdown_dialogs.py",
      "size": 54108,
      "lines": 1558,
      "local_imports": [
        "core.logger",
        "core.theme_manager",
        "core.config_manager",
        "core.language_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "datetime",
        "json",
        "tkinter",
        "customtkinter",
        "webbrowser"
      ]
    },
    "views.components.header": {
      "path": "views\\components\\header.py",
      "size": 28565,
      "lines": 867,
      "local_imports": [
        "views.components.dropdown_dialogs",
        "core.logger",
        "core.language_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "weakref",
        "datetime",
        "tkinter",
        "customtkinter",
        "sys",
        "webbrowser"
      ]
    },
    "views.components.menu_bar": {
      "path": "views\\components\\menu_bar.py",
      "size": 11466,
      "lines": 371,
      "local_imports": [
        "core.logger",
        "core.language_manager"
      ],
      "external_imports": [
        "typing",
        "tkinter"
      ]
    },
    "views.components.quick_test": {
      "path": "views\\components\\quick_test.py",
      "size": 2201,
      "lines": 84,
      "local_imports": [],
      "external_imports": [
        "enhanced_searchable_combobox",
        "customtkinter"
      ]
    },
    "views.components.searchable_combobox": {
      "path": "views\\components\\searchable_combobox.py",
      "size": 20729,
      "lines": 643,
      "local_imports": [],
      "external_imports": [
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "time",
        "random"
      ]
    },
    "views.components.sidebar": {
      "path": "views\\components\\sidebar.py",
      "size": 19652,
      "lines": 601,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "typing",
        "customtkinter"
      ]
    },
    "views.components.status_bar": {
      "path": "views\\components\\status_bar.py",
      "size": 20837,
      "lines": 600,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "datetime",
        "typing",
        "threading",
        "customtkinter"
      ]
    },
    "views.components.toolbar": {
      "path": "views\\components\\toolbar.py",
      "size": 18926,
      "lines": 520,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "typing",
        "customtkinter"
      ]
    }
  },
  "dependencies": {
    "app": [
      "core.user_manager",
      "core.config_manager",
      "core.airtable_manager",
      "views.splash_screen",
      "core.logger",
      "controllers.app_controller",
      "core.db_manager"
    ],
    "controllers.app_controller": [
      "utils.threading_utils",
      "core.user_manager",
      "views.main_window",
      "core.config_manager",
      "core.airtable_manager",
      "views.add_edit_window",
      "core.theme_manager",
      "core.logger",
      "views.login_window",
      "core.language_manager",
      "core.db_manager",
      "core.airtable_dropdown_manager"
    ],
    "core.airtable_dropdown_manager": [
      "core.airtable_manager"
    ],
    "core.app_state_manager": [
      "core.logger"
    ],
    "core.config_manager": [
      "core.logger"
    ],
    "core.db_manager": [
      "core.logger"
    ],
    "core.language_manager": [
      "core.logger",
      "core.config_manager"
    ],
    "core.permissions": [
      "core.logger"
    ],
    "core.session_manager": [
      "core.security.encryption",
      "core.logger"
    ],
    "core.theme_color_manager": [
      "config.modern_color_palettes",
      "core.logger"
    ],
    "core.theme_manager": [
      "core.logger",
      "core.config_manager"
    ],
    "core.user_manager": [
      "core.airtable_manager",
      "core.db_manager",
      "core.logger"
    ],
    "utils.error_handler": [
      "utils.window_manager"
    ],
    "utils.threading_utils": [
      "core.logger"
    ],
    "utils.validators": [
      "core.logger"
    ],
    "views.add_edit_window": [
      "core.theme_color_manager",
      "core.logger",
      "core.language_manager",
      "views.components.combobox",
      "utils.window_manager"
    ],
    "views.login_window": [
      "core.constants",
      "core.theme_color_manager",
      "core.security.encryption",
      "utils.validators",
      "config.login_config",
      "config.modern_color_palettes",
      "core.logger",
      "core.theme_manager",
      "core.language_manager",
      "core.security.rate_limiter",
      "utils.window_manager"
    ],
    "views.main_window": [
      "views.components.data_table",
      "core.theme_color_manager",
      "utils.window_manager",
      "utils.image_utils",
      "core.state_manager",
      "core.event_system",
      "core.permissions",
      "views.components.status_bar",
      "core.logger",
      "core.theme_manager",
      "core.language_manager",
      "views.components.toolbar",
      "views.components.menu_bar",
      "views.components.sidebar",
      "utils.async_operations",
      "views.components.header"
    ],
    "core.security.encryption": [
      "core.logger"
    ],
    "core.security.rate_limiter": [
      "core.logger"
    ],
    "core.security.two_factor_auth": [
      "core.logger"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.__main__": [
      "venv.Lib.site-packages.pip._vendor.distro.distro"
    ],
    "views.components.data_table": [
      "core.language_manager"
    ],
    "views.components.dropdown_dialogs": [
      "core.theme_manager",
      "core.logger",
      "core.config_manager",
      "core.language_manager"
    ],
    "views.components.header": [
      "views.components.dropdown_dialogs",
      "core.logger",
      "core.language_manager"
    ],
    "views.components.menu_bar": [
      "core.logger",
      "core.language_manager"
    ],
    "views.components.sidebar": [
      "core.language_manager"
    ],
    "views.components.status_bar": [
      "core.language_manager"
    ],
    "views.components.toolbar": [
      "core.language_manager"
    ]
  },
  "reverse_dependencies": {
    "core.user_manager": [
      "app",
      "controllers.app_controller"
    ],
    "core.config_manager": [
      "app",
      "views.components.dropdown_dialogs",
      "core.theme_manager",
      "controllers.app_controller",
      "core.language_manager"
    ],
    "core.airtable_manager": [
      "app",
      "core.user_manager",
      "core.airtable_dropdown_manager",
      "controllers.app_controller"
    ],
    "views.splash_screen": [
      "app"
    ],
    "core.logger": [
      "utils.threading_utils",
      "core.user_manager",
      "core.theme_color_manager",
      "app",
      "core.config_manager",
      "views.add_edit_window",
      "core.permissions",
      "core.security.two_factor_auth",
      "core.language_manager",
      "core.security.rate_limiter",
      "core.db_manager",
      "views.components.dropdown_dialogs",
      "utils.validators",
      "core.app_state_manager",
      "views.components.header",
      "core.security.encryption",
      "views.components.menu_bar",
      "controllers.app_controller",
      "views.login_window",
      "views.main_window",
      "core.theme_manager",
      "core.session_manager"
    ],
    "controllers.app_controller": [
      "app"
    ],
    "core.db_manager": [
      "app",
      "core.user_manager",
      "controllers.app_controller"
    ],
    "utils.threading_utils": [
      "controllers.app_controller"
    ],
    "views.login_window": [
      "controllers.app_controller"
    ],
    "views.main_window": [
      "controllers.app_controller"
    ],
    "views.add_edit_window": [
      "controllers.app_controller"
    ],
    "core.theme_manager": [
      "views.components.dropdown_dialogs",
      "views.main_window",
      "controllers.app_controller",
      "views.login_window"
    ],
    "core.language_manager": [
      "views.components.data_table",
      "views.components.dropdown_dialogs",
      "views.main_window",
      "views.add_edit_window",
      "views.components.menu_bar",
      "views.components.status_bar",
      "controllers.app_controller",
      "views.login_window",
      "views.components.toolbar",
      "views.components.sidebar",
      "views.components.header"
    ],
    "core.airtable_dropdown_manager": [
      "controllers.app_controller"
    ],
    "core.security.encryption": [
      "views.login_window",
      "core.session_manager"
    ],
    "config.modern_color_palettes": [
      "core.theme_color_manager",
      "views.login_window"
    ],
    "utils.window_manager": [
      "views.add_edit_window",
      "utils.error_handler",
      "views.main_window",
      "views.login_window"
    ],
    "core.theme_color_manager": [
      "views.add_edit_window",
      "views.main_window",
      "views.login_window"
    ],
    "views.components.combobox": [
      "views.add_edit_window"
    ],
    "core.constants": [
      "views.login_window"
    ],
    "utils.validators": [
      "views.login_window"
    ],
    "core.security.rate_limiter": [
      "views.login_window"
    ],
    "config.login_config": [
      "views.login_window"
    ],
    "views.components.data_table": [
      "views.main_window"
    ],
    "views.components.header": [
      "views.main_window"
    ],
    "utils.image_utils": [
      "views.main_window"
    ],
    "core.state_manager": [
      "views.main_window"
    ],
    "core.event_system": [
      "views.main_window"
    ],
    "core.permissions": [
      "views.main_window"
    ],
    "views.components.status_bar": [
      "views.main_window"
    ],
    "views.components.toolbar": [
      "views.main_window"
    ],
    "views.components.menu_bar": [
      "views.main_window"
    ],
    "views.components.sidebar": [
      "views.main_window"
    ],
    "utils.async_operations": [
      "views.main_window"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.distro": [
      "venv.Lib.site-packages.pip._vendor.distro.__main__"
    ],
    "views.components.dropdown_dialogs": [
      "views.components.header"
    ]
  },
  "external_imports": {
    "app": [
      "os",
      "warnings",
      "traceback",
      "tkinter",
      "sys",
      "faulthandler"
    ],
    "project_analyzer": [
      "os",
      "ast",
      "re",
      "pathlib",
      "typing",
      "json",
      "collections",
      "argparse"
    ],
    "config.login_config": [],
    "config.modern_color_palettes": [],
    "controllers.app_controller": [
      "typing",
      "threading",
      "datetime",
      "json",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "core.airtable_dropdown_manager": [
      "os",
      "typing",
      "threading",
      "datetime",
      "json",
      "logging",
      "time",
      "concurrent.futures"
    ],
    "core.airtable_manager": [
      "os",
      "re",
      "typing",
      "threading",
      "datetime",
      "json",
      "requests",
      "logging",
      "time",
      "concurrent.futures"
    ],
    "core.app_state_manager": [
      "typing",
      "threading",
      "datetime",
      "enum",
      "time"
    ],
    "core.config_manager": [
      "os",
      "dotenv",
      "typing",
      "yaml"
    ],
    "core.constants": [
      "typing",
      "enum"
    ],
    "core.db_manager": [
      "sqlite3",
      "typing",
      "threading"
    ],
    "core.event_system": [
      "queue",
      "typing",
      "threading",
      "datetime"
    ],
    "core.language_manager": [
      "os",
      "typing",
      "yaml"
    ],
    "core.logger": [
      "os",
      "logging",
      "logging.handlers"
    ],
    "core.permissions": [
      "typing",
      "tkinter",
      "functools"
    ],
    "core.session_manager": [
      "os",
      "typing",
      "threading",
      "datetime",
      "secrets",
      "json",
      "time"
    ],
    "core.state_manager": [
      "dataclasses",
      "typing",
      "threading",
      "datetime"
    ],
    "core.theme_color_manager": [
      "typing",
      "customtkinter"
    ],
    "core.theme_manager": [
      "os",
      "typing",
      "json",
      "tkinter",
      "customtkinter"
    ],
    "core.user_manager": [
      "hmac",
      "base64",
      "typing",
      "secrets",
      "datetime",
      "hashlib"
    ],
    "utils.async_operations": [
      "threading",
      "concurrent.futures"
    ],
    "utils.error_handler": [
      "typing",
      "logging",
      "traceback",
      "tkinter",
      "functools"
    ],
    "utils.image_utils": [
      "os",
      "PIL",
      "typing",
      "logging",
      "tkinter",
      "customtkinter",
      "sys"
    ],
    "utils.login_visual_effects": [
      "typing",
      "threading",
      "math",
      "customtkinter",
      "time"
    ],
    "utils.threading_utils": [
      "tkinter",
      "queue",
      "typing",
      "threading"
    ],
    "utils.validators": [
      "re",
      "typing",
      "datetime",
      "string"
    ],
    "utils.window_manager": [
      "ctypes",
      "platform",
      "weakref",
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "views.add_edit_window": [
      "os",
      "typing",
      "threading",
      "datetime",
      "json",
      "tkcalendar",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "views.login_window": [
      "os",
      "ctypes",
      "platform",
      "re",
      "typing",
      "threading",
      "secrets",
      "json",
      "datetime",
      "string",
      "tkinter",
      "customtkinter",
      "time",
      "hashlib",
      "queue",
      "functools"
    ],
    "views.main_window": [
      "os",
      "platform",
      "typing",
      "threading",
      "datetime",
      "weakref",
      "tkinter",
      "customtkinter",
      "functools"
    ],
    "views.splash_screen": [
      "os",
      "PIL",
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "core.security.encryption": [
      "os",
      "base64",
      "typing",
      "secrets",
      "json",
      "hashlib",
      "cryptography.fernet"
    ],
    "core.security.rate_limiter": [
      "os",
      "typing",
      "threading",
      "datetime",
      "json",
      "collections",
      "time"
    ],
    "core.security.two_factor_auth": [
      "io",
      "pyotp",
      "base64",
      "typing",
      "secrets",
      "datetime",
      "json",
      "qrcode",
      "time",
      "hashlib"
    ],
    "venv.Lib.site-packages.pip.__main__": [
      "os",
      "pip._internal.cli.main",
      "sys"
    ],
    "venv.Lib.site-packages.pip._internal.main": [
      "typing",
      "pip._internal.utils.entrypoints"
    ],
    "venv.Lib.site-packages.pip._internal.cli.main": [
      "os",
      "pip._internal.cli.autocompletion",
      "pip._internal.cli.main_parser",
      "pip._internal.exceptions",
      "typing",
      "pip._internal.utils",
      "logging",
      "warnings",
      "sys",
      "locale",
      "pip._internal.commands"
    ],
    "venv.Lib.site-packages.pip._vendor.certifi.__main__": [
      "pip._vendor.certifi",
      "argparse"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.distro": [
      "os",
      "re",
      "typing",
      "json",
      "logging",
      "subprocess",
      "warnings",
      "argparse",
      "sys",
      "shlex",
      "functools"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.__main__": [],
    "venv.Lib.site-packages.pip._vendor.platformdirs.__main__": [
      "__future__",
      "pip._vendor.platformdirs"
    ],
    "venv.Lib.site-packages.pip._vendor.pygments.__main__": [
      "pip._vendor.pygments.cmdline",
      "sys"
    ],
    "venv.Lib.site-packages.pip._vendor.rich.__main__": [
      "pip._vendor.rich.markdown",
      "pip._vendor.rich.console",
      "io",
      "pip._vendor.rich.style",
      "pip._vendor.rich.pretty",
      "pip._vendor.rich.segment",
      "pip._vendor.rich.measure",
      "pip._vendor.rich",
      "pip._vendor.rich.panel",
      "pip._vendor.rich.color",
      "pip._vendor.rich.syntax",
      "pip._vendor.rich.text",
      "time",
      "colorsys",
      "pip._vendor.rich.table"
    ],
    "views.components.autocomplete_entry": [
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "enum",
      "time",
      "random",
      "dataclasses"
    ],
    "views.components.combobox": [
      "typing",
      "traceback",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "views.components.data_table": [
      "datetime",
      "typing",
      "tkinter",
      "customtkinter"
    ],
    "views.components.dropdown_dialogs": [
      "os",
      "typing",
      "datetime",
      "json",
      "tkinter",
      "customtkinter",
      "webbrowser"
    ],
    "views.components.header": [
      "os",
      "typing",
      "weakref",
      "datetime",
      "tkinter",
      "customtkinter",
      "sys",
      "webbrowser"
    ],
    "views.components.menu_bar": [
      "typing",
      "tkinter"
    ],
    "views.components.quick_test": [
      "enhanced_searchable_combobox",
      "customtkinter"
    ],
    "views.components.searchable_combobox": [
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "time",
      "random"
    ],
    "views.components.sidebar": [
      "typing",
      "customtkinter"
    ],
    "views.components.status_bar": [
      "datetime",
      "typing",
      "threading",
      "customtkinter"
    ],
    "views.components.toolbar": [
      "typing",
      "customtkinter"
    ]
  },
  "statistics": {
    "total_files": 54,
    "total_lines": 25382,
    "total_size": 915166,
    "circular_dependencies": [],
    "most_imported": [
      [
        "core.logger",
        22
      ],
      [
        "core.language_manager",
        11
      ],
      [
        "core.config_manager",
        5
      ],
      [
        "core.airtable_manager",
        4
      ],
      [
        "core.theme_manager",
        4
      ],
      [
        "utils.window_manager",
        4
      ],
      [
        "core.db_manager",
        3
      ],
      [
        "core.theme_color_manager",
        3
      ],
      [
        "core.user_manager",
        2
      ],
      [
        "core.security.encryption",
        2
      ]
    ],
    "most_importing": [
      [
        "views.main_window",
        16
      ],
      [
        "controllers.app_controller",
        12
      ],
      [
        "views.login_window",
        11
      ],
      [
        "app",
        7
      ],
      [
        "views.add_edit_window",
        5
      ],
      [
        "views.components.dropdown_dialogs",
        4
      ],
      [
        "core.user_manager",
        3
      ],
      [
        "views.components.header",
        3
      ],
      [
        "core.language_manager",
        2
      ],
      [
        "core.session_manager",
        2
      ]
    ]
  }
}

============================================================
FILE: project_analysis.txt
SIZE: 3750 characters
============================================================

============================================================
üìä ÿ™ŸÇÿ±Ÿäÿ± ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
============================================================

üìà ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©:
  ‚Ä¢ ÿπÿØÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™: 54
  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ≥ÿ∑ÿ±: 25,382
  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≠ÿ¨ŸÖ: 915,166 ÿ≠ÿ±ŸÅ

üîó ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã:
  ‚Ä¢ core.logger: 22 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.language_manager: 11 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.config_manager: 5 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.airtable_manager: 4 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.theme_manager: 4 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ utils.window_manager: 4 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.db_manager: 3 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.theme_color_manager: 3 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.user_manager: 2 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.security.encryption: 2 ÿßÿ≥ÿ™ÿØÿπÿßÿ°

üì§ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™:
  ‚Ä¢ views.main_window: Ÿäÿ≥ÿ™ÿØÿπŸä 16 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ controllers.app_controller: Ÿäÿ≥ÿ™ÿØÿπŸä 12 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.login_window: Ÿäÿ≥ÿ™ÿØÿπŸä 11 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ app: Ÿäÿ≥ÿ™ÿØÿπŸä 7 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.add_edit_window: Ÿäÿ≥ÿ™ÿØÿπŸä 5 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.components.dropdown_dialogs: Ÿäÿ≥ÿ™ÿØÿπŸä 4 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ core.user_manager: Ÿäÿ≥ÿ™ÿØÿπŸä 3 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.components.header: Ÿäÿ≥ÿ™ÿØÿπŸä 3 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ core.language_manager: Ÿäÿ≥ÿ™ÿØÿπŸä 2 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ core.session_manager: Ÿäÿ≥ÿ™ÿØÿπŸä 2 Ÿàÿ≠ÿØÿ©

‚úÖ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©

üå≥ ÿ¥ÿ¨ÿ±ÿ© ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä (app):
‚îú‚îÄ‚îÄ app
  ‚îú‚îÄ‚îÄ controllers.app_controller
    ‚îú‚îÄ‚îÄ controllers.app_controller
      ‚îú‚îÄ‚îÄ core.airtable_dropdown_manager
        ‚îú‚îÄ‚îÄ core.airtable_dropdown_manager
          ‚îî‚îÄ‚îÄ core.airtable_manager
      ‚îú‚îÄ‚îÄ core.airtable_manager
      ‚îú‚îÄ‚îÄ core.config_manager
        ‚îú‚îÄ‚îÄ core.config_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.db_manager
        ‚îú‚îÄ‚îÄ core.db_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.language_manager
        ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.config_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.theme_manager
        ‚îú‚îÄ‚îÄ core.theme_manager
          ‚îú‚îÄ‚îÄ core.config_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.user_manager
        ‚îú‚îÄ‚îÄ core.user_manager
          ‚îú‚îÄ‚îÄ core.airtable_manager
          ‚îú‚îÄ‚îÄ core.db_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ utils.threading_utils
        ‚îú‚îÄ‚îÄ utils.threading_utils
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ views.add_edit_window
        ‚îú‚îÄ‚îÄ views.add_edit_window
          ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.logger
          ‚îú‚îÄ‚îÄ core.theme_color_manager
          ‚îú‚îÄ‚îÄ utils.window_manager
          ‚îî‚îÄ‚îÄ views.components.combobox
      ‚îú‚îÄ‚îÄ views.login_window
        ‚îú‚îÄ‚îÄ views.login_window
          ‚îú‚îÄ‚îÄ config.login_config
          ‚îú‚îÄ‚îÄ config.modern_color_palettes
          ‚îú‚îÄ‚îÄ core.constants
          ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.logger
          ‚îú‚îÄ‚îÄ core.security.encryption
          ‚îú‚îÄ‚îÄ core.security.rate_limiter
          ‚îú‚îÄ‚îÄ core.theme_color_manager
          ‚îú‚îÄ‚îÄ core.theme_manager
          ‚îú‚îÄ‚îÄ utils.validators
          ‚îî‚îÄ‚îÄ utils.window_manager
      ‚îî‚îÄ‚îÄ views.main_window
        ‚îú‚îÄ‚îÄ views.main_window
          ‚îú‚îÄ‚îÄ core.event_system
          ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.logger
          ‚îú‚îÄ‚îÄ core.permissions
          ‚îú‚îÄ‚îÄ core.state_manager
          ‚îú‚îÄ‚îÄ core.theme_color_manager
          ‚îú‚îÄ‚îÄ core.theme_manager
          ‚îú‚îÄ‚îÄ utils.async_operations
          ‚îú‚îÄ‚îÄ utils.image_utils
          ‚îú‚îÄ‚îÄ utils.window_manager
          ‚îú‚îÄ‚îÄ views.components.data_table
          ‚îú‚îÄ‚îÄ views.components.header
          ‚îú‚îÄ‚îÄ views.components.menu_bar
          ‚îú‚îÄ‚îÄ views.components.sidebar
          ‚îú‚îÄ‚îÄ views.components.status_bar
          ‚îî‚îÄ‚îÄ views.components.toolbar
  ‚îú‚îÄ‚îÄ core.airtable_manager
  ‚îú‚îÄ‚îÄ core.config_manager
    ‚îú‚îÄ‚îÄ core.config_manager
      ‚îî‚îÄ‚îÄ core.logger
  ‚îú‚îÄ‚îÄ core.db_manager
    ‚îú‚îÄ‚îÄ core.db_manager
      ‚îî‚îÄ‚îÄ core.logger
  ‚îú‚îÄ‚îÄ core.logger
  ‚îú‚îÄ‚îÄ core.user_manager
    ‚îú‚îÄ‚îÄ core.user_manager
      ‚îú‚îÄ‚îÄ core.airtable_manager
      ‚îú‚îÄ‚îÄ core.db_manager
        ‚îú‚îÄ‚îÄ core.db_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îî‚îÄ‚îÄ core.logger
  ‚îî‚îÄ‚îÄ views.splash_screen


============================================================
FILE: project_analyzer.py
SIZE: 15466 characters
============================================================

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Project File Dependency Analyzer
Ÿäÿ≠ŸÑŸÑ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸàŸäÿ±ÿ≥ŸÖ ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ŸàÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™
"""

import os
import ast
import json
import re
from pathlib import Path
from typing import Dict, List, Set, Tuple
from collections import defaultdict, deque
import argparse


class ProjectAnalyzer:
    def __init__(self, project_root: str):
        self.project_root = Path(project_root)
        self.files_info = {}
        self.dependencies = defaultdict(set)
        self.reverse_dependencies = defaultdict(set)
        self.external_imports = defaultdict(set)

    def find_python_files(self) -> List[Path]:
        """ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ Python ŸÅŸä ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ"""
        python_files = []
        for file_path in self.project_root.rglob("*.py"):
            if not any(part.startswith('.') for part in file_path.parts):
                python_files.append(file_path)
        return python_files

    def get_relative_module_name(self, file_path: Path) -> str:
        """ÿ™ÿ≠ŸàŸäŸÑ ŸÖÿ≥ÿßÿ± ÿßŸÑŸÖŸÑŸÅ ÿ•ŸÑŸâ ÿßÿ≥ŸÖ Ÿàÿ≠ÿØÿ© ŸÜÿ≥ÿ®Ÿä"""
        relative_path = file_path.relative_to(self.project_root)
        module_parts = list(relative_path.parts[:-1])  # ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™
        filename = relative_path.stem

        if filename != "__init__":
            module_parts.append(filename)

        return ".".join(module_parts) if module_parts else filename

    def parse_imports(self, file_content: str, current_module: str) -> Tuple[Set[str], Set[str]]:
        """ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ŸÖŸÜ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÑŸÅ"""
        local_imports = set()
        external_imports = set()

        try:
            tree = ast.parse(file_content)

            for node in ast.walk(tree):
                if isinstance(node, ast.Import):
                    for alias in node.names:
                        module_name = alias.name
                        if self.is_local_import(module_name):
                            local_imports.add(module_name)
                        else:
                            external_imports.add(module_name)

                elif isinstance(node, ast.ImportFrom):
                    if node.module:
                        module_name = node.module
                        if node.level > 0:  # relative import
                            # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ÿßŸÑŸÜÿ≥ÿ®Ÿäÿ©
                            resolved_module = self.resolve_relative_import(
                                current_module, module_name, node.level
                            )
                            if resolved_module:
                                local_imports.add(resolved_module)
                        else:
                            if self.is_local_import(module_name):
                                local_imports.add(module_name)
                            else:
                                external_imports.add(module_name)

        except SyntaxError as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅ {current_module}: {e}")

        return local_imports, external_imports

    def is_local_import(self, module_name: str) -> bool:
        """ÿ™ÿ≠ÿØŸäÿØ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ° ŸÖÿ≠ŸÑŸä ÿ£ŸÖ ÿÆÿßÿ±ÿ¨Ÿä"""
        # ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©
        external_modules = {
            'os', 'sys', 'json', 'ast', 're', 'pathlib', 'typing',
            'collections', 'datetime', 'time', 'logging', 'sqlite3',
            'tkinter', 'threading', 'asyncio', 'urllib', 'http',
            'pandas', 'numpy', 'matplotlib', 'seaborn', 'requests',
            'flask', 'django', 'fastapi', 'aiohttp', 'sqlalchemy',
            'pytest', 'unittest', 'mock', 'cryptography', 'PIL',
            'cv2', 'tensorflow', 'torch', 'sklearn', 'scipy'
        }

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ¨ÿ∞ÿ± ÿßŸÑÿ£ŸàŸÑ ŸÑŸÑŸàÿ≠ÿØÿ©
        root_module = module_name.split('.')[0]

        # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ©
        if root_module in external_modules:
            return False

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖŸÑŸÅ ŸÅŸä ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
        possible_paths = [
            self.project_root / f"{module_name.replace('.', '/')}.py",
            self.project_root / f"{module_name.replace('.', '/')}/__init__.py"
        ]

        return any(path.exists() for path in possible_paths)

    def resolve_relative_import(self, current_module: str, import_module: str, level: int) -> str:
        """ÿ≠ŸÑ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ÿßŸÑŸÜÿ≥ÿ®Ÿäÿ©"""
        if not current_module:
            return None

        current_parts = current_module.split('.')

        # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑
        for _ in range(level):
            if current_parts:
                current_parts.pop()

        if import_module:
            return '.'.join(current_parts + [import_module])
        else:
            return '.'.join(current_parts) if current_parts else None

    def analyze_file(self, file_path: Path):
        """ÿ™ÿ≠ŸÑŸäŸÑ ŸÖŸÑŸÅ Ÿàÿßÿ≠ÿØ"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()

            module_name = self.get_relative_module_name(file_path)
            local_imports, external_imports = self.parse_imports(content, module_name)

            # ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÑŸÅ
            self.files_info[module_name] = {
                'path': str(file_path),
                'size': len(content),
                'lines': len(content.splitlines()),
                'local_imports': list(local_imports),
                'external_imports': list(external_imports)
            }

            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™
            for imported_module in local_imports:
                self.dependencies[module_name].add(imported_module)
                self.reverse_dependencies[imported_module].add(module_name)

            self.external_imports[module_name] = external_imports

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅ {file_path}: {e}")

    def analyze_project(self):
        """ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÉÿßŸÖŸÑÿßŸã"""
        print("üîç ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÑŸÅÿßÿ™ Python...")
        python_files = self.find_python_files()
        print(f"ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ {len(python_files)} ŸÖŸÑŸÅ Python")

        print("üìñ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™...")
        for file_path in python_files:
            self.analyze_file(file_path)

        print(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ {len(self.files_info)} ŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠")

    def generate_dependency_tree(self, module: str, visited: Set[str] = None, depth: int = 0) -> str:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ŸÑŸàÿ≠ÿØÿ© ŸÖÿπŸäŸÜÿ©"""
        if visited is None:
            visited = set()

        if module in visited:
            return "  " * depth + f"‚îú‚îÄ‚îÄ {module} (ÿØÿßÿ¶ÿ±Ÿä)\n"

        visited.add(module)
        tree = "  " * depth + f"‚îú‚îÄ‚îÄ {module}\n"

        if module in self.dependencies:
            deps = sorted(self.dependencies[module])
            for i, dep in enumerate(deps):
                if i == len(deps) - 1:
                    tree += "  " * (depth + 1) + f"‚îî‚îÄ‚îÄ {dep}\n"
                else:
                    tree += "  " * (depth + 1) + f"‚îú‚îÄ‚îÄ {dep}\n"

                if dep in self.dependencies and depth < 3:  # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπŸÖŸÇ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿπŸÇŸäÿØ
                    tree += self.generate_dependency_tree(dep, visited.copy(), depth + 2)

        return tree

    def find_circular_dependencies(self) -> List[List[str]]:
        """ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑÿØÿßÿ¶ÿ±Ÿäÿ©"""
        circles = []
        visited = set()

        def dfs(node, path, rec_stack):
            if node in rec_stack:
                # Ÿàÿ¨ÿØŸÜÿß ÿØÿßÿ¶ÿ±ÿ©
                circle_start = path.index(node)
                circle = path[circle_start:] + [node]
                circles.append(circle)
                return

            if node in visited:
                return

            visited.add(node)
            rec_stack.add(node)
            path.append(node)

            for neighbor in self.dependencies.get(node, []):
                dfs(neighbor, path, rec_stack)

            path.pop()
            rec_stack.remove(node)

        for module in self.files_info:
            if module not in visited:
                dfs(module, [], set())

        return circles

    def get_most_imported_modules(self, top_n: int = 10) -> List[Tuple[str, int]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã"""
        import_counts = {}
        for module, deps in self.reverse_dependencies.items():
            import_counts[module] = len(deps)

        return sorted(import_counts.items(), key=lambda x: x[1], reverse=True)[:top_n]

    def get_most_importing_modules(self, top_n: int = 10) -> List[Tuple[str, int]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™ ÿ£ÿÆÿ±Ÿâ"""
        import_counts = {}
        for module, deps in self.dependencies.items():
            import_counts[module] = len(deps)

        return sorted(import_counts.items(), key=lambda x: x[1], reverse=True)[:top_n]

    def generate_report(self) -> str:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÇÿ±Ÿäÿ± ÿ¥ÿßŸÖŸÑ"""
        report = []
        report.append("=" * 60)
        report.append("üìä ÿ™ŸÇÿ±Ÿäÿ± ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ")
        report.append("=" * 60)
        report.append("")

        # ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿπÿßŸÖÿ©
        report.append("üìà ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©:")
        report.append(f"  ‚Ä¢ ÿπÿØÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™: {len(self.files_info)}")
        total_lines = sum(info['lines'] for info in self.files_info.values())
        report.append(f"  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ≥ÿ∑ÿ±: {total_lines:,}")
        total_size = sum(info['size'] for info in self.files_info.values())
        report.append(f"  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≠ÿ¨ŸÖ: {total_size:,} ÿ≠ÿ±ŸÅ")
        report.append("")

        # ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã
        report.append("üîó ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã:")
        most_imported = self.get_most_imported_modules()
        for module, count in most_imported:
            report.append(f"  ‚Ä¢ {module}: {count} ÿßÿ≥ÿ™ÿØÿπÿßÿ°")
        report.append("")

        # ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™
        report.append("üì§ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™:")
        most_importing = self.get_most_importing_modules()
        for module, count in most_importing:
            report.append(f"  ‚Ä¢ {module}: Ÿäÿ≥ÿ™ÿØÿπŸä {count} Ÿàÿ≠ÿØÿ©")
        report.append("")

        # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑÿØÿßÿ¶ÿ±Ÿäÿ©
        circles = self.find_circular_dependencies()
        if circles:
            report.append("‚ö†Ô∏è  ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ© ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸäŸáÿß:")
            for i, circle in enumerate(circles, 1):
                report.append(f"  {i}. {' ‚Üí '.join(circle)}")
        else:
            report.append("‚úÖ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©")
        report.append("")

        # ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ŸÑŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        if "app" in self.files_info:
            report.append("üå≥ ÿ¥ÿ¨ÿ±ÿ© ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä (app):")
            report.append(self.generate_dependency_tree("app"))

        return "\n".join(report)

    def save_detailed_analysis(self, output_file: str = "project_analysis.json"):
        """ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÅÿµŸÑ ŸÅŸä ŸÖŸÑŸÅ JSON"""
        analysis_data = {
            "files": self.files_info,
            "dependencies": {k: list(v) for k, v in self.dependencies.items()},
            "reverse_dependencies": {k: list(v) for k, v in self.reverse_dependencies.items()},
            "external_imports": {k: list(v) for k, v in self.external_imports.items()},
            "statistics": {
                "total_files": len(self.files_info),
                "total_lines": sum(info['lines'] for info in self.files_info.values()),
                "total_size": sum(info['size'] for info in self.files_info.values()),
                "circular_dependencies": self.find_circular_dependencies(),
                "most_imported": self.get_most_imported_modules(),
                "most_importing": self.get_most_importing_modules()
            }
        }

        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(analysis_data, f, ensure_ascii=False, indent=2)

        print(f"üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÅÿµŸÑ ŸÅŸä: {output_file}")

    def generate_graphviz_dot(self, output_file: str = "dependency_graph.dot"):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz ŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ¥ÿ¨ÿ±ÿ© ÿ®ÿµÿ±ŸäÿßŸã"""
        dot_content = ["digraph ProjectDependencies {"]
        dot_content.append("  rankdir=TB;")
        dot_content.append("  node [shape=box, style=filled, fillcolor=lightblue];")
        dot_content.append("")

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÇÿØ
        for module in self.files_info:
            # ÿ™ŸÜÿ≥ŸäŸÇ ÿßÿ≥ŸÖ ÿßŸÑÿπŸÇÿØÿ©
            clean_name = module.replace(".", "_")
            display_name = module.split(".")[-1] if "." in module else module

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÑŸàŸÜ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÜŸàÿπ ÿßŸÑŸÖŸÑŸÅ
            if "controller" in module:
                color = "lightcoral"
            elif "view" in module:
                color = "lightgreen"
            elif "core" in module:
                color = "lightyellow"
            elif "util" in module:
                color = "lightgray"
            else:
                color = "lightblue"

            dot_content.append(f'  {clean_name} [label="{display_name}", fillcolor={color}];')

        dot_content.append("")

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑÿßÿ™
        for module, deps in self.dependencies.items():
            clean_module = module.replace(".", "_")
            for dep in deps:
                clean_dep = dep.replace(".", "_")
                dot_content.append(f"  {clean_module} -> {clean_dep};")

        dot_content.append("}")

        with open(output_file, 'w', encoding='utf-8') as f:
            f.write("\n".join(dot_content))

        print(f"üìä ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz: {output_file}")
        print("ŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ¥ÿ¨ÿ±ÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ£ŸÖÿ±: dot -Tpng dependency_graph.dot -o dependency_graph.png")


def main():
    parser = argparse.ArgumentParser(description="ÿ™ÿ≠ŸÑŸäŸÑ ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ")
    parser.add_argument("project_path", nargs="?", default=".",
                       help="ŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ (ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä: ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ≠ÿßŸÑŸä)")
    parser.add_argument("--output", "-o", default="project_analysis",
                       help="ÿßÿ≥ŸÖ ŸÖŸÑŸÅ ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ (ÿ®ÿØŸàŸÜ ÿßŸÖÿ™ÿØÿßÿØ)")
    parser.add_argument("--graphviz", action="store_true",
                       help="ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz ŸÑŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ÿµÿ±Ÿä")

    args = parser.parse_args()

    # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    if not os.path.exists(args.project_path):
        print(f"‚ùå ÿßŸÑŸÖÿ≥ÿßÿ± ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ: {args.project_path}")
        return

    print(f"üöÄ ÿ®ÿØÿ° ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÅŸä: {os.path.abspath(args.project_path)}")
    print("-" * 50)

    # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≠ŸÑŸÑ
    analyzer = ProjectAnalyzer(args.project_path)

    # ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    analyzer.analyze_project()

    # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±
    report = analyzer.generate_report()
    print(report)

    # ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÅÿµŸÑ
    json_file = f"{args.output}.json"
    analyzer.save_detailed_analysis(json_file)

    # ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÜÿµŸä
    txt_file = f"{args.output}.txt"
    with open(txt_file, 'w', encoding='utf-8') as f:
        f.write(report)
    print(f"üìÑ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ŸÅŸä: {txt_file}")

    # ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz ÿ•ÿ∞ÿß ÿ∑ŸèŸÑÿ®
    if args.graphviz:
        dot_file = f"{args.output}.dot"
        analyzer.generate_graphviz_dot(dot_file)


if __name__ == "__main__":
    main()


============================================================
FILE: project_export_20250703_042857.txt
SIZE: 67932 characters
============================================================

================================================================================
PROJECT STRUCTURE
================================================================================

PROJECT_ROOT/
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ export_project_improved.py
‚îú‚îÄ‚îÄ fts_sales_cache.db
‚îú‚îÄ‚îÄ project_analysis.json
‚îú‚îÄ‚îÄ project_analysis.txt
‚îú‚îÄ‚îÄ project_analyzer.py
‚îú‚îÄ‚îÄ project_export_20250703_042857.txt
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îî‚îÄ‚îÄ dropdown_cache.json
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ login_config.py
‚îÇ   ‚îú‚îÄ‚îÄ modern_color_palettes.py
‚îÇ   ‚îî‚îÄ‚îÄ settings.yaml
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ app_controller.py
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ airtable_dropdown_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ airtable_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ app_state_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ config_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ constants.py
‚îÇ   ‚îú‚îÄ‚îÄ db_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ event_system.py
‚îÇ   ‚îú‚îÄ‚îÄ language_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îú‚îÄ‚îÄ permissions.py
‚îÇ   ‚îú‚îÄ‚îÄ session_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ state_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ theme_color_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ theme_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ user_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ core/security/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ encryption.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate_limiter.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ two_factor_auth.py
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ login_cache.json
‚îú‚îÄ‚îÄ drafts/
‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îú‚îÄ‚îÄ ar.yaml
‚îÇ   ‚îî‚îÄ‚îÄ en.yaml
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ app.log
‚îÇ   ‚îú‚îÄ‚îÄ logs/logs/
‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îú‚îÄ‚îÄ company_logo.png
‚îÇ   ‚îî‚îÄ‚îÄ fts_icon.ico
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ async_operations.py
‚îÇ   ‚îú‚îÄ‚îÄ error_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ image_utils.py
‚îÇ   ‚îú‚îÄ‚îÄ login_visual_effects.py
‚îÇ   ‚îú‚îÄ‚îÄ threading_utils.py
‚îÇ   ‚îú‚îÄ‚îÄ validators.py
‚îÇ   ‚îî‚îÄ‚îÄ window_manager.py
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ add_edit_window.py
‚îÇ   ‚îú‚îÄ‚îÄ login_window.py
‚îÇ   ‚îú‚îÄ‚îÄ main_window.py
‚îÇ   ‚îú‚îÄ‚îÄ splash_screen.py
‚îÇ   ‚îú‚îÄ‚îÄ views/components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ autocomplete_entry.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ combobox.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_table.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dropdown_dialogs.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu_bar.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quick_test.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ searchable_combobox.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidebar.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status_bar.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toolbar.py

================================================================================
FILE CONTENTS
================================================================================


============================================================
FILE: app.py
SIZE: 6242 characters
============================================================

# -*- coding: utf-8 -*-
"""
app.py

ŸÜŸÇÿ∑ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ© (entry point) ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ FTS Sales Manager.
"""

# ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° Ÿàÿ•ÿØÿßÿ±ÿ™Ÿáÿß
import sys
import traceback
import warnings
import traceback

# ÿ™ÿπÿ∑ŸäŸÑ ÿ™ÿ≠ÿ∞Ÿäÿ± "invalid command name"
warnings.filterwarnings("ignore", message="invalid command name")

# ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ŸÅÿπŸäŸÑ faulthandler ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿØÿπŸàŸÖÿßŸã
try:
    import faulthandler
    # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜŸÜÿß ŸÑÿ≥ŸÜÿß ŸÅŸä IDLE
    if hasattr(sys.stderr, 'fileno') and hasattr(sys.stderr.fileno, '__call__'):
        try:
            sys.stderr.fileno()
            faulthandler.enable()
        except:
            # ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ŸÜÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑÿÆÿ∑ÿ£
            pass
except ImportError:
    # ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ faulthandler ŸÖÿ™ÿßÿ≠ÿßŸã
    pass

# ŸÖÿπÿßŸÑÿ¨ ÿ£ÿÆÿ∑ÿßÿ° ÿπÿßŸÖ ŸÑŸÄ Tkinter
def handle_tk_error(*args):
    import traceback
    import sys

    try:
        # ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ŸàŸÑŸâ: tkinter Ÿäÿ±ÿ≥ŸÑ (exc_type, exc_value, exc_tb)
        if isinstance(args, tuple) and len(args) == 3 and isinstance(args[1], BaseException):
            exc_type, exc_value, exc_tb = args

        # ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©: tkinter Ÿäÿ±ÿ≥ŸÑ ŸÉÿßÿ¶ŸÜ ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑
        elif isinstance(args, tuple) and len(args) == 1 and isinstance(args[0], BaseException):
            exc_type = type(args[0])
            exc_value = args[0]
            exc_tb = args[0].__traceback__ if hasattr(args[0], "__traceback__") else None

        # ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©: (widget, exc_type, exc_value, exc_tb)
        elif isinstance(args, tuple) and len(args) == 4 and isinstance(args[2], BaseException):
            _, exc_type, exc_value, exc_tb = args

        else:
            print("üì¶ ŸÖÿ≠ÿ™ŸàŸâ args ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ™ŸàŸÇÿπ:", args, file=sys.stderr)
            raise ValueError("ÿ™ŸÜÿ≥ŸäŸÇ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿÆÿ∑ÿ£")

        traceback.print_exception(exc_type, exc_value, exc_tb)

    except Exception as e:
        print(f"‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ£ÿ´ŸÜÿßÿ° ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° (ÿØÿßÿÆŸÑŸäŸãÿß): {e}", file=sys.stderr)

# ŸÖÿπÿßŸÑÿ¨ ÿ£ÿÆÿ∑ÿßÿ° ÿ¥ÿßŸÖŸÑ
def handle_exception(exc_type, exc_value, exc_traceback):
    if issubclass(exc_type, KeyboardInterrupt):
        sys.__excepthook__(exc_type, exc_value, exc_traceback)
        return

    # ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ logger ŸáŸÜÿß ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÖÿ®ŸÉÿ±
    from core.logger import logger
    logger.critical("Uncaught exception", exc_info=(exc_type, exc_value, exc_traceback))
    traceback.print_exception(exc_type, exc_value, exc_traceback)

sys.excepthook = handle_exception

# ÿ®ÿßŸÇŸä ÿßŸÑŸàÿßÿ±ÿØÿßÿ™
import os
import tkinter as tk

# ÿ•ÿÆŸÅÿßÿ° ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÅŸàÿ±ÿßŸã ÿ®ÿπÿØ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ tkinter
if tk._default_root:
    tk._default_root.withdraw()

from core.config_manager import ConfigManager
from core.db_manager import DatabaseManager
from core.airtable_manager import AirtableManager, AirtableModel
from core.user_manager import UserManager
from core.logger import logger
from controllers.app_controller import AppController
from views.splash_screen import SplashScreen

# ÿ±ÿ®ÿ∑ ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿ®ŸÄ Tkinter
tk.Tk.report_callback_exception = handle_tk_error


def hide_default_tk_window():
    """ÿ•ÿÆŸÅÿßÿ° ÿ£Ÿä ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
    try:
        # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
        if tk._default_root:
            tk._default_root.withdraw()
            tk._default_root.overrideredirect(True)

        # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£Ÿä ŸÜŸàÿßŸÅÿ∞ tk ŸÖŸÅÿ™Ÿàÿ≠ÿ© Ÿàÿ•ÿÆŸÅÿßÿ§Ÿáÿß
        for widget in tk._default_root.winfo_children() if tk._default_root else []:
            if widget.winfo_class() == 'Tk' and widget.title() == 'tk':
                widget.withdraw()
    except:
        pass


def main() -> None:
    """
    ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.
    """
    # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÖÿÆŸÅŸäÿ© ŸÑŸÄ CTkToplevel
    root = tk.Tk()
    root.withdraw()  # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸàÿ±ÿßŸã
    root.overrideredirect(True)  # ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ

    # ÿ•ÿÆŸÅÿßÿ° ÿ£Ÿä ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ£ÿÆÿ±Ÿâ
    hide_default_tk_window()

    # 1. ÿπÿ±ÿ∂ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÑŸÖÿØÿ© ŸÇÿµŸäÿ±ÿ©
    try:
        splash = SplashScreen(duration=2000, master=root)  # ÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        splash.update()
    except Exception as e:
        logger.warning(f"Failed to show splash screen: {e}", exc_info=True)

    # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ÿ®ÿπÿØ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    hide_default_tk_window()

    # 2. ÿ™ŸáŸäÿ¶ÿ© ConfigManager
    config_mgr = ConfigManager(config_path=os.path.join("config", "settings.yaml"))

    # 3. ÿ™ŸáŸäÿ¶ÿ© DatabaseManager (SQLite ŸÑŸÑŸÉÿßÿ¥ ÿßŸÑŸÖÿ≠ŸÑŸä)
    db_mgr = DatabaseManager(db_path="fts_sales_cache.db")

    # 4. ÿ™ŸáŸäÿ¶ÿ© AirtableModel ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
    users_table = config_mgr.get("airtable_users_table", "Users")
    airtable_users = AirtableModel(
        config_manager=config_mgr,
        db_manager=db_mgr,
        table_name=users_table
    )

    # 5. ÿ™ŸáŸäÿ¶ÿ© AirtableModel ŸÑŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™
    booking_table = config_mgr.get("airtable_booking_table", "List V2")
    airtable_booking = AirtableModel(
        config_manager=config_mgr,
        db_manager=db_mgr,
        table_name=booking_table
    )

    # 6. ÿ™ŸáŸäÿ¶ÿ© UserManager (Ÿäÿ≥ÿ™ÿÆÿØŸÖ airtable_users ŸÅŸÇÿ∑)
    user_mgr = UserManager(airtable_model=airtable_users, db_manager=db_mgr)

    # 7. ÿ™ÿ¥ÿ∫ŸäŸÑ AppController ŸÖÿπ ŸÉŸÑÿß ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ŸäŸÜ
    try:
        app_ctrl = AppController(
            config_mgr=config_mgr,
            db_mgr=db_mgr,
            airtable_users=airtable_users,
            airtable_booking=airtable_booking,
            user_mgr=user_mgr
        )
        app_ctrl.run()
    except Exception as e:
        logger.error(f"Unexpected error in main loop: {e}", exc_info=True)
        raise
    finally:
        # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        try:
            if 'root' in locals() and root:
                root.destroy()
        except:
            pass


if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        logger.critical(f"Fatal error on startup: {e}", exc_info=True)
        # ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        try:
            import tkinter as tk
            from tkinter import messagebox

            # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ŸÖÿ§ŸÇÿ™ÿ© ŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
            error_root = tk.Tk()
            error_root.withdraw()  # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©

            messagebox.showerror(
                "ÿÆÿ∑ÿ£ ŸÅŸä ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ",
                f"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:\n\n{str(e)}\n\nŸäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÑŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ."
            )

            error_root.destroy()
        except:
            pass
        sys.exit(1)

============================================================
FILE: export_project_improved.py
SIZE: 3849 characters
============================================================

import os
import datetime

output_file = f"project_export_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"

# ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿ´ŸÜÿßÿ©
EXCLUDED_DIRS = {'.git', '__pycache__', 'venv', '.venv', 'node_modules', '.idea', '.vscode'}
# ÿßŸÑÿßŸÖÿ™ÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿ´ŸÜÿßÿ©
EXCLUDED_EXTENSIONS = {'.pyc', '.pyo', '.pyd', '.so', '.dll', '.dylib', '.exe'}

with open(output_file, 'w', encoding='utf-8') as out:
    # ŸÉÿ™ÿßÿ®ÿ© ŸáŸäŸÉŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    out.write("=" * 80 + "\n")
    out.write("PROJECT STRUCTURE\n")
    out.write("=" * 80 + "\n\n")

    # ÿ∑ÿ±ŸäŸÇÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ¥ÿ¨ÿ±ÿ©
    for root, dirs, files in os.walk('.'):
        # ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ±ÿ∫Ÿàÿ®ÿ©
        dirs[:] = [d for d in dirs if d not in EXCLUDED_DIRS]

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠
        if root == '.':
            level = 0
            display_path = 'PROJECT_ROOT/'
        else:
            # ÿ•ÿ≤ÿßŸÑÿ© ./ ÿ£Ÿà .\ ŸÖŸÜ ÿßŸÑÿ®ÿØÿßŸäÿ©
            relative_path = os.path.relpath(root, '.')
            level = relative_path.count(os.sep) + 1
            display_path = relative_path.replace(os.sep, '/') + '/'

        # ÿ±ÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸáÿ±ŸÖŸä
        indent = '‚îÇ   ' * (level - 1) + '‚îú‚îÄ‚îÄ ' if level > 0 else ''
        out.write(f'{indent}{display_path}\n')

        # ÿ±ÿ≥ŸÖ ÿßŸÑŸÖŸÑŸÅÿßÿ™
        for i, file in enumerate(files):
            # ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿÆŸÅŸäÿ© ŸàÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖÿ©
            if file.startswith('.') or any(file.endswith(ext) for ext in EXCLUDED_EXTENSIONS):
                continue

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® (ÿ¢ÿÆÿ± ŸÖŸÑŸÅ ÿ£ŸÖ ŸÑÿß)
            is_last = (i == len(files) - 1) and not dirs
            file_indent = '‚îÇ   ' * level + ('‚îî‚îÄ‚îÄ ' if is_last else '‚îú‚îÄ‚îÄ ')
            out.write(f'{file_indent}{file}\n')

    # ŸÉÿ™ÿßÿ®ÿ© ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÑŸÅÿßÿ™
    out.write("\n" + "=" * 80 + "\n")
    out.write("FILE CONTENTS\n")
    out.write("=" * 80 + "\n")

    # ÿßŸÖÿ™ÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ±ÿßÿØ ŸÇÿ±ÿßÿ°ÿ™Ÿáÿß
    READ_EXTENSIONS = {'.py', '.json', '.txt', '.md', '.yml', '.yaml', '.js', '.html', '.css',
                      '.jsx', '.tsx', '.ts', '.vue', '.sql', '.sh', '.bat', '.env.example'}

    files_read = 0
    errors = []

    for root, dirs, files in os.walk('.'):
        dirs[:] = [d for d in dirs if d not in EXCLUDED_DIRS]

        for file in files:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßŸÖÿ™ÿØÿßÿØ
            if any(file.endswith(ext) for ext in READ_EXTENSIONS):
                filepath = os.path.join(root, file)
                relative_path = os.path.relpath(filepath, '.')

                try:
                    with open(filepath, 'r', encoding='utf-8') as f:
                        content = f.read()

                    out.write(f"\n\n{'='*60}\n")
                    out.write(f"FILE: {relative_path}\n")
                    out.write(f"SIZE: {len(content)} characters\n")
                    out.write(f"{'='*60}\n\n")
                    out.write(content)
                    files_read += 1

                except Exception as e:
                    error_msg = f"Error reading {relative_path}: {e}"
                    out.write(f"\n\n{'='*60}\n")
                    out.write(f"ERROR: {error_msg}\n")
                    out.write(f"{'='*60}\n")
                    errors.append(error_msg)

    # ŸÖŸÑÿÆÿµ ÿßŸÑÿ™ÿµÿØŸäÿ±
    out.write(f"\n\n{'='*80}\n")
    out.write("EXPORT SUMMARY\n")
    out.write(f"{'='*80}\n")
    out.write(f"Total files read: {files_read}\n")
    out.write(f"Errors encountered: {len(errors)}\n")
    out.write(f"Export date: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")

    if errors:
        out.write("\nErrors details:\n")
        for error in errors:
            out.write(f"  - {error}\n")

print(f"‚úÖ ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ•ŸÑŸâ: {output_file}")
print(f"üìÅ ÿπÿØÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖŸÇÿ±Ÿàÿ°ÿ©: {files_read}")
if errors:
    print(f"‚ö†Ô∏è  ÿπÿØÿØ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°: {len(errors)}")

============================================================
FILE: project_analysis.json
SIZE: 35687 characters
============================================================

{
  "files": {
    "app": {
      "path": "app.py",
      "size": 6242,
      "lines": 201,
      "local_imports": [
        "core.user_manager",
        "core.config_manager",
        "core.airtable_manager",
        "views.splash_screen",
        "core.logger",
        "controllers.app_controller",
        "core.db_manager"
      ],
      "external_imports": [
        "os",
        "warnings",
        "traceback",
        "tkinter",
        "sys",
        "faulthandler"
      ]
    },
    "project_analyzer": {
      "path": "project_analyzer.py",
      "size": 15466,
      "lines": 401,
      "local_imports": [],
      "external_imports": [
        "os",
        "ast",
        "re",
        "pathlib",
        "typing",
        "json",
        "collections",
        "argparse"
      ]
    },
    "config.login_config": {
      "path": "config\\login_config.py",
      "size": 6796,
      "lines": 217,
      "local_imports": [],
      "external_imports": []
    },
    "config.modern_color_palettes": {
      "path": "config\\modern_color_palettes.py",
      "size": 5867,
      "lines": 202,
      "local_imports": [],
      "external_imports": []
    },
    "controllers.app_controller": {
      "path": "controllers\\app_controller.py",
      "size": 29214,
      "lines": 787,
      "local_imports": [
        "utils.threading_utils",
        "core.user_manager",
        "views.login_window",
        "views.main_window",
        "core.config_manager",
        "core.airtable_manager",
        "views.add_edit_window",
        "core.theme_manager",
        "core.logger",
        "core.language_manager",
        "core.db_manager",
        "core.airtable_dropdown_manager"
      ],
      "external_imports": [
        "typing",
        "threading",
        "datetime",
        "json",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "core.airtable_dropdown_manager": {
      "path": "core\\airtable_dropdown_manager.py",
      "size": 24117,
      "lines": 602,
      "local_imports": [
        "core.airtable_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "json",
        "logging",
        "time",
        "concurrent.futures"
      ]
    },
    "core.airtable_manager": {
      "path": "core\\airtable_manager.py",
      "size": 28862,
      "lines": 774,
      "local_imports": [],
      "external_imports": [
        "os",
        "re",
        "typing",
        "threading",
        "datetime",
        "json",
        "requests",
        "logging",
        "time",
        "concurrent.futures"
      ]
    },
    "core.app_state_manager": {
      "path": "core\\app_state_manager.py",
      "size": 14840,
      "lines": 403,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "typing",
        "threading",
        "datetime",
        "enum",
        "time"
      ]
    },
    "core.config_manager": {
      "path": "core\\config_manager.py",
      "size": 18851,
      "lines": 499,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "os",
        "dotenv",
        "typing",
        "yaml"
      ]
    },
    "core.constants": {
      "path": "core\\constants.py",
      "size": 8556,
      "lines": 295,
      "local_imports": [],
      "external_imports": [
        "typing",
        "enum"
      ]
    },
    "core.db_manager": {
      "path": "core\\db_manager.py",
      "size": 10852,
      "lines": 261,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "sqlite3",
        "typing",
        "threading"
      ]
    },
    "core.event_system": {
      "path": "core\\event_system.py",
      "size": 1015,
      "lines": 31,
      "local_imports": [],
      "external_imports": [
        "queue",
        "typing",
        "threading",
        "datetime"
      ]
    },
    "core.language_manager": {
      "path": "core\\language_manager.py",
      "size": 6614,
      "lines": 166,
      "local_imports": [
        "core.logger",
        "core.config_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "yaml"
      ]
    },
    "core.logger": {
      "path": "core\\logger.py",
      "size": 2118,
      "lines": 62,
      "local_imports": [],
      "external_imports": [
        "os",
        "logging",
        "logging.handlers"
      ]
    },
    "core.permissions": {
      "path": "core\\permissions.py",
      "size": 5411,
      "lines": 176,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "typing",
        "tkinter",
        "functools"
      ]
    },
    "core.session_manager": {
      "path": "core\\session_manager.py",
      "size": 14093,
      "lines": 411,
      "local_imports": [
        "core.security.encryption",
        "core.logger"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "secrets",
        "json",
        "time"
      ]
    },
    "core.state_manager": {
      "path": "core\\state_manager.py",
      "size": 2557,
      "lines": 75,
      "local_imports": [],
      "external_imports": [
        "dataclasses",
        "typing",
        "threading",
        "datetime"
      ]
    },
    "core.theme_color_manager": {
      "path": "core\\theme_color_manager.py",
      "size": 12242,
      "lines": 320,
      "local_imports": [
        "config.modern_color_palettes",
        "core.logger"
      ],
      "external_imports": [
        "typing",
        "customtkinter"
      ]
    },
    "core.theme_manager": {
      "path": "core\\theme_manager.py",
      "size": 25669,
      "lines": 562,
      "local_imports": [
        "core.logger",
        "core.config_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "json",
        "tkinter",
        "customtkinter"
      ]
    },
    "core.user_manager": {
      "path": "core\\user_manager.py",
      "size": 14899,
      "lines": 387,
      "local_imports": [
        "core.airtable_manager",
        "core.db_manager",
        "core.logger"
      ],
      "external_imports": [
        "hmac",
        "base64",
        "typing",
        "secrets",
        "datetime",
        "hashlib"
      ]
    },
    "utils.async_operations": {
      "path": "utils\\async_operations.py",
      "size": 736,
      "lines": 21,
      "local_imports": [],
      "external_imports": [
        "threading",
        "concurrent.futures"
      ]
    },
    "utils.error_handler": {
      "path": "utils\\error_handler.py",
      "size": 1884,
      "lines": 49,
      "local_imports": [
        "utils.window_manager"
      ],
      "external_imports": [
        "typing",
        "logging",
        "traceback",
        "tkinter",
        "functools"
      ]
    },
    "utils.image_utils": {
      "path": "utils\\image_utils.py",
      "size": 8538,
      "lines": 297,
      "local_imports": [],
      "external_imports": [
        "os",
        "PIL",
        "typing",
        "logging",
        "tkinter",
        "customtkinter",
        "sys"
      ]
    },
    "utils.login_visual_effects": {
      "path": "utils\\login_visual_effects.py",
      "size": 11479,
      "lines": 356,
      "local_imports": [],
      "external_imports": [
        "typing",
        "threading",
        "math",
        "customtkinter",
        "time"
      ]
    },
    "utils.threading_utils": {
      "path": "utils\\threading_utils.py",
      "size": 5475,
      "lines": 178,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "tkinter",
        "queue",
        "typing",
        "threading"
      ]
    },
    "utils.validators": {
      "path": "utils\\validators.py",
      "size": 12546,
      "lines": 405,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "re",
        "typing",
        "datetime",
        "string"
      ]
    },
    "utils.window_manager": {
      "path": "utils\\window_manager.py",
      "size": 48019,
      "lines": 1208,
      "local_imports": [],
      "external_imports": [
        "ctypes",
        "platform",
        "weakref",
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "views.add_edit_window": {
      "path": "views\\add_edit_window.py",
      "size": 35739,
      "lines": 861,
      "local_imports": [
        "core.theme_color_manager",
        "core.logger",
        "core.language_manager",
        "views.components.combobox",
        "utils.window_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "json",
        "tkcalendar",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "views.login_window": {
      "path": "views\\login_window.py",
      "size": 91114,
      "lines": 2369,
      "local_imports": [
        "core.constants",
        "core.theme_color_manager",
        "core.security.encryption",
        "utils.validators",
        "core.security.rate_limiter",
        "config.login_config",
        "core.logger",
        "core.theme_manager",
        "core.language_manager",
        "config.modern_color_palettes",
        "utils.window_manager"
      ],
      "external_imports": [
        "os",
        "ctypes",
        "platform",
        "re",
        "typing",
        "threading",
        "secrets",
        "json",
        "datetime",
        "string",
        "tkinter",
        "customtkinter",
        "time",
        "hashlib",
        "queue",
        "functools"
      ]
    },
    "views.main_window": {
      "path": "views\\main_window.py",
      "size": 55631,
      "lines": 1310,
      "local_imports": [
        "views.components.data_table",
        "core.theme_color_manager",
        "views.components.header",
        "utils.image_utils",
        "core.state_manager",
        "core.event_system",
        "core.permissions",
        "views.components.status_bar",
        "core.logger",
        "core.theme_manager",
        "core.language_manager",
        "views.components.toolbar",
        "views.components.menu_bar",
        "views.components.sidebar",
        "utils.async_operations",
        "utils.window_manager"
      ],
      "external_imports": [
        "os",
        "platform",
        "typing",
        "threading",
        "datetime",
        "weakref",
        "tkinter",
        "customtkinter",
        "functools"
      ]
    },
    "views.splash_screen": {
      "path": "views\\splash_screen.py",
      "size": 11100,
      "lines": 363,
      "local_imports": [],
      "external_imports": [
        "os",
        "PIL",
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "core.security.encryption": {
      "path": "core\\security\\encryption.py",
      "size": 6042,
      "lines": 210,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "os",
        "base64",
        "typing",
        "secrets",
        "json",
        "hashlib",
        "cryptography.fernet"
      ]
    },
    "core.security.rate_limiter": {
      "path": "core\\security\\rate_limiter.py",
      "size": 10258,
      "lines": 311,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "os",
        "typing",
        "threading",
        "datetime",
        "json",
        "collections",
        "time"
      ]
    },
    "core.security.two_factor_auth": {
      "path": "core\\security\\two_factor_auth.py",
      "size": 11664,
      "lines": 403,
      "local_imports": [
        "core.logger"
      ],
      "external_imports": [
        "io",
        "pyotp",
        "base64",
        "typing",
        "secrets",
        "datetime",
        "json",
        "qrcode",
        "time",
        "hashlib"
      ]
    },
    "venv.Lib.site-packages.pip.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\__main__.py",
      "size": 854,
      "lines": 24,
      "local_imports": [],
      "external_imports": [
        "os",
        "pip._internal.cli.main",
        "sys"
      ]
    },
    "venv.Lib.site-packages.pip._internal.main": {
      "path": "venv\\Lib\\site-packages\\pip\\_internal\\main.py",
      "size": 340,
      "lines": 12,
      "local_imports": [],
      "external_imports": [
        "typing",
        "pip._internal.utils.entrypoints"
      ]
    },
    "venv.Lib.site-packages.pip._internal.cli.main": {
      "path": "venv\\Lib\\site-packages\\pip\\_internal\\cli\\main.py",
      "size": 2817,
      "lines": 80,
      "local_imports": [],
      "external_imports": [
        "os",
        "pip._internal.cli.autocompletion",
        "pip._internal.cli.main_parser",
        "pip._internal.exceptions",
        "typing",
        "pip._internal.utils",
        "logging",
        "warnings",
        "sys",
        "locale",
        "pip._internal.commands"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.certifi.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\certifi\\__main__.py",
      "size": 255,
      "lines": 12,
      "local_imports": [],
      "external_imports": [
        "pip._vendor.certifi",
        "argparse"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.distro.distro": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\distro\\distro.py",
      "size": 49430,
      "lines": 1403,
      "local_imports": [],
      "external_imports": [
        "os",
        "re",
        "typing",
        "json",
        "logging",
        "subprocess",
        "warnings",
        "argparse",
        "sys",
        "shlex",
        "functools"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.distro.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\distro\\__main__.py",
      "size": 64,
      "lines": 4,
      "local_imports": [
        "venv.Lib.site-packages.pip._vendor.distro.distro"
      ],
      "external_imports": []
    },
    "venv.Lib.site-packages.pip._vendor.platformdirs.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\platformdirs\\__main__.py",
      "size": 1505,
      "lines": 55,
      "local_imports": [],
      "external_imports": [
        "__future__",
        "pip._vendor.platformdirs"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.pygments.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\pygments\\__main__.py",
      "size": 353,
      "lines": 17,
      "local_imports": [],
      "external_imports": [
        "pip._vendor.pygments.cmdline",
        "sys"
      ]
    },
    "venv.Lib.site-packages.pip._vendor.rich.__main__": {
      "path": "venv\\Lib\\site-packages\\pip\\_vendor\\rich\\__main__.py",
      "size": 8319,
      "lines": 273,
      "local_imports": [],
      "external_imports": [
        "pip._vendor.rich.markdown",
        "pip._vendor.rich.console",
        "io",
        "pip._vendor.rich.style",
        "pip._vendor.rich.pretty",
        "pip._vendor.rich.segment",
        "pip._vendor.rich.measure",
        "pip._vendor.rich",
        "pip._vendor.rich.panel",
        "pip._vendor.rich.color",
        "pip._vendor.rich.syntax",
        "pip._vendor.rich.text",
        "time",
        "colorsys",
        "pip._vendor.rich.table"
      ]
    },
    "views.components.autocomplete_entry": {
      "path": "views\\components\\autocomplete_entry.py",
      "size": 19262,
      "lines": 616,
      "local_imports": [],
      "external_imports": [
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "enum",
        "time",
        "random",
        "dataclasses"
      ]
    },
    "views.components.combobox": {
      "path": "views\\components\\combobox.py",
      "size": 70009,
      "lines": 1855,
      "local_imports": [],
      "external_imports": [
        "typing",
        "traceback",
        "tkinter",
        "customtkinter",
        "time"
      ]
    },
    "views.components.data_table": {
      "path": "views\\components\\data_table.py",
      "size": 20968,
      "lines": 614,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "datetime",
        "typing",
        "tkinter",
        "customtkinter"
      ]
    },
    "views.components.dropdown_dialogs": {
      "path": "views\\components\\dropdown_dialogs.py",
      "size": 54108,
      "lines": 1558,
      "local_imports": [
        "core.logger",
        "core.theme_manager",
        "core.config_manager",
        "core.language_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "datetime",
        "json",
        "tkinter",
        "customtkinter",
        "webbrowser"
      ]
    },
    "views.components.header": {
      "path": "views\\components\\header.py",
      "size": 28565,
      "lines": 867,
      "local_imports": [
        "views.components.dropdown_dialogs",
        "core.logger",
        "core.language_manager"
      ],
      "external_imports": [
        "os",
        "typing",
        "weakref",
        "datetime",
        "tkinter",
        "customtkinter",
        "sys",
        "webbrowser"
      ]
    },
    "views.components.menu_bar": {
      "path": "views\\components\\menu_bar.py",
      "size": 11466,
      "lines": 371,
      "local_imports": [
        "core.logger",
        "core.language_manager"
      ],
      "external_imports": [
        "typing",
        "tkinter"
      ]
    },
    "views.components.quick_test": {
      "path": "views\\components\\quick_test.py",
      "size": 2201,
      "lines": 84,
      "local_imports": [],
      "external_imports": [
        "enhanced_searchable_combobox",
        "customtkinter"
      ]
    },
    "views.components.searchable_combobox": {
      "path": "views\\components\\searchable_combobox.py",
      "size": 20729,
      "lines": 643,
      "local_imports": [],
      "external_imports": [
        "typing",
        "threading",
        "tkinter",
        "customtkinter",
        "time",
        "random"
      ]
    },
    "views.components.sidebar": {
      "path": "views\\components\\sidebar.py",
      "size": 19652,
      "lines": 601,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "typing",
        "customtkinter"
      ]
    },
    "views.components.status_bar": {
      "path": "views\\components\\status_bar.py",
      "size": 20837,
      "lines": 600,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "datetime",
        "typing",
        "threading",
        "customtkinter"
      ]
    },
    "views.components.toolbar": {
      "path": "views\\components\\toolbar.py",
      "size": 18926,
      "lines": 520,
      "local_imports": [
        "core.language_manager"
      ],
      "external_imports": [
        "typing",
        "customtkinter"
      ]
    }
  },
  "dependencies": {
    "app": [
      "core.user_manager",
      "core.config_manager",
      "core.airtable_manager",
      "views.splash_screen",
      "core.logger",
      "controllers.app_controller",
      "core.db_manager"
    ],
    "controllers.app_controller": [
      "utils.threading_utils",
      "core.user_manager",
      "views.main_window",
      "core.config_manager",
      "core.airtable_manager",
      "views.add_edit_window",
      "core.theme_manager",
      "core.logger",
      "views.login_window",
      "core.language_manager",
      "core.db_manager",
      "core.airtable_dropdown_manager"
    ],
    "core.airtable_dropdown_manager": [
      "core.airtable_manager"
    ],
    "core.app_state_manager": [
      "core.logger"
    ],
    "core.config_manager": [
      "core.logger"
    ],
    "core.db_manager": [
      "core.logger"
    ],
    "core.language_manager": [
      "core.logger",
      "core.config_manager"
    ],
    "core.permissions": [
      "core.logger"
    ],
    "core.session_manager": [
      "core.security.encryption",
      "core.logger"
    ],
    "core.theme_color_manager": [
      "config.modern_color_palettes",
      "core.logger"
    ],
    "core.theme_manager": [
      "core.logger",
      "core.config_manager"
    ],
    "core.user_manager": [
      "core.airtable_manager",
      "core.db_manager",
      "core.logger"
    ],
    "utils.error_handler": [
      "utils.window_manager"
    ],
    "utils.threading_utils": [
      "core.logger"
    ],
    "utils.validators": [
      "core.logger"
    ],
    "views.add_edit_window": [
      "core.theme_color_manager",
      "core.logger",
      "core.language_manager",
      "views.components.combobox",
      "utils.window_manager"
    ],
    "views.login_window": [
      "core.constants",
      "core.theme_color_manager",
      "core.security.encryption",
      "utils.validators",
      "config.login_config",
      "config.modern_color_palettes",
      "core.logger",
      "core.theme_manager",
      "core.language_manager",
      "core.security.rate_limiter",
      "utils.window_manager"
    ],
    "views.main_window": [
      "views.components.data_table",
      "core.theme_color_manager",
      "utils.window_manager",
      "utils.image_utils",
      "core.state_manager",
      "core.event_system",
      "core.permissions",
      "views.components.status_bar",
      "core.logger",
      "core.theme_manager",
      "core.language_manager",
      "views.components.toolbar",
      "views.components.menu_bar",
      "views.components.sidebar",
      "utils.async_operations",
      "views.components.header"
    ],
    "core.security.encryption": [
      "core.logger"
    ],
    "core.security.rate_limiter": [
      "core.logger"
    ],
    "core.security.two_factor_auth": [
      "core.logger"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.__main__": [
      "venv.Lib.site-packages.pip._vendor.distro.distro"
    ],
    "views.components.data_table": [
      "core.language_manager"
    ],
    "views.components.dropdown_dialogs": [
      "core.theme_manager",
      "core.logger",
      "core.config_manager",
      "core.language_manager"
    ],
    "views.components.header": [
      "views.components.dropdown_dialogs",
      "core.logger",
      "core.language_manager"
    ],
    "views.components.menu_bar": [
      "core.logger",
      "core.language_manager"
    ],
    "views.components.sidebar": [
      "core.language_manager"
    ],
    "views.components.status_bar": [
      "core.language_manager"
    ],
    "views.components.toolbar": [
      "core.language_manager"
    ]
  },
  "reverse_dependencies": {
    "core.user_manager": [
      "app",
      "controllers.app_controller"
    ],
    "core.config_manager": [
      "app",
      "views.components.dropdown_dialogs",
      "core.theme_manager",
      "controllers.app_controller",
      "core.language_manager"
    ],
    "core.airtable_manager": [
      "app",
      "core.user_manager",
      "core.airtable_dropdown_manager",
      "controllers.app_controller"
    ],
    "views.splash_screen": [
      "app"
    ],
    "core.logger": [
      "utils.threading_utils",
      "core.user_manager",
      "core.theme_color_manager",
      "app",
      "core.config_manager",
      "views.add_edit_window",
      "core.permissions",
      "core.security.two_factor_auth",
      "core.language_manager",
      "core.security.rate_limiter",
      "core.db_manager",
      "views.components.dropdown_dialogs",
      "utils.validators",
      "core.app_state_manager",
      "views.components.header",
      "core.security.encryption",
      "views.components.menu_bar",
      "controllers.app_controller",
      "views.login_window",
      "views.main_window",
      "core.theme_manager",
      "core.session_manager"
    ],
    "controllers.app_controller": [
      "app"
    ],
    "core.db_manager": [
      "app",
      "core.user_manager",
      "controllers.app_controller"
    ],
    "utils.threading_utils": [
      "controllers.app_controller"
    ],
    "views.login_window": [
      "controllers.app_controller"
    ],
    "views.main_window": [
      "controllers.app_controller"
    ],
    "views.add_edit_window": [
      "controllers.app_controller"
    ],
    "core.theme_manager": [
      "views.components.dropdown_dialogs",
      "views.main_window",
      "controllers.app_controller",
      "views.login_window"
    ],
    "core.language_manager": [
      "views.components.data_table",
      "views.components.dropdown_dialogs",
      "views.main_window",
      "views.add_edit_window",
      "views.components.menu_bar",
      "views.components.status_bar",
      "controllers.app_controller",
      "views.login_window",
      "views.components.toolbar",
      "views.components.sidebar",
      "views.components.header"
    ],
    "core.airtable_dropdown_manager": [
      "controllers.app_controller"
    ],
    "core.security.encryption": [
      "views.login_window",
      "core.session_manager"
    ],
    "config.modern_color_palettes": [
      "core.theme_color_manager",
      "views.login_window"
    ],
    "utils.window_manager": [
      "views.add_edit_window",
      "utils.error_handler",
      "views.main_window",
      "views.login_window"
    ],
    "core.theme_color_manager": [
      "views.add_edit_window",
      "views.main_window",
      "views.login_window"
    ],
    "views.components.combobox": [
      "views.add_edit_window"
    ],
    "core.constants": [
      "views.login_window"
    ],
    "utils.validators": [
      "views.login_window"
    ],
    "core.security.rate_limiter": [
      "views.login_window"
    ],
    "config.login_config": [
      "views.login_window"
    ],
    "views.components.data_table": [
      "views.main_window"
    ],
    "views.components.header": [
      "views.main_window"
    ],
    "utils.image_utils": [
      "views.main_window"
    ],
    "core.state_manager": [
      "views.main_window"
    ],
    "core.event_system": [
      "views.main_window"
    ],
    "core.permissions": [
      "views.main_window"
    ],
    "views.components.status_bar": [
      "views.main_window"
    ],
    "views.components.toolbar": [
      "views.main_window"
    ],
    "views.components.menu_bar": [
      "views.main_window"
    ],
    "views.components.sidebar": [
      "views.main_window"
    ],
    "utils.async_operations": [
      "views.main_window"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.distro": [
      "venv.Lib.site-packages.pip._vendor.distro.__main__"
    ],
    "views.components.dropdown_dialogs": [
      "views.components.header"
    ]
  },
  "external_imports": {
    "app": [
      "os",
      "warnings",
      "traceback",
      "tkinter",
      "sys",
      "faulthandler"
    ],
    "project_analyzer": [
      "os",
      "ast",
      "re",
      "pathlib",
      "typing",
      "json",
      "collections",
      "argparse"
    ],
    "config.login_config": [],
    "config.modern_color_palettes": [],
    "controllers.app_controller": [
      "typing",
      "threading",
      "datetime",
      "json",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "core.airtable_dropdown_manager": [
      "os",
      "typing",
      "threading",
      "datetime",
      "json",
      "logging",
      "time",
      "concurrent.futures"
    ],
    "core.airtable_manager": [
      "os",
      "re",
      "typing",
      "threading",
      "datetime",
      "json",
      "requests",
      "logging",
      "time",
      "concurrent.futures"
    ],
    "core.app_state_manager": [
      "typing",
      "threading",
      "datetime",
      "enum",
      "time"
    ],
    "core.config_manager": [
      "os",
      "dotenv",
      "typing",
      "yaml"
    ],
    "core.constants": [
      "typing",
      "enum"
    ],
    "core.db_manager": [
      "sqlite3",
      "typing",
      "threading"
    ],
    "core.event_system": [
      "queue",
      "typing",
      "threading",
      "datetime"
    ],
    "core.language_manager": [
      "os",
      "typing",
      "yaml"
    ],
    "core.logger": [
      "os",
      "logging",
      "logging.handlers"
    ],
    "core.permissions": [
      "typing",
      "tkinter",
      "functools"
    ],
    "core.session_manager": [
      "os",
      "typing",
      "threading",
      "datetime",
      "secrets",
      "json",
      "time"
    ],
    "core.state_manager": [
      "dataclasses",
      "typing",
      "threading",
      "datetime"
    ],
    "core.theme_color_manager": [
      "typing",
      "customtkinter"
    ],
    "core.theme_manager": [
      "os",
      "typing",
      "json",
      "tkinter",
      "customtkinter"
    ],
    "core.user_manager": [
      "hmac",
      "base64",
      "typing",
      "secrets",
      "datetime",
      "hashlib"
    ],
    "utils.async_operations": [
      "threading",
      "concurrent.futures"
    ],
    "utils.error_handler": [
      "typing",
      "logging",
      "traceback",
      "tkinter",
      "functools"
    ],
    "utils.image_utils": [
      "os",
      "PIL",
      "typing",
      "logging",
      "tkinter",
      "customtkinter",
      "sys"
    ],
    "utils.login_visual_effects": [
      "typing",
      "threading",
      "math",
      "customtkinter",
      "time"
    ],
    "utils.threading_utils": [
      "tkinter",
      "queue",
      "typing",
      "threading"
    ],
    "utils.validators": [
      "re",
      "typing",
      "datetime",
      "string"
    ],
    "utils.window_manager": [
      "ctypes",
      "platform",
      "weakref",
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "views.add_edit_window": [
      "os",
      "typing",
      "threading",
      "datetime",
      "json",
      "tkcalendar",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "views.login_window": [
      "os",
      "ctypes",
      "platform",
      "re",
      "typing",
      "threading",
      "secrets",
      "json",
      "datetime",
      "string",
      "tkinter",
      "customtkinter",
      "time",
      "hashlib",
      "queue",
      "functools"
    ],
    "views.main_window": [
      "os",
      "platform",
      "typing",
      "threading",
      "datetime",
      "weakref",
      "tkinter",
      "customtkinter",
      "functools"
    ],
    "views.splash_screen": [
      "os",
      "PIL",
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "core.security.encryption": [
      "os",
      "base64",
      "typing",
      "secrets",
      "json",
      "hashlib",
      "cryptography.fernet"
    ],
    "core.security.rate_limiter": [
      "os",
      "typing",
      "threading",
      "datetime",
      "json",
      "collections",
      "time"
    ],
    "core.security.two_factor_auth": [
      "io",
      "pyotp",
      "base64",
      "typing",
      "secrets",
      "datetime",
      "json",
      "qrcode",
      "time",
      "hashlib"
    ],
    "venv.Lib.site-packages.pip.__main__": [
      "os",
      "pip._internal.cli.main",
      "sys"
    ],
    "venv.Lib.site-packages.pip._internal.main": [
      "typing",
      "pip._internal.utils.entrypoints"
    ],
    "venv.Lib.site-packages.pip._internal.cli.main": [
      "os",
      "pip._internal.cli.autocompletion",
      "pip._internal.cli.main_parser",
      "pip._internal.exceptions",
      "typing",
      "pip._internal.utils",
      "logging",
      "warnings",
      "sys",
      "locale",
      "pip._internal.commands"
    ],
    "venv.Lib.site-packages.pip._vendor.certifi.__main__": [
      "pip._vendor.certifi",
      "argparse"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.distro": [
      "os",
      "re",
      "typing",
      "json",
      "logging",
      "subprocess",
      "warnings",
      "argparse",
      "sys",
      "shlex",
      "functools"
    ],
    "venv.Lib.site-packages.pip._vendor.distro.__main__": [],
    "venv.Lib.site-packages.pip._vendor.platformdirs.__main__": [
      "__future__",
      "pip._vendor.platformdirs"
    ],
    "venv.Lib.site-packages.pip._vendor.pygments.__main__": [
      "pip._vendor.pygments.cmdline",
      "sys"
    ],
    "venv.Lib.site-packages.pip._vendor.rich.__main__": [
      "pip._vendor.rich.markdown",
      "pip._vendor.rich.console",
      "io",
      "pip._vendor.rich.style",
      "pip._vendor.rich.pretty",
      "pip._vendor.rich.segment",
      "pip._vendor.rich.measure",
      "pip._vendor.rich",
      "pip._vendor.rich.panel",
      "pip._vendor.rich.color",
      "pip._vendor.rich.syntax",
      "pip._vendor.rich.text",
      "time",
      "colorsys",
      "pip._vendor.rich.table"
    ],
    "views.components.autocomplete_entry": [
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "enum",
      "time",
      "random",
      "dataclasses"
    ],
    "views.components.combobox": [
      "typing",
      "traceback",
      "tkinter",
      "customtkinter",
      "time"
    ],
    "views.components.data_table": [
      "datetime",
      "typing",
      "tkinter",
      "customtkinter"
    ],
    "views.components.dropdown_dialogs": [
      "os",
      "typing",
      "datetime",
      "json",
      "tkinter",
      "customtkinter",
      "webbrowser"
    ],
    "views.components.header": [
      "os",
      "typing",
      "weakref",
      "datetime",
      "tkinter",
      "customtkinter",
      "sys",
      "webbrowser"
    ],
    "views.components.menu_bar": [
      "typing",
      "tkinter"
    ],
    "views.components.quick_test": [
      "enhanced_searchable_combobox",
      "customtkinter"
    ],
    "views.components.searchable_combobox": [
      "typing",
      "threading",
      "tkinter",
      "customtkinter",
      "time",
      "random"
    ],
    "views.components.sidebar": [
      "typing",
      "customtkinter"
    ],
    "views.components.status_bar": [
      "datetime",
      "typing",
      "threading",
      "customtkinter"
    ],
    "views.components.toolbar": [
      "typing",
      "customtkinter"
    ]
  },
  "statistics": {
    "total_files": 54,
    "total_lines": 25382,
    "total_size": 915166,
    "circular_dependencies": [],
    "most_imported": [
      [
        "core.logger",
        22
      ],
      [
        "core.language_manager",
        11
      ],
      [
        "core.config_manager",
        5
      ],
      [
        "core.airtable_manager",
        4
      ],
      [
        "core.theme_manager",
        4
      ],
      [
        "utils.window_manager",
        4
      ],
      [
        "core.db_manager",
        3
      ],
      [
        "core.theme_color_manager",
        3
      ],
      [
        "core.user_manager",
        2
      ],
      [
        "core.security.encryption",
        2
      ]
    ],
    "most_importing": [
      [
        "views.main_window",
        16
      ],
      [
        "controllers.app_controller",
        12
      ],
      [
        "views.login_window",
        11
      ],
      [
        "app",
        7
      ],
      [
        "views.add_edit_window",
        5
      ],
      [
        "views.components.dropdown_dialogs",
        4
      ],
      [
        "core.user_manager",
        3
      ],
      [
        "views.components.header",
        3
      ],
      [
        "core.language_manager",
        2
      ],
      [
        "core.session_manager",
        2
      ]
    ]
  }
}

============================================================
FILE: project_analysis.txt
SIZE: 3750 characters
============================================================

============================================================
üìä ÿ™ŸÇÿ±Ÿäÿ± ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
============================================================

üìà ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©:
  ‚Ä¢ ÿπÿØÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™: 54
  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ≥ÿ∑ÿ±: 25,382
  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≠ÿ¨ŸÖ: 915,166 ÿ≠ÿ±ŸÅ

üîó ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã:
  ‚Ä¢ core.logger: 22 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.language_manager: 11 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.config_manager: 5 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.airtable_manager: 4 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.theme_manager: 4 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ utils.window_manager: 4 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.db_manager: 3 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.theme_color_manager: 3 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.user_manager: 2 ÿßÿ≥ÿ™ÿØÿπÿßÿ°
  ‚Ä¢ core.security.encryption: 2 ÿßÿ≥ÿ™ÿØÿπÿßÿ°

üì§ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™:
  ‚Ä¢ views.main_window: Ÿäÿ≥ÿ™ÿØÿπŸä 16 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ controllers.app_controller: Ÿäÿ≥ÿ™ÿØÿπŸä 12 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.login_window: Ÿäÿ≥ÿ™ÿØÿπŸä 11 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ app: Ÿäÿ≥ÿ™ÿØÿπŸä 7 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.add_edit_window: Ÿäÿ≥ÿ™ÿØÿπŸä 5 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.components.dropdown_dialogs: Ÿäÿ≥ÿ™ÿØÿπŸä 4 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ core.user_manager: Ÿäÿ≥ÿ™ÿØÿπŸä 3 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ views.components.header: Ÿäÿ≥ÿ™ÿØÿπŸä 3 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ core.language_manager: Ÿäÿ≥ÿ™ÿØÿπŸä 2 Ÿàÿ≠ÿØÿ©
  ‚Ä¢ core.session_manager: Ÿäÿ≥ÿ™ÿØÿπŸä 2 Ÿàÿ≠ÿØÿ©

‚úÖ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©

üå≥ ÿ¥ÿ¨ÿ±ÿ© ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä (app):
‚îú‚îÄ‚îÄ app
  ‚îú‚îÄ‚îÄ controllers.app_controller
    ‚îú‚îÄ‚îÄ controllers.app_controller
      ‚îú‚îÄ‚îÄ core.airtable_dropdown_manager
        ‚îú‚îÄ‚îÄ core.airtable_dropdown_manager
          ‚îî‚îÄ‚îÄ core.airtable_manager
      ‚îú‚îÄ‚îÄ core.airtable_manager
      ‚îú‚îÄ‚îÄ core.config_manager
        ‚îú‚îÄ‚îÄ core.config_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.db_manager
        ‚îú‚îÄ‚îÄ core.db_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.language_manager
        ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.config_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.theme_manager
        ‚îú‚îÄ‚îÄ core.theme_manager
          ‚îú‚îÄ‚îÄ core.config_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ core.user_manager
        ‚îú‚îÄ‚îÄ core.user_manager
          ‚îú‚îÄ‚îÄ core.airtable_manager
          ‚îú‚îÄ‚îÄ core.db_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ utils.threading_utils
        ‚îú‚îÄ‚îÄ utils.threading_utils
          ‚îî‚îÄ‚îÄ core.logger
      ‚îú‚îÄ‚îÄ views.add_edit_window
        ‚îú‚îÄ‚îÄ views.add_edit_window
          ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.logger
          ‚îú‚îÄ‚îÄ core.theme_color_manager
          ‚îú‚îÄ‚îÄ utils.window_manager
          ‚îî‚îÄ‚îÄ views.components.combobox
      ‚îú‚îÄ‚îÄ views.login_window
        ‚îú‚îÄ‚îÄ views.login_window
          ‚îú‚îÄ‚îÄ config.login_config
          ‚îú‚îÄ‚îÄ config.modern_color_palettes
          ‚îú‚îÄ‚îÄ core.constants
          ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.logger
          ‚îú‚îÄ‚îÄ core.security.encryption
          ‚îú‚îÄ‚îÄ core.security.rate_limiter
          ‚îú‚îÄ‚îÄ core.theme_color_manager
          ‚îú‚îÄ‚îÄ core.theme_manager
          ‚îú‚îÄ‚îÄ utils.validators
          ‚îî‚îÄ‚îÄ utils.window_manager
      ‚îî‚îÄ‚îÄ views.main_window
        ‚îú‚îÄ‚îÄ views.main_window
          ‚îú‚îÄ‚îÄ core.event_system
          ‚îú‚îÄ‚îÄ core.language_manager
          ‚îú‚îÄ‚îÄ core.logger
          ‚îú‚îÄ‚îÄ core.permissions
          ‚îú‚îÄ‚îÄ core.state_manager
          ‚îú‚îÄ‚îÄ core.theme_color_manager
          ‚îú‚îÄ‚îÄ core.theme_manager
          ‚îú‚îÄ‚îÄ utils.async_operations
          ‚îú‚îÄ‚îÄ utils.image_utils
          ‚îú‚îÄ‚îÄ utils.window_manager
          ‚îú‚îÄ‚îÄ views.components.data_table
          ‚îú‚îÄ‚îÄ views.components.header
          ‚îú‚îÄ‚îÄ views.components.menu_bar
          ‚îú‚îÄ‚îÄ views.components.sidebar
          ‚îú‚îÄ‚îÄ views.components.status_bar
          ‚îî‚îÄ‚îÄ views.components.toolbar
  ‚îú‚îÄ‚îÄ core.airtable_manager
  ‚îú‚îÄ‚îÄ core.config_manager
    ‚îú‚îÄ‚îÄ core.config_manager
      ‚îî‚îÄ‚îÄ core.logger
  ‚îú‚îÄ‚îÄ core.db_manager
    ‚îú‚îÄ‚îÄ core.db_manager
      ‚îî‚îÄ‚îÄ core.logger
  ‚îú‚îÄ‚îÄ core.logger
  ‚îú‚îÄ‚îÄ core.user_manager
    ‚îú‚îÄ‚îÄ core.user_manager
      ‚îú‚îÄ‚îÄ core.airtable_manager
      ‚îú‚îÄ‚îÄ core.db_manager
        ‚îú‚îÄ‚îÄ core.db_manager
          ‚îî‚îÄ‚îÄ core.logger
      ‚îî‚îÄ‚îÄ core.logger
  ‚îî‚îÄ‚îÄ views.splash_screen


============================================================
FILE: project_analyzer.py
SIZE: 15466 characters
============================================================

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Project File Dependency Analyzer
Ÿäÿ≠ŸÑŸÑ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸàŸäÿ±ÿ≥ŸÖ ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ŸàÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™
"""

import os
import ast
import json
import re
from pathlib import Path
from typing import Dict, List, Set, Tuple
from collections import defaultdict, deque
import argparse


class ProjectAnalyzer:
    def __init__(self, project_root: str):
        self.project_root = Path(project_root)
        self.files_info = {}
        self.dependencies = defaultdict(set)
        self.reverse_dependencies = defaultdict(set)
        self.external_imports = defaultdict(set)

    def find_python_files(self) -> List[Path]:
        """ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ Python ŸÅŸä ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ"""
        python_files = []
        for file_path in self.project_root.rglob("*.py"):
            if not any(part.startswith('.') for part in file_path.parts):
                python_files.append(file_path)
        return python_files

    def get_relative_module_name(self, file_path: Path) -> str:
        """ÿ™ÿ≠ŸàŸäŸÑ ŸÖÿ≥ÿßÿ± ÿßŸÑŸÖŸÑŸÅ ÿ•ŸÑŸâ ÿßÿ≥ŸÖ Ÿàÿ≠ÿØÿ© ŸÜÿ≥ÿ®Ÿä"""
        relative_path = file_path.relative_to(self.project_root)
        module_parts = list(relative_path.parts[:-1])  # ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™
        filename = relative_path.stem

        if filename != "__init__":
            module_parts.append(filename)

        return ".".join(module_parts) if module_parts else filename

    def parse_imports(self, file_content: str, current_module: str) -> Tuple[Set[str], Set[str]]:
        """ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ŸÖŸÜ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÑŸÅ"""
        local_imports = set()
        external_imports = set()

        try:
            tree = ast.parse(file_content)

            for node in ast.walk(tree):
                if isinstance(node, ast.Import):
                    for alias in node.names:
                        module_name = alias.name
                        if self.is_local_import(module_name):
                            local_imports.add(module_name)
                        else:
                            external_imports.add(module_name)

                elif isinstance(node, ast.ImportFrom):
                    if node.module:
                        module_name = node.module
                        if node.level > 0:  # relative import
                            # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ÿßŸÑŸÜÿ≥ÿ®Ÿäÿ©
                            resolved_module = self.resolve_relative_import(
                                current_module, module_name, node.level
                            )
                            if resolved_module:
                                local_imports.add(resolved_module)
                        else:
                            if self.is_local_import(module_name):
                                local_imports.add(module_name)
                            else:
                                external_imports.add(module_name)

        except SyntaxError as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅ {current_module}: {e}")

        return local_imports, external_imports

    def is_local_import(self, module_name: str) -> bool:
        """ÿ™ÿ≠ÿØŸäÿØ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ° ŸÖÿ≠ŸÑŸä ÿ£ŸÖ ÿÆÿßÿ±ÿ¨Ÿä"""
        # ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©
        external_modules = {
            'os', 'sys', 'json', 'ast', 're', 'pathlib', 'typing',
            'collections', 'datetime', 'time', 'logging', 'sqlite3',
            'tkinter', 'threading', 'asyncio', 'urllib', 'http',
            'pandas', 'numpy', 'matplotlib', 'seaborn', 'requests',
            'flask', 'django', 'fastapi', 'aiohttp', 'sqlalchemy',
            'pytest', 'unittest', 'mock', 'cryptography', 'PIL',
            'cv2', 'tensorflow', 'torch', 'sklearn', 'scipy'
        }

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ¨ÿ∞ÿ± ÿßŸÑÿ£ŸàŸÑ ŸÑŸÑŸàÿ≠ÿØÿ©
        root_module = module_name.split('.')[0]

        # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ©
        if root_module in external_modules:
            return False

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖŸÑŸÅ ŸÅŸä ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
        possible_paths = [
            self.project_root / f"{module_name.replace('.', '/')}.py",
            self.project_root / f"{module_name.replace('.', '/')}/__init__.py"
        ]

        return any(path.exists() for path in possible_paths)

    def resolve_relative_import(self, current_module: str, import_module: str, level: int) -> str:
        """ÿ≠ŸÑ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ°ÿßÿ™ ÿßŸÑŸÜÿ≥ÿ®Ÿäÿ©"""
        if not current_module:
            return None

        current_parts = current_module.split('.')

        # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑
        for _ in range(level):
            if current_parts:
                current_parts.pop()

        if import_module:
            return '.'.join(current_parts + [import_module])
        else:
            return '.'.join(current_parts) if current_parts else None

    def analyze_file(self, file_path: Path):
        """ÿ™ÿ≠ŸÑŸäŸÑ ŸÖŸÑŸÅ Ÿàÿßÿ≠ÿØ"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()

            module_name = self.get_relative_module_name(file_path)
            local_imports, external_imports = self.parse_imports(content, module_name)

            # ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÑŸÅ
            self.files_info[module_name] = {
                'path': str(file_path),
                'size': len(content),
                'lines': len(content.splitlines()),
                'local_imports': list(local_imports),
                'external_imports': list(external_imports)
            }

            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™
            for imported_module in local_imports:
                self.dependencies[module_name].add(imported_module)
                self.reverse_dependencies[imported_module].add(module_name)

            self.external_imports[module_name] = external_imports

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅ {file_path}: {e}")

    def analyze_project(self):
        """ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÉÿßŸÖŸÑÿßŸã"""
        print("üîç ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÑŸÅÿßÿ™ Python...")
        python_files = self.find_python_files()
        print(f"ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ {len(python_files)} ŸÖŸÑŸÅ Python")

        print("üìñ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™...")
        for file_path in python_files:
            self.analyze_file(file_path)

        print(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ {len(self.files_info)} ŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠")

    def generate_dependency_tree(self, module: str, visited: Set[str] = None, depth: int = 0) -> str:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ŸÑŸàÿ≠ÿØÿ© ŸÖÿπŸäŸÜÿ©"""
        if visited is None:
            visited = set()

        if module in visited:
            return "  " * depth + f"‚îú‚îÄ‚îÄ {module} (ÿØÿßÿ¶ÿ±Ÿä)\n"

        visited.add(module)
        tree = "  " * depth + f"‚îú‚îÄ‚îÄ {module}\n"

        if module in self.dependencies:
            deps = sorted(self.dependencies[module])
            for i, dep in enumerate(deps):
                if i == len(deps) - 1:
                    tree += "  " * (depth + 1) + f"‚îî‚îÄ‚îÄ {dep}\n"
                else:
                    tree += "  " * (depth + 1) + f"‚îú‚îÄ‚îÄ {dep}\n"

                if dep in self.dependencies and depth < 3:  # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπŸÖŸÇ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿπŸÇŸäÿØ
                    tree += self.generate_dependency_tree(dep, visited.copy(), depth + 2)

        return tree

    def find_circular_dependencies(self) -> List[List[str]]:
        """ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑÿØÿßÿ¶ÿ±Ÿäÿ©"""
        circles = []
        visited = set()

        def dfs(node, path, rec_stack):
            if node in rec_stack:
                # Ÿàÿ¨ÿØŸÜÿß ÿØÿßÿ¶ÿ±ÿ©
                circle_start = path.index(node)
                circle = path[circle_start:] + [node]
                circles.append(circle)
                return

            if node in visited:
                return

            visited.add(node)
            rec_stack.add(node)
            path.append(node)

            for neighbor in self.dependencies.get(node, []):
                dfs(neighbor, path, rec_stack)

            path.pop()
            rec_stack.remove(node)

        for module in self.files_info:
            if module not in visited:
                dfs(module, [], set())

        return circles

    def get_most_imported_modules(self, top_n: int = 10) -> List[Tuple[str, int]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã"""
        import_counts = {}
        for module, deps in self.reverse_dependencies.items():
            import_counts[module] = len(deps)

        return sorted(import_counts.items(), key=lambda x: x[1], reverse=True)[:top_n]

    def get_most_importing_modules(self, top_n: int = 10) -> List[Tuple[str, int]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™ ÿ£ÿÆÿ±Ÿâ"""
        import_counts = {}
        for module, deps in self.dependencies.items():
            import_counts[module] = len(deps)

        return sorted(import_counts.items(), key=lambda x: x[1], reverse=True)[:top_n]

    def generate_report(self) -> str:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÇÿ±Ÿäÿ± ÿ¥ÿßŸÖŸÑ"""
        report = []
        report.append("=" * 60)
        report.append("üìä ÿ™ŸÇÿ±Ÿäÿ± ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ")
        report.append("=" * 60)
        report.append("")

        # ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿπÿßŸÖÿ©
        report.append("üìà ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©:")
        report.append(f"  ‚Ä¢ ÿπÿØÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™: {len(self.files_info)}")
        total_lines = sum(info['lines'] for info in self.files_info.values())
        report.append(f"  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ≥ÿ∑ÿ±: {total_lines:,}")
        total_size = sum(info['size'] for info in self.files_info.values())
        report.append(f"  ‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≠ÿ¨ŸÖ: {total_size:,} ÿ≠ÿ±ŸÅ")
        report.append("")

        # ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã
        report.append("üîó ÿ£ŸÉÿ´ÿ± ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßÿ≥ÿ™ÿØÿπÿßÿ°Ÿã:")
        most_imported = self.get_most_imported_modules()
        for module, count in most_imported:
            report.append(f"  ‚Ä¢ {module}: {count} ÿßÿ≥ÿ™ÿØÿπÿßÿ°")
        report.append("")

        # ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™
        report.append("üì§ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿØÿπŸä ÿ£ŸÉÿ´ÿ± Ÿàÿ≠ÿØÿßÿ™:")
        most_importing = self.get_most_importing_modules()
        for module, count in most_importing:
            report.append(f"  ‚Ä¢ {module}: Ÿäÿ≥ÿ™ÿØÿπŸä {count} Ÿàÿ≠ÿØÿ©")
        report.append("")

        # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑÿØÿßÿ¶ÿ±Ÿäÿ©
        circles = self.find_circular_dependencies()
        if circles:
            report.append("‚ö†Ô∏è  ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ© ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸäŸáÿß:")
            for i, circle in enumerate(circles, 1):
                report.append(f"  {i}. {' ‚Üí '.join(circle)}")
        else:
            report.append("‚úÖ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©")
        report.append("")

        # ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ŸÑŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        if "app" in self.files_info:
            report.append("üå≥ ÿ¥ÿ¨ÿ±ÿ© ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä (app):")
            report.append(self.generate_dependency_tree("app"))

        return "\n".join(report)

    def save_detailed_analysis(self, output_file: str = "project_analysis.json"):
        """ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÅÿµŸÑ ŸÅŸä ŸÖŸÑŸÅ JSON"""
        analysis_data = {
            "files": self.files_info,
            "dependencies": {k: list(v) for k, v in self.dependencies.items()},
            "reverse_dependencies": {k: list(v) for k, v in self.reverse_dependencies.items()},
            "external_imports": {k: list(v) for k, v in self.external_imports.items()},
            "statistics": {
                "total_files": len(self.files_info),
                "total_lines": sum(info['lines'] for info in self.files_info.values()),
                "total_size": sum(info['size'] for info in self.files_info.values()),
                "circular_dependencies": self.find_circular_dependencies(),
                "most_imported": self.get_most_imported_modules(),
                "most_importing": self.get_most_importing_modules()
            }
        }

        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(analysis_data, f, ensure_ascii=False, indent=2)

        print(f"üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÅÿµŸÑ ŸÅŸä: {output_file}")

    def generate_graphviz_dot(self, output_file: str = "dependency_graph.dot"):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz ŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ¥ÿ¨ÿ±ÿ© ÿ®ÿµÿ±ŸäÿßŸã"""
        dot_content = ["digraph ProjectDependencies {"]
        dot_content.append("  rankdir=TB;")
        dot_content.append("  node [shape=box, style=filled, fillcolor=lightblue];")
        dot_content.append("")

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÇÿØ
        for module in self.files_info:
            # ÿ™ŸÜÿ≥ŸäŸÇ ÿßÿ≥ŸÖ ÿßŸÑÿπŸÇÿØÿ©
            clean_name = module.replace(".", "_")
            display_name = module.split(".")[-1] if "." in module else module

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÑŸàŸÜ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÜŸàÿπ ÿßŸÑŸÖŸÑŸÅ
            if "controller" in module:
                color = "lightcoral"
            elif "view" in module:
                color = "lightgreen"
            elif "core" in module:
                color = "lightyellow"
            elif "util" in module:
                color = "lightgray"
            else:
                color = "lightblue"

            dot_content.append(f'  {clean_name} [label="{display_name}", fillcolor={color}];')

        dot_content.append("")

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑÿßÿ™
        for module, deps in self.dependencies.items():
            clean_module = module.replace(".", "_")
            for dep in deps:
                clean_dep = dep.replace(".", "_")
                dot_content.append(f"  {clean_module} -> {clean_dep};")

        dot_content.append("}")

        with open(output_file, 'w', encoding='utf-8') as f:
            f.write("\n".join(dot_content))

        print(f"üìä ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz: {output_file}")
        print("ŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ¥ÿ¨ÿ±ÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ£ŸÖÿ±: dot -Tpng dependency_graph.dot -o dependency_graph.png")


def main():
    parser = argparse.ArgumentParser(description="ÿ™ÿ≠ŸÑŸäŸÑ ÿßÿπÿ™ŸÖÿßÿØŸäÿßÿ™ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ")
    parser.add_argument("project_path", nargs="?", default=".",
                       help="ŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ (ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä: ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ≠ÿßŸÑŸä)")
    parser.add_argument("--output", "-o", default="project_analysis",
                       help="ÿßÿ≥ŸÖ ŸÖŸÑŸÅ ÿßŸÑÿ•ÿÆÿ±ÿßÿ¨ (ÿ®ÿØŸàŸÜ ÿßŸÖÿ™ÿØÿßÿØ)")
    parser.add_argument("--graphviz", action="store_true",
                       help="ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz ŸÑŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ÿµÿ±Ÿä")

    args = parser.parse_args()

    # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    if not os.path.exists(args.project_path):
        print(f"‚ùå ÿßŸÑŸÖÿ≥ÿßÿ± ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ: {args.project_path}")
        return

    print(f"üöÄ ÿ®ÿØÿ° ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÅŸä: {os.path.abspath(args.project_path)}")
    print("-" * 50)

    # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≠ŸÑŸÑ
    analyzer = ProjectAnalyzer(args.project_path)

    # ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    analyzer.analyze_project()

    # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±
    report = analyzer.generate_report()
    print(report)

    # ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÅÿµŸÑ
    json_file = f"{args.output}.json"
    analyzer.save_detailed_analysis(json_file)

    # ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÜÿµŸä
    txt_file = f"{args.output}.txt"
    with open(txt_file, 'w', encoding='utf-8') as f:
        f.write(report)
    print(f"üìÑ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ŸÅŸä: {txt_file}")

    # ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ Graphviz ÿ•ÿ∞ÿß ÿ∑ŸèŸÑÿ®
    if args.graphviz:
        dot_file = f"{args.output}.dot"
        analyzer.generate_graphviz_dot(dot_file)


if __name__ == "__main__":
    main()


============================================================
FILE: requirements.txt
SIZE: 784 characters
============================================================

# Core GUI Framework
customtkinter==5.2.2
tkinter-tooltip==2.2.0
tkcalendar==1.6.1

# Airtable Integration
pyairtable==3.1.1
requests==2.31.0

# Configuration & Environment
python-dotenv==1.0.0
PyYAML==6.0.1

# Image Processing
Pillow==11.2.1

# Data Analysis & Visualization
matplotlib==3.10.3
seaborn==0.13.2
pandas==2.2.3
numpy==2.2.5

# Excel & PDF Export
openpyxl==3.1.2
fpdf==1.7.2
reportlab==4.4.1

# Validation (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
phonenumbers==8.13.0

# System Monitoring (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
psutil>=5.9.0

# Testing
pytest==8.0.0
pytest-cov==6.1.1
pytest-mock==3.14.0

# Code Quality
black==24.1.1
flake8==7.0.0
isort==6.0.1
mypy==1.15.0

# Documentation
Sphinx==8.2.3
sphinx-rtd-theme==3.0.2

# Build Tools
setuptools==80.9.0
wheel==0.45.1
pyinstaller==6.13.0
pyinstaller-hooks-contrib==2025.3

============================================================
FILE: cache\dropdown_cache.json
SIZE: 48171 characters
============================================================

{
  "guides": {
    "values": [
      "Arabic",
      "Bengali",
      "Burmese",
      "Chinese",
      "English",
      "French",
      "German",
      "Gujarati",
      "Hindi",
      "Italian",
      "Japanese",
      "Javanese",
      "Kannada",
      "Korean",
      "Malayalam",
      "Marathi",
      "Pashto",
      "Persian",
      "Polish",
      "Portuguese",
      "Punjabi",
      "Russian",
      "Spanish",
      "Tamil",
      "Telugu",
      "Thai",
      "Turkish",
      "Ukrainian",
      "Urdu",
      "Vietnamese"
    ],
    "timestamp": "2025-07-03T04:16:24.975910"
  },
  "options": {
    "values": [
      "Adventure Tour",
      "Cultural Tour",
      "Custom Package",
      "Family Package",
      "Full Day",
      "Group Tour",
      "Half Day",
      "Multi-Day",
      "Private Tour",
      "Standard Tour",
      "VIP Experience",
      "test"
    ],
    "timestamp": "2025-07-03T04:16:25.015600"
  },
  "agencies": {
    "values": [
      "FTS-Travels",
      "Other",
      "√Ñgypten Ausfl√ºge"
    ],
    "timestamp": "2025-07-03T04:16:25.024286"
  },
  "destinations": {
    "values": [
      "Aswan",
      "Cairo",
      "Hurghada",
      "Luxor",
      "Marsa Alam",
      "Sharm El-Sheikh"
    ],
    "timestamp": "2025-07-03T04:16:26.175975"
  },
  "addons": {
    "values": [
      "Transfer Extra: TUI MAGIC LIFE Kalawy, You will pay 25 euros per person for an extra transfer",
      "Transfer Extra: You will pay 10 euros per person for an extra transfer"
    ],
    "timestamp": "2025-07-03T04:16:27.325742"
  },
  "tripnames": {
    "values": [
      "ATV Quad Bike Ride At GIZA Pyramids & BBQ Dinner.",
      "Abu Simbel Sound & light Show - QR Ticket",
      "Abu Simbel Temple QR Tickets",
      "All-inclusive private Trip Pyramids Sphinx, Camel, VIP Lunch",
      "Aswan: Private Nile Boat Cruise and Botanical Garden Visit",
      "Cairo Elite: VIP Airport Welcome or Custom Luxury Tour",
      "Cairo Private Day Trip: Museum , Pyramids & Lunch",
      "Cairo on a Budget: 4-Night Stay & Guided City Highlights",
      "Cairo: 5-Day Egypt Itinerary for Cairo and the Pyramids",
      "Cairo: Customized Full-Day Private Tour",
      "Cairo: Egyptian Museum and National Museum Private Tour",
      "Cairo: Giza Pyramids Tour & Grand Egyptian Museum",
      "Cairo: Giza Pyramids, sphinx and National Museum with Lunch",
      "Cairo: Grand Egyptian Museum Guided Tour and Lunch",
      "Cairo: Guided tour with Al-Hakim Mosque",
      "Cairo: Guided tour with Mosque of Amr ibn al-As",
      "Cairo: Guided tour with Opera House",
      "Cairo: Museum of Islamic Arts QR Tickets & Skip Line",
      "Cairo: Nile Dinner Cruise with Belly Dancer Show and Music",
      "Cairo: Nile Pharaoh Dinner Cruise& Nile with Show",
      "Cairo: Oriental Breakfast (Fatir)or Lunch in arabian village",
      "Cairo: Private Airport Pickup or Drop-Off Service",
      "Cairo: Private Day Tour to Luxor with Sleeper train",
      "Cairo: Private Day Tour to Pharaonic Village",
      "Cairo: Private Jet Sightseeing Tour",
      "Cairo: Private Pyramids Tour with Photographer and Transfer",
      "Cairo: Pyramids & Sphinx Private Tour with Camel Ride",
      "Cairo: Pyramids Arabian Horse or Camel Ride with Bedouin Tea",
      "Cairo: Quad Bike Adventure at Giza Pyramids W/ Camel Ride",
      "Cairo: Sound and Light Show at Giza Pyramids",
      "Cairo: Sound and light show with Dinner with Pyramids view",
      "Cairo: The Coptic Museum QR ticket - Skip The Line",
      "Cairo: Trip Pyramids, Sakkara, & Memphis Tour Lunch",
      "Chatby Tombs Alexandria Day Tour from Cairo",
      "Citadel of Salahdin & Mohamed Ali Mosque QR Ticket",
      "Edfu Temple Sound Light Show Entry Ticket with Transfer",
      "Egyptian Civilization Museum, Citadel & Old Cairo Tour",
      "Egyptian Museum of Antiquities online QR Ticket",
      "Exclusivity: El Gouna Lagoon tour,Snorkel,Dive with Dolphins",
      "From Cairo: Small-Group Day Trip to Luxor by Plane",
      "From Giza/Cairo: Pyramids, Sphinx, and NMEC Tour with Lunch",
      "From Hurghada: Abydos, Osireion, and Dendera Day Tour",
      "From Hurghada: Full-Day Trip to Cairo by Plane",
      "From Hurghada: Historical Tour to Luxor with Hotel Transfer",
      "From Hurghada: Luxor Full-Day Trip with Valley of the Kings",
      "From Hurghada: Majestic Cairo & Giza Highlights Tour By Van",
      "From Hurghada: Two-Day Private Tour of Luxor and Abu Simbel",
      "From Marsa Alam: Private Day Trip to Luxor by Car",
      "From Sharm El-Sheikh: Cairo Day Tour to Pyramids By Bus",
      "From Sharm El-Sheikh: Cairo's Pyramids: Full-Day Journey",
      "From Sharm El-Sheikh: Giza Day Trip with Lunch and Transfer",
      "From Sharm ElSheikh: The Lost City (Petra) Day Tour by Ferry",
      "From Sharm: Ras Muhammed & White Island By Boat & intro Dive",
      "From Sokhna Port: Cairo & Pyramids New Passage Day-Tour",
      "Giza: Grand Egyptian Museum, Old Cairo and Khan Al-khalili",
      "Grand Egyptian Museum QR Ticket",
      "HRG:Private City Tour with Seafood at Barbouni Restaurant",
      "Hurghada to Cairo: Full-Day Tour one way Bus & Flight Return",
      "Hurghada: 2-Day Luxor Tour with Hotel, Balloon, & Nile Boat",
      "Hurghada: Cruise to Bianca Island Utopia w/ Transfer & Lunch",
      "Hurghada: Desert & Sea Horse Riding with + 360¬∞ Photos",
      "Hurghada: Desert Quad Bike Tout with Optional GoPro",
      "Hurghada: Desert Quad Bike and Buggy Adventure with Transfer",
      "Hurghada: Diving & Snorkeling Cruise Tour w Lunch & Drinks",
      "Hurghada: Dolphin & Coral Reef Snorkeling Tour with Lunch",
      "Hurghada: Dolphin Watching Boat Tour with Snorkeling & Lunch",
      "Hurghada: Dolphin Watching Cruise, Snorkeling & Lunch",
      "Hurghada: Eden Island Xtreme, Parasail, Dive & Water Sports",
      "Hurghada: Empire Submarine Boat Trip with Snorkel and Drinks",
      "Hurghada: Full-Day Snorkeling Tour in Sharm El Naga w/Lunch",
      "Hurghada: Full-Day Tour to Cairo by Plane with Egyptologist",
      "Hurghada: Full-Day Trip to Cairo by Plane",
      "Hurghada: Giftun Island with breakfast, lunch & Water Sports",
      "Hurghada: Giza Pyramids Day Trip with Nile Boat Tour Option",
      "Hurghada: Glass Boat and Parasailing Trip with Snorkeling",
      "Hurghada: Guided City Highlights Tour with Shopping Stops",
      "Hurghada: Jeep & Camel Safari with Dinner & Desert Fire Show",
      "Hurghada: Jerusalem day tour from Hurghada by flight",
      "Hurghada: Jungle Aqua Park with Lunch & Transfer (Optional)",
      "Hurghada: Karnak, Hatshepsut, and the Valley of the Kings",
      "Hurghada: Luxor Valley of the Kings & Tutankhamun Tomb Trip",
      "Hurghada: Luxury VIP La Rock Spa & Beauty Salon",
      "Hurghada: Makadi Water World with Lunch & Transfers",
      "Hurghada: Mega Jeep safari, ATV & Camel & with Bedouin vibe",
      "Hurghada: Morning or Sunset Sights Guided Tour with Shopping",
      "Hurghada: Neverland Musical Show Entry Tickets with Pickup",
      "Hurghada: Orange Bay Day Trip with Water Sports and Lunch",
      "Hurghada: Orange Bay island With Parachute Adventure & Lunch",
      "Hurghada: Orange Island Snorkeling, Diving, and Water Sports",
      "Hurghada: Orange Island Yacht Trip with Lunch & Water Sports",
      "Hurghada: Private Airport Arrival/Departure One Way Transfer",
      "Hurghada: Quad, Jeep, Camel and Buggy Safari with BBQ Dinner",
      "Hurghada: Red Sea & Desert Horse Riding Tour with Swimming",
      "Hurghada: Safari 5*1 Quad, Stargazing, Horse ride w/ Dinner",
      "Hurghada: Scenic Submarine Tour with Snorkeling and Transfer",
      "Hurghada: Sea and Mountains Quad or Buggy Family Tour",
      "Hurghada: Snorkeling Cruise to Eden Island with Lunch",
      "Hurghada: Star Watching Desert Adventure by Jeep with Dinner",
      "Hurghada: Unique Bedouin Craft, Handmade and Star Watching",
      "Luxor: Caravanserai private Day Tour",
      "Luxor: Half Day Motor Boat Ride with Banana Island Visit",
      "Luxor: Luxor Museum Entry Tickets or Guided Tour",
      "Luxor: Qurna Village in luxor tour and transfer",
      "Marsa Alam: Ancient Cairo & Giza Pyramids Day Trip by Plane",
      "Marsa Alam: Desert Stargazing Tour with Camel Ride & Dinner",
      "Marsa Alam: Hamata Island Snorkeling Trip with Lunch",
      "Marsa Alam: Snorkeling with Sea Turtles Marsa Mubarak",
      "Marsa Alam: Valley of the Kings & Karnak Temples Luxor Tour",
      "Marsa Alam:Sataya Reefs Dolphin Snorkeling Cruise with Lunch",
      "Mummification Museum QR Ticket or Guided tour",
      "National Museum of Egypt Skip-the-Line QR Ticket",
      "One-Way Journey from Sharm El Sheikh to Hurghada",
      "Philae Temple Sound & Light Show in Aswan",
      "Prince Mohamed Ali Palace Manial QR Tickets",
      "Private Customizable Day Tour to Alexandria from Cairo",
      "Private Half-Day Adventure: Giza Pyramids & Sphinx",
      "Private Half-Day Sightseeing Tour to El Gouna from Hurghada",
      "Pyramids of Giza Plateau Entrance Ticket",
      "Red Sea: SCUBA Diving Experience & Snorkeling Boot Tour",
      "Safaga Airport transfer with option meet & assist",
      "Sharm El Sheikh: ATV Dunes & Waves Adventure with Lunch",
      "Sharm El Sheikh: Cleopatra Bath with Deluxe Spa Treatments",
      "Sharm El Sheikh: Mount Sinai & St. Catherine Monastery Tour",
      "Sharm El Sheikh: Private City Tour W Water Sports Adventure",
      "Sharm El Sheikh: Private City Tour with Seafood Dinner",
      "Sharm El Sheikh: Snorkeling Trip to Tiran Island with Lunch",
      "Sharm El Sheikh: Trip to Luxor & Tutankhamun Tomb by Plane",
      "Sharm El-Sheikh Port to Ras Mohamed National Park by Car",
      "Sharm El-Sheikh: ATV and Camel Ride with BBQ Dinner and Show",
      "Sharm El-Sheikh: Airport One-Way Private Hotel Transfer",
      "Sharm El-Sheikh: Cairo Full-Day Meet The Pharaohs by Flight",
      "Sharm El-Sheikh: Camel Riding, Stargazing, BBQ Dinner & Show",
      "Sharm El-Sheikh: City & Shopping Tour With Old Market Visit",
      "Sharm El-Sheikh: Desert Buggy Safari Adventure",
      "Sharm El-Sheikh: Ghibli Raceway Day Trip",
      "Sharm El-Sheikh: Jeep Adventure to Blue Hole, Canyon & Dahab",
      "Sharm El-Sheikh: Morning Desert ATV Quad & Buggy Adventure",
      "Sharm El-Sheikh: Ras Mohamed & White Island Snorkeling Trip",
      "Sharm El-Sheikh: Ras Mohamed Half Day Tour & Allah's gate",
      "Sharm El-Sheikh: Ras Mohammed & White Island Cruise",
      "Sharm El-Sheikh: Stargazing with Luxury Dinner",
      "Sharm El-Sheikh: Ultimate ATV Quad, Stargazing & BBQ Dinner",
      "Sharm El-Sheikh:King Tut Museum QR Ticket with Optional Tour",
      "Sharm ElSheikh: ATV Quad & Buggy Adventure Sunrise or Sunset",
      "Sharm el-Sheikh Museum Entry Ticket & Private Hotel Transfer",
      "Temple of Hatshepsut QR Ticket - Skip The Line",
      "Trip from Cairo to Luxor by Sleeper Train with Shared group",
      "VIP Cairo Experience: Pyramids, ATV Adventure and Camel ride"
    ],
    "timestamp": "2025-07-03T04:16:27.721890"
  },
  "management_options": {
    "values": [
      "0ne guest with entrance fees and two without",
      "1 dbl buggy",
      "1 dbl buggy 2 x fts scarve",
      "1 dbl buggy 2 x fts scarve private transfer private guide",
      "1 dbl buggy 2 x stargazing",
      "1 dbl buggy 3 x fts scarve",
      "1 dbl buggy private guide",
      "1 dbl quaad 1 sgl quad",
      "1 dbl quad",
      "1 dbl quad 1 sgl quad",
      "1 dbl quad 1 x fts scarve",
      "1 dbl quad 2 x fts scarve",
      "1 dbl quad 2 x fts scarve private transfer 2 x vip dinner",
      "1 dbl quad 2 x vip dinner",
      "1 dbl quad 2 x vip dinner 2 x fts scarve",
      "1 dbl quad private guide",
      "1 family 1 trbl buggy 1 dbl buggy",
      "1 family buggy",
      "1 family buggy 2 x fts scarve",
      "1 family buggy stargazing private transfer",
      "1 sgl",
      "1 sgl buggy",
      "1 sgl quad",
      "1 sgl quad 1 x fts scarve",
      "1 trbl buggy",
      "1 trbl buggy 1 dbl buggy",
      "1 trbl buggy 1 x fts scarve",
      "1 trbl buggy 3 x vip dinner",
      "1 x fts scarve",
      "1-hour dolphin show afternoon at dolphina hurghada",
      "1-hour dolphin show afternoon at dolphina with transfers dh-aftn-01",
      "1-hour dolphin show at dolphin world with private transfer",
      "1-hour dolphin show at dolphin world with transfer",
      "1-hour dolphin show morning at dolphin world with transfer",
      "1-hour dolphin show morning at dolphin world with transfer dw-morn-01",
      "1009a 3-hour desert quad bike tour at sunset without gopro",
      "11 sgl quad",
      "123 2-hour horseback riding journey with swimming",
      "1990 dinner cruise on pharaoh",
      "2 days overnight trip with hot air balloon",
      "2 dbl buggy",
      "2 dbl quad",
      "2 dbl quad 1 sgl quad",
      "2 dbl quad 4 x fts scarve",
      "2 dbl quad 4 x vip dinner",
      "2 kids free 2 guide free",
      "2 sgl buggy",
      "2 sgl quad",
      "2 sgl quad 1 x fts scarve",
      "2 sgl quad 2 x fts scarve",
      "2 sgl quad 2 x fts scarve without dinner",
      "2 sgl quad 2 x vip dinner",
      "2 sgl quad without dinner",
      "2 sgl quadpriavte guide",
      "2 trbl buggy",
      "2-day luxor tour shared tour - with entry fees",
      "2-day luxor tour with hotel shared tour - without entry fees",
      "2-hour horse ride",
      "2-hour horse ride journey without swim",
      "2-hour horse ride without swim 14:00",
      "2-hour horseback riding journey with swimming",
      "2-hour horseback riding journey with swimming 123",
      "2-hour ride with swim stop 123",
      "2-hour ride without swim stop",
      "2-hour ride without swim stop 586",
      "2-hour safari with camel ride",
      "2-hour safari with camel ride bike",
      "2-hour safari with camel ride from hurghada",
      "2-hour safari with camel ride from hurghada bike",
      "2-hour swimming horse ride journey 360 photos",
      "2044 stargazing with atv quad ride & jeep",
      "2044 stargazing with quad ride & dance show with private transfer",
      "2212000 arrival at sharm el-sheikh international airport",
      "2212000 from sharm: ras muhammed & white island by boat & intro dive",
      "2212000 single quad - 1 person in 1 quad",
      "2x without entrance fees",
      "3 - hour desert horse ride with swimming - private transfer 586",
      "3 dbl quad",
      "3 dbl quad 1 sgl quad",
      "3 hour camel riding with bedouin vibe with private transfer",
      "3 hours quad tour",
      "3 hours quad tour -",
      "3 sgl quad",
      "3 sgl quad 3 x fts scarve",
      "3 sgl quad 3 x vip dinner 3 x fts scarve",
      "3-horse ride with swim stop",
      "3-horse ride with swim stop 586",
      "3-horse ride without swim stop",
      "3-hour atv quad tour morning with transfer",
      "3-hour atv quad tour morning with transfer without gopro",
      "3-hour atv quad tour sunset with transfer",
      "3-hour atv quad tour sunset with transfer 1009a",
      "3-hour atv quad tour sunset with transfer without gopro 1009a",
      "3-hour desert & sea horse riding with swimming",
      "3-hour desert & sea horse riding with swimming 586",
      "3-hour desert quad bike tour at sunset without gopro 1009a",
      "3-hour desert quad bike tour without gopro",
      "3-hour horse riding with swim",
      "3-hour quad tour with complimentary fts scarf",
      "3-hour sea horse riding with swimming without 360 photos",
      "3-hr horse ride & swim stop -",
      "3-hr horse ride & swim stop - 586",
      "3-hr horse ride & swim stop - makadi sahl hashesh safaga",
      "3-hr horse ride & swim stop - makadi sahl hashesh safaga 586",
      "3-hr horse ride & swim stop promo offer",
      "3-hr horse ride & swim stop promo offer 586",
      "4 dbl quad",
      "4 sgl quad",
      "4 sgl quad 4 x fts scarve",
      "4 sgl quad collect 20 euro",
      "4 sgl quad private transfer 1 x fts scarve 1 x private guide 1 x vip dinner",
      "4-day cairo short break without accommodation",
      "4567 private half-day sightseeing tour to el gouna from hurghada",
      "5 hour desert adventure safari with bbq dinner",
      "5 sgl quad",
      "5-hour atv quad tour with transfer & bbq dinner",
      "5-hour quad safari adventure and dinner bike",
      "5-hour safari with camel ride & dinner: al ahyaa/makadi/sahl",
      "5-hour safari with camel ride & dinner: al ahyaa/makadi/sahl bike",
      "5-hour safari with camel ride and dinner",
      "5-hour safari with camel ride and dinner bike",
      "5-hour safari with camel ride and dinner from hurghada",
      "5-hour safari with camel ride and dinner from hurghada bike",
      "5-hour safari with camel ride from hurghada bike",
      "5555 full-day orange bay group tour",
      "586 3-hour desert & sea horse riding with swimming",
      "586 mega offer: 2-hour horse ride journey without swim",
      "6 sgl quad",
      "618 with atv quad & blue hole tour & abu galum nature",
      "618 with blue hole & abu galum",
      "618 without blue hole & abu galum",
      "686868 family buggy desert safari from sharm el sheikh",
      "8 sgl quad",
      "8-hour safari with buggy camel bedouin village & dinner",
      "8-hour safari with buggy camel bedouin village & dinner buggy",
      "8-hour tour with pickup from cairo airport cai1",
      "8080 cairo private jet sightseeing tour",
      "8885 entry ticket to sharm el naga tour with snorkeling & lunch",
      "96969 hurghada: snorkeling dolphin watching",
      "9876 eden island with lunch on the island",
      "accommodate instead of going back",
      "accommodation transportation guides and entrance fees 17893",
      "afternoon",
      "al ahyaa/makadi bay/sahl hasheesh: 2-hour quad tour bike",
      "all inclusive",
      "all inclusive group tour",
      "all inclusive private trip with entrance fees 321",
      "all inclusive super safari",
      "all inclusive super safari tour",
      "all-inclusive",
      "all-inclusive private trip pyramids sphinx camel vip lunch",
      "all-inclusive private trip pyramids sphinx camel vip lunch 1515",
      "all-inclusive safari: buggy quad camel show & dinner",
      "all-inclusive safari: buggy quad camel show & dinner buggy",
      "all-inclusive super safari private tour",
      "all-inclusive super safari private tour bike",
      "all-inclusive tour: lunch great pyramid & boat",
      "aqua park ticket with transfer & all-inclusive food & drinks",
      "arrival at sharm el-sheikh international airport 2212000",
      "aswan - kom ombo - phaela temple lunch",
      "aswan to luxor cruise & sunrise balloon",
      "atv quad & blue holeabu galum 08:00",
      "atv quad adventure",
      "atv& blue hole tour& abu galum",
      "atv&blue hole tour& abu galum",
      "ausflug von hurghada nach kairo mit dem flugzeug tour type group",
      "ausflug-safaga-nach-luxor-mit-bus tour type group",
      "begginer boat cruise with 2 intro-dives snorkeling lunch",
      "best value tour entry fees & boat ride covered",
      "bike express morning desert safari with jeep quad & buggy",
      "blue bomba: eden island xtremeparasail & dive water sports 1212",
      "boat cruise snorkeling and lunch with private transfer",
      "boat cruise with 2 intro-dives snorkeling lunch premium begginer",
      "boat cruise with 2 snorkeling sites lunch deluxe snorkeling",
      "boat snorkeling lunch with private transfer",
      "boat trip with intro dive and snorkeling equipment",
      "boat trip with snorkeling equipment",
      "boat trip without snorkeling equipment",
      "boat trip without snorkeling equipment snor",
      "buy for 3 people get the fourth free",
      "cai2 cairo or giza: 10-hour private tour with hotel pickup",
      "cairo by bus hurghada",
      "cairo by bus hurghada with entry fees",
      "cairo by bus hurghada without entry fees",
      "cairo by plane: daily tour with entry fees",
      "cairo day tour",
      "cairo day tour with lunch",
      "cairo day tours to giza pyramids & and egmuseum / 6 hours",
      "cairo day trip pyramids & grand egyptian museum & egyptian museum & lunch",
      "cairo day trip with entry fees free hurghada city tour",
      "cairo grand egyptian museum from & khan el khalili bazaar 200134",
      "cairo or giza: 10-hour private tour with hotel pickup",
      "cairo or giza: 10-hour private tour with hotel pickup cai2",
      "cairo or giza: 8-hour private tour with hotel pickup",
      "cairo or giza: 8-hour private tour with hotel pickup 8-hour tour",
      "cairo pyramids day tour by plane hurghada",
      "cairo: egypt tour package: 15 days all-inclusive",
      "cairo: grand egyptian museum guided tour and lunch 85963",
      "cairo: grand egyptian museum qr ticket",
      "cairo: grand egyptian museum qr ticket 708090",
      "cairo: national museum of egypt skip-line qr ticket 2001618",
      "cairo: pharaoh dinner cruise on the with show",
      "cairo: private pyramids tour with photographer and transfer",
      "city & shopping tour with old market & new panorama cafe",
      "city & shopping tour with old market visit",
      "city & shopping tour with old market visit // limo",
      "city group tour without lunch",
      "city tour- small group experience - without lunch & shisha",
      "colored canyon & blue hole",
      "cruise aswan to luxor with meals",
      "dahab",
      "dbl quad",
      "desert & sea horse riding with swimming",
      "desert adventure safari with bbq dinner",
      "desert adventure safari with bbq dinner in 5 hours",
      "desert safari with double quad and stargazing",
      "dh-aftn-01 1-hour dolphin show afternoon at dolphina with transfers",
      "dinner cruise on crystal 1990",
      "dinner cruise on pharaoh",
      "dinner cruise on pharaoh 1990",
      "diving day trip by boat at ras mohamed in sharm el sheikh",
      "diving with dolphin snorkeling & lunch",
      "dolphin swimming hurghada excursion",
      "dolphin swimming hurghada excursion tour type group",
      "dolphin watching boat tour with diving",
      "dolphin watching boat tour with diving & lunch",
      "dolphin watching boat tour with snorkeling & lunch",
      "dolphin watching snorkeling & lunch - tax not include",
      "double buggy - 2 people in 1 buggy",
      "double buggy - 2 people in 1 buggy defaultd",
      "double dune buggy adventure to bedouin village bike",
      "double dune buggy desert safari from sharm el sheikh 686868",
      "double quad - 2 people in 1 quad",
      "double quad mega safari waves and dunes with lunch sunset",
      "dropoff: cairo airport",
      "dropoff: pyramids park",
      "dw-morn-01 1-hour dolphin show morning at dolphin world with transfer",
      "east and west",
      "eden island with lunch on the island 9876",
      "egyptian museumcitadel & old cairo tour without entry fees 1594",
      "el gouna lagoon and dolphin diving with lunch",
      "el gouna lagoon diving with dolphin snorkeling & lunch",
      "el gouna: desert & sea horse riding with swimming",
      "enter inside great pyramid boat",
      "enter the pyramids and ride a camel and lunch",
      "entry fee & inside the pyramid",
      "entry fees",
      "entry fees & boat ride",
      "entry fees & great pyramid",
      "entry fees & king tutankhamun tomb",
      "entry fees & king tutankhamun tomb - private tour",
      "entry fees & tutankhamun tomb",
      "entry fees & tutankhamun tomb 04:30",
      "entry fees and king tutankhamun tomb",
      "entry fees for the grand pyramids and boat",
      "entry fees with valley of the kings king tutankhamun tomb",
      "entry fees with valley of the kings king tutankhamun tomb tut",
      "entry ticket to grand aquarium & zoo tickets with transfers gaz-ht-001",
      "evening desert safari and stargazing",
      "evening dinner cruise in cairo with private transportation",
      "explore together tour with entry fees",
      "express morning desert safari with jeep quad & buggy",
      "express morning desert safari with jeep quad & buggy bike",
      "family buggy",
      "family buggy - 4 people in 1 buggy",
      "family buggy desert safari from sharm el sheikh",
      "family buggy desert safari from sharm el sheikh 686868",
      "family dune buggy adventure to bedouin village",
      "family dune buggy adventure to bedouin village buggy",
      "farsha cafe round-trip hotel transfers",
      "farsha cafe round-trip hotel transfers 202",
      "flight details",
      "flight from hurghada to cairo giza pyramids & grand egyptian museum & khan el khalili",
      "frais dentre et tombeau de toutankhamon",
      "from cairo: 8-day egypt tour with hotel meals & cruise",
      "from giza/cairo: pyramids sphinx and nmec tour with lunch",
      "from hurghada to giza pyramids and egyption museum tour type group",
      "from hurghada to giza pyramids and egyption museum tour type group without entry",
      "from hurghada: abydos osireion and dendera day tour",
      "from hurghada: private el gouna sightseeing half-day trip",
      "from hurghada: private el gouna sightseeing half-day trip 4567",
      "from marsa alam to pyramids",
      "from sharm el sheikh: guided day trip to luxor by plane",
      "from sharm el-sheikh: giza day trip with lunch and transfer 36963",
      "from sharm el-sheikh: ras mohammed & white island cruise ras muhammed",
      "from sharm elsheikh: the lost city day tour by ferry",
      "from sharm: ras muhammed & white island by boat & intro dive 17896",
      "from sharm: ras muhammed & white island by boat & intro dive 2212000",
      "from sharm: white island and ras mohamed snorkeling trip",
      "from the airport to hotels in sharm el-sheikh",
      "from-hurghada-to-the-pyramids-day-tour",
      "full-day giftun island trip",
      "full-day group tour to orange bay with",
      "full-day group tour with diving",
      "full-day group tour with diving 5555",
      "full-day group tour with entrance fees 5555",
      "full-day group tour with environmental fees 1122",
      "full-day group tour without entrance fees",
      "full-day group tour without entrance fees 5555",
      "full-day group tour without environment fees",
      "full-day group tour without environment fees 5555",
      "full-day group tour without environments fees",
      "full-day group tour without environments fees 5555",
      "full-day orange bay group tour",
      "full-day orange bay group tour 5555",
      "full-day trip to giftun island & orange island entrance fees gif",
      "full-day trip to giftun island & orange island with lunch gif",
      "full-day trip to giftun island with island entrance fees gif",
      "gaz-ht-001 entry ticket to grand aquarium & zoo tickets with transfers",
      "gif full-day trip to giftun island & orange island with lunch",
      "giza pyramids tour in english with entrance fees",
      "great pyramid",
      "great pyramid & boat",
      "group",
      "group city tour",
      "group tour entry fees",
      "group tour with entry fees",
      "group tour with entry fees one way transfer to luxor",
      "group tour with entry fees one way transfer to luxor o/n",
      "group tour with entry fees shared tour entrance",
      "group tour with entry fees with boat",
      "group tour without entry fees",
      "haice",
      "hiace",
      "hiace 1",
      "hiace 2",
      "hiace 2 with new panorama",
      "hiace 3",
      "hiace 4",
      "horseback riding from hurghada",
      "hrg quad jeep camel and buggy safari with bbq dinner",
      "hrg-eden hurghada: eden island xtreme parasail dive & water sports",
      "hrg-jeep-safari hurghada: jeep & camel safari with dinner & desert fire show",
      "hrg:private city tour with seafood at barbouni restaurant 5",
      "hurghada 2-day tour to luxor",
      "hurghada : diving & snorkeling cruise tour w lunch & drinks 08:00",
      "hurghada cairo pyramids day tour by plane - small group",
      "hurghada desert quad bike safari with dinner",
      "hurghada full-day trip to cairo by bus",
      "hurghada full-day trip to cairo by plane",
      "hurghada horse riding tour 3 hours",
      "hurghada morning or sunset sights guided tour with shopping",
      "hurghada pyramids excursion",
      "hurghada quad bike tour with stargazing telescope and dinner 4040",
      "hurghada quad tour afternoon",
      "hurghada scuba diving tour",
      "hurghada snorkelling & swimming with dolphin",
      "hurghada-pyramiden-ausflug tour type group",
      "hurghada: 2-hour camel ride with bedouin vibe",
      "hurghada: 3 hour camel riding with bedouin vibe",
      "hurghada: 3-hour camel ride with bedouin vibe",
      "hurghada: city tour with handicrafts museum entry tickets 258",
      "hurghada: dolphin & coral reef snorkeling tour with lunch",
      "hurghada: dolphin watching boat tour with snorkeling & lunch",
      "hurghada: eden island sirene boat snorkeling trip 1212",
      "hurghada: eden island xtreme parasail dive & water sports",
      "hurghada: glass boat and parasailing trip with snorkeling",
      "hurghada: jeep & camel safari with dinner & desert fire show",
      "hurghada: jungle aqua park with lunch & transfer",
      "hurghada: jungle aqua park with lunch & transfer 09:00",
      "hurghada: luxor valley of kings day trip include entry fees",
      "hurghada: luxor valley of kings day trip include entry fees tour type group",
      "hurghada: majestic vip cruise to orange bay & gourmet lunch vip",
      "hurghada: makadi water world ticket only",
      "hurghada: makadi water world with lunch & transfers",
      "hurghada: makadi water world with lunch & transfers 09:00",
      "hurghada: orange bay day trip with parasailing and lunch",
      "hurghada: orange bay day trip with parasailing and lunch 5555",
      "hurghada: orange bay day trip with water sports and lunch",
      "hurghada: orange bay day trip with water sports and lunch 5555",
      "hurghada: orange island snorkeling diving and water sports hrg-4in1",
      "hurghada: private airport arrival one way transfer",
      "hurghada: private sightseeing tour in el gouna with transfer",
      "hurghada: quad jeep camel and buggy safari with bbq dinner",
      "hurghada: royal sea scope submarine & snorkeling day tour",
      "hurghada: semi submarine & snorkeling day tour",
      "hurghada: semi submarine & snorkeling with transfer",
      "hurghada: semi submarine & snorkeling with transfer semi -sub",
      "hurghada: semi submarine & snorkeling with transfer semi-sub",
      "hurghada: sharm el naga tour with snorkeling & lunch 8885",
      "hurghada: snorkeling dolphin watching & banana boat fun 96969",
      "hurghada: snorkeling dolphin watching 96969",
      "hurghada: thrilling desert safari with quad buggy & bbq experience tour type group",
      "hurghada: unique bedouin craft handmade and star watching 9090",
      "include entry fees",
      "include entry fees tutankhamounvisit utankhamoun",
      "intro 1 x 1",
      "intro 1 x 2",
      "intro 2 x 1",
      "intro 2 x 2",
      "intro 3 x 1",
      "intro 3 x 2",
      "intro 4 x 2",
      "intro 5 x 1",
      "intro 6 x 1",
      "jaz aquaviva",
      "jungle aqua park with lunch without transfer",
      "karnak temple sound & light show qr ticket with transfer",
      "last-minute: group tour entry fees",
      "limo",
      "lowest price",
      "luxor adventure: all-inclusive group tour with entry fees",
      "luxor by bus",
      "luxor day tour with tutankhamun tomb entry fee",
      "luxor day tour without tutankhamun tomb entry fee",
      "luxor day trip",
      "luxor day trip with entry fees free hurghada city tour",
      "luxor museum guided tour",
      "luxor valley of kings day trip include entry fees",
      "luxor: private 10-hour tour with hotel or airport pickup",
      "luxor: private 10-hour tour with hotel or airport pickup lxr 4",
      "luxor: private 10-hour tour with pickup from hotel lxr 4",
      "luxor: private 6-hour tour with hotel pickup",
      "luxor: private 8-hour tour with hotel or airport pickup lxr 3",
      "luxor: private 8-hour tour with hotel pickup lxr 3",
      "lxr 4 luxor: private 10-hour tour with hotel or airport pickup",
      "lxr-private tour private tour vip service with entry fees",
      "makadi water world with lunch & private transfer",
      "makadi water world with lunch & transfers",
      "marsa alam : luxor valley of kings day trip include entry fees",
      "marsa alam: beginners scuba diving day-trip with lunch rmf",
      "marsa alam: desert stargazing tour with camel ride & dinner 2044",
      "marsa alam: snorkeling with sea turtles marsa mubarak rmf",
      "marsa alam:sataya reefs dolphin snorkeling cruise with lunch rmf",
      "massage spa",
      "mega offer: 2-hour horse ride journey",
      "mega offer: 2-hour horse ride journey with swim 123",
      "mega offer: 2-hour horse ride journey without swim",
      "mega offer: 2-hour horse ride journey without swim 586",
      "mega offer: 2-hour horse ride without 360 photos",
      "mega offer: 3-hour horse ride journey with swim 586",
      "mega offer:2-hour horse ride without 360 photos",
      "morning desert safari adventure buggy",
      "morning sunset quad desert adventure safari",
      "morning sunset quad desert adventure safari bike",
      "morning sunset quad or buggy desert adventure safari",
      "morning/ sunset quad or buggy desert adventure safari",
      "moses mountain & saint catherine from dahab",
      "museums only",
      "museums with citadel of saladin bazaar and old cairo 2xm cit",
      "n/a stargazing with jeep tour only",
      "neverland aqua park entry tickets without transfers",
      "neverland aqua park entry with transfer from hurghada",
      "new panorama sharm cafe & restaurant",
      "new panorama sharm cafe & restaurant fphn12",
      "no entry fees- mon/thurs offer",
      "no entry fees- mon/thurs offer 04:30",
      "no entry fees- sun/thurs offer",
      "no entry fees-mon/thurs offer",
      "oasis",
      "offer for one reduced ticket with lunch",
      "old cairo with citadel and lunch",
      "one way sleeper train to luxor",
      "one-way journey from sharm el sheikh to hurghada",
      "online qr ticket for egyptian museum",
      "option: 5555 full-day group tour with entrance fees",
      "option: bike all-inclusive super safari private tour",
      "option: buggy 8-hour safari with buggy camel bedouin village & dinner",
      "option: buy for 3 people get the fourth free",
      "option: desert safari with double quad and stargazing",
      "option: group tour without entry fees",
      "option: n/a stargazing with jeep tour",
      "option: offer for one reduced ticket with lunch",
      "option: quad and double buggy tour makadi sahl hasheesh safaga",
      "option: shared tour entrance group tour with entry fees",
      "option: small group tour: lunch entry fees & inside great pyramid",
      "option: small group with entry fees",
      "option: tut entry fees with valley of the kings king tutankhamun tomb",
      "orange bay day trip with parasailing",
      "orange bay day trip with parasailing 5555",
      "orange bay day trip with parasailing and lunch",
      "orange bay group tour",
      "orange bay group tour 5555",
      "orange bay island snorkeling",
      "orange bay island trip snorkeling & parasailing with lunch",
      "orange bay with a free glass boat cruise the next day",
      "package",
      "panoramic semi-submarine cruise with snorkeling",
      "pickup from hurghada",
      "premium begginer boat cruise with 2 intro-dives snorkeling lunch",
      "private",
      "private 1-hour boat ride and banana island visit",
      "private 10-hour tour with hotel or airport pickup lxr 4",
      "private 10-hour tour with pickup from hotel",
      "private 10-hour tour with pickup from hotel lxr 4",
      "private 2-day tour with entry fees tickets & balloon ride",
      "private 2-day tour with entry fees tickets & balloon ride o/n lxr 3",
      "private 6-hour customized tour with pickup at airport lxr 2",
      "private 6-hour tour with hotel pickup",
      "private 8-hour tour with hotel or airport pickup",
      "private 8-hour tour with hotel or airport pickup lxr 3",
      "private 8-hour tour with hotel pickup aracan eatabe luxor hotel",
      "private 8-hour tour with hotel pickup lxr 3",
      "private city & shopping tour with old market private",
      "private city tour with lunch & shisha pipe experience",
      "private city tour with lunch and shisha",
      "private city tour with personalized experience & shisha pipe",
      "private city tour with shisha and without lunch",
      "private guided",
      "private guided tour private tour",
      "private half-day sightseeing tour to el gouna from hurghada 4567",
      "private luxury beach and horse photoshoot experience photoshoot",
      "private tour",
      "private tour - with entry fees",
      "private tour - without entry fees",
      "private tour all-inclusive",
      "private tour vip service with entry fees",
      "private tour vip service with entry fees lxr-private tour",
      "private tour with entrance fees",
      "private tour with male guide",
      "private transfer",
      "private transfer with 5-hour safari and bbq dinner",
      "private transfer with 5-hour safari and bbq dinner buggy",
      "promo: 1 person free includes lunch & entry tickets",
      "pyramids & sphinx uncovered private half-day tour",
      "pyramids and the national museum 5555",
      "quad and double buggy tour",
      "quad and double buggy tour from hurghada",
      "quad and double buggy tour from hurghada or gouna",
      "quad and double buggy tour makadi sahl hasheesh safaga",
      "quad and double buggy tour sahl hasheesh safaga",
      "quad and double buggy tour with camel ride experience",
      "quad bike adventure at giza pyramids",
      "quad bike adventure at giza pyramids with camel ride",
      "quad buggy desert safari and barbecue",
      "quad double buggy tour from hurghada - private transfer",
      "quad jeep camel and buggy safari with bbq dinner hrg",
      "quad tour along the sea and mountains in hurghada",
      "quad tour along the sea and mountains in hurghada 08:00",
      "quad tour along the sea and mountains in hurghada 15:00",
      "quad-safari-hurghada",
      "ras mohamed half day tour & allahs gate",
      "ras mohammed snorkeling trip sharm el sheikh",
      "ras muhammed sharm el-sheikh: ras mohammed & white island cruise",
      "red sea desert horse ride with swimming - private transfer",
      "red sea desert horse ride with swimming - private transfer 586",
      "red sea: orange bay island and snorkeling cruise with lunch",
      "rmf marsa alam: snorkeling with sea turtles marsa mubarak",
      "rmf marsa alam:sataya reefs dolphin snorkeling cruise with lunch",
      "round tickets - sleeper train - to luxor",
      "royal seascope submarine with snorkeling from hurghada",
      "safari 51 quad stargazing",
      "safari to colored canyon and dahab tour type group",
      "scuba diving tour in hurghada",
      "seafood dinner",
      "seamless shared tour entry fees covered",
      "semi -sub hurghada: semi submarine & snorkeling with transfer",
      "shared day trip boat ride and entry included",
      "shared experience entry fees & lunch included",
      "shared group journey entry fees lunch & inside pyramid",
      "shared tour - pay as you explore",
      "shared tour - with entry fees",
      "shared tour - with entry fees 04:30",
      "shared tour - without entry fees",
      "shared tour - without entry fees in select languages",
      "shared tour with all entry fees and king tutankhamun tomb",
      "shared tour with entry fees",
      "shared tour with entry fees and king tutankhamuns tomb",
      "shared tour with entry fees lxr-inc-tickets",
      "shared tour with lunch - without entry fees no",
      "shared tour with lunch and entry fees",
      "shared tour with male guide",
      "shared tour without entrrance fees",
      "shared tour without entry fees",
      "shared transfer lunch and intro dive",
      "sharm el sheikh: mount sinai & st catherine monastery tour",
      "sharm el sheikh: private city tour with seafood dinner",
      "sharm el sheikh: snorkeling trip to tiran island with lunch",
      "sharm el-sheikh : ras mohamed half day tour & allahs gate",
      "sharm el-sheikh: cafe & restaurant included shisha & drink",
      "sharm el-sheikh: city & shopping tour with old market visit",
      "sharm el-sheikh: city & shopping tour with old market visit // hiace",
      "sharm el-sheikh: departure transfer from hotel to airport 2212000",
      "sharm el-sheikh: ghibli raceway day trip",
      "sharm el-sheikh: ras mohamed half day tour & allahs gate",
      "sharm el-sheikh: ras mohammed & white island cruise ras muhammed",
      "sharm elsheikh: camel riding stargazing bbq dinner & show",
      "single buggy - 1 person in 1 buggy",
      "single quad - 1 person in 1 quad",
      "single quad - 1 person in 1 quad 2212000",
      "single quad mega safari waves and dunes with lunch sunset",
      "sirius palace luxor",
      "small group cairo tour with lunch and entry fees included",
      "small group tour including lunch excluding entry fee",
      "small group tour with entry fees",
      "small group tour without entry fees",
      "small group tour without entry fees 123",
      "small group tour: lunch entry fees & inside great pyramid",
      "small group with entry fees",
      "small-group tour with boat cruise",
      "snor white island & ras mohamed without entrance fees",
      "snorkeling dolphin watching with a private transfer",
      "snorkeling dolphin watching with a private transfer 96969",
      "sound and light show regular price",
      "sound and light show regular price with transfer",
      "sound and light show vip price",
      "sound and light show vip price with transfer",
      "stargazing adventure with jeep tour",
      "stargazing by jeep & dance show with private transfer 2044",
      "stargazing desert adventure by jeep with dinner hurghada",
      "stargazing telescope and dinner 4040",
      "stargazing trip with a double quad",
      "stargazing trip with a single quad",
      "stargazing trip with double quad - 2 people in 1 quad",
      "stargazing trip with single quad - 1 person in 1 quad",
      "stargazing with atv quad ride & jeep",
      "stargazing with atv quad ride & jeep 2044",
      "stargazing with jeep tour",
      "stargazing with jeep tour n/a",
      "stargazing with jeep tour only",
      "stargazing with jeep tour only n/a",
      "stargazing with jeep tour with privite transfer",
      "stargazing with jeep with private transfer",
      "stargazing with quad ride",
      "stargazing with quad ride & dance show with private transfer",
      "stargazing with quad ride & dance show with private transfer 2044",
      "stargazing with quad ride 2044",
      "stargazing with quad ride and dance show 2044",
      "stargazing-camel ride-bbq-marsa alam",
      "stay for 3 hours at 6 october / dropoff pyramids park",
      "sunrise atv quad adventure",
      "sunset atv quad adventure with dinner",
      "sunset atv quad adventure without dinner",
      "sunset desert quad bike adventure with camel ride experience 1009a",
      "sunset double quad mega safari waves and dunes with lunch",
      "sunset quad bike & camel ride 4040",
      "super safari all inclusive",
      "swimming with dolphins in safaga tour type group",
      "ticket with tour and transfer",
      "top deal: inside great pyramids scenic boat ride",
      "top value experience entry fees covered",
      "top value experience entry fees covered lxr-inc-tickets",
      "tour : 3-hour quad tour safaga",
      "tour : hurghada-safari-quad biking-camel riding tour type group",
      "tour : hurghada: luxor valley of kings day trip include entry fees",
      "tour : hurghada: thrilling desert safari with quad buggy & bbq experience",
      "tour : marsa alam sataya reefs dolphin snorkel cruise with lunch tour type group",
      "tour hurghada with dune buggy",
      "tour hurghada with dune buggy: this option includes quad bike ride in the desert dune buggy ride in the desert an encounter and with an arabian camel",
      "tour in a double quad - from sahl hasheesh & safaga 122",
      "tour in a double quad - pickup from hurghada 122",
      "tour in a double quad - pickup from hurghada and el gouna 122",
      "tour type group",
      "tour with boat cruise",
      "tour with camel riding stargazing bbq dinner & show",
      "tour with entry fees",
      "tour with entry fees 04:30",
      "tour with entry fees in select languages",
      "tour with entry fees lunch & inside great pyramid",
      "tour with male guide",
      "tour with single quad bike",
      "transfer only : tour to pyramidsmemphis &saqqara from hotel",
      "transfer to aswan by car",
      "transfer to cairo airport flight cairo-hurghada ms46 am",
      "trip include entry fees",
      "trip with entry fees",
      "trip with entry fees and boat tour",
      "trip with entry fees great pyramid and boat ride",
      "trip- no entry fees no",
      "triple buggy - 3 person in 1 buggy",
      "trips in hurghada sightseeing private city tour",
      "turkish bath spa",
      "ultimate atv quad stargazing & bbq dinner",
      "ultimate tour lunch great pyramid & boat included",
      "unforgettable day at orange bay",
      "unique bedouin craft handmade and star watching 9090",
      "vip hurghada: magician plus vip cruise to orange bay & seafood",
      "visit luxor temple & the valley of the king & hatsehpsut &lunch",
      "visit the pyramids and the sphinx and dinner cruise",
      "von-hurghada-zu-den-pyramiden-tagestour tour type group",
      "walk with the pharaohs: entry fees & tutankhamun tomb access",
      "white hills",
      "white island & ras mohamed without entrance fees",
      "white island & ras mohamed without entrance fees snor",
      "white island and ras mohamed with entrance fees",
      "with atv quad & blue hole tour & abu galum nature",
      "with atv quad & blue hole tour & abu galum nature 618",
      "with atv quad & blue hole tour & abu galum nature 618x",
      "with atv quad & entrance fees",
      "with atv quad & entrance fees 1 x fts scarve",
      "with atv quad & entrance fees 2 x fts scarve",
      "with atv quad & entrances",
      "with atv quad & entrances fees",
      "with atv quad &entrance fees",
      "with atv quad/without blue hole tour & abu galum 618",
      "with atv quad/without blue hole tour & abu galum nature 618",
      "with blue hole & abu galum",
      "with blue hole & abu galum 2212000",
      "with blue hole & abu galum 618",
      "with entrance fees",
      "with entrance fees 08:00",
      "with entrance fees 2 x fts scarve",
      "with entrance fees of blue hole tour & abu galum",
      "with entrance fees of blue hole tour & abu galum 618",
      "with entry fees",
      "with entry fees & entry great pyramid",
      "with entry fees - private tour",
      "with entry fees - rmf",
      "with entry fees and tutankhamun tomb",
      "with entry fees one egyptian stu",
      "with entry fees pick up ftom sahl hashish",
      "with equipment",
      "without blue hole & abu galum",
      "without blue hole & abu galum 618",
      "without entrance fees",
      "without entrance fees 04:30",
      "without entrance fees 2 x fts scarve",
      "without entrance fees of blue hole tour & abu galum",
      "without entrance fees of blue hole tour & abu galum 618",
      "without entry fees",
      "without equipment",
      "without snorkeling",
      "yacht trip with island visit and lunch"
    ],
    "timestamp": "2025-07-03T04:16:37.115664"
  }
}

============================================================
FILE: config\login_config.py
SIZE: 6796 characters
============================================================

# -*- coding: utf-8 -*-
"""
config/login_styles.py

ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿ£ŸÜŸÖÿßÿ∑ ŸàÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
Professional Styles Configuration for Login Window
"""

# ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
PROFESSIONAL_THEMES = {
    'light': {
        # ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        'primary': '#2563eb',           # ÿ£ÿ≤ÿ±ŸÇ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
        'primary_hover': '#1d4ed8',     # ÿ£ÿ≤ÿ±ŸÇ ÿØÿßŸÉŸÜ
        'primary_light': '#dbeafe',     # ÿ£ÿ≤ÿ±ŸÇ ŸÅÿßÿ™ÿ≠ ÿ¨ÿØÿßŸã

        # ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ´ÿßŸÜŸàŸäÿ©
        'secondary': '#64748b',         # ÿ±ŸÖÿßÿØŸä ÿ£ŸÜŸäŸÇ
        'secondary_hover': '#475569',   # ÿ±ŸÖÿßÿØŸä ÿØÿßŸÉŸÜ
        'secondary_light': '#e2e8f0',   # ÿ±ŸÖÿßÿØŸä ŸÅÿßÿ™ÿ≠

        # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑÿ©
        'success': '#10b981',           # ÿ£ÿÆÿ∂ÿ± ÿπÿµÿ±Ÿä
        'success_hover': '#059669',     # ÿ£ÿÆÿ∂ÿ± ÿØÿßŸÉŸÜ
        'success_light': '#d1fae5',     # ÿ£ÿÆÿ∂ÿ± ŸÅÿßÿ™ÿ≠

        'danger': '#ef4444',            # ÿ£ÿ≠ŸÖÿ± ÿ≠ÿØŸäÿ´
        'danger_hover': '#dc2626',      # ÿ£ÿ≠ŸÖÿ± ÿØÿßŸÉŸÜ
        'danger_light': '#fee2e2',      # ÿ£ÿ≠ŸÖÿ± ŸÅÿßÿ™ÿ≠

        'warning': '#f59e0b',           # ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä
        'warning_hover': '#d97706',     # ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä ÿØÿßŸÉŸÜ
        'warning_light': '#fef3c7',     # ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä ŸÅÿßÿ™ÿ≠

        'info': '#3b82f6',              # ÿ£ÿ≤ÿ±ŸÇ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä
        'info_hover': '#2563eb',        # ÿ£ÿ≤ÿ±ŸÇ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ÿØÿßŸÉŸÜ
        'info_light': '#dbeafe',        # ÿ£ÿ≤ÿ±ŸÇ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ŸÅÿßÿ™ÿ≠

        # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ© ŸàÿßŸÑÿ≥ÿ∑ÿ≠
        'background': '#f8fafc',        # ÿÆŸÑŸÅŸäÿ© ÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        'surface': '#ffffff',           # ÿ≥ÿ∑ÿ≠ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™
        'surface_hover': '#f9fafb',     # ÿ≥ÿ∑ÿ≠ ÿπŸÜÿØ ÿßŸÑŸÖÿ±Ÿàÿ±

        # ÿßŸÑÿ≠ÿØŸàÿØ ŸàÿßŸÑÿ∏ŸÑÿßŸÑ
        'border': '#e2e8f0',            # ÿ≠ÿØŸàÿØ ÿπÿßÿØŸäÿ©
        'border_focus': '#2563eb',      # ÿ≠ÿØŸàÿØ ÿπŸÜÿØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
        'shadow': 'rgba(0, 0, 0, 0.1)', # ŸÑŸàŸÜ ÿßŸÑÿ∏ŸÑ
        'shadow_hover': 'rgba(0, 0, 0, 0.15)', # ÿ∏ŸÑ ÿπŸÜÿØ ÿßŸÑŸÖÿ±Ÿàÿ±

        # ÿßŸÑŸÜÿµŸàÿµ
        'text_primary': '#1e293b',      # ŸÜÿµ ÿ£ÿ≥ÿßÿ≥Ÿä
        'text_secondary': '#64748b',    # ŸÜÿµ ÿ´ÿßŸÜŸàŸä
        'text_tertiary': '#94a3b8',     # ŸÜÿµ ÿ´ÿßŸÑÿ´Ÿä
        'text_disabled': '#cbd5e1',     # ŸÜÿµ ŸÖÿπÿ∑ŸÑ
        'text_inverse': '#ffffff',      # ŸÜÿµ ŸÖÿπŸÉŸàÿ≥
    },

    'dark': {
        # ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        'primary': '#3b82f6',           # ÿ£ÿ≤ÿ±ŸÇ ŸÑÿßŸÖÿπ
        'primary_hover': '#2563eb',     # ÿ£ÿ≤ÿ±ŸÇ ÿ£ŸÉÿ´ÿ± ŸÑŸÖÿπÿßŸÜÿßŸã
        'primary_light': '#1e3a8a',     # ÿ£ÿ≤ÿ±ŸÇ ÿØÿßŸÉŸÜ

        # ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ´ÿßŸÜŸàŸäÿ©
        'secondary': '#6b7280',         # ÿ±ŸÖÿßÿØŸä ŸÖÿ™Ÿàÿ≥ÿ∑
        'secondary_hover': '#9ca3af',   # ÿ±ŸÖÿßÿØŸä ŸÅÿßÿ™ÿ≠
        'secondary_light': '#374151',   # ÿ±ŸÖÿßÿØŸä ÿØÿßŸÉŸÜ

        # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑÿ©
        'success': '#10b981',           # ÿ£ÿÆÿ∂ÿ± ŸÑÿßŸÖÿπ
        'success_hover': '#34d399',     # ÿ£ÿÆÿ∂ÿ± ŸÅÿßÿ™ÿ≠
        'success_light': '#064e3b',     # ÿ£ÿÆÿ∂ÿ± ÿØÿßŸÉŸÜ

        'danger': '#f87171',            # ÿ£ÿ≠ŸÖÿ± ŸÑÿßŸÖÿπ
        'danger_hover': '#fca5a5',      # ÿ£ÿ≠ŸÖÿ± ŸÅÿßÿ™ÿ≠
        'danger_light': '#7f1d1d',      # ÿ£ÿ≠ŸÖÿ± ÿØÿßŸÉŸÜ

        'warning': '#fbbf24',           # ÿ£ÿµŸÅÿ± ŸÑÿßŸÖÿπ
        'warning_hover': '#fcd34d',     # ÿ£ÿµŸÅÿ± ŸÅÿßÿ™ÿ≠
        'warning_light': '#78350f',     # ÿ£ÿµŸÅÿ± ÿØÿßŸÉŸÜ

        'info': '#60a5fa',              # ÿ£ÿ≤ÿ±ŸÇ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ŸÑÿßŸÖÿπ
        'info_hover': '#93bbfc',        # ÿ£ÿ≤ÿ±ŸÇ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ŸÅÿßÿ™ÿ≠
        'info_light': '#1e3a8a',        # ÿ£ÿ≤ÿ±ŸÇ ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ÿØÿßŸÉŸÜ

        # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ© ŸàÿßŸÑÿ≥ÿ∑ÿ≠
        'background': '#0f172a',        # ÿÆŸÑŸÅŸäÿ© ÿØÿßŸÉŸÜÿ©
        'surface': '#1e293b',           # ÿ≥ÿ∑ÿ≠ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™
        'surface_hover': '#334155',     # ÿ≥ÿ∑ÿ≠ ÿπŸÜÿØ ÿßŸÑŸÖÿ±Ÿàÿ±

        # ÿßŸÑÿ≠ÿØŸàÿØ ŸàÿßŸÑÿ∏ŸÑÿßŸÑ
        'border': '#334155',            # ÿ≠ÿØŸàÿØ ÿØÿßŸÉŸÜÿ©
        'border_focus': '#3b82f6',      # ÿ≠ÿØŸàÿØ ÿπŸÜÿØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
        'shadow': 'rgba(0, 0, 0, 0.5)', # ŸÑŸàŸÜ ÿßŸÑÿ∏ŸÑ
        'shadow_hover': 'rgba(0, 0, 0, 0.7)', # ÿ∏ŸÑ ÿπŸÜÿØ ÿßŸÑŸÖÿ±Ÿàÿ±

        # ÿßŸÑŸÜÿµŸàÿµ
        'text_primary': '#f1f5f9',      # ŸÜÿµ ÿ£ÿ≥ÿßÿ≥Ÿä ŸÅÿßÿ™ÿ≠
        'text_secondary': '#cbd5e1',    # ŸÜÿµ ÿ´ÿßŸÜŸàŸä
        'text_tertiary': '#94a3b8',     # ŸÜÿµ ÿ´ÿßŸÑÿ´Ÿä
        'text_disabled': '#475569',     # ŸÜÿµ ŸÖÿπÿ∑ŸÑ
        'text_inverse': '#0f172a',      # ŸÜÿµ ŸÖÿπŸÉŸàÿ≥
    }
}

# ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∏ŸÑÿßŸÑ
SHADOW_EFFECTS = {
    'sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
    'md': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
    'lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
    'xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
    '2xl': '0 25px 50px -12px rgba(0, 0, 0, 0.25)',
    'inner': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
    'none': 'none'
}

# ÿ™ŸÉŸàŸäŸÜÿßÿ™ ÿßŸÑÿÆÿ∑Ÿàÿ∑
FONT_CONFIG = {
    'primary_family': 'Segoe UI',      # ÿßŸÑÿÆÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸÑŸÄ Windows
    'secondary_family': 'Helvetica',   # ÿÆÿ∑ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä
    'arabic_family': 'Tahoma',         # ÿÆÿ∑ ÿπÿ±ÿ®Ÿä

    'sizes': {
        'xs': 10,
        'sm': 12,
        'base': 14,
        'lg': 16,
        'xl': 18,
        'xxl': 24,
        'xxxl': 30
    },

    'weights': {
        'normal': 'normal',
        'medium': 'normal',
        'bold': 'bold'
    }
}

# ÿ™ŸÉŸàŸäŸÜÿßÿ™ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑÿßÿ™ ŸàÿßŸÑÿ≠ÿ±ŸÉÿßÿ™
ANIMATION_CONFIG = {
    'durations': {
        'fast': 150,      # ŸÖŸäŸÑŸä ÿ´ÿßŸÜŸäÿ©
        'normal': 300,
        'slow': 500
    },

    'easing': {
        'linear': 'linear',
        'ease_in': 'ease-in',
        'ease_out': 'ease-out',
        'ease_in_out': 'ease-in-out'
    }
}

# ÿ™ŸÉŸàŸäŸÜÿßÿ™ ÿßŸÑÿ£ÿ®ÿπÿßÿØ ŸàÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™
SPACING_CONFIG = {
    'padding': {
        'xs': 5,
        'sm': 10,
        'md': 15,
        'lg': 20,
        'xl': 30
    },

    'margin': {
        'xs': 5,
        'sm': 10,
        'md': 15,
        'lg': 20,
        'xl': 30
    },

    'border_radius': {
        'none': 0,
        'sm': 5,
        'md': 10,
        'lg': 15,
        'xl': 20,
        'full': 9999  # ŸÑŸÑÿØŸàÿßÿ¶ÿ± ÿßŸÑŸÉÿßŸÖŸÑÿ©
    },

    'border_width': {
        'thin': 1,
        'normal': 2,
        'thick': 3
    }
}

# ÿØÿßŸÑÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸàÿ∂Ÿàÿπ ÿ≠ÿ≥ÿ® ÿßŸÑŸàÿ∂ÿπ
def get_theme_colors(mode='light'):
    """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖŸàÿ∂Ÿàÿπ ÿ≠ÿ≥ÿ® ÿßŸÑŸàÿ∂ÿπ"""
    return PROFESSIONAL_THEMES.get(mode, PROFESSIONAL_THEMES['light'])

# ÿØÿßŸÑÿ© ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ∏ŸÑ ÿπŸÑŸâ ÿπŸÜÿµÿ±
def apply_shadow(widget, shadow_type='md'):
    """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸÑ ÿπŸÑŸâ ÿπŸÜÿµÿ±"""
    # ŸÖŸÑÿßÿ≠ÿ∏ÿ©: customtkinter ŸÑÿß ŸäÿØÿπŸÖ ÿßŸÑÿ∏ŸÑÿßŸÑ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
    # Ÿáÿ∞Ÿá ÿßŸÑÿØÿßŸÑÿ© ŸÑŸÑÿ™Ÿàÿ´ŸäŸÇ ŸàÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸä
    return SHADOW_EFFECTS.get(shadow_type, SHADOW_EFFECTS['md'])

# ÿØÿßŸÑÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑
def get_font_size(size='base', is_small_window=False):
    """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®"""
    base_size = FONT_CONFIG['sizes'].get(size, 14)
    if is_small_window:
        return max(base_size - 2, 10)  # ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ≠ÿ¨ŸÖ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ©
    return base_size

# ÿØÿßŸÑÿ© ŸÑÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÉŸàŸäŸÜ ÿÆÿ∑ ŸÉÿßŸÖŸÑ
def get_font_config(size='base', weight='normal', is_small_window=False):
    """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ™ŸÉŸàŸäŸÜ ÿÆÿ∑ ŸÉÿßŸÖŸÑ"""
    return {
        'family': FONT_CONFIG['primary_family'],
        'size': get_font_size(size, is_small_window),
        'weight': FONT_CONFIG['weights'].get(weight, 'normal')
    }

============================================================
FILE: config\modern_color_palettes.py
SIZE: 5867 characters
============================================================

# -*- coding: utf-8 -*-
"""
config/modern_color_palettes.py

ŸÑŸàÿ≠ÿßÿ™ ÿ£ŸÑŸàÿßŸÜ ÿπÿµÿ±Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
Additional Modern Color Palettes for Login Window
"""

# ŸÑŸàÿ≠ÿßÿ™ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿπÿµÿ±Ÿäÿ©
MODERN_PALETTES = {
    # ÿßŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© - ÿ®ŸÜŸÅÿ≥ÿ¨Ÿäÿ© ÿπÿµÿ±Ÿäÿ©
    'modern_purple': {
        'primary': '#5B5FFF',
        'primary_hover': '#4B4FEF',
        'secondary': '#6B7280',
        'success': '#10B981',
        'danger': '#F43F5E',
        'danger_hover': '#E11D48',
        'background': '#F9FAFB',
        'surface': '#FFFFFF',
        'input_bg': '#F3F4F6',
        'input_border': '#D1D5DB',
        'input_focus': '#5B5FFF',
        'border': '#E5E7EB',
        'text_primary': '#111827',
        'text_secondary': '#6B7280',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    },

    # ŸÑŸàÿ≠ÿ© ÿ£ÿ≤ÿ±ŸÇ ŸÉÿ≠ŸÑŸä ÿπÿµÿ±Ÿä
    'modern_blue': {
        'primary': '#0EA5E9',
        'primary_hover': '#0284C7',
        'secondary': '#64748B',
        'success': '#22C55E',
        'danger': '#EF4444',
        'danger_hover': '#DC2626',
        'background': '#F8FAFC',
        'surface': '#FFFFFF',
        'input_bg': '#F1F5F9',
        'input_border': '#CBD5E1',
        'input_focus': '#0EA5E9',
        'border': '#E2E8F0',
        'text_primary': '#0F172A',
        'text_secondary': '#64748B',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    },

    # ŸÑŸàÿ≠ÿ© ÿÆÿ∂ÿ±ÿßÿ° ÿ≤ŸÖÿ±ÿØŸäÿ©
    'modern_emerald': {
        'primary': '#10B981',
        'primary_hover': '#059669',
        'secondary': '#6B7280',
        'success': '#34D399',
        'danger': '#F87171',
        'danger_hover': '#EF4444',
        'background': '#F9FAFB',
        'surface': '#FFFFFF',
        'input_bg': '#F3F4F6',
        'input_border': '#D1D5DB',
        'input_focus': '#10B981',
        'border': '#E5E7EB',
        'text_primary': '#111827',
        'text_secondary': '#6B7280',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    },

    # ŸÑŸàÿ≠ÿ© Ÿàÿ±ÿØŸäÿ© ÿπÿµÿ±Ÿäÿ©
    'modern_pink': {
        'primary': '#EC4899',
        'primary_hover': '#DB2777',
        'secondary': '#6B7280',
        'success': '#10B981',
        'danger': '#F43F5E',
        'danger_hover': '#E11D48',
        'background': '#FEF3F2',
        'surface': '#FFFFFF',
        'input_bg': '#FEE2E2',
        'input_border': '#FCA5A5',
        'input_focus': '#EC4899',
        'border': '#FBBF24',
        'text_primary': '#1F2937',
        'text_secondary': '#6B7280',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    },

    # ŸÑŸàÿ≠ÿ© ÿØÿßŸÉŸÜÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
    'modern_dark': {
        'primary': '#6366F1',
        'primary_hover': '#4F46E5',
        'secondary': '#9CA3AF',
        'success': '#34D399',
        'danger': '#F87171',
        'danger_hover': '#EF4444',
        'background': '#111827',
        'surface': '#1F2937',
        'input_bg': '#374151',
        'input_border': '#4B5563',
        'input_focus': '#6366F1',
        'border': '#374151',
        'text_primary': '#F9FAFB',
        'text_secondary': '#D1D5DB',
        'shadow': 'rgba(0, 0, 0, 0.3)'
    },

    # ŸÑŸàÿ≠ÿ© ÿ®ÿ±ÿ™ŸÇÿßŸÑŸäÿ© ÿØÿßŸÅÿ¶ÿ©
    'modern_orange': {
        'primary': '#F97316',
        'primary_hover': '#EA580C',
        'secondary': '#6B7280',
        'success': '#22C55E',
        'danger': '#EF4444',
        'danger_hover': '#DC2626',
        'background': '#FFFBEB',
        'surface': '#FFFFFF',
        'input_bg': '#FEF3C7',
        'input_border': '#FDE68A',
        'input_focus': '#F97316',
        'border': '#FCD34D',
        'text_primary': '#1F2937',
        'text_secondary': '#6B7280',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    },

    # ŸÑŸàÿ≠ÿ© ÿ£ÿ±ÿ¨ŸàÿßŸÜŸäÿ© ÿ£ŸÜŸäŸÇÿ©
    'modern_indigo': {
        'primary': '#7C3AED',
        'primary_hover': '#6D28D9',
        'secondary': '#6B7280',
        'success': '#10B981',
        'danger': '#F43F5E',
        'danger_hover': '#E11D48',
        'background': '#FAF5FF',
        'surface': '#FFFFFF',
        'input_bg': '#F3E8FF',
        'input_border': '#DDD6FE',
        'input_focus': '#7C3AED',
        'border': '#C4B5FD',
        'text_primary': '#1F2937',
        'text_secondary': '#6B7280',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    },

    # ŸÑŸàÿ≠ÿ© ŸÉŸÑÿßÿ≥ŸäŸÉŸäÿ© ÿ≤ÿ±ŸÇÿßÿ°
    'classic_blue': {
        'primary': '#2563EB',
        'primary_hover': '#1D4ED8',
        'secondary': '#64748B',
        'success': '#16A34A',
        'danger': '#DC2626',
        'danger_hover': '#B91C1C',
        'background': '#F0F9FF',
        'surface': '#FFFFFF',
        'input_bg': '#E0F2FE',
        'input_border': '#BAE6FD',
        'input_focus': '#2563EB',
        'border': '#93C5FD',
        'text_primary': '#1E293B',
        'text_secondary': '#64748B',
        'shadow': 'rgba(0, 0, 0, 0.05)'
    }
}

# ÿØÿßŸÑÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàÿ≠ÿ© ÿ£ŸÑŸàÿßŸÜ
def get_color_palette(palette_name='modern_purple'):
    """
    ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàÿ≠ÿ© ÿ£ŸÑŸàÿßŸÜ ŸÖÿ≠ÿØÿØÿ©

    Args:
        palette_name: ÿßÿ≥ŸÖ ÿßŸÑŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©

    Returns:
        dict: ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
    """
    return MODERN_PALETTES.get(palette_name, MODERN_PALETTES['modern_purple'])

# ÿØÿßŸÑÿ© ŸÑÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
def get_available_palettes():
    """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ£ÿ≥ŸÖÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©"""
    return list(MODERN_PALETTES.keys())

# ÿØÿßŸÑÿ© ŸÑŸÖÿπÿßŸäŸÜÿ© ŸÑŸàÿ≠ÿ© ÿ£ŸÑŸàÿßŸÜ
def preview_palette(palette_name):
    """ÿ∑ÿ®ÿßÿπÿ© ŸÖÿπÿßŸäŸÜÿ© ŸÑŸÑŸàÿ≠ÿ© ÿ£ŸÑŸàÿßŸÜ"""
    palette = get_color_palette(palette_name)
    print(f"\n=== {palette_name.upper()} PALETTE ===")
    for key, value in palette.items():
        print(f"{key}: {value}")
    print("=" * 30)

# ŸÖÿ´ÿßŸÑ ŸÑŸÉŸäŸÅŸäÿ© ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÑŸàÿ≠ÿ© ÿ£ŸÑŸàÿßŸÜ ŸÖÿÆÿ™ŸÑŸÅÿ© ŸÅŸä login_window.py:
"""
# ŸÅŸä ÿ®ÿØÿßŸäÿ© ŸÖŸÑŸÅ login_window.py
from config.modern_color_palettes import get_color_palette

# ÿßÿÆÿ™Ÿäÿßÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
PROFESSIONAL_COLORS = get_color_palette('modern_blue')  # ÿ£Ÿà ÿ£Ÿä ŸÑŸàÿ≠ÿ© ÿ£ÿÆÿ±Ÿâ

# ÿ£Ÿà ŸäŸÖŸÉŸÜ ÿ¨ÿπŸÑŸáÿß ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ÿÆÿµŸäÿµ ŸÖŸÜ ÿÆŸÑÿßŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
theme_palette = config_manager.get('color_palette', 'modern_purple')
PROFESSIONAL_COLORS = get_color_palette(theme_palette)
"""

============================================================
FILE: config\settings.yaml
SIZE: 1027 characters
============================================================

language: en
appearance_mode: light
color_theme: blue
view_name: Sales App
window_size:
  width: 1024
  height: 768
views_settings:
  allow_view_switching: true
  show_current_view_in_status: true
  default_views:
    admin: All Records
    manager: Manager View
    editor: Team View
    viewer: My Bookings
  role_views:
    admin:
    - All Records
    - Today's Bookings
    - This Week
    - This Month
    manager:
    - Manager View
    - Team View
    - Today's Bookings
    - This Week
    editor:
    - Team View
    - My Bookings
    - Today's Bookings
    viewer:
    - My Bookings
cache_settings:
  enable_cache: true
  default_cache_duration: 15
  view_cache_duration:
    All Records: 30
    Today's Bookings: 5
    This Week: 15
    This Month: 60
performance_settings:
  records_per_page: 100
  enable_lazy_loading: true
  show_loading_indicator: true
  background_loading: true
airtable_users_table: users
airtable_booking_table: List V2
main_window_state:
  fullscreen: true
  geometry: null
  state: zoomed


============================================================
FILE: controllers\app_controller.py
SIZE: 38637 characters
============================================================

# -*- coding: utf-8 -*-
"""
controllers/app_controller.py - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸàŸÖÿ®ÿ≥ÿ∑ÿ©

Ÿàÿ≠ÿØÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸëŸÜÿ© ŸÖÿπ:
- ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑ ŸàŸÖŸÜÿ∏ŸÖ
- ÿØÿπŸÖ ÿßÿÆÿ™Ÿäÿßÿ±Ÿä ŸÑÿ±ÿ®ÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ŸÄ Airtable
- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ŸàÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
- ÿπŸÖŸÑŸäÿßÿ™ CRUD ŸÖÿ≠ÿ≥ŸÜÿ©
- ŸÜÿ∏ÿßŸÖ ÿ´ŸäŸÖÿßÿ™ ŸÖŸàÿ≠ÿØ
- ÿØÿπŸÖ ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
- ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© double JSON encoding ŸÅŸä ÿ≠ŸÇŸÑ Assigned To
"""

from typing import Any, Dict, List, Optional, Tuple
from datetime import datetime
from tkinter import messagebox
import threading
import json
import time
import tkinter as tk
import customtkinter as ctk

from core.config_manager import ConfigManager
from core.db_manager import DatabaseManager
from core.language_manager import LanguageManager
from core.theme_manager import ThemeManager
from core.user_manager import UserManager
from core.airtable_manager import AirtableModel
from core.logger import logger
from utils.threading_utils import initialize_threading, shutdown_threading
from views.login_window import LoginWindow
from views.main_window import MainWindow

# ÿ•ÿÆŸÅÿßÿ° ŸÜÿßŸÅÿ∞ÿ© tk ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
if tk._default_root:
    tk._default_root.withdraw()

# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
try:
    from core.airtable_dropdown_manager import AirtableDropdownManager
    from views.add_edit_window import AddEditWindow
    HAS_AIRTABLE_DROPDOWNS = True
    logger.info("ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©")
except ImportError as e:
    logger.warning(f"ŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©: {e}")
    HAS_AIRTABLE_DROPDOWNS = False
    AirtableDropdownManager = None
    AddEditWindow = None


class AppController:
    """Ÿàÿ≠ÿØÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸàÿßŸÑŸÖÿ®ÿ≥ÿ∑ÿ©"""

    def __init__(self, config_mgr: ConfigManager, db_mgr: DatabaseManager,
                 airtable_users: AirtableModel, airtable_booking: AirtableModel,
                 user_mgr: UserManager) -> None:

        # ÿ•ÿÆŸÅÿßÿ° ŸÜŸàÿßŸÅÿ∞ tk ÿ•ÿ∂ÿßŸÅŸäÿ©
        self._hide_default_tk_windows()

        # ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        self.config_mgr = config_mgr
        self.db_mgr = db_mgr
        self.airtable_users = airtable_users
        self.airtable_booking = airtable_booking
        self.user_mgr = user_mgr

        # ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÑÿ∫ÿ© ŸàÿßŸÑÿ´ŸäŸÖ
        self.lang_manager = LanguageManager(self.config_mgr)
        self.theme_manager = ThemeManager(self.config_mgr)

        # ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        self.login_window = None
        self.main_window = None
        self.open_edit_windows = []

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
        self.current_username: Optional[str] = None
        self.current_user_info: Optional[Dict[str, Any]] = None
        self.current_user_collaborator: Optional[Any] = None
        self.selected_record: Optional[Dict[str, Any]] = None

        # ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        self.is_loading = False
        self.loading_operations = set()

        # ŸÉÿßÿ¥ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ© (ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±)
        self.used_booking_numbers = set()

        # ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        self.dropdown_manager = self._initialize_dropdown_manager()

    def _hide_default_tk_windows(self):
        """ÿ•ÿÆŸÅÿßÿ° ŸÜŸàÿßŸÅÿ∞ tk ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
        try:
            if tk._default_root:
                tk._default_root.withdraw()
            for widget in tk._default_root.winfo_children() if tk._default_root else []:
                if widget.winfo_class() == 'Tk':
                    widget.withdraw()
        except:
            pass

    def _initialize_dropdown_manager(self):
        """ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if not HAS_AIRTABLE_DROPDOWNS:
            return None

        try:
            dropdown_manager = AirtableDropdownManager(
                config_manager=self.config_mgr,
                db_manager=self.db_mgr
            )

            if dropdown_manager.has_errors():
                self._handle_dropdown_errors(dropdown_manager.get_all_errors())

            logger.info("ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠")
            return dropdown_manager

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©: {e}")
            return None

    def _handle_dropdown_errors(self, errors):
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        error_msg = "ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿπÿ∂ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©:\n\n"
        for key, msg in errors.items():
            error_msg += f"‚Ä¢ {msg}\n"

        if hasattr(self, 'main_window') and self.main_window:
            self.main_window.after(1000, lambda: messagebox.showerror(
                "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©",
                error_msg + "\n\nŸÑŸÜ ÿ™ÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™."
            ))

    def run(self) -> None:
        """ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        logger.info("ÿ®ÿØÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ")

        self.login_window = LoginWindow(
            controller=self,
            lang_manager=self.lang_manager,
            theme_manager=self.theme_manager,
            airtable_model=self.airtable_users,
            user_mgr=self.user_mgr,
            enable_encryption=True,
            enable_rate_limiting=True,
            enable_2fa=False,
            parent_window=self
        )

        initialize_threading(self.login_window)
        self.login_window.mainloop()

    def on_login_success(self, user_info: Dict[str, str]) -> None:
        """ŸÖÿπÿßŸÑÿ¨ ŸÜÿ¨ÿßÿ≠ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÖÿπ ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖÿ®ÿ≥ÿ∑ÿ©"""
        self.current_username = user_info.get('username', 'Unknown')
        self.current_user_info = user_info

        # ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖÿ®ÿ≥ÿ∑ÿ© ŸÑŸÄ Airtable Collaborator - ÿ®ÿØŸàŸÜ ÿ™ŸÜÿ∏ŸäŸÅ ŸÖÿπŸÇÿØ
        collaborator_raw = user_info.get('airtable_collaborator')
        if collaborator_raw:
            self.current_user_collaborator = collaborator_raw  # ‚Üê ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÇŸäŸÖÿ© ŸÉŸÖÿß ŸáŸä
            logger.info(f"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ŸÜÿßÿ¨ÿ≠: {self.current_username}")
            logger.debug(f"Collaborator: {type(self.current_user_collaborator)} = {self.current_user_collaborator}")
        else:
            logger.warning(f"ŸÑÿß ŸäŸàÿ¨ÿØ Airtable Collaborator ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {self.current_username}")
            self.current_user_collaborator = None

        # ÿ™ÿπŸäŸäŸÜ View ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        user_view = user_info.get('view')
        if user_view:
            self.airtable_booking.set_view(user_view)
            logger.info(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ View: {user_view}")

        # ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        try:
            if self.login_window:
                self.login_window.destroy()
        except Exception as e:
            logger.warning(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ: {e}")

        # ŸÅÿ™ÿ≠ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        self._open_main_window(user_info)

    def _open_main_window(self, user_info: Dict[str, str]) -> None:
        """ŸÅÿ™ÿ≠ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"""
        try:
            user_record = {
                'id': user_info.get('record_id', ''),
                'fields': {
                    'Username': user_info.get('username', ''),
                    'Airtable View': user_info.get('view'),
                    'Role': user_info.get('role', 'viewer'),
                    'Airtable Collaborator': user_info.get('airtable_collaborator')
                }
            }

            self.main_window = MainWindow(
                lang_manager=self.lang_manager,
                theme_manager=self.theme_manager,
                airtable_model=self.airtable_booking,
                controller=self,
                user_record=user_record
            )

            # ÿ™ÿ≠ÿØŸäÿ´ GUI updater
            from utils.threading_utils import get_gui_updater
            get_gui_updater().set_root_widget(self.main_window)

            # ÿ™ÿ≠ŸÖŸäŸÑ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ© ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
            self._load_existing_booking_numbers()

            # ŸÅÿ≠ÿµ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ÿπÿØ ÿßŸÑŸÅÿ™ÿ≠
            if not self.dropdown_manager:
                self.main_window.after(2000, self._show_dropdown_unavailable_message)

            self.main_window.mainloop()

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: {e}")

    def _load_existing_booking_numbers(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±"""
        try:
            records = self.airtable_booking.fetch_records(use_cache=True)
            for record in records:
                booking_nr = record.get('fields', {}).get('Booking Nr.')
                if booking_nr:
                    self.used_booking_numbers.add(booking_nr)

            logger.info(f"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {len(self.used_booking_numbers)} ÿ±ŸÇŸÖ ÿ≠ÿ¨ÿ≤ ŸÖŸàÿ¨ŸàÿØ")
        except Exception as e:
            logger.warning(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: {e}")

    def _show_dropdown_unavailable_message(self):
        """ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿØŸÖ ÿ™ŸàŸÅÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        messagebox.showerror(
            "ÿÆÿ∑ÿ£ ÿ≠ÿ±ÿ¨",
            "ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖŸÜ Airtable.\n"
            "ŸÑŸÜ ÿ™ÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™.\n\n"
            "ÿ™ÿ£ŸÉÿØ ŸÖŸÜ:\n"
            "- Ÿàÿ¨ŸàÿØ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ŸÅŸä Airtable\n"
            "- ÿµÿ≠ÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÅŸä ŸÖŸÑŸÅ .env"
        )

    # =============== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ===============

    def fetch_all_records(self, force_refresh: bool = False) -> List[Dict[str, Any]]:
        """ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖŸÜ Airtable"""
        try:
            records = self.airtable_booking.fetch_records(use_cache=False)
            logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(records)} ÿ≥ÿ¨ŸÑ")

            # ÿ™ÿ≠ÿØŸäÿ´ ŸÉÿßÿ¥ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
            self.used_booking_numbers.clear()
            for record in records:
                booking_nr = record.get('fields', {}).get('Booking Nr.')
                if booking_nr:
                    self.used_booking_numbers.add(booking_nr)

            # ÿ∑ÿ®ÿßÿπÿ© ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ (ŸÑŸÑÿ™ÿ∑ŸàŸäÿ±)
            if records:
                field_names = list(records[0].get('fields', {}).keys())
                logger.debug(f"ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©: {len(field_names)} ÿ≠ŸÇŸÑ")

            return records
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™: {e}")
            return []

    def refresh_data(self) -> List[Dict[str, Any]]:
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        logger.info("ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Airtable")
        return self.fetch_all_records()

    def set_selected_record(self, record: Dict[str, Any]) -> None:
        """ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ≠ÿØÿØ"""
        self.selected_record = record
        logger.debug(f"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ≥ÿ¨ŸÑ: {record.get('id')}")

    # =============== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ===============

    def _check_record_permission(self, record: Dict[str, Any], action: str = "ÿ™ÿπÿØŸäŸÑ") -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿπŸÖŸÑ ÿπŸÑŸâ ÿßŸÑÿ≥ÿ¨ŸÑ"""
        if not record:
            return False

        # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ≥ÿ¨ŸÑ ŸàÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        record_fields = record.get("fields", {})
        record_assigned_to = record_fields.get("Assigned To")
        current_user_id = self._get_current_user_id()
        is_admin = self.current_user_info.get('role', '').lower() == 'admin'

        # ÿßŸÑÿ≥ŸÖÿßÿ≠ ŸÑŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ
        if is_admin:
            return True

        # ŸÖŸÜÿπ ÿßŸÑÿπŸÖŸÑ ÿπŸÑŸâ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©
        if not record_assigned_to:
            logger.warning(f"ÿßŸÑÿ≥ÿ¨ŸÑ ŸÇÿØŸäŸÖ (ÿ®ÿØŸàŸÜ Assigned To) - ŸÖŸÜÿπ {action}")
            return False

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        if current_user_id:
            assigned_to_id = record_assigned_to.get('id') if isinstance(record_assigned_to, dict) else record_assigned_to
            return assigned_to_id == current_user_id

        return False

    def _get_current_user_id(self):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ÿ®ÿ™ŸÜÿ∏ŸäŸÅ ÿ£ÿ≥ÿßÿ≥Ÿä ŸÅŸÇÿ∑"""
        if self.current_user_collaborator:
            if isinstance(self.current_user_collaborator, dict):
                user_id = self.current_user_collaborator.get('id')
            else:
                user_id = self.current_user_collaborator

            # ÿ™ŸÜÿ∏ŸäŸÅ ÿ£ÿ≥ÿßÿ≥Ÿä ŸÅŸÇÿ∑ - ÿ•ÿ≤ÿßŸÑÿ© ŸÖÿ≥ÿßŸÅÿßÿ™ ÿ≤ÿßÿ¶ÿØÿ©
            if user_id:
                cleaned_id = str(user_id).strip()
                logger.debug(f"ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {cleaned_id}")
                return cleaned_id

        return None

    def _get_permission_error_message(self, record: Dict[str, Any], action: str) -> Tuple[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©"""
        record_assigned_to = record.get("fields", {}).get("Assigned To")

        if not record_assigned_to:
            return ("ÿ≥ÿ¨ŸÑ ŸÇÿØŸäŸÖ", f"ÿπÿ∞ÿ±ÿßŸãÿå ŸÑÿß ŸäŸÖŸÉŸÜ {action} Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ¨ŸÑ.\n\nŸáÿ∞ÿß ÿßŸÑÿ≥ÿ¨ŸÑ ŸÇÿØŸäŸÖ Ÿàÿ∫Ÿäÿ± ŸÖÿ±ÿ™ÿ®ÿ∑ ÿ®ÿ£Ÿä ŸÖÿ≥ÿ™ÿÆÿØŸÖ.")
        else:
            return ("ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿµŸÑÿßÿ≠Ÿäÿ©", f"ÿπÿ∞ÿ±ÿßŸãÿå ŸÑÿß ŸäŸÖŸÉŸÜŸÉ {action} Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ¨ŸÑ.\n\nŸäŸÖŸÉŸÜŸÉ ŸÅŸÇÿ∑ {action} ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ™Ÿä ŸÇŸÖÿ™ ÿ®ÿ•ŸÜÿ¥ÿßÿ¶Ÿáÿß.")

    # =============== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨ ===============

    def open_add_form(self):
        """ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ¨ÿ≤ ÿ¨ÿØŸäÿØ"""
        if not self._can_open_form():
            return

        self._open_form_with_checks("add")

    def open_edit_form(self) -> None:
        """ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ≠ÿØÿØ"""
        if not self.selected_record:
            messagebox.showwarning("ÿ™ŸÜÿ®ŸäŸá", "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿ≥ÿ¨ŸÑ ŸÑŸÑÿ™ÿπÿØŸäŸÑ")
            return

        if not self._can_open_form():
            return

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
        if not self._check_record_permission(self.selected_record, "ÿ™ÿπÿØŸäŸÑ"):
            title, message = self._get_permission_error_message(self.selected_record, "ÿ™ÿπÿØŸäŸÑ")
            messagebox.showerror(title, message)
            return

        self._open_form_with_checks("edit")

    def _can_open_form(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ŸÅÿ™ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨"""
        if self.is_loading:
            messagebox.showinfo(
                "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ",
                "Ÿäÿ±ÿ¨Ÿâ ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÜÿ™Ÿáÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÇÿ®ŸÑ ŸÅÿ™ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨."
            )
            return False

        if not HAS_AIRTABLE_DROPDOWNS or not self.dropdown_manager:
            messagebox.showerror(
                "ÿÆÿ∑ÿ£",
                "ŸÑÿß ŸäŸÖŸÉŸÜ ŸÅÿ™ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨.\nÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖŸÜ Airtable ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©."
            )
            return False

        return True

    def _open_form_with_checks(self, mode: str):
        """ŸÅÿ™ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ŸÖÿπ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        operation_id = f"open_form_{mode}_{datetime.now().timestamp()}"
        self.loading_operations.add(operation_id)

        loading_dialog = self._create_loading_dialog("ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...")

        def check_and_open():
            try:
                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
                status = self.dropdown_manager.get_status() if self.dropdown_manager else {'errors': {'general': 'ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠'}}

                # ÿ•ÿ∫ŸÑÿßŸÇ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
                self.main_window.after(0, lambda: loading_dialog.destroy())
                self.loading_operations.discard(operation_id)

                if status.get('errors'):
                    self.main_window.after(100, lambda: self._show_dropdown_errors(status['errors']))
                    return

                # ŸÅÿ™ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
                self.main_window.after(100, lambda: self._create_form(mode))

            except Exception as e:
                self.main_window.after(0, lambda: loading_dialog.destroy())
                self.loading_operations.discard(operation_id)
                self.main_window.after(100, lambda: messagebox.showerror("ÿÆÿ∑ÿ£", f"ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ŸÇŸÇ: {str(e)}"))

        threading.Thread(target=check_and_open, daemon=True).start()

    def _create_form(self, mode: str):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ - ÿØÿßŸÑÿ© ŸÖŸàÿ≠ÿØÿ©"""
        try:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÜÿßŸÅÿ∞ÿ© ŸÖŸÅÿ™Ÿàÿ≠ÿ© ŸÑŸÜŸÅÿ≥ ÿßŸÑÿ≥ÿ¨ŸÑ (ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ)
            if mode == "edit":
                record_id = self.selected_record.get("id")
                for window in self.open_edit_windows:
                    if (window.winfo_exists() and hasattr(window, 'record_id') and
                        window.record_id == record_id):
                        window.focus_force()
                        return

            # ŸÖÿ¨ŸÖŸàÿπÿßÿ™ Ÿàÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ
            field_groups, field_type_map = self._get_form_configuration()

            # ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™
            form_params = {
                "parent": self.main_window,
                "config_mgr": self.config_mgr,
                "db_mgr": self.db_mgr,
                "airtable_model": self.airtable_booking,
                "controller": self,
                "dropdown_manager": self.dropdown_manager,
                "lang_manager": self.lang_manager,
                "field_groups": field_groups,
                "field_type_map": field_type_map,
                "mode": mode
            }

            # ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿπÿßŸÖŸÑÿßÿ™ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            if mode == "edit":
                form_params.update({
                    "record_id": self.selected_record.get("id"),
                    "initial_fields": self.selected_record.get("fields", {})
                })

            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            form_window = AddEditWindow(**form_params)

            logger.info(f"ÿ™ŸÖ ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© {mode} ÿ®ŸÜÿ¨ÿßÿ≠")
            self.open_edit_windows.append(form_window)

            # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÜÿØ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
            def on_close():
                if form_window in self.open_edit_windows:
                    self.open_edit_windows.remove(form_window)

            form_window.protocol("WM_DELETE_WINDOW", lambda: [on_close(), form_window.destroy()])

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ŸÜŸÖŸàÿ∞ÿ¨ {mode}: {e}")
            messagebox.showerror("ÿÆÿ∑ÿ£", f"ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {str(e)}")

    def _get_form_configuration(self) -> Tuple[Dict, Dict]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ™ŸÉŸàŸäŸÜ ŸÖÿ¨ŸÖŸàÿπÿßÿ™ Ÿàÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ"""
        field_groups = {
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©": [
                "Customer Name", "Hotel Name", "Agency", "Booking Nr."
            ],
            "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿ≠ŸÑÿ©": [
                "trip Name", "Date Trip", "Option", "des", "Guide", "Product ID"
            ],
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ±ŸÉÿßÿ®": [
                "ADT", "CHD", "STD", "Youth", "CHD Age"
            ],
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ": [
                "Customer Phone", "Customer Email"
            ],
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±": [
                "Total price USD", "Collecting on date Trip"
            ]
        }

        field_type_map = {
            "Customer Name": "text", "Hotel Name": "text", "Agency": "dropdown",
            "Booking Nr.": "readonly", "trip Name": "dropdown", "Date Trip": "date",
            "Option": "dropdown", "des": "dropdown", "Guide": "dropdown",
            "Product ID": "text", "ADT": "number", "CHD": "number", "STD": "number",
            "Youth": "number", "CHD Age": "text", "Customer Phone": "phone",
            "Customer Email": "email", "Total price USD": "currency",
            "Collecting on date Trip": "text"
        }

        return field_groups, field_type_map

    def _show_dropdown_errors(self, errors):
        """ÿπÿ±ÿ∂ ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        error_msg = "ÿ™ÿπÿ∞ÿ± ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Airtable:\n\n"
        for table, error in errors.items():
            error_msg += f"‚Ä¢ {error}\n"
        error_msg += "\n‚õî ŸÑŸÜ ÿ™ÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™."

        messagebox.showerror("ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©", error_msg)

    # =============== ÿπŸÖŸÑŸäÿßÿ™ CRUD ===============

    def create_record(self, fields: Dict[str, Any]) -> Dict[str, Any]:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ÿ¨ÿØŸäÿØ ŸÖÿπ ÿ•ÿ∂ÿßŸÅÿ© Assigned To ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"""
        try:
            logger.info("ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ÿ¨ÿØŸäÿØ...")

            # ÿ•ÿ∂ÿßŸÅÿ© Assigned To ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖÿπ ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÑŸÄ User field
            collaborator_id = self._get_current_user_id()
            if collaborator_id:
                # ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÇŸäŸÖÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ© ÿ®ÿØŸàŸÜ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
                fields['Assigned To'] = {"id": collaborator_id}  # object
                logger.info(f"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© Assigned To: {collaborator_id}")

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ Ÿàÿ∂ŸÖÿßŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
            booking_nr = fields.get('Booking Nr.')
            if booking_nr:
                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÖÿ≥ÿ®ŸÇÿßŸã
                if booking_nr in self.used_booking_numbers:
                    logger.warning(f"ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ {booking_nr} ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸãÿå ÿ≥Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÇŸÖ ÿ¨ÿØŸäÿØ")
                    # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ∑ŸÇ ŸÑÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿ¨ÿØŸäÿØ ŸáŸÜÿß ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
                else:
                    # ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿ•ŸÑŸâ ÿßŸÑŸÉÿßÿ¥
                    self.used_booking_numbers.add(booking_nr)
                    logger.info(f"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑÿ¨ÿØŸäÿØ: {booking_nr}")

            # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ≠ŸÇŸàŸÑ - ÿ®ÿØŸàŸÜ ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÄ Assigned To
            cleaned_fields = self._clean_fields_for_save_simple(fields)

            if not cleaned_fields:
                raise ValueError("ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿ≠ŸÅÿ∏Ÿáÿß")

            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ
            result = self.airtable_booking.create_record(cleaned_fields)

            if result:
                logger.info(f"ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠: {result.get('id')}")
                self._refresh_main_window()
                return result
            else:
                logger.error("ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ")
                return None

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ: {e}")
            raise

    def update_record(self, record_id: str, fields: Dict[str, Any]) -> Dict[str, Any]:
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ≥ÿ¨ŸÑ ŸÖŸàÿ¨ŸàÿØ ŸÖÿπ ÿ∂ŸÖÿßŸÜ ÿπÿØŸÖ ÿ™ÿπÿØŸäŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"""
        try:
            logger.info(f"ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ: {record_id}")

            # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ≠ŸÇŸàŸÑ (ŸÖÿπ ŸÖŸÜÿπ ÿ™ÿπÿØŸäŸÑ Assigned To Ÿà Booking Nr.)
            cleaned_fields = self._clean_fields_for_save(fields, exclude_assigned_to=True, exclude_booking_nr=True)

            if not cleaned_fields:
                logger.warning("ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ŸÇŸàŸÑ ŸÑŸÑÿ™ÿ≠ÿØŸäÿ´")
                return None

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ
            result = self.airtable_booking.update_record(record_id, cleaned_fields)

            if result:
                logger.info(f"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠: {record_id}")
                self._refresh_main_window()
                return result
            else:
                logger.error(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ: {record_id}")
                return None

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ: {e}")
            raise

    def delete_record(self) -> bool:
        """ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ≠ÿØÿØ"""
        if not self.selected_record:
            return False

        record_id = self.selected_record.get("id")

        try:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
            if not self._check_record_permission(self.selected_record, "ÿ≠ÿ∞ŸÅ"):
                title, message = self._get_permission_error_message(self.selected_record, "ÿ≠ÿ∞ŸÅ")
                messagebox.showerror(title, message)
                return False

            # ÿ•ÿ≤ÿßŸÑÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ ŸÇÿ®ŸÑ ÿßŸÑÿ≠ÿ∞ŸÅ
            booking_nr = self.selected_record.get('fields', {}).get('Booking Nr.')
            if booking_nr and booking_nr in self.used_booking_numbers:
                self.used_booking_numbers.remove(booking_nr)
                logger.info(f"ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ {booking_nr} ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥")

            # ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ
            success = self.airtable_booking.delete_record(record_id)

            if success:
                logger.info(f"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ: {record_id}")
                self.selected_record = None
                self._refresh_main_window()

            return success

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ: {e}")
            return False

    def batch_delete_records(self, record_ids: List[str]) -> Tuple[int, int]:
        """ÿ≠ÿ∞ŸÅ ÿπÿØÿ© ÿ≥ÿ¨ŸÑÿßÿ™"""
        success_count = 0
        unauthorized_count = 0
        old_records_count = 0

        # ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™
        all_records = self.fetch_all_records()
        records_dict = {record['id']: record for record in all_records}

        for record_id in record_ids:
            try:
                record = records_dict.get(record_id)
                if not record:
                    continue

                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
                if not self._check_record_permission(record, "ÿ≠ÿ∞ŸÅ"):
                    if not record.get("fields", {}).get("Assigned To"):
                        old_records_count += 1
                    else:
                        unauthorized_count += 1
                    continue

                # ÿ•ÿ≤ÿßŸÑÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥
                booking_nr = record.get('fields', {}).get('Booking Nr.')
                if booking_nr and booking_nr in self.used_booking_numbers:
                    self.used_booking_numbers.remove(booking_nr)

                # ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ
                if self.airtable_booking.delete_record(record_id):
                    success_count += 1

            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ {record_id}: {e}")

        # ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©
        self._show_batch_delete_result(success_count, len(record_ids), unauthorized_count, old_records_count)

        if success_count > 0:
            self._refresh_main_window()

        return success_count, len(record_ids)

    def _clean_fields_for_save_simple(self, fields: Dict[str, Any]) -> Dict[str, Any]:
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿ®ÿØŸàŸÜ ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖÿπŸÇÿØÿ© ŸÑÿ≠ŸÇŸÑ Assigned To"""
        # ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®ÿ© ŸàÿßŸÑŸÖÿ≠ÿ∏Ÿàÿ±ÿ©
        computed_fields = [
            'Created By', 'Last Modified By', 'Created Date', 'Last Modified',
            'Modified By', 'Modified Date'
        ]

        cleaned = {}
        for key, value in fields.items():
            if key in computed_fields:
                continue

            # ÿ™ŸÜÿ∏ŸäŸÅ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÇŸäŸÖ ÿßŸÑŸÜÿµŸäÿ© ÿßŸÑÿπÿßÿØŸäÿ©
            if value is not None and value != "":
                if isinstance(value, str):
                    cleaned_value = value.strip()
                    if cleaned_value:
                        cleaned[key] = cleaned_value
                else:
                    cleaned[key] = value

        logger.debug(f"ÿ™ŸÜÿ∏ŸäŸÅ ÿ®ÿ≥Ÿäÿ∑: {len(fields)} ‚Üí {len(cleaned)} ÿ≠ŸÇŸÑ")
        return cleaned

    def _clean_fields_for_save(self, fields: Dict[str, Any], exclude_assigned_to: bool = False, exclude_booking_nr: bool = False) -> Dict[str, Any]:
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ≠ŸÅÿ∏ ŸÖÿπ ÿÆŸäÿßÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸàŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑÿ≠ŸÇŸàŸÑ User"""
        # ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®ÿ© ŸàÿßŸÑŸÖÿ≠ÿ∏Ÿàÿ±ÿ©
        computed_fields = [
            'Created By', 'Last Modified By', 'Created Date', 'Last Modified',
            'Modified By', 'Modified Date'
        ]

        if exclude_assigned_to:
            computed_fields.append('Assigned To')

        # ‚Üê ÿ•ÿ∂ÿßŸÅÿ© ÿÆŸäÿßÿ± ŸÖŸÜÿπ ÿ™ÿπÿØŸäŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ
        if exclude_booking_nr:
            computed_fields.append('Booking Nr.')
            logger.info("ÿ™ŸÖ ÿßÿ≥ÿ™ÿ®ÿπÿßÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÖŸÜ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ (ŸÖÿ≠ŸÖŸä ŸÖŸÜ ÿßŸÑÿ™ÿπÿØŸäŸÑ)")

        # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®ÿ© ŸàÿßŸÑŸÅÿßÿ±ÿ∫ÿ© ŸÖÿπ ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑÿ≠ŸÇŸàŸÑ User
        cleaned = {}
        for key, value in fields.items():
            if key in computed_fields:
                continue

            # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑÿ≠ŸÇŸÑ Assigned To (User field)
            if key == 'Assigned To' and not exclude_assigned_to:
                cleaned_value = self._clean_user_field_value(value)
                if cleaned_value:
                    cleaned[key] = cleaned_value
                    logger.debug(f"ÿ™ŸÜÿ∏ŸäŸÅ ÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{key}': {value} ‚Üí {cleaned_value}")

            # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿπÿßÿØŸäÿ©
            elif value is not None and value != "":
                # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÜÿµŸäÿ© ŸÖŸÜ escape characters ÿ•ÿ∂ÿßŸÅŸäÿ©
                if isinstance(value, str):
                    cleaned_value = value.strip()
                    if cleaned_value:
                        cleaned[key] = cleaned_value
                else:
                    cleaned[key] = value

        # ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÑŸÑÿ™ÿ¥ÿÆŸäÿµ
        excluded_count = len(fields) - len(cleaned)
        if excluded_count > 0:
            logger.debug(f"ÿ™ŸÖ ÿßÿ≥ÿ™ÿ®ÿπÿßÿØ {excluded_count} ÿ≠ŸÇŸÑ ŸÖŸÜ ÿßŸÑÿ≠ŸÅÿ∏")

        return cleaned

    def _clean_user_field_value(self, value) -> Optional[str]:
        """ÿØÿßŸÑÿ© ŸÖÿ®ÿ≥ÿ∑ÿ© ŸÑÿ™ŸÜÿ∏ŸäŸÅ ÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        if not value:
            return None

        # ÿ™ŸÜÿ∏ŸäŸÅ ÿ®ÿ≥Ÿäÿ∑
        if isinstance(value, dict):
            user_id = value.get('id')
            if user_id:
                return str(user_id).strip()
        elif isinstance(value, str):
            return value.strip()

        return None

    def _show_batch_delete_result(self, success: int, total: int, unauthorized: int, old: int):
        """ÿπÿ±ÿ∂ ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ≠ÿ∞ŸÅ ÿßŸÑÿØŸÅÿπŸä"""
        message = f"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ {success} ÿ≥ÿ¨ŸÑ ŸÖŸÜ ÿ£ÿµŸÑ {total}\n\n"

        if unauthorized > 0:
            message += f"‚Ä¢ {unauthorized} ÿ≥ÿ¨ŸÑ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅŸá (ŸÖŸÖŸÑŸàŸÉ ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿ¢ÿÆÿ±ŸäŸÜ)\n"

        if old > 0:
            message += f"‚Ä¢ {old} ÿ≥ÿ¨ŸÑ ŸÇÿØŸäŸÖ (Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿØÿπŸÖ ÿßŸÑŸÅŸÜŸä)\n"

        if unauthorized > 0:
            message += "\nŸäŸÖŸÉŸÜŸÉ ŸÅŸÇÿ∑ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ™Ÿä ŸÇŸÖÿ™ ÿ®ÿ•ŸÜÿ¥ÿßÿ¶Ÿáÿß"

        messagebox.showinfo("ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ≠ÿ∞ŸÅ", message)

    def _refresh_main_window(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"""
        if self.main_window and hasattr(self.main_window, '_refresh_data'):
            self.main_window.after(100, self.main_window._refresh_data)

    # =============== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸàÿßŸÑÿ¨ŸÑÿ≥ÿ© ===============

    def get_current_user_collaborator(self):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ Airtable Collaborator ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÖÿπ ÿ™ÿ¥ÿÆŸäÿµ ŸÖÿ≠ÿ≥ŸÜ"""
        if self.current_user_collaborator:
            logger.debug(f"ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÖŸàÿ¨ŸàÿØ: {type(self.current_user_collaborator)} = {self.current_user_collaborator}")
            return self.current_user_collaborator

        # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ¨ŸÑÿ®Ÿáÿß ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        if self.current_username and self.airtable_users:
            try:
                logger.info(f"ŸÖÿ≠ÿßŸàŸÑÿ© ÿ¨ŸÑÿ® ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {self.current_username}")
                users = self.airtable_users.fetch_records()
                for user in users:
                    username = user.get('fields', {}).get('Username', '')
                    if username.lower() == self.current_username.lower():
                        collaborator = user.get('fields', {}).get('Airtable Collaborator')
                        if collaborator:
                            self.current_user_collaborator = collaborator
                            logger.info(f"ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ Collaborator: {type(collaborator)} = {collaborator}")
                            return collaborator
                        else:
                            logger.warning(f"ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ Airtable Collaborator ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {username}")

                logger.warning(f"ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {self.current_username}")
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {e}")

        return None

    def on_logout(self) -> None:
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"""
        logger.info("ÿ®ÿØÿ° ÿπŸÖŸÑŸäÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨...")

        # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ©
        for window in self.open_edit_windows:
            try:
                if window.winfo_exists():
                    window.destroy()
            except:
                pass

        self.open_edit_windows.clear()

        # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™
        self.current_username = None
        self.current_user_info = None
        self.current_user_collaborator = None
        self.selected_record = None
        self.is_loading = False
        self.loading_operations.clear()

        # ŸÖÿ≥ÿ≠ ŸÉÿßÿ¥ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
        self.used_booking_numbers.clear()

        # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÄ View
        self.airtable_booking.set_view(None)

        logger.info("ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠")

    # =============== ÿßŸÑÿ£ÿØŸàÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ===============

    def _create_loading_dialog(self, message: str = "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...") -> ctk.CTkToplevel:
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ"""
        dialog = ctk.CTkToplevel()
        dialog.title("ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...")
        dialog.geometry("350x150")

        # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        dialog.update_idletasks()
        x = (dialog.winfo_screenwidth() // 2) - 175
        y = (dialog.winfo_screenheight() // 2) - 75
        dialog.geometry(f"350x150+{x}+{y}")

        dialog.grab_set()
        dialog.transient(self.main_window if self.main_window else None)

        # ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        frame = ctk.CTkFrame(dialog)
        frame.pack(fill="both", expand=True, padx=20, pady=20)

        ctk.CTkLabel(frame, text=f"‚è≥ {message}", font=ctk.CTkFont(size=16)).pack(pady=10)

        progress = ctk.CTkProgressBar(frame)
        progress.pack(fill="x", pady=10)
        progress.configure(mode="indeterminate")
        progress.start()

        ctk.CTkLabel(frame, text="Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±", font=ctk.CTkFont(size=12), text_color="gray").pack()

        return dialog

    def update_all_windows_language(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÑÿ∫ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ©"""
        logger.info("ÿ™ÿ≠ÿØŸäÿ´ ŸÑÿ∫ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞...")

        for window in self.open_edit_windows:
            try:
                if window.winfo_exists() and hasattr(window, 'update_language'):
                    window.update_language(self.lang_manager)
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ŸÑÿ∫ÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    def update_all_windows_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ŸÅŸä ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ©"""
        logger.info("ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ŸÅŸä ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞...")

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        if self.main_window and hasattr(self.main_window, 'refresh_theme'):
            try:
                self.main_window.refresh_theme()
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿ´ŸäŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©: {e}")

        # ÿ™ÿ≠ÿØŸäÿ´ ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ™ÿπÿØŸäŸÑ/ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
        for window in self.open_edit_windows:
            try:
                if window.winfo_exists() and hasattr(window, 'refresh_theme'):
                    window.refresh_theme()
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿ´ŸäŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    def cleanup(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿπŸÜÿØ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        logger.info("ÿ®ÿØÿ° ÿ™ŸÜÿ∏ŸäŸÅ ŸÖŸàÿßÿ±ÿØ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ...")

        # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ©
        for window in self.open_edit_windows:
            try:
                if window.winfo_exists():
                    window.destroy()
            except:
                pass

        # ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™
        self.is_loading = False
        self.loading_operations.clear()

        # ŸÖÿ≥ÿ≠ ÿßŸÑŸÉÿßÿ¥
        self.used_booking_numbers.clear()

        # ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿÆŸäŸàÿ∑
        shutdown_threading()

        logger.info("ÿ™ŸÖ ÿ™ŸÜÿ∏ŸäŸÅ ŸÖŸàÿßÿ±ÿØ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ")

    # =============== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ===============

    def refresh_dropdown_manager(self):
        """ÿ•ÿπÿßÿØÿ© ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if HAS_AIRTABLE_DROPDOWNS:
            try:
                self.dropdown_manager = AirtableDropdownManager(
                    config_manager=self.config_mgr,
                    db_manager=self.db_mgr
                )
                logger.info("ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©")
                return True
            except Exception as e:
                logger.error(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©: {e}")
                self.dropdown_manager = None
                return False
        return False

    def get_dropdown_status(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿßŸÑÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.dropdown_manager:
            return self.dropdown_manager.get_status()
        return {
            "available": HAS_AIRTABLE_DROPDOWNS,
            "initialized": False,
            "errors": {"general": "ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ∫Ÿäÿ± ŸÖŸáŸäÿ£"}
        }

    # =============== ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ===============

    def is_booking_number_unique(self, booking_number: str) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿ™ŸÉÿ±ÿßÿ± ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"""
        return booking_number not in self.used_booking_numbers

    def add_booking_number_to_cache(self, booking_number: str):
        """ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÇŸÖ ÿ≠ÿ¨ÿ≤ ÿ•ŸÑŸâ ÿßŸÑŸÉÿßÿ¥"""
        if booking_number:
            self.used_booking_numbers.add(booking_number)
            logger.debug(f"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ {booking_number} ÿ•ŸÑŸâ ÿßŸÑŸÉÿßÿ¥")

    def remove_booking_number_from_cache(self, booking_number: str):
        """ÿ•ÿ≤ÿßŸÑÿ© ÿ±ŸÇŸÖ ÿ≠ÿ¨ÿ≤ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥"""
        if booking_number and booking_number in self.used_booking_numbers:
            self.used_booking_numbers.remove(booking_number)
            logger.debug(f"ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ {booking_number} ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥")

    def get_booking_numbers_count(self) -> int:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿπÿØÿØ ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©"""
        return len(self.used_booking_numbers)

    # =============== ÿØŸàÿßŸÑ ÿßŸÑÿ™ÿ¥ÿÆŸäÿµ ŸàÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ===============

    def debug_user_info(self):
        """ÿØÿßŸÑÿ© ÿ™ÿ¥ÿÆŸäÿµ ŸÖÿ®ÿ≥ÿ∑ÿ© ŸÑŸÅÿ≠ÿµ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        logger.info("=" * 50)
        logger.info("ÿ™ÿ¥ÿÆŸäÿµ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ")
        logger.info("=" * 50)

        logger.info(f"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {self.current_username}")
        logger.info(f"ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {self.current_user_info}")
        logger.info(f"Collaborator (ŸÜŸàÿπ): {type(self.current_user_collaborator)}")
        logger.info(f"Collaborator (ŸÇŸäŸÖÿ©): {self.current_user_collaborator}")
        logger.info(f"Collaborator (repr): {repr(self.current_user_collaborator)}")

        # ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        user_id = self._get_current_user_id()
        logger.info(f"ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜŸáÿßÿ¶Ÿä: '{user_id}'")
        logger.info(f"ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (repr): {repr(user_id)}")

        logger.info("=" * 50)

    def test_user_field_creation(self) -> bool:
        """ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖÿ®ÿ≥ÿ∑ ŸÑÿ≠ŸÇŸÑ Assigned To"""
        try:
            user_id = self._get_current_user_id()
            if not user_id:
                logger.error("‚ùå ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿπÿ±ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ")
                return False

            logger.info(f"‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ± ŸÜÿßÿ¨ÿ≠ - ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: '{user_id}'")
            logger.info(f"ÿ∑ŸàŸÑ ÿßŸÑŸÖÿπÿ±ŸÅ: {len(user_id)}")
            logger.info(f"Ÿäÿ®ÿØÿ£ ÿ®ŸÄ usr: {user_id.startswith('usr')}")
            return True

        except Exception as e:
            logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {e}")
            return False
            # -*- coding: utf-8 -*-


============================================================
FILE: core\airtable_dropdown_manager.py
SIZE: 24117 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/airtable_dropdown_manager.py - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑÿ£ÿØÿßÿ° ŸàŸÖŸÜÿπ ÿßŸÑÿ™ÿ¨ŸÖÿØ

ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ:
- ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ™Ÿàÿßÿ≤Ÿä ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ
- ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ§ŸÇÿ™ ÿ∞ŸÉŸä
- ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ŸÅÿ∂ŸÑ ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ°
- ŸÖŸÜÿπ ÿßŸÑÿ™ÿ¨ŸÖÿØ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
"""

import os
import logging
import threading
import time
from concurrent.futures import ThreadPoolExecutor, as_completed, TimeoutError
from typing import Dict, List, Optional, Tuple
from datetime import datetime, timedelta
import json

from core.airtable_manager import AirtableModel

logger = logging.getLogger(__name__)


class AirtableDropdownManager:
    """ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿ£ÿØÿßÿ° ŸàŸÖŸÜÿπ ÿßŸÑÿ™ÿ¨ŸÖÿØ"""

    # ŸÖŸÑŸÅ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
    CACHE_FILE = "cache/dropdown_cache.json"
    CACHE_DURATION = timedelta(hours=1)  # ŸÖÿØÿ© ÿßŸÑŸÉÿßÿ¥ ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©
    LOADING_TIMEOUT = 30  # ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ© ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ (30 ÿ´ÿßŸÜŸäÿ©)
    MAX_WORKERS = 3  # ÿπÿØÿØ ÿßŸÑÿÆŸäŸàÿ∑ ÿßŸÑŸÖÿ™Ÿàÿßÿ≤Ÿäÿ©

    def __init__(self, config_manager, db_manager):
        self.config_mgr = config_manager
        self.db_mgr = db_manager
        self.tables = {}
        self.field_names = {}
        self.errors = {}
        self._cache = {}
        self._cache_timestamps = {}
        self._loading = False
        self._load_lock = threading.RLock()
        self._loading_start_time = None
        self._active_futures = set()

        # ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ ÿßŸÑŸÉÿßÿ¥
        os.makedirs("cache", exist_ok=True)

        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿßÿ¥ ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅ
        self._load_cache_from_file()

        # ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ¨ÿØÿßŸàŸÑ
        self._setup_tables()

        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©
        self._start_background_loading()

    def _load_cache_from_file(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿßÿ¥ ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅ"""
        try:
            if os.path.exists(self.CACHE_FILE):
                with open(self.CACHE_FILE, 'r', encoding='utf-8') as f:
                    cache_data = json.load(f)

                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÉÿßÿ¥
                for key, data in cache_data.items():
                    try:
                        timestamp = datetime.fromisoformat(data.get('timestamp', ''))
                        if datetime.now() - timestamp < self.CACHE_DURATION:
                            self._cache[key] = data.get('values', [])
                            self._cache_timestamps[key] = timestamp
                    except (ValueError, TypeError) as e:
                        logger.warning(f"ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÑŸäŸÑ timestamp ŸÑŸÑŸÖŸÅÿ™ÿßÿ≠ {key}: {e}")
                        continue

                if self._cache:
                    logger.info(f"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {len(self._cache)} ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥")

        except Exception as e:
            logger.warning(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿßÿ¥: {e}")

    def _save_cache_to_file(self):
        """ÿ≠ŸÅÿ∏ ÿßŸÑŸÉÿßÿ¥ ÿ•ŸÑŸâ ÿßŸÑŸÖŸÑŸÅ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            cache_data = {}
            with self._load_lock:
                for key in self._cache:
                    if key in self._cache_timestamps:
                        cache_data[key] = {
                            'values': self._cache[key],
                            'timestamp': self._cache_timestamps[key].isoformat()
                        }

            # ŸÉÿ™ÿßÿ®ÿ© ŸÖÿ§ŸÇÿ™ÿ© ÿ´ŸÖ ŸÜŸÇŸÑ
            temp_file = self.CACHE_FILE + '.tmp'
            with open(temp_file, 'w', encoding='utf-8') as f:
                json.dump(cache_data, f, ensure_ascii=False, indent=2)

            # ŸÜŸÇŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ŸÅŸàŸÇ ÿßŸÑÿ£ÿµŸÑŸä
            if os.path.exists(self.CACHE_FILE):
                os.remove(self.CACHE_FILE)
            os.rename(temp_file, self.CACHE_FILE)

        except Exception as e:
            logger.warning(f"ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿßŸÑŸÉÿßÿ¥: {e}")
            # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
            temp_file = self.CACHE_FILE + '.tmp'
            if os.path.exists(temp_file):
                try:
                    os.remove(temp_file)
                except:
                    pass

    def _setup_tables(self):
        """ÿ™ŸáŸäÿ¶ÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        dropdown_config = {
            'guides': os.getenv('AIRTABLE_GUIDES_TABLE', 'Guides'),
            'agencies': (os.getenv('AIRTABLE_AGENCIES_TABLE', 'Agencies'), 'Agency Name'),
            'options': (os.getenv('AIRTABLE_OPTIONS_TABLE', 'Trip Options'), 'Option Name'),
            'destinations': (os.getenv('AIRTABLE_DESTINATIONS_TABLE', 'Destinations'), 'Destination'),
            'tripnames': (os.getenv('AIRTABLE_TRIPNAMES_TABLE', 'Trip Names'), 'Trip Name'),
            'management_options': (os.getenv('AIRTABLE_MANAGEMENT_OPTIONS_TABLE', 'Management Option'), 'Option Name'),
            'addons': os.getenv('AIRTABLE_ADDONS_TABLE', 'Add-on'),
        }

        logger.info(f"[Dropdown Manager] ÿ™ŸáŸäÿ¶ÿ© {len(dropdown_config)} ÿ¨ÿØŸàŸÑ")

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ API
        api_key = os.getenv('AIRTABLE_API_KEY')
        base_id = os.getenv('AIRTABLE_BASE_ID')

        if not api_key or not base_id:
            error_msg = "API Key ÿ£Ÿà Base ID ŸÖŸÅŸÇŸàÿØ"
            logger.error(f"[Dropdown Manager] {error_msg}")
            self.errors['config'] = error_msg
            return

        # ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ¨ÿØÿßŸàŸÑ
        for key, config in dropdown_config.items():
            try:
                if isinstance(config, tuple):
                    table_name, field_name = config
                else:
                    table_name = config
                    field_name = 'Name'

                self.tables[key] = AirtableModel(
                    config_manager=self.config_mgr,
                    db_manager=self.db_mgr,
                    table_name=table_name
                )
                self.field_names[key] = field_name

                logger.debug(f"ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© ÿ¨ÿØŸàŸÑ {key}: {table_name} (ÿ≠ŸÇŸÑ: {field_name})")

            except Exception as e:
                error_msg = f"ŸÅÿ¥ŸÑ ÿ™ŸáŸäÿ¶ÿ© ÿ¨ÿØŸàŸÑ '{key}': {str(e)}"
                logger.error(f"[Dropdown Manager] {error_msg}")
                self.errors[key] = error_msg

    def _start_background_loading(self):
        """ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©"""
        def load_all():
            try:
                self._load_all_dropdowns_parallel()
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿÆŸÑŸÅŸä: {e}")

        thread = threading.Thread(target=load_all, daemon=True, name="DropdownLoader")
        thread.start()

    def _load_all_dropdowns_parallel(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ®ÿ¥ŸÉŸÑ ŸÖÿ™Ÿàÿßÿ≤Ÿä ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©"""
        with self._load_lock:
            if self._loading:
                logger.debug("ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ÿßÿ±Ÿä ÿ®ÿßŸÑŸÅÿπŸÑ")
                return
            self._loading = True
            self._loading_start_time = datetime.now()

        start_time = time.time()
        logger.info("[Dropdown Manager] ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ™Ÿàÿßÿ≤Ÿä ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ")

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ¨ÿØÿßŸàŸÑ ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ
        if not self.tables:
            logger.warning("ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ÿØÿßŸàŸÑ ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ")
            with self._load_lock:
                self._loading = False
                self._loading_start_time = None
            return

        # ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÇÿ®ŸÑ try block
        completed = 0
        failed = 0
        timeout_count = 0

        try:
            # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ThreadPoolExecutor ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ™Ÿàÿßÿ≤Ÿä
            with ThreadPoolExecutor(max_workers=self.MAX_WORKERS) as executor:
                futures = {}

                # ÿ•ÿ∑ŸÑÿßŸÇ ŸÖŸáÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÑŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑÿ™Ÿä ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ™ÿ≠ÿØŸäÿ´
                for key in self.tables:
                    if self._is_cache_valid(key):
                        logger.debug(f"ÿ™ÿÆÿ∑Ÿä {key} - ÿßŸÑŸÉÿßÿ¥ ÿµÿßŸÑÿ≠")
                        continue

                    future = executor.submit(self._load_single_dropdown_with_timeout, key)
                    futures[future] = key
                    self._active_futures.add(future)

                if not futures:
                    logger.info("ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ŸÖÿ≠ÿØÿ´ÿ© ŸÅŸä ÿßŸÑŸÉÿßÿ¥")
                    return

                # ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑŸÖŸáÿßŸÖ ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©

                try:
                    for future in as_completed(futures, timeout=self.LOADING_TIMEOUT):
                        key = futures[future]
                        self._active_futures.discard(future)

                        try:
                            values = future.result(timeout=5)  # ŸÖŸáŸÑÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©
                            if values is not None:
                                with self._load_lock:
                                    self._cache[key] = values
                                    self._cache_timestamps[key] = datetime.now()
                                completed += 1
                                logger.debug(f"‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {key}: {len(values)} ŸÇŸäŸÖÿ©")

                                # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£ ÿ•ÿ∞ÿß ŸÜÿ¨ÿ≠ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
                                self.errors.pop(key, None)
                            else:
                                failed += 1
                                logger.warning(f"‚úó ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ {key}: ŸÑŸÖ Ÿäÿ™ŸÖ ÿ•ÿ±ÿ¨ÿßÿπ ÿ®ŸäÿßŸÜÿßÿ™")
                        except TimeoutError:
                            timeout_count += 1
                            logger.error(f"‚úó ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ {key}")
                            self.errors[key] = "ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ"
                        except Exception as e:
                            failed += 1
                            logger.error(f"‚úó ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ {key}: {e}")
                            self.errors[key] = str(e)

                except TimeoutError:
                    logger.error("ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ÿßŸÑÿπÿßŸÖÿ© ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ")
                    # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©
                    for future in futures:
                        if not future.done():
                            future.cancel()
                            key = futures[future]
                            self.errors[key] = "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿ≥ÿ®ÿ® ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸÖŸáŸÑÿ©"

                # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©
                self._active_futures.clear()

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ÿπÿßŸÖ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ™Ÿàÿßÿ≤Ÿä: {e}")
            # ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
            if 'completed' not in locals():
                completed = 0
            if 'failed' not in locals():
                failed = len(self.tables)
            if 'timeout_count' not in locals():
                timeout_count = 0

        finally:
            # ÿ≠ŸÅÿ∏ ÿßŸÑŸÉÿßÿ¥
            if completed > 0:
                self._save_cache_to_file()

            elapsed = time.time() - start_time
            logger.info(f"[Dropdown Manager] ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸä {elapsed:.2f}ÿ´ - "
                       f"ŸÜÿ¨ÿ≠: {completed}, ŸÅÿ¥ŸÑ: {failed}, ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ©: {timeout_count}")

            with self._load_lock:
                self._loading = False
                self._loading_start_time = None

    def _load_single_dropdown_with_timeout(self, key: str) -> Optional[List[str]]:
        """ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© Ÿàÿßÿ≠ÿØÿ© ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©"""
        start_time = time.time()

        try:
            if key not in self.tables:
                logger.warning(f"ÿßŸÑÿ¨ÿØŸàŸÑ {key} ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ")
                return None

            field_name = self.field_names.get(key, 'Name')
            logger.debug(f"ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ {key} ŸÖŸÜ ÿßŸÑÿ≠ŸÇŸÑ {field_name}")

            # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©
            values = self.tables[key].get_all_values(field_name=field_name, force_refresh=True)

            elapsed = time.time() - start_time

            if not values:
                logger.warning(f"ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä {key} (ÿßÿ≥ÿ™ÿ∫ÿ±ŸÇ {elapsed:.2f}ÿ´)")
                self.errors[key] = f"ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ"
                return []

            logger.debug(f"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {key} ÿ®ŸÜÿ¨ÿßÿ≠: {len(values)} ŸÇŸäŸÖÿ© (ÿßÿ≥ÿ™ÿ∫ÿ±ŸÇ {elapsed:.2f}ÿ´)")
            return values

        except Exception as e:
            elapsed = time.time() - start_time
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {key} (ÿßÿ≥ÿ™ÿ∫ÿ±ŸÇ {elapsed:.2f}ÿ´): {e}")
            self.errors[key] = str(e)
            raise

    def _is_cache_valid(self, key: str) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÉÿßÿ¥"""
        if key not in self._cache or key not in self._cache_timestamps:
            return False

        age = datetime.now() - self._cache_timestamps[key]
        return age < self.CACHE_DURATION

    def _cancel_loading_operations(self):
        """ÿ•ŸÑÿ∫ÿßÿ° ÿ¨ŸÖŸäÿπ ÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ¨ÿßÿ±Ÿäÿ©"""
        logger.info("ÿ•ŸÑÿ∫ÿßÿ° ÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ¨ÿßÿ±Ÿäÿ©...")

        # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸÜÿ¥ÿ∑ÿ©
        for future in list(self._active_futures):
            if not future.done():
                future.cancel()
                logger.debug(f"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ŸÖŸáŸÖÿ© ÿ™ÿ≠ŸÖŸäŸÑ")

        self._active_futures.clear()

        with self._load_lock:
            self._loading = False
            self._loading_start_time = None

    def get_dropdown_values(self, key: str, force_refresh: bool = False, timeout: float = 20.0) -> List[str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇŸäŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©"""
        try:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿ¨ÿØŸàŸÑ
            if key not in self.tables:
                logger.warning(f"ÿßŸÑÿ¨ÿØŸàŸÑ {key} ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ŸÅŸä ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©")
                return []

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ ÿ£ŸàŸÑÿßŸã
            if not force_refresh and self._is_cache_valid(key):
                logger.debug(f"ÿ•ÿ±ÿ¨ÿßÿπ ŸÇŸäŸÖ {key} ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥")
                return self._cache.get(key, [])

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ÿßÿ±ŸäÿßŸãÿå ÿßŸÜÿ™ÿ∏ÿ± ŸÇŸÑŸäŸÑÿßŸã ÿ£Ÿà ÿ£ÿ±ÿ¨ÿπ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÇÿØŸäŸÖ
            if self._loading:
                logger.debug(f"ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ÿßÿ±Ÿä - ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÜÿ™ÿ∏ÿßÿ± {key}")

                # ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©
                start_wait = time.time()
                while self._loading and (time.time() - start_wait) < timeout:
                    time.sleep(0.1)

                    # ÿ•ÿ∞ÿß ÿ£ÿµÿ®ÿ≠ÿ™ ÿßŸÑŸÇŸäŸÖÿ© ŸÖÿ™ÿßÿ≠ÿ© ŸÅŸä ÿßŸÑŸÉÿßÿ¥ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
                    if self._is_cache_valid(key):
                        logger.debug(f"ÿ™ŸÖ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ {key} ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±")
                        return self._cache.get(key, [])

                # ÿ•ÿ∞ÿß ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖŸáŸÑÿ© ŸàŸÖÿß ÿ≤ÿßŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ÿßÿ±ŸäÿßŸã
                if self._loading:
                    logger.warning(f"ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÜÿ™ÿ∏ÿßÿ± {key} - ÿ•ÿ±ÿ¨ÿßÿπ ŸÉÿßÿ¥ ŸÇÿØŸäŸÖ ÿ£Ÿà ŸÅÿßÿ±ÿ∫")
                    return self._cache.get(key, [])

            # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÅŸä ÿÆŸäÿ∑ ŸÖŸÜŸÅÿµŸÑ ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©
            try:
                logger.debug(f"ÿ™ÿ≠ŸÖŸäŸÑ {key} ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©")

                # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ThreadPoolExecutor ŸÑÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿßÿ≠ÿØ
                with ThreadPoolExecutor(max_workers=1) as executor:
                    future = executor.submit(self._load_single_dropdown_with_timeout, key)

                    try:
                        values = future.result(timeout=timeout)
                        if values is not None:
                            with self._load_lock:
                                self._cache[key] = values
                                self._cache_timestamps[key] = datetime.now()
                            self._save_cache_to_file()
                            return values
                        return []

                    except TimeoutError:
                        logger.warning(f"ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ {key}")
                        future.cancel()
                        self.errors[key] = "ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©"
                        # ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÇÿØŸäŸÖ ÿ•ŸÜ Ÿàÿ¨ÿØ
                        return self._cache.get(key, [])

            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® {key}: {e}")
                self.errors[key] = str(e)
                # ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÇÿØŸäŸÖ ÿ•ŸÜ Ÿàÿ¨ÿØ
                return self._cache.get(key, [])

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ÿπÿßŸÖ ŸÅŸä get_dropdown_values ŸÑŸÄ {key}: {e}")
            self.errors[key] = f"ÿÆÿ∑ÿ£ ÿπÿßŸÖ: {str(e)}"
            return []

    def add_value_to_dropdown(self, key: str, value: str) -> bool:
        """ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ© ÿ•ŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if key not in self.tables:
            logger.warning(f"[Dropdown] ÿ¨ÿØŸàŸÑ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ: {key}")
            return False

        if not value or not value.strip():
            logger.warning(f"[Dropdown] ŸÇŸäŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ© ŸÑŸÄ {key}")
            return False

        try:
            field_name = self.field_names.get(key, 'Name')
            success = self.tables[key].insert_if_not_exists(value.strip(), field_name=field_name)

            if success:
                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿßÿ¥
                with self._load_lock:
                    if key in self._cache:
                        if value.strip() not in self._cache[key]:
                            self._cache[key].append(value.strip())
                            self._cache[key].sort()
                            self._save_cache_to_file()

                logger.info(f"[Dropdown] ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© '{value}' ÿ•ŸÑŸâ '{key}'")

            return success

        except Exception as e:
            logger.error(f"[Dropdown] ŸÅÿ¥ŸÑ ÿ•ÿ∂ÿßŸÅÿ© '{value}' ÿ•ŸÑŸâ '{key}': {e}")
            return False

    def refresh_all(self, force: bool = True):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        logger.info("[Dropdown] ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ")

        # ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ÿßÿ±Ÿä
        if self._loading:
            logger.info("ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ¨ÿßÿ±Ÿä ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´")
            self._cancel_loading_operations()

            # ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ•ŸäŸÇÿßŸÅ
            time.sleep(0.5)

        if force:
            # ŸÖÿ≥ÿ≠ ÿßŸÑŸÉÿßÿ¥
            with self._load_lock:
                self._cache.clear()
                self._cache_timestamps.clear()
                self.errors.clear()

        # ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        self._start_background_loading()

    def get_all_dropdowns(self, timeout: float = 15.0) -> Dict[str, List[str]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ©"""
        # ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ¨ÿßÿ±ŸäÿßŸã
        start_wait = time.time()

        while self._loading and (time.time() - start_wait) < timeout:
            time.sleep(0.2)

        if self._loading:
            logger.warning(f"ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ({timeout}s)")

        result = {}
        for key in self.tables:
            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖ ŸÖÿπ ŸÖŸáŸÑÿ© ÿ≤ŸÖŸÜŸäÿ© ŸÇÿµŸäÿ±ÿ©
            try:
                result[key] = self.get_dropdown_values(key, timeout=3.0)
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® {key}: {e}")
                result[key] = []

        return result

    def get_field_mapping(self) -> Dict[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ"""
        return {
            "Agency": "agencies",
            "Guide": "guides",
            "Option": "options",
            "des": "destinations",
            "trip Name": "tripnames",
            "Management Option": "management_options",
            "Add-on": "addons"
        }

    def get_dropdown_by_field_name(self, field_name: str, timeout: float = 5.0) -> List[str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇŸäŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿ≠ŸÇŸÑ"""
        field_mapping = self.get_field_mapping()
        key = field_mapping.get(field_name)

        if key:
            return self.get_dropdown_values(key, timeout=timeout)

        logger.warning(f"[Dropdown] ŸÑÿß ŸäŸàÿ¨ÿØ ÿ±ÿ®ÿ∑ ŸÑŸÑÿ≠ŸÇŸÑ: {field_name}")
        return []

    def is_connected(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ"""
        return len(self.tables) > 0 and not self.errors.get('config')

    def get_status(self) -> Dict[str, any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿØŸäÿ± ÿ®ÿ¥ŸÉŸÑ ÿ¢ŸÖŸÜ"""
        try:
            with self._load_lock:
                # ÿ≠ÿ≥ÿßÿ® ÿπÿØÿØ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿ≠ŸÖŸÑÿ© ÿ®ŸÜÿ¨ÿßÿ≠
                successful_loads = 0
                if hasattr(self, '_cache') and self._cache:
                    successful_loads = len([k for k in self._cache if k not in self.errors])

                # ÿ™ŸÇÿØŸäÿ± ŸàŸÇÿ™ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä
                estimated_time_remaining = None
                if self._loading and self._loading_start_time:
                    elapsed = (datetime.now() - self._loading_start_time).total_seconds()
                    if elapsed < self.LOADING_TIMEOUT:
                        estimated_time_remaining = max(0, self.LOADING_TIMEOUT - elapsed)

                return {
                    'connected': self.is_connected(),
                    'loading': getattr(self, '_loading', False),
                    'tables_count': len(getattr(self, 'tables', {})),
                    'cached_count': len(getattr(self, '_cache', {})),
                    'successful_loads': successful_loads,
                    'tables': list(getattr(self, 'tables', {}).keys()),
                    'cached_tables': list(getattr(self, '_cache', {}).keys()),
                    'api_configured': bool(os.getenv('AIRTABLE_API_KEY') and os.getenv('AIRTABLE_BASE_ID')),
                    'errors': getattr(self, 'errors', {}).copy(),
                    'loading_start_time': self._loading_start_time.isoformat() if getattr(self, '_loading_start_time', None) else None,
                    'estimated_time_remaining': estimated_time_remaining,
                    'active_futures_count': len(getattr(self, '_active_futures', set()))
                }
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿßŸÑÿ© ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©: {e}")
            return {
                'connected': False,
                'loading': False,
                'tables_count': 0,
                'cached_count': 0,
                'successful_loads': 0,
                'tables': [],
                'cached_tables': [],
                'api_configured': False,
                'errors': {'status_error': str(e)},
                'loading_start_time': None,
                'estimated_time_remaining': None,
                'active_futures_count': 0
            }

    def get_error_for_key(self, key: str) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£"""
        return self.errors.get(key, "")

    def has_errors(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ£ÿÆÿ∑ÿßÿ°"""
        return len(self.errors) > 0

    def get_all_errors(self) -> Dict[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        return self.errors.copy()

    def clear_errors(self):
        """ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        with self._load_lock:
            self.errors.clear()

    def get_cache_info(self) -> Dict[str, any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÉÿßÿ¥"""
        with self._load_lock:
            cache_info = {}
            for key in self._cache:
                timestamp = self._cache_timestamps.get(key)
                cache_info[key] = {
                    'count': len(self._cache[key]),
                    'timestamp': timestamp.isoformat() if timestamp else None,
                    'age_seconds': (datetime.now() - timestamp).total_seconds() if timestamp else None,
                    'is_valid': self._is_cache_valid(key)
                }
            return cache_info

    def force_stop_loading(self):
        """ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿßŸÑŸÇŸàÿ©"""
        logger.warning("ÿ•ŸäŸÇÿßŸÅ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ÿßŸÑŸÇŸàÿ©")
        self._cancel_loading_operations()

        # ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸÑŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑÿ™Ÿä ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑŸáÿß
        for key in self.tables:
            if key not in self._cache:
                self.errors[key] = "ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿßŸÑŸÇŸàÿ©"

    def __del__(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿπŸÜÿØ ÿßŸÑÿ™ÿØŸÖŸäÿ±"""
        try:
            if hasattr(self, '_loading') and self._loading:
                self._cancel_loading_operations()
        except:
            pass

============================================================
FILE: core\airtable_manager.py
SIZE: 36988 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/airtable_manager.py - ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑÿ•ÿØÿßÿ±ÿ© Airtable

Ÿäÿ¨ŸÖÿπ Ÿàÿ∏ÿßÿ¶ŸÅ:
- airtable_manager.py (ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸàÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©)
- airtable_model.py (ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ®ÿ≥Ÿäÿ∑ ŸàÿßŸÑŸÉÿßÿ¥)
- airtable_integration_helper.py (ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©)

ŸÖÿπ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ŸÉÿ±ÿßÿ± Ÿàÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ° Ÿàÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ≠ŸÇŸÑ Assigned To
"""

import os
import json
import time
import logging
import threading
from concurrent.futures import ThreadPoolExecutor, as_completed, TimeoutError
from typing import Dict, List, Any, Optional, Tuple, Callable, Union
from datetime import datetime, timedelta
import requests
import re

logger = logging.getLogger(__name__)


class AirtableManager:
    """
    ŸÖÿØŸäÿ± ŸÖŸàÿ≠ÿØ ŸÑÿ¨ŸÖŸäÿπ ÿπŸÖŸÑŸäÿßÿ™ Airtable
    Ÿäÿ¨ŸÖÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸàÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© ŸàÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©
    ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ≠ŸÇŸÑ Assigned To
    """

    # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÉÿßÿ¥ ŸàÿßŸÑÿ£ÿØÿßÿ°
    CACHE_DURATION = timedelta(minutes=30)
    REQUEST_TIMEOUT = 30
    MAX_RETRIES = 3
    RETRY_DELAY = 1.5
    MAX_WORKERS = 3

    def __init__(self,
                 config_manager=None,
                 db_manager=None,
                 table_name: str = "",
                 view_name: str = None):
        """
        ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± Airtable ÿßŸÑŸÖŸàÿ≠ÿØ

        :param config_manager: ŸÖÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        :param db_manager: ŸÖÿØŸäÿ± ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        :param table_name: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ
        :param view_name: ÿßÿ≥ŸÖ ÿßŸÑÿπÿ±ÿ∂ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        """
        self.config = config_manager
        self.db = db_manager
        self.table_name = table_name
        self.view_name = view_name

        # ÿ•ÿπÿØÿßÿØÿßÿ™ API
        self._setup_api_config()

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÉÿßÿ¥
        self.last_fetch = None
        self.cached_data = []
        self.cache_timestamps = {}
        self._cache_lock = threading.RLock()

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°
        self.errors = {}
        self._loading = False

        # ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿÆÿ≤ŸÜÿ© ŸÑŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©
        self.cached_related_data = {
            'add_on_prices': [],
            'management_options': [],
            'trip_names': [],
            'users': []
        }

        logger.info(f"ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© AirtableManager ŸÑŸÑÿ¨ÿØŸàŸÑ: {table_name}")

    def _setup_api_config(self):
        """ÿ•ÿπÿØÿßÿØ ŸÖÿπŸÑŸàŸÖÿßÿ™ API"""
        if self.config:
            self.api_key = self.config.get("airtable_api_key", "")
            self.base_id = self.config.get("airtable_base_id", "")
        else:
            self.api_key = os.getenv('AIRTABLE_API_KEY', "")
            self.base_id = os.getenv('AIRTABLE_BASE_ID', "")

        if not all([self.api_key, self.base_id]):
            logger.error("ÿ•ÿπÿØÿßÿØÿßÿ™ Airtable ÿ∫Ÿäÿ± ŸÖŸÉÿ™ŸÖŸÑÿ© (API Key ÿ£Ÿà Base ID)")
            return

        # ÿ®ŸÜÿßÿ° URL ŸàÿßŸÑŸÄ headers
        if self.table_name:
            self.endpoint = f"https://api.airtable.com/v0/{self.base_id}/{self.table_name}"

        self.headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json; charset=utf-8"
        }

    def set_table(self, table_name: str, view_name: str = None):
        """ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ¨ÿØŸàŸÑ ŸàÿßŸÑÿπÿ±ÿ∂"""
        self.table_name = table_name
        self.view_name = view_name
        if self.base_id:
            self.endpoint = f"https://api.airtable.com/v0/{self.base_id}/{table_name}"
        logger.info(f"ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ¨ÿØŸàŸÑ ÿ•ŸÑŸâ: {table_name} (ÿßŸÑÿπÿ±ÿ∂: {view_name or 'ÿßŸÑŸÉŸÑ'})")

    def set_view(self, view_name: str):
        """ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        self.view_name = view_name
        logger.info(f"ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿπÿ±ÿ∂ ÿ•ŸÑŸâ: {view_name}")

    # ========================================
    # üîß ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© (CRUD)
    # ========================================

    def fetch_records(self,
                     use_cache: bool = True,
                     force_refresh: bool = False,
                     filter_formula: str = None,
                     view: str = None) -> List[Dict[str, Any]]:
        """
        ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖÿπ ÿØÿπŸÖ ÿßŸÑŸÉÿßÿ¥ ŸàÿßŸÑŸÅŸÑÿ™ÿ±ÿ©

        :param use_cache: ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÉÿßÿ¥
        :param force_refresh: ÿ•ÿ¨ÿ®ÿßÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
        :param filter_formula: ÿµŸäÿ∫ÿ© ÿßŸÑŸÅŸÑÿ™ÿ±
        :param view: ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®
        :return: ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
        """
        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥
        if use_cache and not force_refresh and self._is_cache_valid():
            logger.debug(f"ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÉÿßÿ¥ ŸÑŸÑÿ¨ÿØŸàŸÑ: {self.table_name}")
            return self.cached_data

        logger.info(f"ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖŸÜ Airtable ŸÑŸÑÿ¨ÿØŸàŸÑ: {self.table_name}")

        all_records = []
        url = self.endpoint
        params = {"pageSize": 100}

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™
        if view or self.view_name:
            params["view"] = view or self.view_name
        if filter_formula:
            params["filterByFormula"] = filter_formula

        while True:
            try:
                response = requests.get(
                    url,
                    headers=self.headers,
                    params=params,
                    timeout=self.REQUEST_TIMEOUT
                )
                response.raise_for_status()

                payload = response.json()
                records = payload.get("records", [])
                all_records.extend(records)

                logger.debug(f"ÿßÿ≥ÿ™ŸÑÿßŸÖ {len(records)} ÿ≥ÿ¨ŸÑ ŸÖŸÜ {self.table_name}")

                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©
                offset = payload.get("offset")
                if offset:
                    params["offset"] = offset
                    time.sleep(0.2)  # ÿ™ÿ¨ŸÜÿ® rate limiting
                else:
                    break

            except requests.RequestException as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖŸÜ {self.table_name}: {e}")
                # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÇÿØŸäŸÖ
                if self.cached_data:
                    logger.warning("ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÇÿØŸäŸÖ ÿ®ÿ≥ÿ®ÿ® ŸÅÿ¥ŸÑ ÿßŸÑÿ∑ŸÑÿ®")
                    return self.cached_data
                raise

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿßÿ¥
        with self._cache_lock:
            self.cached_data = all_records
            self.last_fetch = datetime.now()
            self.cache_timestamps[self.table_name] = datetime.now()

        # ÿ≠ŸÅÿ∏ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©
        if self.db:
            self._save_to_local_db(all_records)

        logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(all_records)} ÿ≥ÿ¨ŸÑ ŸÖŸÜ {self.table_name}")
        return all_records

    def fetch_record(self, record_id: str) -> Optional[Dict[str, Any]]:
        """ÿ¨ŸÑÿ® ÿ≥ÿ¨ŸÑ Ÿàÿßÿ≠ÿØ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ID"""
        url = f"{self.endpoint}/{record_id}"

        for attempt in range(self.MAX_RETRIES):
            try:
                response = requests.get(
                    url,
                    headers=self.headers,
                    timeout=self.REQUEST_TIMEOUT
                )
                response.raise_for_status()

                record = response.json()
                logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑ {record_id} ŸÖŸÜ {self.table_name}")
                return record

            except requests.RequestException as e:
                if attempt < self.MAX_RETRIES - 1:
                    logger.warning(f"ŸÖÿ≠ÿßŸàŸÑÿ© {attempt + 1} ŸÅÿ¥ŸÑÿ™ ŸÑÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑ {record_id}: {e}")
                    time.sleep(self.RETRY_DELAY * (attempt + 1))
                else:
                    logger.error(f"ŸÅÿ¥ŸÑ ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑ {record_id} ŸÜŸáÿßÿ¶ŸäÿßŸã: {e}")
                    return None

    def create_record(self, fields: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ÿ¨ÿØŸäÿØ ŸÖÿπ ŸÖÿπÿßŸÑÿ¨ÿ© ÿµÿ≠Ÿäÿ≠ÿ© ŸÑÿ≠ŸÇŸÑ Assigned To"""
        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿπŸÇÿØÿ©
        processed_fields = self._process_fields_for_create(fields)
        payload = {"fields": processed_fields}

        for attempt in range(self.MAX_RETRIES):
            try:
                logger.debug(f"ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ (ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© {attempt + 1}): {self.table_name}")
                logger.debug(f"ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ≥ŸÑÿ©: {json.dumps(payload, indent=2, ensure_ascii=False)}")

                # üîç logging ÿÆÿßÿµ ŸÑÿ≠ŸÇŸÑ Assigned To
                if 'Assigned To' in processed_fields:
                    assigned_value = processed_fields['Assigned To']
                    logger.info(f"üéØ Assigned To ŸÅŸä ÿßŸÑŸÄ payload: {type(assigned_value)} = {assigned_value}")

                response = requests.post(
                    self.endpoint,
                    headers=self.headers,
                    json=payload,
                    timeout=self.REQUEST_TIMEOUT
                )

                if response.status_code == 422:
                    logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ¨ŸÑ (422): {response.text}")
                    if "Assigned To" in response.text:
                        logger.error("‚ùå ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿ≠ŸÇŸÑ Assigned To")
                        # logging ÿ•ÿ∂ÿßŸÅŸä ŸÑŸÑÿ™ÿ¥ÿÆŸäÿµ
                        if 'Assigned To' in processed_fields:
                            assigned_value = processed_fields['Assigned To']
                            logger.error(f"ŸÇŸäŸÖÿ© Assigned To ÿßŸÑŸÖÿ±ÿ≥ŸÑÿ©: {assigned_value}")
                            logger.error(f"ŸÜŸàÿπ ÿßŸÑŸÇŸäŸÖÿ©: {type(assigned_value)}")
                            logger.error(f"ŸÖÿ≠ÿ™ŸàŸâ JSON: {json.dumps(assigned_value, ensure_ascii=False)}")
                    return None

                response.raise_for_status()

                # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉÿßÿ¥ ÿ®ÿπÿØ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°
                self._invalidate_cache()

                created = response.json()
                rec_id = created.get("id")
                logger.info(f"‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ÿ¨ÿØŸäÿØ: {rec_id} ŸÅŸä {self.table_name}")
                return created

            except requests.RequestException as e:
                if attempt < self.MAX_RETRIES - 1:
                    logger.warning(f"ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ŸÜÿ¥ÿßÿ° {attempt + 1} ŸÅÿ¥ŸÑÿ™: {e}")
                    time.sleep(self.RETRY_DELAY * (attempt + 1))
                else:
                    logger.error(f"‚ùå ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ ŸÜŸáÿßÿ¶ŸäÿßŸã: {e}")
                    if hasattr(e, 'response') and e.response:
                        logger.error(f"ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿÆÿ∑ÿ£: {e.response.text}")
                    return None

    def update_record(self, record_id: str, fields: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ≥ÿ¨ŸÑ ŸÖŸàÿ¨ŸàÿØ"""
        url = f"{self.endpoint}/{record_id}"

        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ
        processed_fields = self._process_fields_for_update(fields)
        payload = {"fields": processed_fields}

        for attempt in range(self.MAX_RETRIES):
            try:
                logger.debug(f"ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ {record_id} (ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© {attempt + 1})")

                response = requests.patch(
                    url,
                    headers=self.headers,
                    json=payload,
                    timeout=self.REQUEST_TIMEOUT
                )
                response.raise_for_status()

                # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉÿßÿ¥
                self._invalidate_cache()

                updated = response.json()
                logger.info(f"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ {record_id} ŸÅŸä {self.table_name}")
                return updated

            except requests.RequestException as e:
                if attempt < self.MAX_RETRIES - 1:
                    logger.warning(f"ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ {attempt + 1} ŸÅÿ¥ŸÑÿ™: {e}")
                    time.sleep(self.RETRY_DELAY * (attempt + 1))
                else:
                    logger.error(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ {record_id}: {e}")
                    return None

    def delete_record(self, record_id: str) -> bool:
        """ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ"""
        url = f"{self.endpoint}/{record_id}"

        for attempt in range(self.MAX_RETRIES):
            try:
                response = requests.delete(
                    url,
                    headers=self.headers,
                    timeout=self.REQUEST_TIMEOUT
                )
                response.raise_for_status()

                # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉÿßÿ¥
                self._invalidate_cache()

                logger.info(f"ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ {record_id} ŸÖŸÜ {self.table_name}")
                return True

            except requests.RequestException as e:
                if attempt < self.MAX_RETRIES - 1:
                    logger.warning(f"ŸÖÿ≠ÿßŸàŸÑÿ© ÿ≠ÿ∞ŸÅ {attempt + 1} ŸÅÿ¥ŸÑÿ™: {e}")
                    time.sleep(self.RETRY_DELAY * (attempt + 1))
                else:
                    logger.error(f"ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ {record_id}: {e}")
                    return False

    # ========================================
    # üìÑ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© (Pagination & Search)
    # ========================================

    def get_records_paginated(self, limit=50, offset=None):
        """ÿ¨ŸÑÿ® ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖÿπ pagination"""
        url = self.endpoint
        params = {"pageSize": min(limit, 100)}

        if offset:
            params["offset"] = offset
        if self.view_name:
            params["view"] = self.view_name

        try:
            response = requests.get(
                url,
                headers=self.headers,
                params=params,
                timeout=self.REQUEST_TIMEOUT
            )
            response.raise_for_status()

            data = response.json()
            records = data.get("records", [])
            next_offset = data.get("offset", None)

            logger.info(f"ÿ¨ŸÑÿ® {len(records)} ÿ≥ÿ¨ŸÑ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖŸÜ {self.table_name}")
            return records, next_offset

        except requests.RequestException as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿµŸÅÿ≠ÿ©: {e}")
            return [], None

    def search_records(self, formula: str) -> List[Dict[str, Any]]:
        """ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Airtable formula"""
        try:
            params = {"filterByFormula": formula}
            if self.view_name:
                params["view"] = self.view_name

            response = requests.get(
                self.endpoint,
                headers=self.headers,
                params=params,
                timeout=self.REQUEST_TIMEOUT
            )
            response.raise_for_status()

            records = response.json().get('records', [])
            logger.info(f"Ÿàÿ¨ÿØ {len(records)} ÿ≥ÿ¨ŸÑ ŸÖÿ∑ÿßÿ®ŸÇ ŸÑŸÑÿ®ÿ≠ÿ´ ŸÅŸä {self.table_name}")
            return records

        except requests.RequestException as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ÿ≠ÿ´: {e}")
            return []

    # ========================================
    # üìã ÿØŸàÿßŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
    # ========================================

    def get_all_values(self, field_name: str = "Name", force_refresh: bool = False) -> List[str]:
        """ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÅÿ±ŸäÿØÿ© ŸÖŸÜ ÿ≠ŸÇŸÑ ŸÖÿπŸäŸÜ"""
        records = self.fetch_records(force_refresh=force_refresh)
        values = []

        for record in records:
            fields = record.get('fields', {})
            value = fields.get(field_name)
            if value and value not in values:
                # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÇŸäŸÖÿ©
                clean_value = str(value).strip()
                if clean_value and clean_value not in values:
                    values.append(clean_value)

        return sorted(values)

    def insert_if_not_exists(self, value: str, field_name: str = "Name") -> bool:
        """ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©"""
        if not value or not value.strip():
            logger.warning(f"ŸÇŸäŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ© ŸÑŸÑÿ≠ŸÇŸÑ {field_name}")
            return False

        existing_values = self.get_all_values(field_name)
        clean_value = str(value).strip()

        if clean_value not in existing_values:
            result = self.create_record({field_name: clean_value})
            if result:
                logger.info(f"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© '{clean_value}' ÿ•ŸÑŸâ {self.table_name}")
                return True
            return False

        logger.debug(f"ÿßŸÑŸÇŸäŸÖÿ© '{clean_value}' ŸÖŸàÿ¨ŸàÿØÿ© ÿ®ÿßŸÑŸÅÿπŸÑ ŸÅŸä {self.table_name}")
        return False

    # ÿØŸàÿßŸÑ ŸÖÿ™ÿÆÿµÿµÿ© ŸÑŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©
    def fetch_agencies(self, field_name: str = "Agency Name") -> List[str]:
        """ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸàŸÉÿßŸÑÿßÿ™"""
        return self._fetch_dropdown_values(field_name, ["Agency Name", "Name", "Agency"])

    def fetch_guides(self, field_name: str = "Name") -> List[str]:
        """ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ±ÿ¥ÿØŸäŸÜ"""
        return self._fetch_dropdown_values(field_name, ["Guide Name", "Name", "Language"])

    def fetch_destinations(self, field_name: str = "Destination") -> List[str]:
        """ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸàÿ¨Ÿáÿßÿ™"""
        return self._fetch_dropdown_values(field_name, ["Destination", "Name", "City", "Location"])

    def get_dropdown_values(self, field_name: str, default_field: str = "Name") -> List[str]:
        """ÿØÿßŸÑÿ© ÿπÿßŸÖÿ© ŸÑÿ¨ŸÑÿ® ŸÇŸäŸÖ ÿ£Ÿä ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ©"""
        return self._fetch_dropdown_values(field_name, [field_name, default_field])

    def _fetch_dropdown_values(self, primary_field: str, fallback_fields: List[str]) -> List[str]:
        """ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ¨ŸÑÿ® ŸÇŸäŸÖ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        try:
            records = self.fetch_records()
            values = []

            for record in records:
                fields = record.get('fields', {})
                value = None

                # ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸÖŸÑÿ©
                for field in fallback_fields:
                    if field in fields and fields[field]:
                        value = fields[field]
                        break

                if value:
                    clean_value = str(value).strip()
                    if clean_value and clean_value not in values:
                        values.append(clean_value)

            values.sort()
            logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(values)} ŸÇŸäŸÖÿ© ŸÖŸÜ {primary_field} ŸÅŸä {self.table_name}")
            return values

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ŸÇŸäŸÖ {primary_field}: {e}")
            return []

    # ========================================
    # üîó ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© (ŸÖŸÜ integration_helper)
    # ========================================

    def fetch_all_related_data(self, callback=None, error_callback=None):
        """ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©"""
        def fetch_task():
            try:
                # ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ŸÉŸÑ ÿ¨ÿØŸàŸÑ
                self._fetch_add_on_prices()
                self._fetch_management_options()
                self._fetch_trip_names()
                self._fetch_users()

                logger.info("ÿ™ŸÖ ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©")

                if callback:
                    callback(self.cached_related_data)

                return self.cached_related_data

            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©: {e}")
                if error_callback:
                    error_callback(str(e))
                raise

        # ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸä ÿÆŸäÿ∑ ŸÖŸÜŸÅÿµŸÑ
        threading.Thread(target=fetch_task, daemon=True).start()

    def _fetch_add_on_prices(self):
        """ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™"""
        original_table = self.table_name
        try:
            self.set_table("Add-on prices")
            records = self.fetch_records(use_cache=False)
            add_ons = []

            for record in records:
                fields = record.get('fields', {})
                add_on_name = fields.get('Add-ons', '')
                if add_on_name:
                    add_ons.append(add_on_name)

            self.cached_related_data['add_on_prices'] = sorted(list(set(add_ons)))
            logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(add_ons)} ÿ•ÿ∂ÿßŸÅÿ©")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® Add-on prices: {e}")
        finally:
            self.set_table(original_table)

    def _fetch_management_options(self):
        """ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©"""
        original_table = self.table_name
        try:
            self.set_table("Management Option")
            records = self.fetch_records(use_cache=False)
            options = []

            for record in records:
                fields = record.get('fields', {})
                option_name = fields.get('Main Option', '')
                if option_name:
                    options.append(option_name)

            self.cached_related_data['management_options'] = sorted(list(set(options)))
            logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(options)} ÿÆŸäÿßÿ± ÿ•ÿØÿßÿ±ÿ©")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® Management Option: {e}")
        finally:
            self.set_table(original_table)

    def _fetch_trip_names(self):
        """ÿ¨ŸÑÿ® ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ±ÿ≠ŸÑÿßÿ™"""
        original_table = self.table_name
        try:
            self.set_table("Trip Name Correction")
            records = self.fetch_records(use_cache=False)
            trip_names = []

            for record in records:
                fields = record.get('fields', {})
                old_name = fields.get('Old Name', '')
                new_name = fields.get('New Name', '')

                trip_name = new_name if new_name else old_name
                if trip_name:
                    trip_names.append(trip_name)

            self.cached_related_data['trip_names'] = sorted(list(set(trip_names)))
            logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(trip_names)} ÿßÿ≥ŸÖ ÿ±ÿ≠ŸÑÿ©")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® Trip Name Correction: {e}")
        finally:
            self.set_table(original_table)

    def _fetch_users(self):
        """ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"""
        original_table = self.table_name
        try:
            self.set_table("Users")
            records = self.fetch_records(use_cache=False)
            users = []

            for record in records:
                fields = record.get('fields', {})
                username = fields.get('Username', '')
                collaborator = fields.get('Airtable Collaborator')

                if username:
                    users.append(username)
                elif collaborator and isinstance(collaborator, dict):
                    user_name = collaborator.get('name', '')
                    if user_name:
                        users.append(user_name)

            self.cached_related_data['users'] = sorted(list(set(users)))
            logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® {len(users)} ŸÖÿ≥ÿ™ÿÆÿØŸÖ")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® Users: {e}")
        finally:
            self.set_table(original_table)

    def get_cached_related_data(self) -> Dict[str, List[str]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜÿ©"""
        return self.cached_related_data

    def refresh_related_data(self, table_name: Optional[str] = None):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©"""
        if table_name:
            if table_name == "Add-on prices":
                self._fetch_add_on_prices()
            elif table_name == "Management Option":
                self._fetch_management_options()
            elif table_name == "Trip Name Correction":
                self._fetch_trip_names()
            elif table_name == "Users":
                self._fetch_users()
        else:
            self.fetch_all_related_data()

    # ========================================
    # üõ†Ô∏è ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ŸàŸÉÿßÿ¥
    # ========================================

    def _process_fields_for_create(self, fields: Dict[str, Any]) -> Dict[str, Any]:
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ° - ŸÖÿ≠ÿØÿ´ÿ© ŸÑÿ≠ŸÇŸÑ Assigned To"""
        processed = {}

        for key, value in fields.items():
            if key == 'Assigned To':
                # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑÿ≠ŸÇŸÑ Assigned To - ÿ•ÿ±ÿ¨ÿßÿπ object
                processed_value = self._process_assigned_to_field(value)
                if processed_value:  # ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÇŸäŸÖÿ© ÿµÿßŸÑÿ≠ÿ©
                    processed[key] = processed_value
                    logger.debug(f"‚úÖ Assigned To processed: {processed_value}")
            elif value is not None and str(value).strip():
                processed[key] = value

        return processed

    def _process_fields_for_update(self, fields: Dict[str, Any]) -> Dict[str, Any]:
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ - ŸÖÿ≠ÿØÿ´ÿ© ŸÑÿ≠ŸÇŸÑ Assigned To"""
        processed = {}

        for key, value in fields.items():
            if key == 'Assigned To':
                # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑÿ≠ŸÇŸÑ Assigned To
                processed_value = self._process_assigned_to_field(value)
                if processed_value:
                    processed[key] = processed_value
            else:
                processed[key] = value

        return processed

    def _process_assigned_to_field(self, value: Any) -> Optional[Dict[str, str]]:
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑÿ≠ŸÇŸÑ Assigned To - ÿ•ÿ±ÿ¨ÿßÿπ object ÿ®ÿØŸÑÿßŸã ŸÖŸÜ string"""
        if value is None:
            return None

        # ÿ•ÿ∞ÿß ŸÉÿßŸÜ dict ÿ®ÿßŸÑŸÅÿπŸÑÿå ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ id ÿ£Ÿà email
        if isinstance(value, dict):
            if 'id' in value:
                user_id = str(value['id']).strip()
                logger.debug(f"Dict with id found: {user_id}")
                return {"id": user_id}
            elif 'email' in value:
                email = str(value['email']).strip()
                logger.debug(f"Dict with email found: {email}")
                return {"email": email}
            else:
                # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£Ÿä ŸÇŸäŸÖÿ© ŸÖŸÅŸäÿØÿ© ŸÅŸä ÿßŸÑŸÄ dict
                for k, v in value.items():
                    if v and str(v).strip():
                        clean_val = str(v).strip()
                        if '@' in clean_val:
                            return {"email": clean_val}
                        elif clean_val.startswith(('usr', 'rec')) or len(clean_val) > 10:
                            return {"id": clean_val}
                return None

        # ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ string ÿ£ŸàŸÑÿßŸã
        str_value = str(value)

        # ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä escape characters ÿ£Ÿà quotes ÿ≤ÿßÿ¶ÿØÿ©
        cleaned_value = str_value.strip()

        # ÿ•ÿ≤ÿßŸÑÿ© quotes ÿÆÿßÿ±ÿ¨Ÿäÿ© ŸÖÿ™ÿπÿØÿØÿ© ÿ•ÿ∞ÿß Ÿàÿ¨ÿØÿ™
        while cleaned_value.startswith('"') and cleaned_value.endswith('"'):
            cleaned_value = cleaned_value[1:-1]

        while cleaned_value.startswith("'") and cleaned_value.endswith("'"):
            cleaned_value = cleaned_value[1:-1]

        # ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä backslashes ÿ≤ÿßÿ¶ÿØÿ©
        cleaned_value = cleaned_value.replace('\\"', '"').replace("\\'", "'")

        # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÇŸäŸÖÿ© ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÖÿπÿ±ŸÅ Airtable User
        final_value = cleaned_value.strip()

        # logging ŸÑŸÑÿ™ÿ¥ÿÆŸäÿµ
        if str_value != final_value:
            logger.debug(f"ÿ™ŸÜÿ∏ŸäŸÅ Assigned To: '{str_value}' ‚Üí '{final_value}'")

        # ‚úÖ ÿ•ÿ±ÿ¨ÿßÿπ object ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÄ Airtable
        if final_value:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÜŸàÿπ ÿßŸÑŸÇŸäŸÖÿ© (ID ÿ£ŸÖ Email)
            if final_value.startswith('usr') or final_value.startswith('rec'):
                # ŸÖÿπÿ±ŸÅ Airtable User/Record
                logger.debug(f"ÿ•ÿ±ÿ¨ÿßÿπ User ID: {final_value}")
                return {"id": final_value}
            elif '@' in final_value and '.' in final_value:
                # ÿπŸÜŸàÿßŸÜ ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä
                logger.debug(f"ÿ•ÿ±ÿ¨ÿßÿπ Email: {final_value}")
                return {"email": final_value}
            else:
                # ÿßŸÅÿ™ÿ±ÿßÿ∂ ÿ£ŸÜŸá ŸÖÿπÿ±ŸÅ ÿ≠ÿ™Ÿâ ŸÑŸà ŸÑŸÖ Ÿäÿ®ÿØÿ£ ÿ®ŸÄ usr
                logger.debug(f"ÿ•ÿ±ÿ¨ÿßÿπ ID (ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä): {final_value}")
                return {"id": final_value}

        return None

    def _validate_user_field_format(self, value: Any) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ™ŸÜÿ≥ŸäŸÇ ÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        if not value:
            return False

        if isinstance(value, dict):
            return 'id' in value or 'email' in value

        if isinstance(value, str):
            value = value.strip()
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖÿπÿ±ŸÅ Airtable ÿ£Ÿà ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä
            return (value.startswith(('usr', 'rec')) and len(value) >= 10) or ('@' in value and '.' in value)

        return False

    def _is_cache_valid(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÉÿßÿ¥"""
        if not self.last_fetch or not self.cached_data:
            return False

        age = datetime.now() - self.last_fetch
        return age < self.CACHE_DURATION

    def _invalidate_cache(self):
        """ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉÿßÿ¥"""
        with self._cache_lock:
            self.last_fetch = None
            self.cached_data = []
            if self.table_name in self.cache_timestamps:
                del self.cache_timestamps[self.table_name]

    def _save_to_local_db(self, records: List[Dict[str, Any]]):
        """ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©"""
        try:
            if self.db and hasattr(self.db, 'save_records'):
                self.db.save_records(self.table_name, records)
        except Exception as e:
            logger.warning(f"ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÑŸäÿßŸã: {e}")

    def get_cache_info(self) -> Dict[str, Any]:
        """ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÉÿßÿ¥"""
        with self._cache_lock:
            return {
                'table': self.table_name,
                'cached_records': len(self.cached_data),
                'last_fetch': self.last_fetch.isoformat() if self.last_fetch else None,
                'cache_age_seconds': (datetime.now() - self.last_fetch).total_seconds() if self.last_fetch else None,
                'is_valid': self._is_cache_valid()
            }

    def clear_cache(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑŸÉÿßÿ¥"""
        self._invalidate_cache()
        logger.info(f"ÿ™ŸÖ ŸÖÿ≥ÿ≠ ŸÉÿßÿ¥ {self.table_name}")

    def is_connected(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ"""
        return bool(self.api_key and self.base_id)

    def get_status(self) -> Dict[str, Any]:
        """ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿØŸäÿ±"""
        return {
            'connected': self.is_connected(),
            'table_name': self.table_name,
            'view_name': self.view_name,
            'loading': self._loading,
            'cached_records': len(self.cached_data),
            'cache_valid': self._is_cache_valid(),
            'errors': self.errors.copy(),
            'related_data_cached': {
                key: len(values) for key, values in self.cached_related_data.items()
            }
        }

    # ========================================
    # üîß ÿØŸàÿßŸÑ ÿßŸÑÿ™ÿ¥ÿÆŸäÿµ ŸàÿßŸÑÿ™ÿµÿ≠Ÿäÿ≠
    # ========================================

    def debug_assigned_to_processing(self, test_values: List[Any]) -> Dict[str, Any]:
        """ÿØÿßŸÑÿ© ÿ™ÿ¥ÿÆŸäÿµ ŸÑÿßÿÆÿ™ÿ®ÿßÿ± ŸÖÿπÿßŸÑÿ¨ÿ© ÿ≠ŸÇŸÑ Assigned To"""
        results = {}

        logger.info("üîç ÿ®ÿØÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖÿπÿßŸÑÿ¨ÿ© ÿ≠ŸÇŸÑ Assigned To")
        logger.info("=" * 50)

        for i, test_value in enumerate(test_values):
            try:
                logger.info(f"ÿßÿÆÿ™ÿ®ÿßÿ± {i+1}: {type(test_value)} = {test_value}")

                # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÇŸäŸÖÿ©
                processed = self._process_assigned_to_field(test_value)

                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ
                is_valid = self._validate_user_field_format(processed)

                results[f"test_{i+1}"] = {
                    "input": test_value,
                    "input_type": str(type(test_value)),
                    "processed": processed,
                    "processed_type": str(type(processed)),
                    "is_valid": is_valid,
                    "success": processed is not None
                }

                logger.info(f"‚úÖ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: {processed} (ÿµÿ≠Ÿäÿ≠: {is_valid})")

            except Exception as e:
                logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©: {e}")
                results[f"test_{i+1}"] = {
                    "input": test_value,
                    "error": str(e),
                    "success": False
                }

            logger.info("-" * 30)

        logger.info("=" * 50)
        return results

    def test_user_field_creation(self, user_id: str) -> bool:
        """ÿßÿÆÿ™ÿ®ÿßÿ± ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä ŸÖÿπ ÿ≠ŸÇŸÑ Assigned To"""
        try:
            logger.info(f"üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ŸÖÿπ Assigned To: {user_id}")

            # ÿ™ÿ¨ŸáŸäÿ≤ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©
            test_fields = {
                "Customer Name": f"Test User {datetime.now().strftime('%H%M%S')}",
                "Assigned To": user_id,
                "Agency": "Test Agency"
            }

            # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ
            processed = self._process_fields_for_create(test_fields)

            logger.info(f"ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©: {json.dumps(processed, ensure_ascii=False, indent=2)}")

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸÜÿ≥ŸäŸÇ Assigned To
            if 'Assigned To' in processed:
                assigned_to = processed['Assigned To']
                is_valid = self._validate_user_field_format(assigned_to)
                logger.info(f"ÿ™ŸÜÿ≥ŸäŸÇ Assigned To ÿµÿ≠Ÿäÿ≠: {is_valid}")
                return is_valid

            return False

        except Exception as e:
            logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {e}")
            return False

    def validate_record_fields(self, fields: Dict[str, Any]) -> Tuple[bool, List[str]]:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ≥ÿ¨ŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ"""
        errors = []

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
        required_fields = ['Customer Name']  # ŸäŸÖŸÉŸÜ ÿ™ÿÆÿµŸäÿµŸáÿß ÿ≠ÿ≥ÿ® ÿßŸÑÿ¨ÿØŸàŸÑ

        for field in required_fields:
            if field not in fields or not fields[field]:
                errors.append(f"ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® '{field}' ŸÖŸÅŸÇŸàÿØ ÿ£Ÿà ŸÅÿßÿ±ÿ∫")

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸÜÿ≥ŸäŸÇ ÿ≠ŸÇŸÑ Assigned To
        if 'Assigned To' in fields:
            assigned_to = fields['Assigned To']
            if not self._validate_user_field_format(assigned_to):
                errors.append(f"ÿ™ŸÜÿ≥ŸäŸÇ ÿ≠ŸÇŸÑ 'Assigned To' ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠: {assigned_to}")

        return len(errors) == 0, errors

    def create_record_with_validation(self, fields: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿ¨ŸÑ ŸÖÿπ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿßŸÑŸÖÿ≥ÿ®ŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ
        is_valid, errors = self.validate_record_fields(fields)

        if not is_valid:
            logger.error("‚ùå ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ≠ŸÇŸàŸÑ:")
            for error in errors:
                logger.error(f"  - {error}")
            return None

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿµÿ≠Ÿäÿ≠ÿ©
        return self.create_record(fields)


# ========================================
# üè≠ ÿØŸàÿßŸÑ Factory ŸÑŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©
# ========================================

def create_airtable_manager(config_manager=None, db_manager=None, table_name: str = "") -> AirtableManager:
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿØŸäÿ± Airtable ÿπÿßŸÖ"""
    return AirtableManager(config_manager, db_manager, table_name)

def create_bookings_manager(config_manager=None, db_manager=None, view_name: str = None) -> AirtableManager:
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿØŸäÿ± ŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™"""
    return AirtableManager(config_manager, db_manager, "Bookings", view_name)

def create_agencies_manager(config_manager=None, db_manager=None) -> AirtableManager:
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿØŸäÿ± ŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸàŸÉÿßŸÑÿßÿ™"""
    return AirtableManager(config_manager, db_manager, "Agencies")

def create_guides_manager(config_manager=None, db_manager=None) -> AirtableManager:
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿØŸäÿ± ŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÖÿ±ÿ¥ÿØŸäŸÜ"""
    return AirtableManager(config_manager, db_manager, "Guides")

def create_destinations_manager(config_manager=None, db_manager=None) -> AirtableManager:
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿØŸäÿ± ŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸàÿ¨Ÿáÿßÿ™"""
    return AirtableManager(config_manager, db_manager, "Destinations")

def create_users_manager(config_manager=None, db_manager=None) -> AirtableManager:
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿØŸäÿ± ŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"""
    return AirtableManager(config_manager, db_manager, "Users")


# ========================================
# üîÑ ÿØÿßŸÑÿ© ÿßŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ
# ========================================

class AirtableModel(AirtableManager):
    """ŸÉŸÑÿßÿ≥ ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ - Ÿàÿ±ÿßÿ´ÿ© ŸÖŸÜ AirtableManager"""

    def __init__(self, config_manager, db_manager, table_name: str, view_name: str = None):
        super().__init__(config_manager, db_manager, table_name, view_name)
        logger.info(f"ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° AirtableModel (ÿ™ŸàÿßŸÅŸÇ) ŸÑŸÑÿ¨ÿØŸàŸÑ: {table_name}")

    # ÿØŸàÿßŸÑ ÿßŸÑÿ™ŸàÿßŸÅŸÇ
    def fetch_all_records(self, view: Optional[str] = None, force_refresh: bool = False) -> List[Dict[str, Any]]:
        """ÿØÿßŸÑÿ© ÿ™ŸàÿßŸÅŸÇ - ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ fetch_records"""
        return self.fetch_records(force_refresh=force_refresh, view=view)

    def get_record_by_id(self, record_id: str) -> Optional[Dict[str, Any]]:
        """ÿØÿßŸÑÿ© ÿ™ŸàÿßŸÅŸÇ - ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ fetch_record"""
        return self.fetch_record(record_id)

============================================================
FILE: core\app_state_manager.py
SIZE: 14840 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/app_state_manager.py

ŸÖÿØŸäÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÑŸÖŸÜÿπ ÿßŸÑÿ™ÿØÿßÿÆŸÑ ŸàÿßŸÑÿ™ÿ¨ŸÖÿØ
"""

import threading
import time
from datetime import datetime, timedelta
from typing import Dict, Set, Optional, Any
from enum import Enum
from core.logger import logger


class OperationType(Enum):
    """ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
    DATA_LOADING = "data_loading"
    DROPDOWN_LOADING = "dropdown_loading"
    RECORD_SAVING = "record_saving"
    RECORD_DELETING = "record_deleting"
    USER_AUTHENTICATION = "user_authentication"
    EXPORT_DATA = "export_data"
    UI_UPDATE = "ui_update"


class OperationState(Enum):
    """ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™"""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"
    TIMEOUT = "timeout"


class Operation:
    """ŸÉŸÑÿßÿ≥ ŸÑÿ™ŸÖÿ´ŸäŸÑ ÿπŸÖŸÑŸäÿ© Ÿàÿßÿ≠ÿØÿ©"""

    def __init__(self, operation_id: str, operation_type: OperationType,
                 description: str = "", timeout: float = 30.0):
        self.id = operation_id
        self.type = operation_type
        self.description = description
        self.state = OperationState.PENDING
        self.start_time = None
        self.end_time = None
        self.timeout = timeout
        self.progress = 0.0
        self.error_message = None
        self.result = None
        self.metadata = {}

    def start(self):
        """ÿ®ÿØÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        self.state = OperationState.IN_PROGRESS
        self.start_time = datetime.now()
        logger.debug(f"ÿ®ÿØÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©: {self.id} ({self.type.value})")

    def complete(self, result: Any = None):
        """ÿ•ŸÉŸÖÿßŸÑ ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠"""
        self.state = OperationState.COMPLETED
        self.end_time = datetime.now()
        self.progress = 100.0
        self.result = result
        logger.debug(f"ÿßŸÉÿ™ŸÖŸÑÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©: {self.id} ({self.type.value})")

    def fail(self, error_message: str):
        """ŸÅÿ¥ŸÑ ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        self.state = OperationState.FAILED
        self.end_time = datetime.now()
        self.error_message = error_message
        logger.warning(f"ŸÅÿ¥ŸÑÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©: {self.id} ({self.type.value}) - {error_message}")

    def cancel(self):
        """ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        self.state = OperationState.CANCELLED
        self.end_time = datetime.now()
        logger.info(f"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©: {self.id} ({self.type.value})")

    def timeout_operation(self):
        """ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        self.state = OperationState.TIMEOUT
        self.end_time = datetime.now()
        logger.warning(f"ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿπŸÖŸÑŸäÿ©: {self.id} ({self.type.value})")

    def update_progress(self, progress: float):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÇÿØŸÖ ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        self.progress = max(0.0, min(100.0, progress))

    def is_active(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸàŸÜ ÿßŸÑÿπŸÖŸÑŸäÿ© ŸÜÿ¥ÿ∑ÿ©"""
        return self.state in [OperationState.PENDING, OperationState.IN_PROGRESS]

    def is_completed(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        return self.state == OperationState.COMPLETED

    def is_timed_out(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÜÿ™Ÿáÿßÿ° ŸÖŸáŸÑÿ© ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        if not self.start_time or not self.is_active():
            return False

        elapsed = (datetime.now() - self.start_time).total_seconds()
        return elapsed > self.timeout

    def get_elapsed_time(self) -> float:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖŸÜŸÇÿ∂Ÿä"""
        if not self.start_time:
            return 0.0

        end_time = self.end_time or datetime.now()
        return (end_time - self.start_time).total_seconds()


class AppStateManager:
    """ŸÖÿØŸäÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""

    def __init__(self):
        self._operations: Dict[str, Operation] = {}
        self._lock = threading.RLock()
        self._operation_counter = 0
        self._global_state = {
            'is_busy': False,
            'current_user': None,
            'last_activity': datetime.now(),
            'session_start': datetime.now()
        }

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©
        self._default_timeouts = {
            OperationType.DATA_LOADING: 45.0,
            OperationType.DROPDOWN_LOADING: 30.0,
            OperationType.RECORD_SAVING: 15.0,
            OperationType.RECORD_DELETING: 10.0,
            OperationType.USER_AUTHENTICATION: 20.0,
            OperationType.EXPORT_DATA: 60.0,
            OperationType.UI_UPDATE: 5.0
        }

        # ÿ®ÿØÿ° ŸÖÿ±ÿßŸÇÿ® ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©
        self._start_timeout_monitor()

    def _generate_operation_id(self, operation_type: OperationType) -> str:
        """ÿ™ŸàŸÑŸäÿØ ŸÖÿπÿ±ŸÅ ŸÅÿ±ŸäÿØ ŸÑŸÑÿπŸÖŸÑŸäÿ©"""
        with self._lock:
            self._operation_counter += 1
            timestamp = int(datetime.now().timestamp() * 1000)
            return f"{operation_type.value}_{timestamp}_{self._operation_counter}"

    def start_operation(self, operation_type: OperationType,
                       description: str = "", timeout: float = None) -> str:
        """ÿ®ÿØÿ° ÿπŸÖŸÑŸäÿ© ÿ¨ÿØŸäÿØÿ©"""
        with self._lock:
            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©
            if timeout is None:
                timeout = self._default_timeouts.get(operation_type, 30.0)

            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©
            operation_id = self._generate_operation_id(operation_type)
            operation = Operation(operation_id, operation_type, description, timeout)

            # ÿ®ÿØÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©
            operation.start()
            self._operations[operation_id] = operation

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿßŸÖÿ©
            self._update_global_state()

            logger.info(f"ÿ®ÿØÿ° ÿπŸÖŸÑŸäÿ© ÿ¨ÿØŸäÿØÿ©: {operation_id} - {description}")
            return operation_id

    def complete_operation(self, operation_id: str, result: Any = None) -> bool:
        """ÿ•ŸÉŸÖÿßŸÑ ÿπŸÖŸÑŸäÿ©"""
        with self._lock:
            operation = self._operations.get(operation_id)
            if not operation:
                logger.warning(f"ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©: {operation_id}")
                return False

            if not operation.is_active():
                logger.warning(f"ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑ÿ©: {operation_id}")
                return False

            operation.complete(result)
            self._update_global_state()

            # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©
            self._cleanup_old_operations()

            return True

    def fail_operation(self, operation_id: str, error_message: str) -> bool:
        """ŸÅÿ¥ŸÑ ÿπŸÖŸÑŸäÿ©"""
        with self._lock:
            operation = self._operations.get(operation_id)
            if not operation:
                logger.warning(f"ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©: {operation_id}")
                return False

            operation.fail(error_message)
            self._update_global_state()

            return True

    def cancel_operation(self, operation_id: str) -> bool:
        """ÿ•ŸÑÿ∫ÿßÿ° ÿπŸÖŸÑŸäÿ©"""
        with self._lock:
            operation = self._operations.get(operation_id)
            if not operation:
                logger.warning(f"ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©: {operation_id}")
                return False

            if operation.is_active():
                operation.cancel()
                self._update_global_state()
                return True

            return False

    def update_operation_progress(self, operation_id: str, progress: float) -> bool:
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÇÿØŸÖ ÿßŸÑÿπŸÖŸÑŸäÿ©"""
        with self._lock:
            operation = self._operations.get(operation_id)
            if not operation:
                return False

            operation.update_progress(progress)
            return True

    def get_operation(self, operation_id: str) -> Optional[Operation]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿπŸÖŸÑŸäÿ©"""
        with self._lock:
            return self._operations.get(operation_id)

    def get_active_operations(self, operation_type: OperationType = None) -> List[Operation]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ©"""
        with self._lock:
            active_ops = [op for op in self._operations.values() if op.is_active()]

            if operation_type:
                active_ops = [op for op in active_ops if op.type == operation_type]

            return active_ops

    def is_busy(self, operation_types: List[OperationType] = None) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÜÿ¥ÿ∫ÿßŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        with self._lock:
            if operation_types:
                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜŸàÿßÿπ ŸÖÿ≠ÿØÿØÿ© ŸÖŸÜ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™
                for op in self._operations.values():
                    if op.is_active() and op.type in operation_types:
                        return True
                return False
            else:
                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£Ÿä ÿπŸÖŸÑŸäÿßÿ™ ŸÜÿ¥ÿ∑ÿ©
                return any(op.is_active() for op in self._operations.values())

    def can_start_operation(self, operation_type: OperationType) -> tuple[bool, str]:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿ®ÿØÿ° ÿπŸÖŸÑŸäÿ© ÿ¨ÿØŸäÿØÿ©"""
        with self._lock:
            # ŸÇŸàÿßÿπÿØ ÿßŸÑÿ™ÿØÿßÿÆŸÑ
            blocking_combinations = {
                OperationType.DATA_LOADING: [OperationType.DATA_LOADING, OperationType.EXPORT_DATA],
                OperationType.DROPDOWN_LOADING: [OperationType.DROPDOWN_LOADING],
                OperationType.RECORD_SAVING: [OperationType.RECORD_SAVING, OperationType.DATA_LOADING],
                OperationType.RECORD_DELETING: [OperationType.RECORD_DELETING, OperationType.DATA_LOADING],
                OperationType.EXPORT_DATA: [OperationType.EXPORT_DATA, OperationType.DATA_LOADING],
                OperationType.USER_AUTHENTICATION: [OperationType.USER_AUTHENTICATION]
            }

            blocking_types = blocking_combinations.get(operation_type, [])

            for op in self._operations.values():
                if op.is_active() and op.type in blocking_types:
                    return False, f"ÿπŸÖŸÑŸäÿ© ÿ£ÿÆÿ±Ÿâ ŸÖŸÜ ŸÜŸàÿπ {op.type.value} ÿ¨ÿßÿ±Ÿäÿ© ÿ®ÿßŸÑŸÅÿπŸÑ"

            return True, ""

    def cancel_operations_by_type(self, operation_type: OperationType) -> int:
        """ÿ•ŸÑÿ∫ÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ŸÖŸÜ ŸÜŸàÿπ ŸÖÿπŸäŸÜ"""
        with self._lock:
            cancelled_count = 0

            for operation in self._operations.values():
                if operation.is_active() and operation.type == operation_type:
                    operation.cancel()
                    cancelled_count += 1

            self._update_global_state()
            logger.info(f"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° {cancelled_count} ÿπŸÖŸÑŸäÿ© ŸÖŸÜ ŸÜŸàÿπ {operation_type.value}")

            return cancelled_count

    def force_cancel_all_operations(self) -> int:
        """ÿ•ŸÑÿ∫ÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿ®ÿßŸÑŸÇŸàÿ©"""
        with self._lock:
            cancelled_count = 0

            for operation in self._operations.values():
                if operation.is_active():
                    operation.cancel()
                    cancelled_count += 1

            self._update_global_state()
            logger.warning(f"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° {cancelled_count} ÿπŸÖŸÑŸäÿ© ÿ®ÿßŸÑŸÇŸàÿ©")

            return cancelled_count

    def _update_global_state(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿßŸÖÿ© ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        self._global_state['is_busy'] = self.is_busy()
        self._global_state['last_activity'] = datetime.now()

    def _start_timeout_monitor(self):
        """ÿ®ÿØÿ° ŸÖÿ±ÿßŸÇÿ® ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©"""
        def monitor():
            while True:
                try:
                    time.sleep(5)  # ŸÅÿ≠ÿµ ŸÉŸÑ 5 ÿ´ŸàÿßŸÜ
                    self._check_timeouts()
                except Exception as e:
                    logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿ±ÿßŸÇÿ® ÿßŸÑŸÖŸáŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©: {e}")

        thread = threading.Thread(target=monitor, daemon=True, name="TimeoutMonitor")
        thread.start()

    def _check_timeouts(self):
        """ŸÅÿ≠ÿµ ÿßŸÑŸÖŸáŸÑÿßÿ™ ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ŸÑŸÑÿπŸÖŸÑŸäÿßÿ™"""
        with self._lock:
            timed_out_operations = []

            for operation in self._operations.values():
                if operation.is_timed_out():
                    operation.timeout_operation()
                    timed_out_operations.append(operation.id)

            if timed_out_operations:
                logger.warning(f"ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© {len(timed_out_operations)} ÿπŸÖŸÑŸäÿ©")
                self._update_global_state()

    def _cleanup_old_operations(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ© ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©"""
        with self._lock:
            # ÿ•ÿ®ŸÇÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ŸÑŸÖÿØÿ© ÿ≥ÿßÿπÿ© ÿ®ÿπÿØ ÿßŸÉÿ™ŸÖÿßŸÑŸáÿß
            cutoff_time = datetime.now() - timedelta(hours=1)

            operations_to_remove = []
            for op_id, operation in self._operations.items():
                if (not operation.is_active() and
                    operation.end_time and
                    operation.end_time < cutoff_time):
                    operations_to_remove.append(op_id)

            for op_id in operations_to_remove:
                del self._operations[op_id]

            if operations_to_remove:
                logger.debug(f"ÿ™ŸÖ ÿ™ŸÜÿ∏ŸäŸÅ {len(operations_to_remove)} ÿπŸÖŸÑŸäÿ© ŸÇÿØŸäŸÖÿ©")

    def get_status_summary(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÑÿÆÿµ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        with self._lock:
            active_ops = self.get_active_operations()

            # ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ
            ops_by_type = {}
            for op in active_ops:
                op_type = op.type.value
                if op_type not in ops_by_type:
                    ops_by_type[op_type] = []
                ops_by_type[op_type].append({
                    'id': op.id,
                    'description': op.description,
                    'progress': op.progress,
                    'elapsed_time': op.get_elapsed_time()
                })

            return {
                'is_busy': self._global_state['is_busy'],
                'total_operations': len(self._operations),
                'active_operations': len(active_ops),
                'operations_by_type': ops_by_type,
                'current_user': self._global_state.get('current_user'),
                'session_duration': (datetime.now() - self._global_state['session_start']).total_seconds(),
                'last_activity': self._global_state['last_activity'].isoformat()
            }

    def set_current_user(self, username: str):
        """ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        with self._lock:
            self._global_state['current_user'] = username
            logger.info(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä: {username}")

    def clear_current_user(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        with self._lock:
            self._global_state['current_user'] = None
            logger.info("ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä")


# ŸÖÿ´ŸäŸÑ ÿπÿßŸÖ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
app_state_manager = AppStateManager()

============================================================
FILE: core\config_manager.py
SIZE: 18851 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/config_manager.py

ÿ™ÿØŸäÿ± Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ¶ÿ© ŸÇÿ±ÿßÿ°ÿ© ŸàŸÉÿ™ÿßÿ®ÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÖŸÜ/ÿ•ŸÑŸâ ŸÖŸÑŸÅ YAML.
ÿ™ÿØÿπŸÖ ÿ£Ÿäÿ∂ÿßŸã ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ© ŸÖŸÜ ŸÖŸÑŸÅ .env
ŸàÿØÿπŸÖ ÿ¥ÿßŸÖŸÑ ŸÑÿ•ÿπÿØÿßÿØÿßÿ™ Views ŸàÿßŸÑÿ£ÿØÿßÿ°
"""

import os
import yaml
from dotenv import load_dotenv
from core.logger import logger
from typing import Dict  # ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
from typing import Dict, Any, Optional, List

class ConfigManager:
    """
    ŸÅÿ¶ÿ© ConfigManager ÿ™ÿ™ŸàŸÑŸâ:
    - ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÖŸÜ ŸÖŸÑŸÅ .env
    - ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÜ ŸÖŸÑŸÅ YAML
    - ÿØŸÖÿ¨ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖÿπ ÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ£ŸàŸÑŸàŸäÿ© ŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©
    - ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ (ÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ©) ŸÅŸä ŸÖŸÑŸÅ YAML
    - ÿ•ÿØÿßÿ±ÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ Views ŸàÿßŸÑÿ£ÿØÿßÿ°
    """

    def __init__(self, config_path: str = "config/settings.yaml") -> None:
        """
        ÿ™ŸáŸäÿ¶ÿ© ConfigManager.

        :param config_path: ÿßŸÑŸÖÿ≥ÿßÿ± ÿ•ŸÑŸâ ŸÖŸÑŸÅ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ YAML
        """
        self.config_path: str = config_path
        self.config_data: Dict[str, Any] = {}
        self.env_data: Dict[str, str] = {}

        # ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ© ÿ£ŸàŸÑÿßŸã
        self._load_env()

        # ÿ´ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿπÿØÿßÿØÿßÿ™ YAML
        self._load_config()

        # ÿØŸÖÿ¨ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        self._merge_settings()

    def _load_env(self) -> None:
        """
        ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÖŸÜ ŸÖŸÑŸÅ .env
        """
        # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÑŸÅ .env ŸÅŸä ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ≠ÿßŸÑŸä ÿ£Ÿà ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ£ÿπŸÑŸâ
        env_paths = ['.env', '../.env', os.path.join(os.path.dirname(__file__), '..', '.env')]

        env_loaded = False
        for env_path in env_paths:
            if os.path.exists(env_path):
                load_dotenv(env_path)
                env_loaded = True
                logger.info(f"ConfigManager: ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ© ŸÖŸÜ '{env_path}'")
                break

        if not env_loaded:
            logger.warning("ConfigManager: ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖŸÑŸÅ .env - ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©")

        # ÿ≠ŸÅÿ∏ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ© ÿßŸÑŸÖŸáŸÖÿ©
        self.env_data = {
            'airtable_api_key': os.getenv('AIRTABLE_API_KEY', ''),
            'airtable_base_id': os.getenv('AIRTABLE_BASE_ID', ''),
            'airtable_users_table': os.getenv('AIRTABLE_USERS_TABLE', 'Users'),
            'airtable_booking_table': os.getenv('AIRTABLE_BOOKING_TABLE', 'List V2'),
            'default_language': os.getenv('DEFAULT_LANGUAGE', 'ar'),
            'default_theme': os.getenv('DEFAULT_THEME', 'light'),
            'db_path': os.getenv('DB_PATH', 'fts_sales_cache.db'),
        }

        # ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        self.env_data.update({
            'airtable_guides_table': os.getenv('AIRTABLE_GUIDES_TABLE', 'Guides'),
            'airtable_agencies_table': os.getenv('AIRTABLE_AGENCIES_TABLE', 'Agencies'),
            'airtable_options_table': os.getenv('AIRTABLE_OPTIONS_TABLE', 'Trip Options'),
            'airtable_destinations_table': os.getenv('AIRTABLE_DESTINATIONS_TABLE', 'Destinations'),
                })

        # ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©
        self.env_data.update({
            'airtable_tripnames_table': os.getenv('AIRTABLE_TRIPNAMES_TABLE', 'Trip Names'),
            'airtable_management_options_table': os.getenv('AIRTABLE_MANAGEMENT_OPTIONS_TABLE', 'Management Options'),
            'airtable_addons_table': os.getenv('AIRTABLE_ADDONS_TABLE', 'Add-ons'),
                })

    def _load_config(self) -> None:
        """
        ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÜ ŸÖŸÑŸÅ YAML
        """
        if not os.path.exists(self.config_path):
            logger.warning(f"ConfigManager: ŸÖŸÑŸÅ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ '{self.config_path}' ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ. ÿ≥Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ÿ¨ÿØŸäÿØ.")
            parent_dir = os.path.dirname(self.config_path)
            if parent_dir and not os.path.isdir(parent_dir):
                try:
                    os.makedirs(parent_dir, exist_ok=True)
                    logger.info(f"ConfigManager: ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØ '{parent_dir}'.")
                except Exception as exc:
                    logger.error(f"ConfigManager: ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØ '{parent_dir}': {exc}", exc_info=True)

            # ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
            self._create_default_config()
        else:
            try:
                with open(self.config_path, "r", encoding="utf-8") as f:
                    self.config_data = yaml.safe_load(f) or {}
                logger.info(f"ConfigManager: ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÜ '{self.config_path}'.")
            except Exception as exc:
                logger.error(f"ConfigManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ŸÇÿ±ÿßÿ°ÿ© ŸÖŸÑŸÅ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ '{self.config_path}': {exc}", exc_info=True)
                self.config_data = {}

    def _create_default_config(self) -> None:
        """
        ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÖÿπ ÿØÿπŸÖ Views
        """
        self.config_data = {
            'language': self.env_data.get('default_language', 'ar'),
            'appearance_mode': self.env_data.get('default_theme', 'light'),
            'color_theme': 'blue',
            'view_name': 'Sales App',
            'window_size': {
                'width': 1024,
                'height': 768
            },
            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÄ Views
            'views_settings': {
                'allow_view_switching': True,
                'show_current_view_in_status': True,
                'default_views': {
                    'admin': 'All Records',
                    'manager': 'Manager View',
                    'editor': 'Team View',
                    'viewer': 'My Bookings'
                },
                'role_views': {
                    'admin': ['All Records', 'Today\'s Bookings', 'This Week', 'This Month'],
                    'manager': ['Manager View', 'Team View', 'Today\'s Bookings', 'This Week'],
                    'editor': ['Team View', 'My Bookings', 'Today\'s Bookings'],
                    'viewer': ['My Bookings']
                }
            },
            'cache_settings': {
                'enable_cache': True,
                'default_cache_duration': 15,
                'view_cache_duration': {
                    'All Records': 30,
                    'Today\'s Bookings': 5,
                    'This Week': 15,
                    'This Month': 60
                }
            },
            'performance_settings': {
                'records_per_page': 100,
                'enable_lazy_loading': True,
                'show_loading_indicator': True,
                'background_loading': True
            }
        }
        self._save_config()

    def _merge_settings(self) -> None:
        """
        ÿØŸÖÿ¨ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖÿπ ÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ£ŸàŸÑŸàŸäÿ© ŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©
        """
        # ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ© ŸÖŸÜ .env ÿ™ÿ£ÿÆÿ∞ ÿßŸÑÿ£ŸàŸÑŸàŸäÿ© ÿØÿßÿ¶ŸÖÿßŸã
        if self.env_data.get('airtable_api_key'):
            self.config_data['airtable_api_key'] = self.env_data['airtable_api_key']
        if self.env_data.get('airtable_base_id'):
            self.config_data['airtable_base_id'] = self.env_data['airtable_base_id']
        if self.env_data.get('airtable_users_table'):
            self.config_data['airtable_users_table'] = self.env_data['airtable_users_table']
        if self.env_data.get('airtable_booking_table'):
            self.config_data['airtable_booking_table'] = self.env_data['airtable_booking_table']

    def get(self, key: str, default: Optional[Any] = None) -> Any:
        """
        ÿ•ÿ±ÿ¨ÿßÿπ ŸÇŸäŸÖÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿå ŸÖÿπ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ© ÿ£ŸàŸÑÿßŸã

        :param key: ÿßÿ≥ŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØ
        :param default: ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        :return: ŸÇŸäŸÖÿ© ÿßŸÑÿ•ÿπÿØÿßÿØ
        """
        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ© ÿ£ŸàŸÑÿßŸã ŸÑŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ©
        if key in ['airtable_api_key', 'airtable_base_id']:
            env_value = self.env_data.get(key)
            if env_value:
                return env_value

        return self.config_data.get(key, default)

    def set(self, key: str, value: Any) -> None:
        """
        ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ© ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ŸÑÿß Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ© ŸÅŸä YAML

        :param key: ÿßÿ≥ŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØ
        :param value: ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        """
        # ŸÖŸÜÿπ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ© ŸÅŸä YAML
        sensitive_keys = ['airtable_api_key', 'airtable_base_id', 'password', 'secret']

        if key not in sensitive_keys:
            self.config_data[key] = value
            logger.debug(f"ConfigManager: ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ key='{key}' ÿ•ŸÑŸâ ÿßŸÑŸÇŸäŸÖÿ©: {value!r}.")
            self._save_config()
        else:
            logger.warning(f"ConfigManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿ≠ŸÅÿ∏ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ≠ÿ≥ÿßÿ≥ÿ© '{key}' - ÿ™ŸÖ ÿßŸÑÿ™ÿ¨ÿßŸáŸÑ")

    def _save_config(self) -> None:
        """
        ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ© ÿ•ŸÑŸâ ŸÖŸÑŸÅ YAML
        """
        # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿ≥ÿÆÿ© ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿØŸàŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ©
        safe_data = {}
        sensitive_keys = ['airtable_api_key', 'airtable_base_id', 'password', 'secret']

        for key, value in self.config_data.items():
            if key not in sensitive_keys:
                safe_data[key] = value

        try:
            with open(self.config_path, "w", encoding="utf-8") as f:
                yaml.safe_dump(safe_data, f, default_flow_style=False, sort_keys=False, allow_unicode=True)
            logger.info(f"ConfigManager: ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÅŸä '{self.config_path}'.")
        except Exception as exc:
            logger.error(f"ConfigManager: ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ•ŸÑŸâ '{self.config_path}': {exc}", exc_info=True)

    def reload(self) -> None:
        """
        ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        """
        logger.debug("ConfigManager: ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™.")
        self._load_env()
        self._load_config()
        self._merge_settings()

    # ============ ÿØŸàÿßŸÑ ÿ¨ÿØŸäÿØÿ© ŸÑÿØÿπŸÖ Views ============

    def get_all_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
        return self.config_data.copy()

    def get_setting(self, key: str, default: Any = None) -> Any:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØ ŸÖÿ≠ÿØÿØ (ŸÖÿ±ÿßÿØŸÅ ŸÑŸÄ get)"""
        return self.get(key, default)

    def get_nested_setting(self, keys: List[str], default: Any = None) -> Any:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØ ŸÖÿ™ÿØÿßÿÆŸÑ

        :param keys: ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ™ÿØÿßÿÆŸÑÿ©
        :param default: ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        :return: ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ£Ÿà ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        """
        value = self.config_data
        for key in keys:
            if isinstance(value, dict):
                value = value.get(key)
            else:
                return default
        return value if value is not None else default

    # ÿØŸàÿßŸÑ ÿÆÿßÿµÿ© ÿ®ŸÄ Views
    def get_views_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿ•ÿπÿØÿßÿØÿßÿ™ Views"""
        return self.get_setting('views_settings', {
            'allow_view_switching': True,
            'default_views': {'viewer': 'My Bookings'}
        })

    def get_role_views(self, role: str) -> List[str]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ Views ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ÿ© ŸÑÿØŸàÿ± ŸÖÿπŸäŸÜ

        :param role: ÿØŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (admin, manager, editor, viewer)
        :return: ŸÇÿßÿ¶ŸÖÿ© ÿ£ÿ≥ŸÖÿßÿ° Views ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ÿ©
        """
        return self.get_nested_setting(
            ['views_settings', 'role_views', role],
            ['My Bookings']  # ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        )

    def get_default_view(self, role: str) -> str:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ View ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÑÿØŸàÿ± ŸÖÿπŸäŸÜ

        :param role: ÿØŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        :return: ÿßÿ≥ŸÖ View ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
        """
        return self.get_nested_setting(
            ['views_settings', 'default_views', role],
            'My Bookings'
        )

    def is_view_switching_allowed(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≥ŸÖÿßÿ≠ ÿ®ÿ™ÿ®ÿØŸäŸÑ Views"""
        return self.get_nested_setting(
            ['views_settings', 'allow_view_switching'],
            True
        )

    def get_view_cache_duration(self, view_name: str) -> int:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿØÿ© ÿßŸÑŸÉÿßÿ¥ ŸÑŸÄ View ŸÖÿπŸäŸÜ ÿ®ÿßŸÑÿØŸÇÿßÿ¶ŸÇ

        :param view_name: ÿßÿ≥ŸÖ View
        :return: ŸÖÿØÿ© ÿßŸÑŸÉÿßÿ¥ ÿ®ÿßŸÑÿØŸÇÿßÿ¶ŸÇ
        """
        duration = self.get_nested_setting(
            ['cache_settings', 'view_cache_duration', view_name]
        )
        if duration is None:
            duration = self.get_nested_setting(
                ['cache_settings', 'default_cache_duration'],
                15
            )
        return duration

    def get_view_specific_settings(self, view_name: str) -> Dict[str, Any]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÄ View ŸÖÿπŸäŸÜ

        :param view_name: ÿßÿ≥ŸÖ View
        :return: ŸÇÿßŸÖŸàÿ≥ ÿ®ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿÆÿßÿµÿ©
        """
        return self.get_nested_setting(
            ['views_settings', 'view_specific_settings', view_name],
            {}
        )

    def get_performance_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ°"""
        return self.get_setting('performance_settings', {
            'records_per_page': 100,
            'enable_lazy_loading': True,
            'show_loading_indicator': True,
            'background_loading': True
        })

    def get_export_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ™ÿµÿØŸäÿ±"""
        return self.get_setting('export_settings', {
            'allowed_formats': ['excel', 'pdf', 'csv'],
            'max_export_records': 5000,
            'include_timestamp': True
        })

    def get_cache_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÉÿßÿ¥"""
        return self.get_setting('cache_settings', {
            'enable_cache': True,
            'default_cache_duration': 15,
            'max_cache_size': 1000,
            'clear_on_logout': True
        })

    def is_cache_enabled(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÉÿßÿ¥"""
        return self.get_nested_setting(['cache_settings', 'enable_cache'], True)

    def get_security_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ"""
        return self.get_setting('security_settings', {
            'session_timeout': 60,
            'log_failed_attempts': True,
            'max_failed_attempts': 5,
            'lockout_duration': 15
        })

    def get_logging_settings(self) -> Dict[str, Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"""
        return self.get_setting('logging_settings', {
            'level': 'INFO',
            'log_to_file': True,
            'log_file_path': 'logs/app.log',
            'max_log_size': 10,
            'backup_count': 5
        })

    def update_setting(self, key: str, value: Any) -> bool:
        """
        ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿπÿØÿßÿØ ŸÖÿπŸäŸÜ (ŸÖÿ±ÿßÿØŸÅ ŸÑŸÄ set ŸÖÿπ ÿ•ÿ±ÿ¨ÿßÿπ ŸÜÿ™Ÿäÿ¨ÿ©)

        :param key: ÿßÿ≥ŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØ
        :param value: ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        :return: True ÿ•ÿ∞ÿß ŸÜÿ¨ÿ≠ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
        """
        try:
            self.set(key, value)
            return True
        except Exception as e:
            logger.error(f"Error updating setting {key}: {e}")
            return False

    def save_settings(self) -> bool:
        """
        ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ•ŸÑŸâ ÿßŸÑŸÖŸÑŸÅ (ŸÖÿ±ÿßÿØŸÅ ŸÑŸÄ _save_config)

        :return: True ÿ•ÿ∞ÿß ŸÜÿ¨ÿ≠ ÿßŸÑÿ≠ŸÅÿ∏
        """
        try:
            self._save_config()
            return True
        except Exception:
            return False

    # ============ ÿØŸàÿßŸÑ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ============
    USER_SETTINGS_FILE = "user_settings.yaml"

    def _load_user_settings(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ¥ÿÆÿµŸäÿ©"""
        try:
            with open(self.USER_SETTINGS_FILE, "r", encoding="utf-8") as f:
                self.user_settings = yaml.safe_load(f) or {}
        except FileNotFoundError:
            self.user_settings = {
                "language": "ar",
                "theme": "light",
                "window_size": {"width": 1024, "height": 768},
                "last_filter": "",
                "last_view": "",  # ÿ•ÿ∂ÿßŸÅÿ© ÿ¢ÿÆÿ± View ŸÖÿ≥ÿ™ÿÆÿØŸÖ
                "favorites_views": []  # Views ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©
            }
            with open(self.USER_SETTINGS_FILE, "w", encoding="utf-8") as f:
                yaml.dump(self.user_settings, f, allow_unicode=True)

    def save_user_setting(self, key: str, value: Any):
        """ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿπŸäŸÜ"""
        if not hasattr(self, 'user_settings'):
            self._load_user_settings()

        self.user_settings[key] = value
        with open(self.USER_SETTINGS_FILE, "w", encoding="utf-8") as f:
            yaml.dump(self.user_settings, f, allow_unicode=True)

    def get_user_setting(self, key: str, default: Any = None) -> Any:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿπŸäŸÜ"""
        if not hasattr(self, 'user_settings'):
            self._load_user_settings()

        return self.user_settings.get(key, default)

    def get_last_used_view(self) -> Optional[str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¢ÿÆÿ± View ÿßÿ≥ÿ™ÿÆÿØŸÖŸá ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        return self.get_user_setting('last_view')

    def save_last_used_view(self, view_name: str):
        """ÿ≠ŸÅÿ∏ ÿ¢ÿÆÿ± View ÿßÿ≥ÿ™ÿÆÿØŸÖŸá ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        self.save_user_setting('last_view', view_name)

    def get_favorite_views(self) -> List[str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ Views ÿßŸÑŸÖŸÅÿ∂ŸÑÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        return self.get_user_setting('favorites_views', [])

    def add_favorite_view(self, view_name: str):
        """ÿ•ÿ∂ÿßŸÅÿ© View ŸÑŸÑŸÖŸÅÿ∂ŸÑÿ©"""
        favorites = self.get_favorite_views()
        if view_name not in favorites:
            favorites.append(view_name)
            self.save_user_setting('favorites_views', favorites)

    def remove_favorite_view(self, view_name: str):
        """ÿ•ÿ≤ÿßŸÑÿ© View ŸÖŸÜ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©"""
        favorites = self.get_favorite_views()
        if view_name in favorites:
            favorites.remove(view_name)
            self.save_user_setting('favorites_views', favorites)

    def get_airtable_config(self) -> Dict[str, str]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ Airtable ŸÖŸÜ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©

        :return: ŸÇÿßŸÖŸàÿ≥ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ api_key Ÿà base_id
        """
        return {
            'api_key': self.env_data.get('airtable_api_key', ''),
            'base_id': self.env_data.get('airtable_base_id', ''),
            'users_table': self.env_data.get('airtable_users_table', 'users'),
            'booking_table': self.env_data.get('airtable_booking_table', 'List V2')
        }

    def get_dropdown_tables_config(self) -> Dict[str, str]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ≥ŸÖÿßÿ° ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©

        :return: ŸÇÿßŸÖŸàÿ≥ ÿ®ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ¨ÿØÿßŸàŸÑ
        """
        return {
            'guides': self.env_data.get('airtable_guides_table', 'Guides'),
            'agencies': self.env_data.get('airtable_agencies_table', 'Agencies'),
            'options': self.env_data.get('airtable_options_table', 'Trip Options'),
            'destinations': self.env_data.get('airtable_destinations_table', 'Destinations'),
            'tripnames': self.env_data.get('airtable_tripnames_table', 'Trip Names'),
            'management_options': self.env_data.get('airtable_management_options_table', 'Management Options'),
            'addons': self.env_data.get('airtable_addons_table', 'Add-ons')
        }

============================================================
FILE: core\constants.py
SIZE: 8556 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/constants.py

ÿ´Ÿàÿßÿ®ÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
Application Constants
"""

from enum import Enum
from typing import Dict, List, Tuple


class LoginConstants:
    """ÿ´Ÿàÿßÿ®ÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"""

    # Password requirements
    MIN_PASSWORD_LENGTH = 8
    MAX_PASSWORD_LENGTH = 128
    PASSWORD_SPECIAL_CHARS = "!@#$%^&*()_+-=[]{}|;:,.<>?"

    # Security settings
    MAX_LOGIN_ATTEMPTS = 5
    LOGIN_TIMEOUT = 30  # seconds
    SESSION_TIMEOUT = 1800  # 30 minutes
    LOCKOUT_DURATION = 300  # 5 minutes

    # Rate limiting
    RATE_LIMIT_WINDOW = 300  # 5 minutes
    RATE_LIMIT_MAX_ATTEMPTS = 5

    # Session management
    SESSION_COOKIE_NAME = "fts_session"
    SESSION_COOKIE_SECURE = True
    SESSION_COOKIE_HTTPONLY = True
    SESSION_COOKIE_SAMESITE = "Strict"

    # Token settings
    TOKEN_LENGTH = 32
    CSRF_TOKEN_LENGTH = 32
    REFRESH_TOKEN_EXPIRY = 604800  # 7 days

    # Validation
    USERNAME_MIN_LENGTH = 3
    USERNAME_MAX_LENGTH = 50
    USERNAME_PATTERN = r'^[a-zA-Z0-9_.-]+$'

    # 2FA settings
    OTP_LENGTH = 6
    OTP_VALIDITY = 300  # 5 minutes
    BACKUP_CODES_COUNT = 10


class WindowConstants:
    """ÿ´Ÿàÿßÿ®ÿ™ ÿßŸÑŸÜŸàÿßŸÅÿ∞"""

    # Login window
    LOGIN_WINDOW_SIZE = "450x700"
    MIN_WINDOW_WIDTH = 450
    MIN_WINDOW_HEIGHT = 700
    MAX_WINDOW_WIDTH = 600
    MAX_WINDOW_HEIGHT = 800

    # Animations
    ANIMATION_DURATION = 300
    FLASH_INTERVAL = 300
    FADE_DURATION = 200
    SLIDE_DURATION = 250

    # UI elements
    BUTTON_HEIGHT = 45
    BUTTON_CORNER_RADIUS = 22
    ENTRY_HEIGHT = 45
    ENTRY_CORNER_RADIUS = 10

    # Spacing
    PADDING_X = 25
    PADDING_Y = 25
    ELEMENT_SPACING = 10
    SECTION_SPACING = 20


class ThemeConstants:
    """ÿ´Ÿàÿßÿ®ÿ™ ÿßŸÑÿ´ŸäŸÖÿßÿ™"""

    # Color schemes
    THEMES = {
        "blue": {
            "primary": "#3498db",
            "primary_hover": "#2980b9",
            "secondary": "#2c3e50",
            "secondary_hover": "#1a252f",
            "success": "#27ae60",
            "error": "#e74c3c",
            "warning": "#f39c12",
            "info": "#3498db"
        },
        "green": {
            "primary": "#27ae60",
            "primary_hover": "#229954",
            "secondary": "#16a085",
            "secondary_hover": "#138d75",
            "success": "#27ae60",
            "error": "#e74c3c",
            "warning": "#f39c12",
            "info": "#3498db"
        },
        "dark": {
            "primary": "#34495e",
            "primary_hover": "#2c3e50",
            "secondary": "#7f8c8d",
            "secondary_hover": "#707b7c",
            "success": "#27ae60",
            "error": "#e74c3c",
            "warning": "#f39c12",
            "info": "#3498db"
        }
    }

    # Gradients
    GRADIENTS = {
        "primary": ["#3498db", "#2980b9"],
        "success": ["#27ae60", "#229954"],
        "error": ["#e74c3c", "#c0392b"],
        "warning": ["#f39c12", "#d68910"],
        "info": ["#3498db", "#2980b9"]
    }

    # Font settings
    FONT_FAMILY = "Segoe UI"
    FONT_FAMILY_ARABIC = "Arial"
    FONT_SIZE_BASE = 14
    FONT_SIZE_SMALL = 12
    FONT_SIZE_LARGE = 16
    FONT_SIZE_TITLE = 28
    FONT_SIZE_SUBTITLE = 18


class SecurityLevel(Enum):
    """ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ"""
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"


class AuthenticationMethod(Enum):
    """ÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿµÿßÿØŸÇÿ©"""
    PASSWORD = "password"
    TWO_FACTOR = "two_factor"
    BIOMETRIC = "biometric"
    SSO = "sso"
    MAGIC_LINK = "magic_link"
    HARDWARE_KEY = "hardware_key"


class LoginStatus(Enum):
    """ÿ≠ÿßŸÑÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    SUCCESS = "success"
    FAILED = "failed"
    LOCKED = "locked"
    TIMEOUT = "timeout"
    CANCELLED = "cancelled"


class PasswordStrength(Enum):
    """ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"""
    VERY_WEAK = (0, "very_weak", "#e74c3c")
    WEAK = (1, "weak", "#e74c3c")
    FAIR = (2, "fair", "#f39c12")
    GOOD = (3, "good", "#f1c40f")
    STRONG = (4, "strong", "#27ae60")
    VERY_STRONG = (5, "very_strong", "#27ae60")

    def __init__(self, level: int, name: str, color: str):
        self.level = level
        self.strength_name = name
        self.color = color


class ErrorCode(Enum):
    """ÿ±ŸÖŸàÿ≤ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
    NONE = 0
    INVALID_CREDENTIALS = 1001
    ACCOUNT_LOCKED = 1002
    SESSION_EXPIRED = 1003
    NETWORK_ERROR = 1004
    SERVER_ERROR = 1005
    RATE_LIMIT_EXCEEDED = 1006
    INVALID_2FA = 1007
    PERMISSION_DENIED = 1008
    MAINTENANCE_MODE = 1009
    UNKNOWN_ERROR = 9999


class MessageType(Enum):
    """ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ"""
    INFO = "info"
    SUCCESS = "success"
    WARNING = "warning"
    ERROR = "error"
    DEBUG = "debug"


# API Endpoints
API_ENDPOINTS = {
    "auth": {
        "login": "/api/v1/auth/login",
        "logout": "/api/v1/auth/logout",
        "refresh": "/api/v1/auth/refresh",
        "verify": "/api/v1/auth/verify",
        "forgot_password": "/api/v1/auth/forgot-password",
        "reset_password": "/api/v1/auth/reset-password",
        "change_password": "/api/v1/auth/change-password",
        "verify_2fa": "/api/v1/auth/verify-2fa",
        "setup_2fa": "/api/v1/auth/setup-2fa"
    },
    "user": {
        "profile": "/api/v1/user/profile",
        "update_profile": "/api/v1/user/update-profile",
        "sessions": "/api/v1/user/sessions",
        "devices": "/api/v1/user/devices",
        "security_log": "/api/v1/user/security-log"
    }
}


# Regular expressions
REGEX_PATTERNS = {
    "username": r'^[a-zA-Z0-9_.-]+$',
    "email": r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$',
    "phone": r'^\+?[0-9\s\-\(\)]+$',
    "strong_password": r'^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$',
    "url": r'^https?://(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)$',
    "ipv4": r'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$',
    "ipv6": r'^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$'
}


# Default messages
DEFAULT_MESSAGES = {
    "en": {
        "welcome": "Welcome to FTS Sales Manager",
        "login_prompt": "Please enter your credentials to continue",
        "login_success": "Login successful! Redirecting...",
        "login_failed": "Login failed. Please check your credentials.",
        "account_locked": "Your account has been locked. Please contact support.",
        "session_expired": "Your session has expired. Please login again.",
        "password_changed": "Your password has been changed successfully.",
        "profile_updated": "Your profile has been updated successfully.",
        "logout_success": "You have been logged out successfully.",
        "maintenance_mode": "System is under maintenance. Please try again later."
    },
    "ar": {
        "welcome": "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖÿØŸäÿ± ŸÖÿ®Ÿäÿπÿßÿ™ FTS",
        "login_prompt": "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©",
        "login_success": "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠! ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ...",
        "login_failed": "ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ.",
        "account_locked": "ÿ™ŸÖ ŸÇŸÅŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿØÿπŸÖ.",
        "session_expired": "ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿ¨ŸÑÿ≥ÿ™ŸÉ. Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
        "password_changed": "ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ®ŸÜÿ¨ÿßÿ≠.",
        "profile_updated": "ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅŸÉ ÿßŸÑÿ¥ÿÆÿµŸä ÿ®ŸÜÿ¨ÿßÿ≠.",
        "logout_success": "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠.",
        "maintenance_mode": "ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ™ÿ≠ÿ™ ÿßŸÑÿµŸäÿßŸÜÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÑÿßÿ≠ŸÇÿßŸã."
    }
}


# Icons
ICONS = {
    "user": "üë§",
    "lock": "üîí",
    "eye": "üëÅ",
    "eye_closed": "üëÅ‚Äçüó®",
    "key": "üîë",
    "shield": "üõ°Ô∏è",
    "warning": "‚ö†Ô∏è",
    "error": "‚ùå",
    "success": "‚úÖ",
    "info": "‚ÑπÔ∏è",
    "language": "üåê",
    "theme": "üåì",
    "help": "‚ùì",
    "settings": "‚öôÔ∏è",
    "logout": "üö™",
    "fingerprint": "üëÜ",
    "face": "üòä",
    "email": "üìß",
    "phone": "üì±",
    "clock": "üïê",
    "calendar": "üìÖ",
    "location": "üìç",
    "device": "üíª"
}

============================================================
FILE: core\db_manager.py
SIZE: 10852 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/db_manager.py

ÿ™ÿØŸäÿ± Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ SQLite ÿßŸÑŸÖÿ≠ŸÑŸäÿ© ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸáÿß ŸÉŸÉÿßÿ¥ (Cache) ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™
ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ÿ© ŸÖŸÜ Airtable. ÿ™ŸàŸÅÿ± Ÿàÿßÿ¨Ÿáÿßÿ™ ŸÑÿ≠ŸÅÿ∏ Ÿàÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© ŸÖÿπ ÿØÿπŸÖ ÿ¨ÿØÿßŸàŸÑ ŸÖÿ™ÿπÿØÿØÿ©.
"""

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥Ÿäÿ©
# ------------------------------------------------------------
import sqlite3
import threading
from typing import Any, Dict, List, Optional

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ Ÿàÿ≠ÿØÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
# ------------------------------------------------------------
from core.logger import logger


class DatabaseManager:
    """
    ŸÅÿ¶ÿ© DatabaseManager ÿ™ÿ™ŸàŸÑŸâ:
    - ÿ•ŸÜÿ¥ÿßÿ° ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ SQLite (ŸÖŸÑŸÅ db_path).
    - ÿ™ŸáŸäÿ¶ÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© (users_cache, bookings_cache, records_cache).
    - ÿ•ÿ™ÿßÿ≠ÿ© ÿ∑ÿ±ŸÇ ŸÑŸÑÿ≠ŸÅÿ∏ ŸàÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ ŸÑŸÉŸÑ ÿ¨ÿØŸàŸÑ.
    """

    def __init__(self, db_path: str) -> None:
        """
        ÿ™ŸáŸäÿ¶ÿ© DatabaseManager.

        :param db_path: ŸÖÿ≥ÿßÿ± ŸÖŸÑŸÅ ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ SQLite (ŸÖÿ´ŸÑ "fts_sales_cache.db").
        """
        self.db_path: str = db_path
        self._conn: Optional[sqlite3.Connection] = None
        self._lock: threading.Lock = threading.Lock()
        self._connect_and_init()

    def _connect_and_init(self) -> None:
        """
        ÿ•ŸÜÿ¥ÿßÿ° ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ Ÿàÿ™ŸáŸäÿ¶ÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÉÿßÿ¥ ŸÑŸÉŸÑ ÿ¨ÿØŸàŸÑ Airtable.
        """
        try:
            self._conn = sqlite3.connect(self.db_path, check_same_thread=False)
            cursor = self._conn.cursor()

            # ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿØŸàŸÑ ŸÖŸÜŸÅÿµŸÑ ŸÑŸÉŸÑ ŸÜŸàÿπ ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            # ÿ¨ÿØŸàŸÑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS users_cache (
                    id TEXT PRIMARY KEY,
                    data TEXT NOT NULL,
                    table_name TEXT DEFAULT 'Users'
                );
            """)

            # ÿ¨ÿØŸàŸÑ ŸÑŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS bookings_cache (
                    id TEXT PRIMARY KEY,
                    data TEXT NOT NULL,
                    table_name TEXT DEFAULT 'List V2'
                );
            """)

            # ÿ¨ÿØŸàŸÑ ÿπÿßŸÖ ŸÑŸÑŸÉÿßÿ¥ (ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ)
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS records_cache (
                    id TEXT PRIMARY KEY,
                    data TEXT NOT NULL,
                    table_name TEXT
                );
            """)

            self._conn.commit()
            logger.info(f"DatabaseManager: ŸÖÿ™ÿµŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ '{self.db_path}' Ÿàÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© ÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÉÿßÿ¥.")
        except Exception as exc:
            logger.error(f"DatabaseManager: ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ°/ÿ™ŸáŸäÿ¶ÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ '{self.db_path}': {exc}", exc_info=True)

    def get_cached_record(self, record_id: str, table_name: str = None) -> Optional[str]:
        """
        ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÅŸä ÿßŸÑŸÉÿßÿ¥ ŸÖŸÜ ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®.
        :param record_id: ŸÖÿπÿ±ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿ∞Ÿä ŸÜÿ®ÿ≠ÿ´ ÿπŸÜŸá.
        :param table_name: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        :return: ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ (json) ŸÉÿ≥ŸÑÿ≥ŸÑÿ© ŸÜÿµŸäÿ© ÿ•ÿ∞ÿß ŸàŸèÿ¨ÿØÿ™ÿå Ÿàÿ•ŸÑÿß None.
        """
        if not self._conn:
            logger.warning("DatabaseManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿ≥ÿ¨ŸÑ ŸÇÿ®ŸÑ Ÿàÿ¨ŸàÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.")
            return None

        try:
            with self._lock:
                cursor = self._conn.cursor()

                # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ table_name
                if table_name == "Users":
                    cursor.execute("SELECT data FROM users_cache WHERE id = ?;", (record_id,))
                elif table_name == "List V2":
                    cursor.execute("SELECT data FROM bookings_cache WHERE id = ?;", (record_id,))
                else:
                    cursor.execute("SELECT data FROM records_cache WHERE id = ?;", (record_id,))

                result = cursor.fetchone()

            if result:
                logger.debug(f"DatabaseManager: Ÿàÿ¨ÿØ ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÅŸä ÿßŸÑŸÉÿßÿ¥ (ÿ¨ÿØŸàŸÑ: {table_name}).")
                return result[0]
            logger.debug(f"DatabaseManager: ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ŸÅŸä ÿßŸÑŸÉÿßÿ¥.")
            return None
        except Exception as exc:
            logger.error(f"DatabaseManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥: {exc}", exc_info=True)
            return None

    def set_cached_record(self, record_id: str, data: str, table_name: str = None) -> None:
        """
        ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ§ŸÇÿ™ ŸÅŸä ÿ¨ÿØŸàŸÑ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®.
        :param record_id: ŸÖÿπÿ±ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ.
        :param data: ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ÿÆÿ≤ŸäŸÜŸáÿß ŸÉÿ≥ŸÑÿ≥ŸÑÿ© ŸÜÿµŸäÿ© (ÿπÿßÿØÿ© JSON).
        :param table_name: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        """
        if not self._conn:
            logger.warning("DatabaseManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿÆÿ≤ŸäŸÜ ÿ≥ÿ¨ŸÑ ŸÇÿ®ŸÑ Ÿàÿ¨ŸàÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.")
            return

        try:
            with self._lock:
                cursor = self._conn.cursor()

                # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®
                if table_name == "Users":
                    cursor.execute("""
                        INSERT INTO users_cache (id, data) VALUES (?, ?)
                        ON CONFLICT(id) DO UPDATE SET data=excluded.data;
                    """, (record_id, data))
                elif table_name == "List V2":
                    cursor.execute("""
                        INSERT INTO bookings_cache (id, data) VALUES (?, ?)
                        ON CONFLICT(id) DO UPDATE SET data=excluded.data;
                    """, (record_id, data))
                else:
                    cursor.execute("""
                        INSERT INTO records_cache (id, data, table_name) VALUES (?, ?, ?)
                        ON CONFLICT(id) DO UPDATE SET data=excluded.data, table_name=excluded.table_name;
                    """, (record_id, data, table_name))

                self._conn.commit()
            logger.debug(f"DatabaseManager: ÿ™ŸÖ ÿ™ÿÆÿ≤ŸäŸÜ/ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÅŸä ÿßŸÑŸÉÿßÿ¥ (ÿ¨ÿØŸàŸÑ: {table_name}).")
        except Exception as exc:
            logger.error(f"DatabaseManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÅŸä ÿßŸÑŸÉÿßÿ¥: {exc}", exc_info=True)

    def get_all_cached_ids(self, table_name: str = None) -> List[str]:
        """
        ÿ•ÿ±ÿ¨ÿßÿπ ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ¨ŸÖŸäÿπ ŸÖÿπÿ±ŸÅÿßÿ™ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖÿÆÿ≤ŸÜÿ© ŸÅŸä ÿ¨ÿØŸàŸÑ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÖÿ≠ÿØÿØ.
        :param table_name: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        :return: ŸÇÿßÿ¶ŸÖÿ© ŸÖÿπÿ±ŸÅÿßÿ™ ŸÉÿ≥ŸÑÿßÿ≥ŸÑ ŸÜÿµŸäÿ©.
        """
        if not self._conn:
            logger.warning("DatabaseManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ŸÖÿπÿ±ŸÅÿßÿ™ ŸÇÿ®ŸÑ Ÿàÿ¨ŸàÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.")
            return []

        try:
            with self._lock:
                cursor = self._conn.cursor()

                if table_name == "Users":
                    cursor.execute("SELECT id FROM users_cache;")
                elif table_name == "List V2":
                    cursor.execute("SELECT id FROM bookings_cache;")
                else:
                    cursor.execute("SELECT id FROM records_cache;")

                rows = cursor.fetchall()

            ids = [row[0] for row in rows]
            logger.debug(f"DatabaseManager: ÿ¨ŸèŸÑÿ®ÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿπÿ±ŸÅÿßÿ™ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ ({len(ids)} ÿ≥ÿ¨ŸÑÿßŸã) - ÿ¨ÿØŸàŸÑ: {table_name}.")
            return ids
        except Exception as exc:
            logger.error(f"DatabaseManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿπÿ±ŸÅÿßÿ™ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥: {exc}", exc_info=True)
            return []

    def clear_cache(self, table_name: str = None) -> None:
        """
        ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖŸÜ ÿ¨ÿØŸàŸÑ ÿßŸÑŸÉÿßÿ¥ ÿßŸÑŸÖÿ≠ÿØÿØ.
        :param table_name: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ (None = ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉŸÑ)
        """
        if not self._conn:
            logger.warning("DatabaseManager: ŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ≥ÿ≠ ÿßŸÑŸÉÿßÿ¥ ŸÇÿ®ŸÑ Ÿàÿ¨ŸàÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.")
            return

        try:
            with self._lock:
                cursor = self._conn.cursor()

                if table_name == "Users":
                    cursor.execute("DELETE FROM users_cache;")
                elif table_name == "List V2":
                    cursor.execute("DELETE FROM bookings_cache;")
                elif table_name is None:
                    # ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¨ÿØÿßŸàŸÑ
                    cursor.execute("DELETE FROM users_cache;")
                    cursor.execute("DELETE FROM bookings_cache;")
                    cursor.execute("DELETE FROM records_cache;")
                else:
                    cursor.execute("DELETE FROM records_cache WHERE table_name = ?;", (table_name,))

                self._conn.commit()
            logger.info(f"DatabaseManager: ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ (ÿ¨ÿØŸàŸÑ: {table_name or 'ÿßŸÑŸÉŸÑ'}).")
        except Exception as exc:
            logger.error(f"DatabaseManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ŸÖÿ≥ÿ≠ ÿßŸÑŸÉÿßÿ¥: {exc}", exc_info=True)

    def delete_cached_record(self, record_id: str, table_name: str = None) -> bool:
        """
        ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ŸÖÿ≠ÿØÿØ ŸÖŸÜ ÿ¨ÿØŸàŸÑ ÿßŸÑŸÉÿßÿ¥.
        :param record_id: ŸÖÿπÿ±ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ±ÿßÿØ ÿ≠ÿ∞ŸÅŸá.
        :param table_name: ÿßÿ≥ŸÖ ÿßŸÑÿ¨ÿØŸàŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        :return: True ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠ÿå False ÿÆŸÑÿßŸÅ ÿ∞ŸÑŸÉ.
        """
        if not self._conn:
            logger.warning("DatabaseManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ŸÇÿ®ŸÑ Ÿàÿ¨ŸàÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.")
            return False

        try:
            with self._lock:
                cursor = self._conn.cursor()

                # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® Ÿàÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ
                if table_name == "Users":
                    cursor.execute("DELETE FROM users_cache WHERE id = ?;", (record_id,))
                elif table_name == "List V2":
                    cursor.execute("DELETE FROM bookings_cache WHERE id = ?;", (record_id,))
                else:
                    cursor.execute("DELETE FROM records_cache WHERE id = ?;", (record_id,))

                self._conn.commit()

                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ ÿ™ŸÖ ÿ≠ÿ∞ŸÅŸá ŸÅÿπŸÑÿßŸã
                if cursor.rowcount > 0:
                    logger.debug(f"DatabaseManager: ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ (ÿ¨ÿØŸàŸÑ: {table_name}).")
                    return True
                else:
                    logger.debug(f"DatabaseManager: ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã ŸÅŸä ÿßŸÑŸÉÿßÿ¥.")
                    return False

        except Exception as exc:
            logger.error(f"DatabaseManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ '{record_id}' ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥: {exc}", exc_info=True)
            return False

    def close(self) -> None:
        """
        ÿ•ÿ∫ŸÑÿßŸÇ ÿßÿ™ÿµÿßŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.
        """
        if self._conn:
            try:
                self._conn.close()
                logger.info("DatabaseManager: ÿ™ŸÖ ÿ•ÿ∫ŸÑÿßŸÇ ÿßÿ™ÿµÿßŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.")
            except Exception as exc:
                logger.error(f"DatabaseManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∫ŸÑÿßŸÇ ÿßÿ™ÿµÿßŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: {exc}", exc_info=True)
            finally:
                self._conn = None

============================================================
FILE: core\event_system.py
SIZE: 1015 characters
============================================================

# core/event_system.py
from typing import Callable, Dict, List, Any
import threading
from datetime import datetime
import queue

class EventBus:
    """ŸÜÿßŸÇŸÑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿä"""

    def __init__(self):
        self._subscribers: Dict[str, List[Callable]] = {}
        self._lock = threading.Lock()

    def emit(self, event_name: str, data: Any = None):
        """ÿ•ÿ∑ŸÑÿßŸÇ ÿ≠ÿØÿ´"""
        subscribers = self._subscribers.get(event_name, [])
        for callback in subscribers:
            try:
                threading.Thread(
                    target=lambda: callback(data),
                    daemon=True
                ).start()
            except Exception as e:
                print(f"Error in event callback: {e}")

    def subscribe(self, event_name: str, callback: Callable):
        """ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ ŸÅŸä ÿ≠ÿØÿ´"""
        with self._lock:
            if event_name not in self._subscribers:
                self._subscribers[event_name] = []
            self._subscribers[event_name].append(callback)

============================================================
FILE: core\language_manager.py
SIZE: 6614 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/language_manager.py

ÿ™ÿØŸäÿ± Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ¶ÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™ (locale) ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑÿ∫ÿ© (ÿπÿ±ÿ®Ÿä ÿ£Ÿà ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä).
ÿ™ÿπÿ™ŸÖÿØ ÿπŸÑŸâ ŸÖŸÑŸÅÿßÿ™ YAML ÿØÿßÿÆŸÑ ŸÖÿ¨ŸÑÿØ locales/ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠.
ŸäŸÖŸÉŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿØŸàŸÜ ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑŸá.
"""

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥Ÿäÿ©
# ------------------------------------------------------------
import os
from typing import Any, Dict

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ©
# ------------------------------------------------------------
import yaml

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ Ÿàÿ≠ÿØÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
# ------------------------------------------------------------
from core.config_manager import ConfigManager
from core.logger import logger


class LanguageManager:
    """
    ŸÅÿ¶ÿ© LanguageManager ŸÖÿ≥ÿ§ŸàŸÑÿ© ÿπŸÜ:
    - ŸÇÿ±ÿßÿ°ÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸÖŸÜ ConfigManager.
    - ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ® (ar.yaml ÿ£Ÿà en.yaml) ÿ•ŸÑŸâ ŸÇÿßŸÖŸàÿ≥ ÿØÿßÿÆŸÑŸä.
    - ÿ™ŸàŸÅŸäÿ± Ÿàÿßÿ¨Ÿáÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸÅÿ™ÿßÿ≠ (text key).
    - ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© Ÿàÿ™ÿ≠ÿØŸäÿ´ ConfigManager Ÿàÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™.
    """

    def __init__(self, config_manager: ConfigManager) -> None:
        """
        ÿ™ŸáŸäÿ¶ÿ© LanguageManager.
        :param config_manager: ŸÉÿßÿ¶ŸÜ ConfigManager ŸÑŸÇÿ±ÿßÿ°ÿ©/ÿ™ÿπÿØŸäŸÑ ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÑÿ∫ÿ© ŸÅŸä ŸÖŸÑŸÅ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™.
        """
        self.config_manager = config_manager

        # ÿßŸÅÿ™ÿ±ÿßÿ∂ ÿ£ŸÜ ConfigManager ŸÑÿØŸäŸá ÿØÿßŸÑÿ© get() ÿ£Ÿà get_config()
        try:
            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÑÿ∫ÿ© ŸÖŸÜ ConfigManager
            self.current_lang: str = self.config_manager.get("language", "en")
        except AttributeError:
            try:
                # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ®ÿØŸäŸÑÿ©
                config_data = self.config_manager.get_config()
                self.current_lang: str = config_data.get("language", "en")
            except:
                # ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
                self.current_lang: str = "en"

        self.translations: Dict[str, Any] = {}
        self._load_translations()

    def _load_translations(self) -> None:
        """
        ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ self.current_lang ÿ•ŸÑŸâ ÿßŸÑŸÇÿßŸÖŸàÿ≥ self.translations.
        Ÿäÿ™ŸàŸÇÿπ Ÿàÿ¨ŸàÿØ ŸÖŸÑŸÅ ÿ∂ŸÖŸÜ ŸÖÿ¨ŸÑÿØ "locales" ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ "<lang>.yaml"ÿå ŸÖÿ´ŸÑ "ar.yaml" ÿ£Ÿà "en.yaml".
        """
        lang_code = self.current_lang.lower()
        locales_dir = os.path.join("locales")
        file_name = f"{lang_code}.yaml"
        file_path = os.path.join(locales_dir, file_name)

        if not os.path.isdir(locales_dir):
            logger.warning(f"LanguageManager: ŸÖÿ¨ŸÑÿØ 'locales/' ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ. ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™.")
            self.translations = {}
            return

        if not os.path.isfile(file_path):
            logger.error(f"LanguageManager: ŸÖŸÑŸÅ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© '{file_path}' ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ. ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© (ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©).")
            self.translations = {}
            return

        try:
            with open(file_path, "r", encoding="utf-8") as f:
                self.translations = yaml.safe_load(f) or {}
            logger.info(f"LanguageManager: ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™ ŸÖŸÜ '{file_path}'.")
        except Exception as exc:
            logger.error(f"LanguageManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ŸÇÿ±ÿßÿ°ÿ© ŸÖŸÑŸÅ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© '{file_path}': {exc}", exc_info=True)
            self.translations = {}

    def get(self, key: str, default: str = "") -> str:
        """
        ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖ ŸÑŸÑŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸÖÿ≠ÿØÿØ.
        ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠ ŸÖŸàÿ¨ŸàÿØŸãÿß ŸÅŸä ÿßŸÑŸÇÿßŸÖŸàÿ≥ÿå ŸäŸèÿπÿßÿØ default.

        :param key: ÿßŸÑŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸÜÿµŸä ŸÉŸÖÿß ŸáŸà ŸÖŸàÿ¨ŸàÿØ ŸÅŸä ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© YAML.
        :param default: ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿπÿ´ÿ± ÿπŸÑŸâ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠.
        :return: ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖ (ÿ£Ÿà default).
        """
        # ŸÅŸä ÿ≠ÿßŸÑÿ© Ÿàÿ¨ŸàÿØ ÿ™ÿπÿ¥Ÿäÿ¥ ŸÅŸä ŸÖŸÑŸÅÿßÿ™ YAML ÿ™ŸÉŸàŸÜ ÿßŸÑŸÇŸäŸÖ ŸÇÿØ ÿ™ŸÉŸàŸÜ dictÿõ ŸàŸÑŸÉŸÜ ŸáŸÜÿß ŸÜÿ™ŸàŸÇÿπ ŸÇŸäŸÖÿ© ŸÜÿµŸäÿ© ŸÑŸÉŸÑ ŸÖŸÅÿ™ÿßÿ≠.
        value = self.translations.get(key)
        if isinstance(value, str):
            return value
        elif value is None:
            return default
        else:
            # ŸÅŸä ÿ≠ÿßŸÑ ŸÉÿßŸÜ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠ Ÿäÿ¥Ÿäÿ± ÿ•ŸÑŸâ ŸáŸäŸÉŸÑ ŸÖÿπŸÇÿØ (ÿ∫Ÿäÿ± ŸÜÿµ ŸÖÿ®ÿßÿ¥ÿ±ÿ©)ÿå ŸÜÿ≠ŸàŸÑŸá ÿ•ŸÑŸâ ŸÜÿµ
            try:
                return str(value)
            except Exception:
                return default

    def set_language(self, lang_code: str) -> None:
        """
        ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿ•ŸÑŸâ lang_code (ŸÖÿ´ŸÑ "ar" ÿ£Ÿà "en").
        Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ConfigManager Ÿàÿ≠ŸÅÿ∏Ÿáÿå ÿ´ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©.

        :param lang_code: ÿ±ŸÖÿ≤ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ¨ÿØŸäÿØ.
        """
        try:
            lang_code = lang_code.lower()
            previous = self.current_lang
            if lang_code == previous:
                logger.debug(f"LanguageManager: ÿßŸÑŸÑÿ∫ÿ© '{lang_code}' ŸáŸä ŸÜŸÅÿ≥Ÿáÿß ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©ÿõ ŸÑÿß ÿ™ÿ∫ŸäŸäÿ±.")
                return

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ Ÿàÿ≠ŸÅÿ∏Ÿáÿß
            self.current_lang = lang_code

            # ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑÿÆÿ∑ÿ£: ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ self.config_manager ÿ®ÿØŸÑÿßŸã ŸÖŸÜ self.config
            if hasattr(self.config_manager, 'set'):
                self.config_manager.set("language", lang_code)
            elif hasattr(self.config_manager, 'update_config'):
                self.config_manager.update_config({"language": lang_code})
            else:
                logger.warning(f"LanguageManager: ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÑÿ∫ÿ©. ConfigManager ŸÑÿß Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿØÿßŸÑÿ© set() ÿ£Ÿà update_config().")

            logger.info(f"LanguageManager: ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ŸÖŸÜ '{previous}' ÿ•ŸÑŸâ '{lang_code}'. ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™.")
            self._load_translations()

        except Exception as exc:
            logger.error(f"LanguageManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ÿ•ŸÑŸâ '{lang_code}': {exc}", exc_info=True)
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£ÿå ŸÜÿ≠ÿßŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™ ŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            self._load_translations()

    def reload(self) -> None:
        """
        ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ self.current_lang ÿßŸÑÿ≠ÿßŸÑŸäÿ©.
        ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿØÿπÿßÿ§Ÿá ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ŸäÿØŸàŸäŸãÿß ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.
        """
        try:
            logger.debug("LanguageManager: ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™.")
            self._load_translations()
        except Exception as exc:
            logger.error(f"LanguageManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™: {exc}", exc_info=True)

    def get_current_language(self) -> str:
        """
        ÿ•ÿ±ÿ¨ÿßÿπ ÿ±ŸÖÿ≤ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©.
        :return: ÿ±ŸÖÿ≤ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© (ŸÖÿ´ŸÑ "ar" ÿ£Ÿà "en").
        """
        return self.current_lang

    def is_rtl(self) -> bool:
        """
        ÿ™ÿ≠ÿØŸäÿØ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿ™ŸèŸÉÿ™ÿ® ŸÖŸÜ ÿßŸÑŸäŸÖŸäŸÜ ÿ•ŸÑŸâ ÿßŸÑŸäÿ≥ÿßÿ±.
        :return: True ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©ÿå False ŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑÿ£ÿÆÿ±Ÿâ.
        """
        return self.current_lang.lower() in ["ar", "arabic", "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"]

============================================================
FILE: core\logger.py
SIZE: 2118 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/logger.py

ÿ™ŸèÿπÿØ Ÿáÿ∞Ÿá ÿßŸÑŸàÿ≠ÿØÿ© ŸÖÿ≥ÿ§ŸàŸÑÿ©Ÿã ÿπŸÜ ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿØŸàŸäŸÜ (logging) ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.
ÿ™ÿ≥ÿ™ÿÆÿØŸÖ RotatingFileHandler ŸÑÿ™ŸÇÿ≥ŸäŸÖ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ≥ÿ¨ŸÑ (log files) ÿπŸÜÿØ ÿ®ŸÑŸàÿ∫ ÿ≠ÿ¨ŸÖ ŸÖÿ≠ÿØÿØ.
"""

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥Ÿäÿ©
# ------------------------------------------------------------
import logging
from logging.handlers import RotatingFileHandler
import os

# ------------------------------------------------------------
# ÿ•ÿπÿØÿßÿØ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿ± ŸàÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™
# ------------------------------------------------------------
LOG_DIR = "logs"
LOG_FILE = "app.log"
MAX_BYTES = 5 * 1024 * 1024   # 5 ŸÖŸäÿ∫ÿßÿ®ÿßŸäÿ™ ŸÑŸÉŸÑ ŸÖŸÑŸÅ ÿ≥ÿ¨ŸÑ
BACKUP_COUNT = 3              # ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿ´ŸÑÿßÿ´ ŸÜÿ≥ÿÆ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©

# ------------------------------------------------------------
# ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖÿ¨ŸÑÿØ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
# ------------------------------------------------------------
if not os.path.isdir(LOG_DIR):
    try:
        os.makedirs(LOG_DIR, exist_ok=True)
    except Exception:
        # ŸÅŸä ÿ≠ÿßŸÑ ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ÿå ŸÜÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑÿ≠ÿßŸÑŸä ÿ®ÿØŸÑŸãÿß ŸÖŸÜŸá
        LOG_DIR = "."
        # ŸÑÿß ŸÜÿπÿßŸÑÿ¨ ÿßŸÑÿÆÿ∑ÿ£ ŸáŸÜÿß ŸÑÿ£ŸÜŸá Ÿäÿ≠ÿØÿ´ ŸÇÿ®ŸÑ ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÄlogger ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
# ------------------------------------------------------------
# ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÄLogger ÿßŸÑÿπÿßŸÖ
# ------------------------------------------------------------
logger = logging.getLogger("fts_sales_manager")
logger.setLevel(logging.DEBUG)  # ÿ≥ÿ¨ŸÑ ŸÉÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿ®ÿØÿ°Ÿãÿß ŸÖŸÜ DEBUG

# ÿ™ŸÜÿ≥ŸäŸÇ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ≥ÿ¨ŸÑ
formatter = logging.Formatter(
    "%(asctime)s [%(levelname)s] %(name)s: %(message)s",
    datefmt="%Y-%m-%d %H:%M:%S"
)

# ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿØŸàŸäÿ± ÿßŸÑŸÖŸÑŸÅÿßÿ™ (RotatingFileHandler)
file_path = os.path.join(LOG_DIR, LOG_FILE)
file_handler = RotatingFileHandler(
    filename=file_path,
    maxBytes=MAX_BYTES,
    backupCount=BACKUP_COUNT,
    encoding="utf-8"
)
file_handler.setLevel(logging.INFO)
file_handler.setFormatter(formatter)
logger.addHandler(file_handler)

# ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ∑ÿ®ÿßÿπÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© (StreamHandler) ŸÑŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿ∑ŸàŸäÿ±Ÿäÿ©
stream_handler = logging.StreamHandler()
stream_handler.setLevel(logging.DEBUG)
stream_handler.setFormatter(formatter)
logger.addHandler(stream_handler)


============================================================
FILE: core\permissions.py
SIZE: 5411 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/permissions.py

ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
Ÿäÿ≠ÿØÿØ ŸÖÿß ŸäŸÖŸÉŸÜ ŸÑŸÉŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÇŸäÿßŸÖ ÿ®Ÿá ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
"""

from typing import List, Set
from functools import wraps
from tkinter import messagebox
from core.logger import logger


class Permission:
    """ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
    VIEW_ALL = "view_all"
    CREATE_SALES = "create_sales"
    EDIT_SALES = "edit_sales"
    DELETE_SALES = "delete_sales"
    MANAGE_USERS = "manage_users"
    EXPORT_DATA = "export_data"
    VIEW_REPORTS = "view_reports"
    SETTINGS = "settings"


class PermissionManager:
    """
    ŸÖÿØŸäÿ± ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ - Ÿäÿ≠ÿØÿØ ŸàŸäÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
    """

    def __init__(self):
        """ÿ™ŸáŸäÿ¶ÿ© ŸÖÿØŸäÿ± ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™"""
        self.current_user_id: str = ""
        self.current_user_permissions: Set[str] = set()

    def set_current_user(self, user_id: str, permissions: List[str]) -> None:
        """
        ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸàÿµŸÑÿßÿ≠Ÿäÿßÿ™Ÿá

        :param user_id: ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        :param permissions: ŸÇÿßÿ¶ŸÖÿ© ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        """
        self.current_user_id = user_id
        self.current_user_permissions = set(permissions)

        logger.info(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ {user_id} ÿ®ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™: {permissions}")

    def has_permission(self, permission: str) -> bool:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÖÿπŸäŸÜÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ

        :param permission: ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜŸáÿß
        :return: True ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸäŸÖŸÑŸÉ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
        """
        return permission in self.current_user_permissions

    def check_permission(self, permission: str, show_message: bool = True) -> bool:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ© ŸÖÿπ ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿ±ŸÅÿ∂

        :param permission: ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
        :param show_message: ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿµŸÑÿßÿ≠Ÿäÿ©
        :return: True ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸäŸÖŸÑŸÉ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
        """
        if self.has_permission(permission):
            return True

        if show_message:
            permission_names = {
                Permission.VIEW_ALL: "ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™",
                Permission.CREATE_SALES: "ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑÿßÿ™ ÿ¨ÿØŸäÿØÿ©",
                Permission.EDIT_SALES: "ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™",
                Permission.DELETE_SALES: "ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™",
                Permission.MANAGE_USERS: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ",
                Permission.EXPORT_DATA: "ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                Permission.VIEW_REPORTS: "ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±",
                Permission.SETTINGS: "ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
            }

            permission_name = permission_names.get(permission, permission)

            messagebox.showerror(
                "ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿµŸÑÿßÿ≠Ÿäÿ©",
                f"ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿµŸÑÿßÿ≠Ÿäÿ©: {permission_name}"
            )

        logger.warning(
            f"ŸÖÿ≠ÿßŸàŸÑÿ© ŸàÿµŸàŸÑ ÿ∫Ÿäÿ± ŸÖÿµÿ±ÿ≠: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ {self.current_user_id} "
            f"ÿ≠ÿßŸàŸÑ {permission}"
        )

        return False

    def get_user_permissions(self) -> Set[str]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä

        :return: ŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™
        """
        return self.current_user_permissions.copy()

    def can_user_modify_record(self, record_owner_id: str = None) -> bool:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿ™ÿπÿØŸäŸÑ ÿ≥ÿ¨ŸÑ

        :param record_owner_id: ŸÖÿπÿ±ŸÅ ŸÖÿßŸÑŸÉ ÿßŸÑÿ≥ÿ¨ŸÑ (ÿ∫Ÿäÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ≠ÿßŸÑŸäÿßŸã)
        :return: True ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿπÿØŸäŸÑ
        """
        return self.has_permission(Permission.EDIT_SALES)

    def can_user_delete_record(self) -> bool:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ

        :return: True ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸäŸÖŸÉŸÜ ÿßŸÑÿ≠ÿ∞ŸÅ
        """
        return self.has_permission(Permission.DELETE_SALES)


# Singleton instance
permission_manager = PermissionManager()


def require_permission(permission: str):
    """
    Decorator ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ŸÇÿ®ŸÑ ÿ™ŸÜŸÅŸäÿ∞ ÿØÿßŸÑÿ©

    ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ:
    @require_permission(Permission.DELETE_SALES)
    def delete_record(self):
        # ŸÉŸàÿØ ÿßŸÑÿ≠ÿ∞ŸÅ
    """
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            if permission_manager.check_permission(permission):
                return func(*args, **kwargs)
            # ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸáŸÜÿßŸÉ ÿµŸÑÿßÿ≠Ÿäÿ©ÿå ŸÑÿß ÿ™ŸÜŸÅÿ∞ ÿßŸÑÿØÿßŸÑÿ©
            return None
        return wrapper
    return decorator


# ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ≥ÿ±Ÿäÿπ
def can_view_all() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"""
    return permission_manager.has_permission(Permission.VIEW_ALL)

def can_create() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°"""
    return permission_manager.has_permission(Permission.CREATE_SALES)

def can_edit() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ™ÿπÿØŸäŸÑ"""
    return permission_manager.has_permission(Permission.EDIT_SALES)

def can_delete() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ≠ÿ∞ŸÅ"""
    return permission_manager.has_permission(Permission.DELETE_SALES)

def can_export() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ™ÿµÿØŸäÿ±"""
    return permission_manager.has_permission(Permission.EXPORT_DATA)

def can_manage_users() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"""
    return permission_manager.has_permission(Permission.MANAGE_USERS)

def can_view_reports() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±"""
    return permission_manager.has_permission(Permission.VIEW_REPORTS)

def can_change_settings() -> bool:
    """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
    return permission_manager.has_permission(Permission.SETTINGS)

============================================================
FILE: core\session_manager.py
SIZE: 14093 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/session_manager.py

ŸÖÿØŸäÿ± ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™
Session Manager
"""

import secrets
import json
import os
from datetime import datetime, timedelta
from typing import Dict, Optional, List
import threading
import time

from core.logger import logger
from core.security.encryption import EncryptionManager


class SessionManager:
    """ŸÖÿØŸäÿ± ÿ¨ŸÑÿ≥ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"""

    def __init__(
        self,
        session_timeout: int = 1800,  # 30 minutes
        max_sessions_per_user: int = 5,
        enable_encryption: bool = True,
        storage_path: str = "data/sessions"
    ):
        """
        Initialize session manager

        Args:
            session_timeout: Session timeout in seconds
            max_sessions_per_user: Maximum concurrent sessions per user
            enable_encryption: Enable session data encryption
            storage_path: Path to store session data
        """
        self.session_timeout = session_timeout
        self.max_sessions_per_user = max_sessions_per_user
        self.enable_encryption = enable_encryption
        self.storage_path = storage_path

        # Storage
        self.sessions: Dict[str, dict] = {}
        self._lock = threading.RLock()

        # Encryption
        if self.enable_encryption:
            self.encryption = EncryptionManager()

        # Create storage directory
        os.makedirs(self.storage_path, exist_ok=True)

        # Load existing sessions
        self._load_sessions()

        # Start cleanup thread
        self._start_cleanup_thread()

    def create_session(
        self,
        user_info: dict,
        ip_address: Optional[str] = None,
        user_agent: Optional[str] = None
    ) -> str:
        """
        Create new session

        Args:
            user_info: User information dictionary
            ip_address: Client IP address
            user_agent: Client user agent

        Returns:
            Session ID
        """
        with self._lock:
            # Generate session ID
            session_id = secrets.token_urlsafe(32)

            # Check concurrent sessions
            username = user_info.get('username')
            if username:
                self._check_concurrent_sessions(username)

            # Create session data
            session_data = {
                'id': session_id,
                'user': user_info,
                'created_at': datetime.now().isoformat(),
                'last_activity': datetime.now().isoformat(),
                'expires_at': (datetime.now() + timedelta(seconds=self.session_timeout)).isoformat(),
                'ip_address': ip_address,
                'user_agent': user_agent,
                'active': True,
                'activity_count': 0
            }

            # Store session
            self.sessions[session_id] = session_data

            # Save to disk
            self._save_session(session_id, session_data)

            logger.info(f"Session created for user: {username} (ID: {session_id[:8]}...)")

            return session_id

    def validate_session(self, session_id: str) -> Optional[dict]:
        """
        Validate session

        Args:
            session_id: Session ID to validate

        Returns:
            Session data if valid, None otherwise
        """
        with self._lock:
            session = self.sessions.get(session_id)

            if not session:
                # Try loading from disk
                session = self._load_session(session_id)
                if session:
                    self.sessions[session_id] = session

            if not session:
                return None

            # Check if active
            if not session.get('active', False):
                logger.warning(f"Inactive session: {session_id[:8]}...")
                return None

            # Check expiration
            expires_at = datetime.fromisoformat(session['expires_at'])
            if datetime.now() > expires_at:
                logger.warning(f"Expired session: {session_id[:8]}...")
                self.invalidate_session(session_id)
                return None

            # Update last activity
            session['last_activity'] = datetime.now().isoformat()
            session['activity_count'] = session.get('activity_count', 0) + 1

            # Extend session if active
            session['expires_at'] = (datetime.now() + timedelta(seconds=self.session_timeout)).isoformat()

            # Save updated session
            self._save_session(session_id, session)

            return session

    def invalidate_session(self, session_id: str) -> bool:
        """
        Invalidate session

        Args:
            session_id: Session ID to invalidate

        Returns:
            True if successful
        """
        with self._lock:
            if session_id in self.sessions:
                session = self.sessions[session_id]
                session['active'] = False
                session['invalidated_at'] = datetime.now().isoformat()

                # Save to disk
                self._save_session(session_id, session)

                # Remove from memory
                del self.sessions[session_id]

                username = session.get('user', {}).get('username', 'Unknown')
                logger.info(f"Session invalidated for user: {username}")

                return True

            return False

    def get_user_sessions(self, username: str) -> List[dict]:
        """
        Get all sessions for a user

        Args:
            username: Username

        Returns:
            List of active sessions
        """
        with self._lock:
            user_sessions = []

            for session_id, session in self.sessions.items():
                if session.get('user', {}).get('username') == username and session.get('active'):
                    user_sessions.append({
                        'id': session_id,
                        'created_at': session['created_at'],
                        'last_activity': session['last_activity'],
                        'ip_address': session.get('ip_address'),
                        'user_agent': session.get('user_agent')
                    })

            return sorted(user_sessions, key=lambda x: x['created_at'], reverse=True)

    def invalidate_user_sessions(self, username: str, except_session: Optional[str] = None) -> int:
        """
        Invalidate all sessions for a user

        Args:
            username: Username
            except_session: Session ID to keep active

        Returns:
            Number of sessions invalidated
        """
        with self._lock:
            count = 0

            for session_id in list(self.sessions.keys()):
                session = self.sessions.get(session_id)
                if session and session.get('user', {}).get('username') == username:
                    if session_id != except_session:
                        self.invalidate_session(session_id)
                        count += 1

            logger.info(f"Invalidated {count} sessions for user: {username}")
            return count

    def extend_session(self, session_id: str, duration: Optional[int] = None) -> bool:
        """
        Extend session timeout

        Args:
            session_id: Session ID
            duration: Extension duration in seconds (default: session_timeout)

        Returns:
            True if successful
        """
        with self._lock:
            session = self.validate_session(session_id)

            if session:
                duration = duration or self.session_timeout
                session['expires_at'] = (datetime.now() + timedelta(seconds=duration)).isoformat()
                self._save_session(session_id, session)
                return True

            return False

    def get_session_info(self, session_id: str) -> Optional[dict]:
        """
        Get session information

        Args:
            session_id: Session ID

        Returns:
            Session info dictionary
        """
        session = self.validate_session(session_id)

        if session:
            return {
                'id': session_id,
                'username': session.get('user', {}).get('username'),
                'created_at': session['created_at'],
                'last_activity': session['last_activity'],
                'expires_at': session['expires_at'],
                'activity_count': session.get('activity_count', 0),
                'ip_address': session.get('ip_address'),
                'active': session.get('active', False)
            }

        return None

    def cleanup_expired_sessions(self):
        """Clean up expired sessions"""
        with self._lock:
            now = datetime.now()
            expired = []

            for session_id, session in self.sessions.items():
                expires_at = datetime.fromisoformat(session['expires_at'])
                if now > expires_at:
                    expired.append(session_id)

            for session_id in expired:
                self.invalidate_session(session_id)

            if expired:
                logger.info(f"Cleaned up {len(expired)} expired sessions")

    def _check_concurrent_sessions(self, username: str):
        """Check and limit concurrent sessions"""
        user_sessions = self.get_user_sessions(username)

        if len(user_sessions) >= self.max_sessions_per_user:
            # Remove oldest session
            oldest = user_sessions[-1]
            self.invalidate_session(oldest['id'])
            logger.warning(f"Removed oldest session for user: {username} (limit: {self.max_sessions_per_user})")

    def _save_session(self, session_id: str, session_data: dict):
        """Save session to disk"""
        try:
            filename = os.path.join(self.storage_path, f"{session_id}.json")

            # Prepare data
            data = json.dumps(session_data, ensure_ascii=False)

            # Encrypt if enabled
            if self.enable_encryption:
                data = self.encryption.encrypt_data(data)
                save_data = {"encrypted": True, "data": data}
            else:
                save_data = session_data

            # Write to file
            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(save_data, f, ensure_ascii=False, indent=2)

        except Exception as e:
            logger.error(f"Error saving session: {e}")

    def _load_session(self, session_id: str) -> Optional[dict]:
        """Load session from disk"""
        try:
            filename = os.path.join(self.storage_path, f"{session_id}.json")

            if not os.path.exists(filename):
                return None

            with open(filename, 'r', encoding='utf-8') as f:
                save_data = json.load(f)

            # Decrypt if needed
            if save_data.get("encrypted") and self.enable_encryption:
                decrypted = self.encryption.decrypt_data(save_data["data"])
                session_data = json.loads(decrypted)
            else:
                session_data = save_data

            return session_data

        except Exception as e:
            logger.error(f"Error loading session: {e}")
            return None

    def _load_sessions(self):
        """Load all sessions from disk"""
        try:
            if not os.path.exists(self.storage_path):
                return

            for filename in os.listdir(self.storage_path):
                if filename.endswith('.json'):
                    session_id = filename[:-5]  # Remove .json
                    session = self._load_session(session_id)

                    if session and session.get('active'):
                        # Check if not expired
                        expires_at = datetime.fromisoformat(session['expires_at'])
                        if datetime.now() <= expires_at:
                            self.sessions[session_id] = session

        except Exception as e:
            logger.error(f"Error loading sessions: {e}")

    def _start_cleanup_thread(self):
        """Start background cleanup thread"""
        def cleanup_loop():
            while True:
                try:
                    time.sleep(300)  # Run every 5 minutes
                    self.cleanup_expired_sessions()
                except Exception as e:
                    logger.error(f"Cleanup thread error: {e}")

        thread = threading.Thread(target=cleanup_loop, daemon=True)
        thread.start()

    def get_statistics(self) -> dict:
        """
        Get session statistics

        Returns:
            Statistics dictionary
        """
        with self._lock:
            total_sessions = len(self.sessions)

            # Count by user
            users = {}
            for session in self.sessions.values():
                username = session.get('user', {}).get('username', 'Unknown')
                users[username] = users.get(username, 0) + 1

            return {
                'total_active_sessions': total_sessions,
                'unique_users': len(users),
                'sessions_per_user': users,
                'session_timeout': self.session_timeout,
                'max_sessions_per_user': self.max_sessions_per_user
            }

============================================================
FILE: core\state_manager.py
SIZE: 2557 characters
============================================================

# core/state_manager.py
from dataclasses import dataclass, field
from typing import List, Dict, Any, Optional, Callable
from datetime import datetime
import threading

@dataclass
class WindowState:
    """ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"""
    all_records: List[Dict[str, Any]] = field(default_factory=list)
    filtered_records: List[Dict[str, Any]] = field(default_factory=list)
    selected_records: List[Dict[str, Any]] = field(default_factory=list)
    current_page: int = 1
    records_per_page: int = 50
    is_loading: bool = False
    last_refresh: Optional[datetime] = None
    search_query: str = ""
    sort_column: Optional[str] = None
    sort_order: str = "asc"

    def reset_selection(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ"""
        self.selected_records.clear()

    def update_records(self, records: List[Dict[str, Any]]):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"""
        self.all_records = records
        self.filtered_records = records
        self.last_refresh = datetime.now()

    def get_selected_count(self) -> int:
        """ÿπÿØÿØ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ©"""
        return len(self.selected_records)

class StateManager:
    """ŸÖÿØŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿä"""

    def __init__(self):
        self._states: Dict[str, Any] = {}
        self._lock = threading.Lock()
        self._observers: Dict[str, List[Callable]] = {}

    def register_state(self, name: str, state: Any):
        """ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿßŸÑÿ© ÿ¨ÿØŸäÿØÿ©"""
        with self._lock:
            self._states[name] = state

    def get_state(self, name: str) -> Any:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿßŸÑÿ©"""
        with self._lock:
            return self._states.get(name)

    def update_state(self, name: str, updates: Dict[str, Any]):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ©"""
        with self._lock:
            state = self._states.get(name)
            if state:
                for key, value in updates.items():
                    if hasattr(state, key):
                        setattr(state, key, value)
                self._notify_observers(name, state)

    def subscribe(self, state_name: str, callback: Callable):
        """ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑÿ©"""
        if state_name not in self._observers:
            self._observers[state_name] = []
        self._observers[state_name].append(callback)

    def _notify_observers(self, state_name: str, state: Any):
        """ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑŸÖÿ±ÿßŸÇÿ®ŸäŸÜ ÿ®ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™"""
        for callback in self._observers.get(state_name, []):
            try:
                callback(state)
            except Exception as e:
                print(f"Error notifying observer: {e}")

============================================================
FILE: core\theme_color_manager.py
SIZE: 14000 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/theme_color_manager.py

ŸÜÿ∏ÿßŸÖ ÿ´ŸäŸÖ ŸÖŸàÿ≠ÿØ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞
Ÿäÿ¨ŸÖÿπ ÿ®ŸäŸÜ ÿßŸÑŸÖÿ±ŸàŸÜÿ© ŸàÿßŸÑŸÖŸàÿ´ŸàŸÇŸäÿ© ŸàÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©
ŸÖÿπ ÿØÿπŸÖ ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ© (readonly fields)
"""

import customtkinter as ctk
from typing import Dict, Optional, Any
from core.logger import logger

class ThemeColorManager:
    """ŸÖÿØŸäÿ± ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ"""

    def __init__(self, theme_manager=None):
        self.theme_manager = theme_manager
        self._color_cache = {}
        self._load_color_palettes()

    def _load_color_palettes(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ŸÑŸàÿ≠ÿßÿ™ ÿßŸÑÿ£ŸÑŸàÿßŸÜ"""
        try:
            from config.modern_color_palettes import get_color_palette, get_available_palettes
            self._has_palettes = True
            self._get_color_palette = get_color_palette
            self._get_available_palettes = get_available_palettes
        except ImportError:
            self._has_palettes = False
            logger.debug("Modern color palettes not available")

    def get_current_colors(self) -> Dict[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑŸäÿ©"""
        mode = self._get_appearance_mode()
        palette_key = self._get_current_palette_key(mode)

        if self._has_palettes:
            try:
                return self._get_color_palette(palette_key)
            except Exception as e:
                logger.warning(f"Error loading palette {palette_key}: {e}")

        return self._get_default_colors(mode)

    def _get_appearance_mode(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ∏Ÿáÿ± ÿßŸÑÿ≠ÿßŸÑŸä"""
        if self.theme_manager:
            try:
                if hasattr(self.theme_manager, 'get_current_appearance_mode'):
                    return self.theme_manager.get_current_appearance_mode()
                elif hasattr(self.theme_manager, 'current_mode'):
                    return self.theme_manager.current_mode
            except:
                pass

        # ÿßŸÑÿ≠ÿµŸàŸÑ ŸÖŸÜ customtkinter ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        try:
            return ctk.get_appearance_mode().lower()
        except:
            return "light"

    def _get_current_palette_key(self, mode: str) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÅÿ™ÿßÿ≠ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑŸäÿ©"""
        if mode == "dark":
            return "modern_dark"

        # ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠ÿå ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏
        if self.theme_manager and hasattr(self.theme_manager, 'config'):
            try:
                return self.theme_manager.config.get('light_color_palette', 'modern_purple')
            except:
                pass

        return "modern_purple"

    def _get_default_colors(self, mode: str) -> Dict[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
        if mode == "dark":
            return {
                'primary': '#5B5FFF',
                'primary_hover': '#4B4FEF',
                'secondary': '#6B7280',
                'success': '#10B981',
                'danger': '#F43F5E',
                'danger_hover': '#E11D48',
                'warning': '#F59E0B',
                'background': '#1a1a1a',
                'surface': '#2b2b2b',
                'input_bg': '#374151',
                'input_border': '#4B5563',
                'input_focus': '#5B5FFF',
                'border': '#374151',
                'text_primary': '#F9FAFB',
                'text_secondary': '#D1D5DB',
                'shadow': 'rgba(0, 0, 0, 0.25)',
                # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                'readonly_bg': '#1f2937',
                'readonly_border': '#374151',
                'readonly_text': '#9CA3AF'
            }
        else:
            return {
                'primary': '#5B5FFF',
                'primary_hover': '#4B4FEF',
                'secondary': '#6B7280',
                'success': '#10B981',
                'danger': '#F43F5E',
                'danger_hover': '#E11D48',
                'warning': '#F59E0B',
                'background': '#F9FAFB',
                'surface': '#FFFFFF',
                'input_bg': '#F3F4F6',
                'input_border': '#D1D5DB',
                'input_focus': '#5B5FFF',
                'border': '#E5E7EB',
                'text_primary': '#111827',
                'text_secondary': '#6B7280',
                'shadow': 'rgba(0, 0, 0, 0.05)',
                # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                'readonly_bg': '#F3F4F6',
                'readonly_border': '#D1D5DB',
                'readonly_text': '#9CA3AF'
            }

    def get_color(self, color_name: str, fallback: str = None) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ŸÖÿ≠ÿØÿØ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥ ÿ£ŸàŸÑÿßŸã
        cache_key = f"{self._get_appearance_mode()}_{color_name}"
        if cache_key in self._color_cache:
            return self._color_cache[cache_key]

        colors = self.get_current_colors()
        color = colors.get(color_name)

        if not color and fallback:
            color = fallback
        elif not color:
            # ÿ£ŸÑŸàÿßŸÜ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ£ÿ≥ÿßÿ≥Ÿäÿ©
            backup_colors = {
                'primary': '#1f538d',
                'background': 'gray14' if self._get_appearance_mode() == 'dark' else 'white',
                'surface': 'gray16' if self._get_appearance_mode() == 'dark' else '#f8f9fa',
                'text_primary': 'white' if self._get_appearance_mode() == 'dark' else 'black',
                'text_secondary': 'gray',
                'success': '#4caf50',
                'danger': '#f44336',
                'warning': '#ff9800',
                'readonly_bg': '#f5f5f5' if self._get_appearance_mode() == 'light' else '#2a2a2a',
                'readonly_border': '#cccccc' if self._get_appearance_mode() == 'light' else '#444444',
                'readonly_text': '#666666' if self._get_appearance_mode() == 'light' else '#999999'
            }
            color = backup_colors.get(color_name, '#1f538d')

        # ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑŸÉÿßÿ¥
        self._color_cache[cache_key] = color
        return color

    def apply_to_window(self, window):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        try:
            bg_color = self.get_color('background')
            window.configure(fg_color=bg_color)
        except Exception as e:
            logger.debug(f"Error applying theme to window: {e}")

    def apply_to_frame(self, frame, frame_type='default'):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿ•ÿ∑ÿßÿ±"""
        try:
            colors = {
                'default': self.get_color('surface'),
                'transparent': 'transparent',
                'header': self.get_color('surface'),
                'sidebar': self.get_color('input_bg'),
                'content': self.get_color('background')
            }

            fg_color = colors.get(frame_type, self.get_color('surface'))
            frame.configure(fg_color=fg_color)
        except Exception as e:
            logger.debug(f"Error applying theme to frame: {e}")

    def apply_to_button(self, button, button_type='primary'):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿ≤ÿ±"""
        try:
            configs = {
                'primary': {
                    'fg_color': self.get_color('primary'),
                    'hover_color': self.get_color('primary_hover'),
                    'text_color': 'white'
                },
                'secondary': {
                    'fg_color': self.get_color('input_bg'),
                    'hover_color': self.get_color('border'),
                    'text_color': self.get_color('text_primary'),
                    'border_width': 1,
                    'border_color': self.get_color('input_border')
                },
                'success': {
                    'fg_color': self.get_color('success'),
                    'hover_color': self.get_color('success'),
                    'text_color': 'white'
                },
                'danger': {
                    'fg_color': self.get_color('danger'),
                    'hover_color': self.get_color('danger_hover'),
                    'text_color': 'white'
                },
                'warning': {
                    'fg_color': self.get_color('warning'),
                    'hover_color': self.get_color('warning'),
                    'text_color': 'white'
                }
            }

            config = configs.get(button_type, configs['primary'])
            button.configure(**config)
        except Exception as e:
            logger.debug(f"Error applying theme to button: {e}")

    def apply_to_entry(self, entry, entry_type='normal'):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿ≠ŸÇŸÑ ÿ•ÿØÿÆÿßŸÑ"""
        try:
            if entry_type == 'readonly':
                # ÿ£ŸÑŸàÿßŸÜ ÿÆÿßÿµÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                entry.configure(
                    fg_color=self.get_color('readonly_bg'),
                    border_color=self.get_color('readonly_border'),
                    text_color=self.get_color('readonly_text')
                )
            else:
                # ÿ£ŸÑŸàÿßŸÜ ÿπÿßÿØŸäÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ÿ≠ÿ±Ÿäÿ±
                entry.configure(
                    fg_color=self.get_color('input_bg'),
                    border_color=self.get_color('input_border'),
                    text_color=self.get_color('text_primary')
                )
        except Exception as e:
            logger.debug(f"Error applying theme to entry: {e}")

    def apply_to_combobox(self, combobox):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ©"""
        try:
            combobox.configure(
                fg_color=self.get_color('input_bg'),
                button_color=self.get_color('primary'),
                button_hover_color=self.get_color('primary_hover'),
                dropdown_fg_color=self.get_color('surface'),
                dropdown_text_color=self.get_color('text_primary'),
                text_color=self.get_color('text_primary')
            )
        except Exception as e:
            logger.debug(f"Error applying theme to combobox: {e}")

    def apply_to_label(self, label, label_type='primary'):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿ™ÿ≥ŸÖŸäÿ©"""
        try:
            colors = {
                'primary': self.get_color('text_primary'),
                'secondary': self.get_color('text_secondary'),
                'success': self.get_color('success'),
                'danger': self.get_color('danger'),
                'warning': self.get_color('warning'),
                'readonly': self.get_color('readonly_text')  # ‚Üê ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸàŸÜ ÿÆÿßÿµ ŸÑŸÑÿ™ÿ≥ŸÖŸäÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
            }

            text_color = colors.get(label_type, self.get_color('text_primary'))
            label.configure(text_color=text_color)
        except Exception as e:
            logger.debug(f"Error applying theme to label: {e}")

    def get_readonly_colors(self) -> Dict[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        return {
            'bg_color': self.get_color('readonly_bg'),
            'border_color': self.get_color('readonly_border'),
            'text_color': self.get_color('readonly_text')
        }

    def get_themed_colors_tuple(self, color_name: str) -> tuple:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ tuple ŸÑŸÑÿ£ŸÑŸàÿßŸÜ (light, dark)"""
        # ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÖŸàÿ¨ŸàÿØ
        light_colors = self._get_default_colors('light')
        dark_colors = self._get_default_colors('dark')

        light_color = light_colors.get(color_name, '#ffffff')
        dark_color = dark_colors.get(color_name, '#1a1a1a')

        return (light_color, dark_color)

    def invalidate_cache(self):
        """ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÉÿßÿ¥ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ"""
        self._color_cache.clear()

    def get_available_palettes(self) -> list:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÑŸàÿ≠ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©"""
        if self._has_palettes:
            try:
                all_palettes = self._get_available_palettes()
                return [p for p in all_palettes if p != 'modern_dark']
            except:
                pass
        return ['modern_purple', 'modern_blue', 'modern_emerald']

    def set_palette(self, palette_name: str):
        """ÿ™ÿπŸäŸäŸÜ ŸÑŸàÿ≠ÿ© ÿ£ŸÑŸàÿßŸÜ ÿ¨ÿØŸäÿØÿ©"""
        if self.theme_manager and hasattr(self.theme_manager, 'config'):
            try:
                self.theme_manager.config.set('light_color_palette', palette_name)
                if hasattr(self.theme_manager.config, 'save'):
                    self.theme_manager.config.save()
                self.invalidate_cache()
                logger.info(f"Color palette changed to: {palette_name}")
            except Exception as e:
                logger.error(f"Error setting palette: {e}")


# ŸÉŸÑÿßÿ≥ ŸÖÿ≥ÿßÿπÿØ ŸÑŸÑŸÜŸàÿßŸÅÿ∞
class ThemedWindow:
    """ŸÉŸÑÿßÿ≥ ŸÖÿ≥ÿßÿπÿØ ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿßŸÑŸÜŸàÿßŸÅÿ∞"""

    def __init__(self, window, theme_manager=None):
        self.window = window
        self.color_manager = ThemeColorManager(theme_manager)

    def apply_theme(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÉÿßŸÖŸÑ ÿπŸÑŸâ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.color_manager.apply_to_window(self.window)

    def get_color(self, color_name: str, fallback: str = None) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ"""
        return self.color_manager.get_color(color_name, fallback)

    def apply_to_widget(self, widget, widget_type: str, sub_type: str = 'normal'):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ widget ŸÖÿ≠ÿØÿØ"""
        if widget_type == 'button':
            self.color_manager.apply_to_button(widget, sub_type)
        elif widget_type == 'entry':
            self.color_manager.apply_to_entry(widget, sub_type)
        elif widget_type == 'combobox':
            self.color_manager.apply_to_combobox(widget)
        elif widget_type == 'label':
            self.color_manager.apply_to_label(widget, sub_type)
        elif widget_type == 'frame':
            self.color_manager.apply_to_frame(widget, sub_type)

    def get_readonly_colors(self) -> Dict[str, str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        return self.color_manager.get_readonly_colors()

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ"""
        self.color_manager.invalidate_cache()
        self.apply_theme()

============================================================
FILE: core\theme_manager.py
SIZE: 25669 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/theme_manager.py

ÿ™ÿØŸäÿ± Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ¶ÿ© ÿ•ÿπÿØÿßÿØ Ÿàÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖÿßÿ™ (Themes) ŸÅŸä Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸÉÿ™ÿ®ÿ© CustomTkinter.
ÿ™ÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØÿßÿ™ ConfigManager ŸÑŸÇÿ±ÿßÿ°ÿ© ÿ´ŸäŸÖ ÿßŸÑŸàÿßÿ¨Ÿáÿ© (ŸÅÿßÿ™ÿ≠/ÿØÿßŸÉŸÜ) ŸàÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÑŸàŸÜŸä (Color Theme).
ŸäŸÖŸÉŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿØŸàŸÜ ÿßŸÑÿ≠ÿßÿ¨ÿ© ŸÑÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ.

üîµ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¨ÿØŸäÿØ: ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
"""

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥Ÿäÿ©
# ------------------------------------------------------------
from typing import Optional, Dict, Any, Union
import json
import os

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ©
# ------------------------------------------------------------
import customtkinter as ctk
import tkinter as tk

# ------------------------------------------------------------
# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ Ÿàÿ≠ÿØÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
# ------------------------------------------------------------
from core.config_manager import ConfigManager
from core.logger import logger


class ThemeManager:
    """
    ŸÅÿ¶ÿ© ThemeManager ŸÖÿ≥ÿ§ŸàŸÑÿ© ÿπŸÜ:
    - ŸÇÿ±ÿßÿ°ÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ´ŸäŸÖ ŸÖŸÜ ConfigManager.
    - ÿ™ÿ∑ÿ®ŸäŸÇ ÿ´ŸäŸÖ ÿßŸÑŸàÿßÿ¨Ÿáÿ© (Appearance Mode) Ÿàÿ´ŸäŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ (Color Theme) ÿπŸÑŸâ CustomTkinter.
    - ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß Ÿàÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™.
    - ÿØÿπŸÖ ÿ´ŸäŸÖÿßÿ™ ŸÖÿÆÿµÿµÿ© ŸÖÿ´ŸÑ Windows 7
    - üîµ ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
    """

    def __init__(self, config_manager: ConfigManager) -> None:
        """
        ÿ™ŸáŸäÿ¶ÿ© ThemeManager.
        """
        self.config: ConfigManager = config_manager

        # ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿ´ŸäŸÖÿßÿ™ ÿßŸÑŸÖÿÆÿµÿµÿ©
        self.custom_themes = {
            "windows7_aero": self._get_windows7_aero_colors(),
            "windows7_classic": self._get_windows7_classic_colors(),
            "windows7_basic": self._get_windows7_basic_colors()
        }

        # ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ´ŸäŸÖÿßÿ™ ÿßŸÑŸÖÿØŸÖÿ¨ÿ© - ÿ•ÿ≤ÿßŸÑÿ© dark-blue
        self.builtin_themes = ["blue", "green"]  # ‚ö†Ô∏è ÿ£ÿ≤ŸÑŸÜÿß "dark-blue"

        # ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        self.current_mode: str = self.config.get("appearance_mode", "light")

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ´ŸäŸÖ Ÿàÿ™ÿµÿ≠Ÿäÿ≠Ÿá ÿ•ÿ∞ÿß ŸÉÿßŸÜ dark-blue
        saved_theme = self.config.get("color_theme", "blue")
        if saved_theme == "dark-blue":
            logger.warning("ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ dark-blue theme - ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ∫ŸäŸäÿ± ÿ•ŸÑŸâ blue")
            saved_theme = "blue"
            self.config.set("color_theme", "blue")

        self.current_color_theme: str = saved_theme

        # ÿ™ÿ∑ÿ®ŸäŸÇ appearance mode ŸÅŸÇÿ∑
        self.apply_appearance_mode(self.current_mode)

        # ŸÑÿß ÿ™ÿ∑ÿ®ŸÇ color theme ŸáŸÜÿß - ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇŸá ŸÅŸä app_controller

    def apply_blue_theme_to_enhanced_combo(self, combo_widget):
        """üîµ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿπŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        try:
            if hasattr(combo_widget, 'apply_blue_theme'):
                combo_widget.apply_blue_theme(self)
                logger.info("‚úÖ ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿπŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©")
            elif hasattr(combo_widget, '_get_blue_colors'):
                # ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ŸÑŸàÿßŸÜ
                combo_widget.theme_manager = self
                if hasattr(combo_widget, '_populate_dropdown_simple'):
                    combo_widget._populate_dropdown_simple()
            else:
                logger.warning("‚ö†Ô∏è ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÑÿß ÿ™ÿØÿπŸÖ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ")
        except Exception as e:
            logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ: {e}")

    def _get_windows7_aero_colors(self) -> Dict[str, Any]:
        """
        ÿ£ŸÑŸàÿßŸÜ ÿ´ŸäŸÖ Windows 7 Aero ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        """
        return {
            "window_bg": {"light": "#F0F0F0", "dark": "#1E1E1E"},
            "frame_bg": {"light": "#FFFFFF", "dark": "#2D2D30"},
            "button_bg": {"light": "#E1E1E1", "dark": "#3F3F46"},
            "button_hover": {"light": "#B9D7F1", "dark": "#4B7BB1"},
            "button_pressed": {"light": "#7DA2CE", "dark": "#2C5282"},
            "button_text": {"light": "#000000", "dark": "#FFFFFF"},
            "entry_bg": {"light": "#FFFFFF", "dark": "#383838"},
            "entry_border": {"light": "#7DA2CE", "dark": "#555555"},
            "entry_border_focus": {"light": "#569DE5", "dark": "#0078D7"},
            "text_color": {"light": "#000000", "dark": "#E0E0E0"},
            "label_color": {"light": "#000000", "dark": "#CCCCCC"},
            "disabled_color": {"light": "#8B8B8B", "dark": "#6B6B6B"},
            "selection_bg": {"light": "#0078D7", "dark": "#0078D7"},
            "selection_text": {"light": "#FFFFFF", "dark": "#FFFFFF"},
            "scrollbar_bg": {"light": "#F0F0F0", "dark": "#2D2D30"},
            "scrollbar_thumb": {"light": "#CDCDCD", "dark": "#686868"},
            "scrollbar_thumb_hover": {"light": "#A6A6A6", "dark": "#9E9E9E"},
            "menu_bg": {"light": "#F0F0F0", "dark": "#2D2D30"},
            "menu_hover": {"light": "#E3F2FD", "dark": "#094771"},
            # üîµ ÿ£ŸÑŸàÿßŸÜ ÿ¨ÿØŸäÿØÿ© ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
            "dropdown_hover": {"light": "#E6F3FF", "dark": "#1E90FF"},
            "dropdown_text_hover": {"light": "#000080", "dark": "#FFFFFF"},
            "dropdown_select": {"light": "#ADD8E6", "dark": "#000080"},
            "dropdown_border": {"light": "#0000FF", "dark": "#ADD8E6"},
            "tooltip_bg": {"light": "#FFFFCC", "dark": "#4B4B4B"},
            "tooltip_text": {"light": "#000000", "dark": "#FFFFFF"},
            "progress_bg": {"light": "#E6E6E6", "dark": "#2D2D30"},
            "progress_fill": {"light": "#06B025", "dark": "#06B025"},
            "tab_active": {"light": "#FFFFFF", "dark": "#3F3F46"},
            "tab_inactive": {"light": "#E8E8E8", "dark": "#2D2D30"},
            "border_color": {"light": "#ADADAD", "dark": "#555555"},
            "shadow_color": {"light": "#B0B0B0", "dark": "#000000"}
        }

    def _get_windows7_classic_colors(self) -> Dict[str, Any]:
        """
        ÿ£ŸÑŸàÿßŸÜ ÿ´ŸäŸÖ Windows 7 Classic (ÿ®ÿØŸàŸÜ ÿ¥ŸÅÿßŸÅŸäÿ©) ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
        """
        return {
            "window_bg": {"light": "#D4D0C8", "dark": "#3C3C3C"},
            "frame_bg": {"light": "#ECE9D8", "dark": "#404040"},
            "button_bg": {"light": "#D4D0C8", "dark": "#404040"},
            "button_hover": {"light": "#E0DDD7", "dark": "#4A4A4A"},
            "button_pressed": {"light": "#C4C0B8", "dark": "#353535"},
            "button_text": {"light": "#000000", "dark": "#E0E0E0"},
            "entry_bg": {"light": "#FFFFFF", "dark": "#525252"},
            "entry_border": {"light": "#404040", "dark": "#6B6B6B"},
            "entry_border_focus": {"light": "#0054E3", "dark": "#0078D7"},
            "text_color": {"light": "#000000", "dark": "#E0E0E0"},
            "label_color": {"light": "#000000", "dark": "#D0D0D0"},
            "disabled_color": {"light": "#808080", "dark": "#808080"},
            "selection_bg": {"light": "#316AC5", "dark": "#316AC5"},
            "selection_text": {"light": "#FFFFFF", "dark": "#FFFFFF"},
            "scrollbar_bg": {"light": "#D4D0C8", "dark": "#404040"},
            "scrollbar_thumb": {"light": "#A0A0A0", "dark": "#606060"},
            "scrollbar_thumb_hover": {"light": "#808080", "dark": "#808080"},
            "menu_bg": {"light": "#F0F0F0", "dark": "#404040"},
            "menu_hover": {"light": "#316AC5", "dark": "#316AC5"},
            # üîµ ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
            "dropdown_hover": {"light": "#CCE7FF", "dark": "#4169E1"},
            "dropdown_text_hover": {"light": "#000080", "dark": "#FFFFFF"},
            "dropdown_select": {"light": "#87CEEB", "dark": "#191970"},
            "dropdown_border": {"light": "#0000CD", "dark": "#87CEEB"},
            "tooltip_bg": {"light": "#FFFFE1", "dark": "#4B4B4B"},
            "tooltip_text": {"light": "#000000", "dark": "#FFFFFF"},
            "progress_bg": {"light": "#E0E0E0", "dark": "#404040"},
            "progress_fill": {"light": "#316AC5", "dark": "#316AC5"},
            "tab_active": {"light": "#ECE9D8", "dark": "#525252"},
            "tab_inactive": {"light": "#D4D0C8", "dark": "#404040"},
            "border_color": {"light": "#808080", "dark": "#6B6B6B"},
            "shadow_color": {"light": "#808080", "dark": "#000000"}
        }

    def _get_windows7_basic_colors(self) -> Dict[str, Any]:
        """
        ÿ£ŸÑŸàÿßŸÜ ÿ´ŸäŸÖ Windows 7 Basic (ÿ®ÿØŸàŸÜ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ Aero) ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
        """
        return {
            "window_bg": {"light": "#E8E8E8", "dark": "#2B2B2B"},
            "frame_bg": {"light": "#F5F5F5", "dark": "#363636"},
            "button_bg": {"light": "#DDDDDD", "dark": "#484848"},
            "button_hover": {"light": "#C8E6F5", "dark": "#5A7FA6"},
            "button_pressed": {"light": "#9ECDE7", "dark": "#405F7E"},
            "button_text": {"light": "#000000", "dark": "#FFFFFF"},
            "entry_bg": {"light": "#FFFFFF", "dark": "#404040"},
            "entry_border": {"light": "#999999", "dark": "#5C5C5C"},
            "entry_border_focus": {"light": "#3399FF", "dark": "#0078D7"},
            "text_color": {"light": "#000000", "dark": "#E0E0E0"},
            "label_color": {"light": "#000000", "dark": "#D4D4D4"},
            "disabled_color": {"light": "#999999", "dark": "#7A7A7A"},
            "selection_bg": {"light": "#3399FF", "dark": "#3399FF"},
            "selection_text": {"light": "#FFFFFF", "dark": "#FFFFFF"},
            "scrollbar_bg": {"light": "#E8E8E8", "dark": "#363636"},
            "scrollbar_thumb": {"light": "#B8B8B8", "dark": "#5C5C5C"},
            "scrollbar_thumb_hover": {"light": "#999999", "dark": "#7A7A7A"},
            "menu_bg": {"light": "#F5F5F5", "dark": "#363636"},
            "menu_hover": {"light": "#D8E9F5", "dark": "#4B6983"},
            # üîµ ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
            "dropdown_hover": {"light": "#E6F7FF", "dark": "#1E90FF"},
            "dropdown_text_hover": {"light": "#003366", "dark": "#FFFFFF"},
            "dropdown_select": {"light": "#B3D9FF", "dark": "#0066CC"},
            "dropdown_border": {"light": "#0066FF", "dark": "#B3D9FF"},
            "tooltip_bg": {"light": "#FFFFC8", "dark": "#525252"},
            "tooltip_text": {"light": "#000000", "dark": "#FFFFFF"},
            "progress_bg": {"light": "#E0E0E0", "dark": "#363636"},
            "progress_fill": {"light": "#3399FF", "dark": "#3399FF"},
            "tab_active": {"light": "#F5F5F5", "dark": "#484848"},
            "tab_inactive": {"light": "#DDDDDD", "dark": "#363636"},
            "border_color": {"light": "#B5B5B5", "dark": "#5C5C5C"},
            "shadow_color": {"light": "#C0C0C0", "dark": "#000000"}
        }

    def get_theme_colors(self, theme_name: str = None) -> Dict[str, str]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ÿ£Ÿà ÿ´ŸäŸÖ ŸÖÿ≠ÿØÿØ
        """
        if theme_name is None:
            theme_name = self.current_color_theme

        if theme_name in self.custom_themes:
            colors = self.custom_themes[theme_name]
            mode = self.current_mode if self.current_mode in ["light", "dark"] else "light"
            # ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑÿ≠ÿßŸÑŸä ŸÅŸÇÿ∑
            return {key: value[mode] for key, value in colors.items()}

        # ŸÑŸÑÿ´ŸäŸÖÿßÿ™ ÿßŸÑŸÖÿØŸÖÿ¨ÿ©ÿå ÿ•ÿ±ÿ¨ÿßÿπ ÿ£ŸÑŸàÿßŸÜ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÖÿπ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
        return self._get_default_colors()

    def _get_default_colors(self) -> Dict[str, str]:
        """
        ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑÿ´ŸäŸÖÿßÿ™ ÿßŸÑŸÖÿØŸÖÿ¨ÿ© ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
        """
        if self.current_mode == "dark":
            return {
                "window_bg": "#212121",
                "frame_bg": "#2B2B2B",
                "button_bg": "#3F7CAC",
                "button_hover": "#5294C7",
                "text_color": "#E0E0E0",
                "entry_bg": "#3A3A3A",
                "entry_border": "#565B5E",
                # üîµ ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ±ŸÇÿßÿ° ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä
                "dropdown_hover": "#1E90FF",
                "dropdown_text_hover": "#FFFFFF",
                "dropdown_select": "#000080",
                "dropdown_border": "#ADD8E6"
            }
        else:
            return {
                "window_bg": "#F0F0F0",
                "frame_bg": "#FFFFFF",
                "button_bg": "#1F538D",
                "button_hover": "#2A5F9E",
                "text_color": "#000000",
                "entry_bg": "#FFFFFF",
                "entry_border": "#CCCCCC",
                # üîµ ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ±ŸÇÿßÿ° ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑŸÜŸáÿßÿ±Ÿä
                "dropdown_hover": "#E6F3FF",
                "dropdown_text_hover": "#000080",
                "dropdown_select": "#ADD8E6",
                "dropdown_border": "#0000FF"
            }

    def get_dropdown_hover_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© - ÿ£ÿ≤ÿ±ŸÇ ŸÅÿßÿ™ÿ≠"""
        colors = self.get_theme_colors()
        return colors.get("dropdown_hover", "#E6F3FF" if self.current_mode == "light" else "#1E90FF")

    def get_dropdown_text_hover_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßŸÑŸÜÿµ ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿπŸÜÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±"""
        colors = self.get_theme_colors()
        return colors.get("dropdown_text_hover", "#000080" if self.current_mode == "light" else "#FFFFFF")

    def get_dropdown_select_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠"""
        colors = self.get_theme_colors()
        return colors.get("dropdown_select", "#ADD8E6" if self.current_mode == "light" else "#000080")

    def get_dropdown_border_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿ≠ÿØŸàÿØ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        colors = self.get_theme_colors()
        return colors.get("dropdown_border", "#0000FF" if self.current_mode == "light" else "#ADD8E6")

    def apply_appearance_mode(self, mode: str) -> None:
        """
        ÿ™ÿ∑ÿ®ŸäŸÇ ÿ´ŸäŸÖ ÿßŸÑŸàÿßÿ¨Ÿáÿ© (Appearance Mode) ÿπŸÑŸâ CustomTkinter.
        """
        mode = mode.lower()
        if mode not in ("light", "dark", "system"):
            logger.warning(f"ThemeManager: ŸÇŸäŸÖÿ© ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ© ŸÑŸÑŸÄ appearance_mode: '{mode}'. ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ 'light'.")
            mode = "light"

        try:
            ctk.set_appearance_mode(mode)
            self.current_mode = mode
            self.config.set("appearance_mode", mode)
            logger.info(f"ThemeManager: ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Appearance Mode='{mode}'.")
        except Exception as exc:
            logger.error(f"ThemeManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ∑ÿ®ŸäŸÇ Appearance Mode='{mode}': {exc}", exc_info=True)

    def apply_color_theme(self, color_theme: str) -> None:
        """
        ÿ™ÿ∑ÿ®ŸäŸÇ ÿ´ŸäŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿπŸÑŸâ CustomTkinter.
        """
        color_theme = color_theme.lower()

        # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ´ŸäŸÖ ŸÖÿÆÿµÿµ
        if color_theme in self.custom_themes:
            # ÿ≠ŸÅÿ∏ ÿßŸÑÿ´ŸäŸÖ ŸÅŸÇÿ∑ ÿØŸàŸÜ ÿ™ÿ∑ÿ®ŸäŸÇŸá ÿπŸÑŸâ CTk
            self.current_color_theme = color_theme
            self.config.set("color_theme", color_theme)
            logger.info(f"ThemeManager: ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÖÿÆÿµÿµ '{color_theme}'.")

        # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ´ŸäŸÖ ŸÖÿØŸÖÿ¨
        elif color_theme in self.builtin_themes:
            try:
                # ‚ö†Ô∏è ŸÑÿß ÿ™ÿ≥ÿ™ÿØÿπŸä set_default_color_theme ŸáŸÜÿß!
                # ŸÅŸÇÿ∑ ÿßÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØ
                self.current_color_theme = color_theme
                self.config.set("color_theme", color_theme)
                logger.info(f"ThemeManager: ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± Color Theme='{color_theme}'.")

                # ÿ•ÿ∏Ÿáÿßÿ± ÿ™ÿ≠ÿ∞Ÿäÿ± ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                logger.warning("ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ Ÿäÿ™ÿ∑ŸÑÿ® ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÑŸäÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇŸá ÿ®ÿßŸÑŸÉÿßŸÖŸÑ")

            except Exception as exc:
                logger.error(f"ThemeManager: ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ Color Theme='{color_theme}': {exc}")
        else:
            logger.warning(f"ThemeManager: ÿ´ŸäŸÖ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ '{color_theme}'.")

    def apply_widget_theme(self, widget: Union[tk.Widget, ctk.CTkBaseClass]) -> None:
        """
        ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿπŸÜÿµÿ± Ÿàÿßÿ¨Ÿáÿ© ŸÖÿ≠ÿØÿØ ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        """
        if self.current_color_theme not in self.custom_themes:
            return

        colors = self.get_theme_colors()

        try:
            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿπŸÜÿµÿ±
            if isinstance(widget, ctk.CTkButton):
                widget.configure(
                    fg_color=colors.get("button_bg"),
                    hover_color=colors.get("button_hover"),
                    text_color=colors.get("button_text"),
                    corner_radius=4,
                    border_width=1,
                    border_color=colors.get("border_color")
                )

            elif isinstance(widget, ctk.CTkEntry):
                widget.configure(
                    fg_color=colors.get("entry_bg"),
                    border_color=colors.get("entry_border"),
                    text_color=colors.get("text_color"),
                    corner_radius=2,
                    border_width=1
                )

            elif isinstance(widget, ctk.CTkFrame):
                widget.configure(
                    fg_color=colors.get("frame_bg"),
                    corner_radius=6,
                    border_width=1,
                    border_color=colors.get("border_color")
                )

            elif isinstance(widget, ctk.CTkLabel):
                widget.configure(
                    text_color=colors.get("label_color")
                )

            elif isinstance(widget, ctk.CTkTextbox):
                widget.configure(
                    fg_color=colors.get("entry_bg"),
                    border_color=colors.get("entry_border"),
                    text_color=colors.get("text_color"),
                    corner_radius=2,
                    border_width=1,
                    scrollbar_button_color=colors.get("scrollbar_thumb"),
                    scrollbar_button_hover_color=colors.get("scrollbar_thumb_hover")
                )

            elif isinstance(widget, ctk.CTkProgressBar):
                widget.configure(
                    fg_color=colors.get("progress_bg"),
                    progress_color=colors.get("progress_fill"),
                    corner_radius=2,
                    border_width=1,
                    border_color=colors.get("border_color")
                )

            elif isinstance(widget, ctk.CTkCheckBox):
                widget.configure(
                    fg_color=colors.get("selection_bg"),
                    hover_color=colors.get("button_hover"),
                    text_color=colors.get("text_color"),
                    border_color=colors.get("entry_border"),
                    checkmark_color=colors.get("selection_text"),
                    corner_radius=2,
                    border_width=1
                )

            elif isinstance(widget, ctk.CTkSwitch):
                widget.configure(
                    fg_color=colors.get("scrollbar_bg"),
                    progress_color=colors.get("selection_bg"),
                    button_color=colors.get("button_bg"),
                    button_hover_color=colors.get("button_hover"),
                    text_color=colors.get("text_color")
                )

            elif isinstance(widget, ctk.CTkOptionMenu):
                widget.configure(
                    fg_color=colors.get("entry_bg"),
                    button_color=colors.get("button_bg"),
                    button_hover_color=colors.get("button_hover"),
                    text_color=colors.get("text_color"),
                    dropdown_fg_color=colors.get("menu_bg"),
                    dropdown_hover_color=self.get_dropdown_hover_color(),  # üîµ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ
                    dropdown_text_color=self.get_dropdown_text_hover_color(),  # üîµ ŸÜÿµ ÿ£ÿ≤ÿ±ŸÇ
                    corner_radius=2
                )

            elif isinstance(widget, ctk.CTkComboBox):
                widget.configure(
                    fg_color=colors.get("entry_bg"),
                    border_color=colors.get("entry_border"),
                    button_color=colors.get("button_bg"),
                    button_hover_color=colors.get("button_hover"),
                    text_color=colors.get("text_color"),
                    dropdown_fg_color=colors.get("menu_bg"),
                    dropdown_hover_color=self.get_dropdown_hover_color(),  # üîµ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ
                    dropdown_text_color=self.get_dropdown_text_hover_color(),  # üîµ ŸÜÿµ ÿ£ÿ≤ÿ±ŸÇ
                    corner_radius=2,
                    border_width=1
                )

            elif isinstance(widget, ctk.CTkTabview):
                widget.configure(
                    fg_color=colors.get("frame_bg"),
                    segmented_button_fg_color=colors.get("window_bg"),
                    segmented_button_selected_color=colors.get("tab_active"),
                    segmented_button_selected_hover_color=colors.get("button_hover"),
                    segmented_button_unselected_color=colors.get("tab_inactive"),
                    segmented_button_unselected_hover_color=colors.get("scrollbar_thumb_hover"),
                    text_color=colors.get("text_color"),
                    corner_radius=6
                )

            elif isinstance(widget, ctk.CTkScrollbar):
                widget.configure(
                    fg_color=colors.get("scrollbar_bg"),
                    button_color=colors.get("scrollbar_thumb"),
                    button_hover_color=colors.get("scrollbar_thumb_hover")
                )

            # ŸÑŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿπÿßÿØŸäÿ© ŸÖŸÜ tkinter
            elif hasattr(widget, 'configure'):
                try:
                    widget.configure(bg=colors.get("window_bg"))
                    if hasattr(widget, 'fg'):
                        widget.configure(fg=colors.get("text_color"))
                except:
                    pass

        except Exception as e:
            logger.debug(f"ÿ™ÿπÿ∞ÿ± ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ {type(widget).__name__}: {e}")

    def apply_blue_dropdown_theme(self, widget) -> None:
        """
        üîµ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿÆÿµŸäÿµÿßŸã ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
        """
        try:
            if hasattr(widget, '_apply_blue_hover_colors'):
                # ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ÿßŸÑÿ™Ÿä ÿ™ÿØÿπŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
                widget._apply_blue_hover_colors(
                    hover_color=self.get_dropdown_hover_color(),
                    text_color=self.get_dropdown_text_hover_color(),
                    select_color=self.get_dropdown_select_color(),
                    border_color=self.get_dropdown_border_color()
                )
                logger.debug(f"ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿπŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©")
            elif hasattr(widget, 'configure'):
                # ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑÿπÿßÿØŸäÿ©
                widget.configure(
                    dropdown_hover_color=self.get_dropdown_hover_color(),
                    dropdown_text_color=self.get_dropdown_text_hover_color()
                )
                logger.debug(f"ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿπŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπÿßÿØŸäÿ©")
        except Exception as e:
            logger.debug(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ: {e}")

    def apply_to_all_widgets(self, parent_widget) -> None:
        """
        ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÅŸä ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿπ ÿØÿπŸÖ ÿÆÿßÿµ ŸÑŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
        """
        def apply_recursively(widget):
            self.apply_widget_theme(widget)

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿÆÿßÿµ ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
            if hasattr(widget, '_apply_blue_hover_colors'):
                self.apply_blue_dropdown_theme(widget)

            for child in widget.winfo_children():
                apply_recursively(child)

        apply_recursively(parent_widget)

    def get_error_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßŸÑÿÆÿ∑ÿ£ ÿ≠ÿ≥ÿ® ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        if self.current_mode == "dark":
            return "#FF6B6B"
        else:
            return "#DC143C"

    def get_success_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßŸÑŸÜÿ¨ÿßÿ≠ ÿ≠ÿ≥ÿ® ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        if self.current_mode == "dark":
            return "#51CF66"
        else:
            return "#228B22"

    def get_warning_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ± ÿ≠ÿ≥ÿ® ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        if self.current_mode == "dark":
            return "#FFD93D"
        else:
            return "#FFA500"

    def get_info_color(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä"""
        if self.current_mode == "dark":
            return "#339AF0"
        else:
            return "#0066CC"

    def is_windows7_theme(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ´ŸäŸÖ Windows 7"""
        return self.current_color_theme.startswith("windows7")

    def get_available_themes(self) -> list:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ¨ŸÖŸäÿπ ÿßŸÑÿ´ŸäŸÖÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©"""
        return self.builtin_themes + list(self.custom_themes.keys())

    def toggle_appearance_mode(self) -> None:
        """ÿ™ÿ®ÿØŸäŸÑ ÿ´ŸäŸÖ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ®ŸäŸÜ 'light' Ÿà 'dark'"""
        new_mode = "dark" if self.current_mode == "light" else "light"
        logger.debug(f"ThemeManager: ÿ™ÿ®ÿØŸäŸÑ Appearance Mode ŸÖŸÜ '{self.current_mode}' ÿ•ŸÑŸâ '{new_mode}'.")
        self.apply_appearance_mode(new_mode)

    def get_current_appearance_mode(self) -> str:
        """ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÑŸÑŸàÿßÿ¨Ÿáÿ©"""
        return self.current_mode

    def get_current_color_theme(self) -> str:
        """ÿ•ÿ±ÿ¨ÿßÿπ ÿ´ŸäŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑŸä"""
        return self.current_color_theme

    def reload(self) -> None:
        """ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖÿßÿ™ ŸÖŸÜ ConfigManager"""
        mode = self.config.get("appearance_mode", "light")
        color = self.config.get("color_theme", "blue")
        logger.debug("ThemeManager: ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ´ŸäŸÖÿßÿ™ ŸÖŸÜ ConfigManager.")
        self.apply_appearance_mode(mode)
        self.apply_color_theme(color)


============================================================
FILE: core\user_manager.py
SIZE: 14899 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/user_manager.py - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ©

ŸÖÿØŸäÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© get_field_value
"""

from typing import Dict, Optional, Any
import hashlib
import hmac
import secrets
import base64
from datetime import datetime, timedelta

from core.airtable_manager import AirtableModel
from core.db_manager import DatabaseManager
from core.logger import logger


class UserManager:
    """ŸÖÿØŸäÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""

    def __init__(self, airtable_model: AirtableModel, db_manager: DatabaseManager) -> None:
        self.airtable_model: AirtableModel = airtable_model
        self.db: DatabaseManager = db_manager

        # ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÅŸä ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©
        self._users_cache: Dict[str, Dict[str, Any]] = {}

        # ÿ≠ŸÖÿßŸäÿ© ÿ∂ÿØ Ÿáÿ¨ŸÖÿßÿ™ ÿßŸÑŸÇŸàÿ© ÿßŸÑÿ∫ÿßÿ¥ŸÖÿ©
        self._failed_attempts: Dict[str, list] = {}
        self._max_attempts = 5
        self._lockout_duration = timedelta(minutes=15)

        # ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
        self._salt = b"FTS_SALES_MANAGER_2024"

        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
        self._load_users()

    def _hash_password(self, password: str, salt: Optional[bytes] = None) -> str:
        """ÿ™ÿ¥ŸÅŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ PBKDF2-HMAC-SHA256"""
        if salt is None:
            salt = secrets.token_bytes(32)

        key = hashlib.pbkdf2_hmac(
            'sha256',
            password.encode('utf-8'),
            salt,
            100_000
        )

        storage = salt + key
        return base64.b64encode(storage).decode('ascii')

    def _verify_password(self, stored_password: str, provided_password: str) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"""
        try:
            decoded = base64.b64decode(stored_password)
            if len(decoded) >= 32:
                salt = decoded[:32]
                stored_key = decoded[32:]

                new_key = hashlib.pbkdf2_hmac(
                    'sha256',
                    provided_password.encode('utf-8'),
                    salt,
                    100_000
                )

                return hmac.compare_digest(stored_key, new_key)
        except Exception:
            pass

        # ÿßŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑŸÇÿØŸäŸÖÿ©
        return stored_password == provided_password

    def _is_account_locked(self, username: str) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÇŸÅŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®"""
        if username not in self._failed_attempts:
            return False

        cutoff_time = datetime.now() - self._lockout_duration
        self._failed_attempts[username] = [
            attempt for attempt in self._failed_attempts[username]
            if attempt > cutoff_time
        ]

        return len(self._failed_attempts[username]) >= self._max_attempts

    def _record_failed_attempt(self, username: str) -> None:
        """ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ≠ÿßŸàŸÑÿ© ŸÅÿßÿ¥ŸÑÿ©"""
        if username not in self._failed_attempts:
            self._failed_attempts[username] = []

        self._failed_attempts[username].append(datetime.now())

        cutoff_time = datetime.now() - self._lockout_duration
        self._failed_attempts[username] = [
            attempt for attempt in self._failed_attempts[username]
            if attempt > cutoff_time
        ]

    def _clear_failed_attempts(self, username: str) -> None:
        """ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿßŸÑŸÅÿßÿ¥ŸÑÿ©"""
        if username in self._failed_attempts:
            del self._failed_attempts[username]

    def _load_users(self) -> None:
        """ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÖŸÜ Airtable"""
        logger.info("UserManager: ÿ®ÿØÿ° ÿ¨ŸÑÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÖŸÜ Airtable")

        try:
            records = self.airtable_model.fetch_records(use_cache=False)
            self._users_cache.clear()

            active_users = 0
            inactive_users = 0

            for rec in records:
                fields = rec.get("fields", {}) or {}

                username = fields.get("Username")
                if not username:
                    continue

                # ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± - ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸäŸáÿß ŸÅŸä ÿ≠ŸÇŸàŸÑ ŸÖÿÆÿ™ŸÑŸÅÿ©
                stored_password = fields.get("PasswordHash") or fields.get("Password") or fields.get("password")
                if not stored_password:
                    logger.warning(f"UserManager: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ÿ®ÿØŸàŸÜ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±")
                    continue

                is_active = fields.get("Active", True)
                if not is_active:
                    inactive_users += 1
                    logger.debug(f"UserManager: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑")
                    continue

                active_users += 1

                # ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©
                airtable_view = fields.get("Airtable View")
                role = fields.get("Role", "viewer")
                airtable_collaborator = fields.get("Airtable Collaborator")

                last_login = fields.get("Last Login")
                login_count = fields.get("Login Count", 0)

                lookup_key = username.lower()
                self._users_cache[lookup_key] = {
                    'username': username,
                    'password': stored_password,
                    'view': airtable_view,
                    'role': role,
                    'airtable_collaborator': airtable_collaborator,
                    'record_id': rec.get("id"),
                    'is_active': is_active,
                    'last_login': last_login,
                    'login_count': login_count
                }

                logger.debug(f"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {username} (Role: {role})")

            logger.info(f"UserManager: ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {active_users} ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÜÿ¥ÿ∑ ({inactive_users} ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑)")

        except Exception as exc:
            logger.error(f"UserManager: ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ: {exc}", exc_info=True)
            if not self._users_cache:
                raise Exception("ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÖŸÜ Airtable")

    def authenticate(self, username: str, password: str) -> Optional[Dict[str, Any]]:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"""
        if self._is_account_locked(username):
            logger.warning(f"UserManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿØÿÆŸàŸÑ ŸÑÿ≠ÿ≥ÿßÿ® ŸÖŸÇŸÅŸÑ '{username}'")
            return None

        lookup_key = username.strip().lower()
        user_info = self._users_cache.get(lookup_key)

        if not user_info:
            logger.warning(f"UserManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ŸÖ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ '{username}'")
            self._record_failed_attempt(username)
            return None

        if self._verify_password(user_info['password'], password):
            logger.info(f"UserManager: ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ŸÜÿßÿ¨ÿ≠ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}'")

            self._clear_failed_attempts(username)

            # ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ÿÆÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ
            self._update_last_login(user_info['record_id'])

            # ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÜÿµ ÿπÿßÿØŸä
            if user_info['password'] == password:
                logger.info(f"UserManager: ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ŸÑÿ™ŸÉŸàŸÜ ŸÖÿ¥ŸÅÿ±ÿ©")
                self._update_password_hash(user_info['record_id'], password)

            return {
                'username': user_info['username'],
                'view': user_info.get('view'),
                'role': user_info.get('role', 'viewer'),
                'airtable_collaborator': user_info.get('airtable_collaborator'),
                'record_id': user_info.get('record_id')
            }
        else:
            logger.warning(f"UserManager: ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿÆÿßÿ∑ÿ¶ÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}'")
            self._record_failed_attempt(username)
            return None

    def _update_last_login(self, record_id: str) -> None:
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ÿÆÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿπÿØÿØ ŸÖÿ±ÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿ≠ÿßŸÑŸä
            current_login_count = 0
            for user_data in self._users_cache.values():
                if user_data.get('record_id') == record_id:
                    current_login_count = user_data.get('login_count', 0)
                    break

            fields = {
                "Last Login": datetime.now().isoformat(),
                "Login Count": current_login_count + 1
            }
            self.airtable_model.update_record(record_id, fields)

        except Exception as e:
            logger.error(f"UserManager: ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ÿÆÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ: {e}")

    def _update_password_hash(self, record_id: str, password: str) -> None:
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÑÿ™ŸÉŸàŸÜ ŸÖÿ¥ŸÅÿ±ÿ©"""
        try:
            hashed = self._hash_password(password)

            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ŸÅŸä ÿ≠ŸÇŸàŸÑ ŸÖÿÆÿ™ŸÑŸÅÿ©
            success = False

            # ŸÖÿ≠ÿßŸàŸÑÿ© 1: ÿ≠ŸÇŸÑ PasswordHash
            try:
                fields = {"PasswordHash": hashed}
                self.airtable_model.update_record(record_id, fields)
                success = True
                logger.info("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÅŸä ÿ≠ŸÇŸÑ PasswordHash")
            except Exception as e1:
                logger.warning(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ PasswordHash: {e1}")

                # ŸÖÿ≠ÿßŸàŸÑÿ© 2: ÿ≠ŸÇŸÑ Password
                try:
                    fields = {"Password": hashed}
                    self.airtable_model.update_record(record_id, fields)
                    success = True
                    logger.info("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÅŸä ÿ≠ŸÇŸÑ Password")
                except Exception as e2:
                    logger.error(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ Password ÿ£Ÿäÿ∂ÿßŸã: {e2}")

            if success:
                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿßÿ¥
                for user_data in self._users_cache.values():
                    if user_data.get('record_id') == record_id:
                        user_data['password'] = hashed
                        break

        except Exception as e:
            logger.error(f"UserManager: ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ©: {e}")

    def change_password(self, username: str, old_password: str, new_password: str) -> bool:
        """ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        if not self.authenticate(username, old_password):
            return False

        if not self._validate_password_strength(new_password):
            logger.warning(f"UserManager: ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© ÿ∂ÿπŸäŸÅÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}'")
            return False

        lookup_key = username.strip().lower()
        user_info = self._users_cache.get(lookup_key)
        if user_info:
            self._update_password_hash(user_info['record_id'], new_password)
            logger.info(f"UserManager: ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ÿ®ŸÜÿ¨ÿßÿ≠")
            return True

        return False

    def _validate_password_strength(self, password: str) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"""
        if len(password) < 8:
            return False

        has_letter = any(c.isalpha() for c in password)
        has_digit = any(c.isdigit() for c in password)

        return has_letter and has_digit

    def reset_password(self, username: str, new_password: str, admin_token: str) -> bool:
        """ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        lookup_key = username.strip().lower()
        user_info = self._users_cache.get(lookup_key)

        if not user_info:
            logger.error(f"UserManager: ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ '{username}'")
            return False

        if not self._validate_password_strength(new_password):
            return False

        self._update_password_hash(user_info['record_id'], new_password)
        logger.info(f"UserManager: ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿßŸÑŸÖÿØŸäÿ±")

        self._clear_failed_attempts(username)

        return True

    def reload_users(self) -> None:
        """ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÖŸÜ Airtable"""
        logger.debug("UserManager: ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ")
        self._load_users()

    def get_user_view(self, username: str) -> Optional[str]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÄ View ÿßŸÑŸÖÿÆÿµÿµ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        lookup_key = username.strip().lower()
        user_info = self._users_cache.get(lookup_key)
        return user_info.get('view') if user_info else None

    def get_user_collaborator(self, username: str) -> Optional[Any]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ Airtable Collaborator ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        lookup_key = username.strip().lower()
        user_info = self._users_cache.get(lookup_key)
        return user_info.get('airtable_collaborator') if user_info else None

    def get_user_role(self, username: str) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿØŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        lookup_key = username.strip().lower()
        user_info = self._users_cache.get(lookup_key)
        return user_info.get('role', 'viewer') if user_info else 'viewer'

    def get_all_users(self) -> Dict[str, Dict[str, Any]]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"""
        safe_users = {}
        for key, user in self._users_cache.items():
            safe_user = user.copy()
            safe_user.pop('password', None)
            safe_users[key] = safe_user
        return safe_users

    def user_exists(self, username: str) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        lookup_key = username.strip().lower()
        return lookup_key in self._users_cache

    def create_user(self, username: str, password: str, role: str = "viewer",
                   admin_token: str = None) -> Optional[str]:
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ"""
        if self.user_exists(username):
            logger.error(f"UserManager: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ")
            return None

        if not self._validate_password_strength(password):
            logger.error(f"UserManager: ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿ∂ÿπŸäŸÅÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ¨ÿØŸäÿØ '{username}'")
            return None

        password_hash = self._hash_password(password)

        try:
            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ≠ŸÇŸàŸÑ ŸÖÿÆÿ™ŸÑŸÅÿ©
            fields = {
                "Username": username,
                "Role": role,
                "Active": True,
                "Created Date": datetime.now().isoformat()
            }

            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ©
            try:
                fields["PasswordHash"] = password_hash
            except:
                # ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ≠ŸÇŸÑ Password
                fields["Password"] = password_hash

            result = self.airtable_model.create_record(fields)
            if result:
                logger.info(f"UserManager: ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}' ÿ®ŸÜÿ¨ÿßÿ≠")
                self.reload_users()
                return result.get('id')

        except Exception as e:
            logger.error(f"UserManager: ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ '{username}': {e}")

        return None

============================================================
FILE: core\security\encryption.py
SIZE: 6042 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/security/encryption.py

ŸÖÿØŸäÿ± ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ©
"""

import hashlib
import secrets
from cryptography.fernet import Fernet
import os
import base64
import json
from typing import Tuple, Optional

from core.logger import logger


class EncryptionManager:
    """ŸÖÿØŸäÿ± ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ÿßŸÑÿ¢ŸÖŸÜ ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™"""

    def __init__(self, key_file: str = "data/.encryption_key"):
        """
        Initialize encryption manager

        Args:
            key_file: Path to encryption key file
        """
        self.key_file = key_file
        self.key = self._get_or_create_key()
        self.cipher = Fernet(self.key)

    def _get_or_create_key(self) -> bytes:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ÿ£Ÿà ÿ•ŸÜÿ¥ÿßÿ§Ÿá"""
        try:
            if os.path.exists(self.key_file):
                with open(self.key_file, 'rb') as f:
                    key = f.read()
                    # Validate key
                    Fernet(key)  # This will raise if invalid
                    return key

            # Create new key
            key = Fernet.generate_key()

            # Save key securely
            os.makedirs(os.path.dirname(self.key_file), exist_ok=True)

            # Set restrictive permissions on Unix-like systems
            if os.name != 'nt':  # Not Windows
                os.chmod(os.path.dirname(self.key_file), 0o700)

            with open(self.key_file, 'wb') as f:
                f.write(key)

            # Set file permissions
            if os.name != 'nt':
                os.chmod(self.key_file, 0o600)

            logger.info("Created new encryption key")
            return key

        except Exception as e:
            logger.error(f"Error managing encryption key: {e}")
            # Generate temporary key (not persistent)
            return Fernet.generate_key()

    def encrypt_data(self, data: str) -> str:
        """
        ÿ™ÿ¥ŸÅŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™

        Args:
            data: String data to encrypt

        Returns:
            Base64 encoded encrypted data
        """
        try:
            encrypted = self.cipher.encrypt(data.encode('utf-8'))
            return base64.urlsafe_b64encode(encrypted).decode('utf-8')
        except Exception as e:
            logger.error(f"Encryption error: {e}")
            raise

    def decrypt_data(self, encrypted_data: str) -> str:
        """
        ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™

        Args:
            encrypted_data: Base64 encoded encrypted data

        Returns:
            Decrypted string data
        """
        try:
            decoded = base64.urlsafe_b64decode(encrypted_data.encode('utf-8'))
            decrypted = self.cipher.decrypt(decoded)
            return decrypted.decode('utf-8')
        except Exception as e:
            logger.error(f"Decryption error: {e}")
            raise

    def encrypt_json(self, data: dict) -> str:
        """
        ÿ™ÿ¥ŸÅŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ JSON

        Args:
            data: Dictionary to encrypt

        Returns:
            Encrypted JSON string
        """
        json_str = json.dumps(data, ensure_ascii=False)
        return self.encrypt_data(json_str)

    def decrypt_json(self, encrypted_data: str) -> dict:
        """
        ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ JSON

        Args:
            encrypted_data: Encrypted JSON string

        Returns:
            Decrypted dictionary
        """
        json_str = self.decrypt_data(encrypted_data)
        return json.loads(json_str)

    def hash_password(self, password: str, salt: Optional[bytes] = None) -> Tuple[str, bytes]:
        """
        ÿ™ÿ¥ŸÅŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ PBKDF2

        Args:
            password: Password to hash
            salt: Optional salt (will generate if not provided)

        Returns:
            Tuple of (hashed_password, salt)
        """
        if salt is None:
            salt = secrets.token_bytes(32)

        # Use PBKDF2 with SHA256
        hashed = hashlib.pbkdf2_hmac(
            'sha256',
            password.encode('utf-8'),
            salt,
            100000,  # iterations
            dklen=64  # 64 bytes = 512 bits
        )

        # Return base64 encoded hash and salt
        return base64.b64encode(hashed).decode('utf-8'), salt

    def verify_password(self, password: str, hashed: str, salt: bytes) -> bool:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±

        Args:
            password: Password to verify
            hashed: Base64 encoded hashed password
            salt: Salt used for hashing

        Returns:
            True if password matches
        """
        new_hash, _ = self.hash_password(password, salt)
        return secrets.compare_digest(new_hash, hashed)

    def generate_token(self, length: int = 32) -> str:
        """
        Generate secure random token

        Args:
            length: Token length in bytes

        Returns:
            URL-safe base64 encoded token
        """
        return secrets.token_urlsafe(length)

    def rotate_key(self) -> bool:
        """
        Rotate encryption key (requires re-encrypting all data)

        Returns:
            True if successful
        """
        try:
            # Generate new key
            new_key = Fernet.generate_key()
            new_cipher = Fernet(new_key)

            # Save old key for rollback
            old_key = self.key

            # Update key
            self.key = new_key
            self.cipher = new_cipher

            # Save new key
            with open(self.key_file, 'wb') as f:
                f.write(new_key)

            logger.info("Encryption key rotated successfully")
            return True

        except Exception as e:
            logger.error(f"Key rotation failed: {e}")
            return False

============================================================
FILE: core\security\rate_limiter.py
SIZE: 10258 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/security/rate_limiter.py

ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ Ÿáÿ¨ŸÖÿßÿ™ Brute Force
"""

import time
import json
import os
from collections import defaultdict
from typing import Tuple, Dict, List
from datetime import datetime, timedelta
import threading

from core.logger import logger


class RateLimiter:
    """ŸÖÿØŸäÿ± ÿ≠ŸÖÿßŸäÿ© ŸÖÿπÿØŸÑ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™"""

    def __init__(
        self,
        max_attempts: int = 5,
        window_seconds: int = 300,  # 5 minutes
        lockout_seconds: int = 300,  # 5 minutes
        persistent_storage: bool = True
    ):
        """
        Initialize rate limiter

        Args:
            max_attempts: Maximum attempts allowed in window
            window_seconds: Time window for attempts
            lockout_seconds: Lockout duration after max attempts
            persistent_storage: Save state to disk
        """
        self.max_attempts = max_attempts
        self.window_seconds = window_seconds
        self.lockout_seconds = lockout_seconds
        self.persistent_storage = persistent_storage

        # Storage
        self.attempts: Dict[str, List[float]] = defaultdict(list)
        self.lockouts: Dict[str, float] = {}
        self.config_file = "data/rate_limiter.json"

        # Thread safety
        self._lock = threading.RLock()

        # Load saved state
        if self.persistent_storage:
            self._load_state()

        # Start cleanup thread
        self._start_cleanup_thread()

    def check_rate_limit(self, identifier: str) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖÿπÿØŸÑ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™

        Args:
            identifier: Unique identifier (e.g., username:ip)

        Returns:
            Tuple of (allowed, message)
        """
        with self._lock:
            # Clean up old data
            self._cleanup_old_attempts()

            # Check if locked out
            if identifier in self.lockouts:
                remaining = self.lockouts[identifier] - time.time()
                if remaining > 0:
                    minutes = int(remaining // 60)
                    seconds = int(remaining % 60)
                    return False, f"Account locked. Try again in {minutes}m {seconds}s"
                else:
                    # Lockout expired
                    del self.lockouts[identifier]
                    logger.info(f"Lockout expired for: {identifier}")

            # Check attempts in current window
            now = time.time()
            window_start = now - self.window_seconds

            # Filter attempts within window
            self.attempts[identifier] = [
                t for t in self.attempts[identifier]
                if t > window_start
            ]

            # Check if exceeding limit
            current_attempts = len(self.attempts[identifier])

            if current_attempts >= self.max_attempts:
                # Lock out the identifier
                self.lockouts[identifier] = now + self.lockout_seconds
                logger.warning(f"Rate limit exceeded for: {identifier} - Locked out")

                if self.persistent_storage:
                    self._save_state()

                return False, f"Too many attempts. Account locked for {self.lockout_seconds // 60} minutes."

            # Calculate remaining attempts
            remaining = self.max_attempts - current_attempts
            return True, f"{remaining} attempts remaining"

    def record_attempt(self, identifier: str):
        """
        ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ≠ÿßŸàŸÑÿ©

        Args:
            identifier: Unique identifier
        """
        with self._lock:
            self.attempts[identifier].append(time.time())
            logger.debug(f"Recorded attempt for: {identifier}")

            if self.persistent_storage:
                self._save_state()

    def clear_attempts(self, identifier: str):
        """
        ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿπŸÜÿØ ÿßŸÑŸÜÿ¨ÿßÿ≠

        Args:
            identifier: Unique identifier
        """
        with self._lock:
            if identifier in self.attempts:
                del self.attempts[identifier]
            if identifier in self.lockouts:
                del self.lockouts[identifier]

            logger.info(f"Cleared attempts for: {identifier}")

            if self.persistent_storage:
                self._save_state()

    def is_locked_out(self, identifier: str) -> bool:
        """
        Check if identifier is locked out

        Args:
            identifier: Unique identifier

        Returns:
            True if locked out
        """
        with self._lock:
            if identifier in self.lockouts:
                if self.lockouts[identifier] > time.time():
                    return True
                else:
                    del self.lockouts[identifier]
            return False

    def get_attempts_count(self, identifier: str) -> int:
        """
        Get current attempts count

        Args:
            identifier: Unique identifier

        Returns:
            Number of attempts in current window
        """
        with self._lock:
            now = time.time()
            window_start = now - self.window_seconds

            return len([
                t for t in self.attempts.get(identifier, [])
                if t > window_start
            ])

    def reset_identifier(self, identifier: str):
        """
        Reset all data for an identifier

        Args:
            identifier: Unique identifier
        """
        self.clear_attempts(identifier)

    def _cleanup_old_attempts(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©"""
        now = time.time()
        window_start = now - self.window_seconds

        # Clean attempts
        for identifier in list(self.attempts.keys()):
            self.attempts[identifier] = [
                t for t in self.attempts[identifier]
                if t > window_start
            ]
            if not self.attempts[identifier]:
                del self.attempts[identifier]

        # Clean expired lockouts
        for identifier in list(self.lockouts.keys()):
            if self.lockouts[identifier] <= now:
                del self.lockouts[identifier]
                logger.debug(f"Removed expired lockout for: {identifier}")

    def _save_state(self):
        """ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖŸÑŸÅ"""
        if not self.persistent_storage:
            return

        try:
            with self._lock:
                state = {
                    "attempts": dict(self.attempts),
                    "lockouts": dict(self.lockouts),
                    "timestamp": datetime.now().isoformat(),
                    "config": {
                        "max_attempts": self.max_attempts,
                        "window_seconds": self.window_seconds,
                        "lockout_seconds": self.lockout_seconds
                    }
                }

                os.makedirs(os.path.dirname(self.config_file), exist_ok=True)

                # Write to temporary file first
                temp_file = f"{self.config_file}.tmp"
                with open(temp_file, 'w', encoding='utf-8') as f:
                    json.dump(state, f, indent=2)

                # Atomic rename
                os.replace(temp_file, self.config_file)

        except Exception as e:
            logger.error(f"Error saving rate limiter state: {e}")

    def _load_state(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ© ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅ"""
        if not self.persistent_storage:
            return

        try:
            if os.path.exists(self.config_file):
                with open(self.config_file, 'r', encoding='utf-8') as f:
                    state = json.load(f)

                with self._lock:
                    # Load attempts
                    self.attempts = defaultdict(list)
                    for key, value in state.get("attempts", {}).items():
                        self.attempts[key] = value

                    # Load lockouts
                    self.lockouts = state.get("lockouts", {})

                    # Clean old data immediately
                    self._cleanup_old_attempts()

                logger.info("Loaded rate limiter state")

        except Exception as e:
            logger.error(f"Error loading rate limiter state: {e}")

    def _start_cleanup_thread(self):
        """Start background cleanup thread"""
        def cleanup_loop():
            while True:
                try:
                    time.sleep(60)  # Run every minute
                    with self._lock:
                        self._cleanup_old_attempts()
                        if self.persistent_storage:
                            self._save_state()
                except Exception as e:
                    logger.error(f"Cleanup thread error: {e}")

        thread = threading.Thread(target=cleanup_loop, daemon=True)
        thread.start()

    def get_statistics(self) -> dict:
        """
        Get rate limiter statistics

        Returns:
            Dictionary with statistics
        """
        with self._lock:
            return {
                "total_tracked": len(self.attempts),
                "currently_locked": len(self.lockouts),
                "total_attempts": sum(len(attempts) for attempts in self.attempts.values()),
                "config": {
                    "max_attempts": self.max_attempts,
                    "window_seconds": self.window_seconds,
                    "lockout_seconds": self.lockout_seconds
                }
            }

    def export_blacklist(self) -> List[str]:
        """
        Export list of currently locked identifiers

        Returns:
            List of locked identifiers
        """
        with self._lock:
            self._cleanup_old_attempts()
            return list(self.lockouts.keys())

============================================================
FILE: core\security\two_factor_auth.py
SIZE: 11664 characters
============================================================

# -*- coding: utf-8 -*-
"""
core/security/two_factor_auth.py

ŸÖÿØŸäÿ± ÿßŸÑŸÖÿµÿßÿØŸÇÿ© ÿßŸÑÿ´ŸÜÿßÿ¶Ÿäÿ©
Two-Factor Authentication Manager
"""

import pyotp
import qrcode
import io
import base64
import secrets
from typing import Optional, List, Tuple
from datetime import datetime
import json

from core.logger import logger


class TwoFactorAuth:
    """ŸÖÿØŸäÿ± ÿßŸÑŸÖÿµÿßÿØŸÇÿ© ÿßŸÑÿ´ŸÜÿßÿ¶Ÿäÿ©"""

    def __init__(self, issuer_name: str = "FTS Sales Manager"):
        """
        Initialize 2FA manager

        Args:
            issuer_name: Name shown in authenticator apps
        """
        self.issuer_name = issuer_name

    def generate_secret(self) -> str:
        """
        Generate a new secret key for 2FA

        Returns:
            Base32 encoded secret key
        """
        return pyotp.random_base32()

    def generate_qr_code(self, username: str, secret: str) -> str:
        """
        Generate QR code for authenticator app setup

        Args:
            username: User's username
            secret: Secret key

        Returns:
            Base64 encoded QR code image
        """
        try:
            # Create provisioning URI
            totp = pyotp.TOTP(secret)
            provisioning_uri = totp.provisioning_uri(
                name=username,
                issuer_name=self.issuer_name
            )

            # Generate QR code
            qr = qrcode.QRCode(
                version=1,
                error_correction=qrcode.constants.ERROR_CORRECT_L,
                box_size=10,
                border=4,
            )
            qr.add_data(provisioning_uri)
            qr.make(fit=True)

            # Create image
            img = qr.make_image(fill_color="black", back_color="white")

            # Convert to base64
            buffer = io.BytesIO()
            img.save(buffer, format='PNG')
            img_str = base64.b64encode(buffer.getvalue()).decode()

            return f"data:image/png;base64,{img_str}"

        except Exception as e:
            logger.error(f"Error generating QR code: {e}")
            raise

    def verify_token(self, secret: str, token: str, window: int = 1) -> bool:
        """
        Verify a TOTP token

        Args:
            secret: User's secret key
            token: 6-digit token from authenticator
            window: Time window for validity (default 1 = ¬±30 seconds)

        Returns:
            True if token is valid
        """
        try:
            # Remove spaces and validate format
            token = token.replace(" ", "").strip()

            if not token.isdigit() or len(token) != 6:
                return False

            # Verify token
            totp = pyotp.TOTP(secret)
            return totp.verify(token, valid_window=window)

        except Exception as e:
            logger.error(f"Error verifying token: {e}")
            return False

    def generate_backup_codes(self, count: int = 10) -> List[str]:
        """
        Generate backup codes for account recovery

        Args:
            count: Number of backup codes to generate

        Returns:
            List of backup codes
        """
        codes = []

        for _ in range(count):
            # Generate 8-character alphanumeric code
            code = ''.join(secrets.choice('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789') for _ in range(8))
            # Format as XXXX-XXXX
            formatted_code = f"{code[:4]}-{code[4:]}"
            codes.append(formatted_code)

        return codes

    def hash_backup_code(self, code: str) -> str:
        """
        Hash a backup code for storage

        Args:
            code: Backup code to hash

        Returns:
            Hashed code
        """
        import hashlib

        # Remove formatting
        clean_code = code.replace("-", "").upper()

        # Hash with salt
        salt = "FTS_2FA_BACKUP"
        return hashlib.sha256(f"{salt}{clean_code}".encode()).hexdigest()

    def verify_backup_code(self, code: str, hashed_codes: List[str]) -> Tuple[bool, Optional[str]]:
        """
        Verify a backup code

        Args:
            code: Backup code to verify
            hashed_codes: List of hashed backup codes

        Returns:
            Tuple of (is_valid, used_code_hash)
        """
        hashed = self.hash_backup_code(code)

        if hashed in hashed_codes:
            return True, hashed

        return False, None

    def get_current_token(self, secret: str) -> str:
        """
        Get current TOTP token (for testing)

        Args:
            secret: Secret key

        Returns:
            Current 6-digit token
        """
        totp = pyotp.TOTP(secret)
        return totp.now()

    def get_time_remaining(self) -> int:
        """
        Get seconds remaining for current token

        Returns:
            Seconds until token expires
        """
        import time
        return 30 - int(time.time() % 30)

    def export_setup_data(self, username: str, secret: str, backup_codes: List[str]) -> dict:
        """
        Export 2FA setup data for user

        Args:
            username: Username
            secret: Secret key
            backup_codes: List of backup codes

        Returns:
            Dictionary with setup data
        """
        return {
            "username": username,
            "secret": secret,
            "issuer": self.issuer_name,
            "backup_codes": backup_codes,
            "setup_date": datetime.now().isoformat(),
            "algorithm": "SHA1",
            "digits": 6,
            "period": 30
        }

    def validate_setup(self, secret: str, token1: str, token2: str) -> bool:
        """
        Validate 2FA setup with two consecutive tokens

        Args:
            secret: Secret key
            token1: First token
            token2: Second token (should be different)

        Returns:
            True if setup is valid
        """
        # Verify first token
        if not self.verify_token(secret, token1):
            return False

        # Ensure tokens are different
        if token1 == token2:
            return False

        # Wait and verify second token
        import time
        time.sleep(1)

        return self.verify_token(secret, token2)


class TwoFactorDialog(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑŸÖÿµÿßÿØŸÇÿ© ÿßŸÑÿ´ŸÜÿßÿ¶Ÿäÿ©"""

    def __init__(self, parent, lang_manager, theme_manager):
        super().__init__(parent)

        self.parent = parent
        self.lang_manager = lang_manager
        self.theme_manager = theme_manager
        self.result = None

        # Setup window
        self.title(self.lang_manager.get("2fa_title", "Two-Factor Authentication"))
        self.geometry("400x300")
        self.resizable(False, False)

        # Make modal
        self.transient(parent)
        self.grab_set()

        # Build UI
        self._build_ui()

        # Center window
        self.update_idletasks()
        x = (self.winfo_screenwidth() - 400) // 2
        y = (self.winfo_screenheight() - 300) // 2
        self.geometry(f"400x300+{x}+{y}")

        # Focus on entry
        self.after(100, lambda: self.code_entry.focus_set())

    def _build_ui(self):
        """Build dialog UI"""
        # Main frame
        main_frame = ctk.CTkFrame(self)
        main_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # Icon and title
        title_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        title_frame.pack(fill="x", pady=(0, 20))

        icon_label = ctk.CTkLabel(
            title_frame,
            text="üîê",
            font=ctk.CTkFont(size=48)
        )
        icon_label.pack()

        title_label = ctk.CTkLabel(
            title_frame,
            text=self.lang_manager.get("2fa_prompt", "Enter Authentication Code"),
            font=ctk.CTkFont(size=18, weight="bold")
        )
        title_label.pack(pady=(10, 0))

        # Instructions
        instructions = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get(
                "2fa_instructions",
                "Enter the 6-digit code from your authenticator app"
            ),
            font=ctk.CTkFont(size=12),
            text_color="gray60",
            wraplength=350
        )
        instructions.pack(pady=(0, 20))

        # Code entry
        self.code_entry = ctk.CTkEntry(
            main_frame,
            placeholder_text="000 000",
            font=ctk.CTkFont(size=24, weight="bold"),
            justify="center",
            height=50,
            width=200
        )
        self.code_entry.pack()

        # Bind events
        self.code_entry.bind("<Return>", lambda e: self._verify())
        self.code_entry.bind("<KeyRelease>", self._format_code)

        # Buttons
        button_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        button_frame.pack(fill="x", pady=(30, 0))

        self.verify_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("verify", "Verify"),
            command=self._verify,
            width=120,
            height=40
        )
        self.verify_btn.pack(side="left", padx=(0, 10))

        self.cancel_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self._cancel,
            width=120,
            height=40,
            fg_color="transparent",
            border_width=2
        )
        self.cancel_btn.pack(side="left")

        # Use backup code link
        backup_link = ctk.CTkButton(
            main_frame,
            text=self.lang_manager.get("use_backup_code", "Use backup code"),
            font=ctk.CTkFont(size=12, underline=True),
            fg_color="transparent",
            text_color=("blue", "lightblue"),
            hover=False,
            command=self._use_backup_code
        )
        backup_link.pack(pady=(15, 0))

    def _format_code(self, event=None):
        """Format code as XXX XXX"""
        text = self.code_entry.get().replace(" ", "")

        # Only allow digits
        text = ''.join(c for c in text if c.isdigit())[:6]

        # Format with space
        if len(text) > 3:
            text = f"{text[:3]} {text[3:]}"

        # Update entry
        self.code_entry.delete(0, "end")
        self.code_entry.insert(0, text)

    def _verify(self):
        """Verify code"""
        code = self.code_entry.get().replace(" ", "")

        if len(code) != 6 or not code.isdigit():
            self.code_entry.configure(border_color="red")
            return

        self.result = code
        self.destroy()

    def _cancel(self):
        """Cancel dialog"""
        self.result = None
        self.destroy()

    def _use_backup_code(self):
        """Switch to backup code entry"""
        # Change UI for backup code entry
        self.code_entry.configure(placeholder_text="XXXX-XXXX")
        self.title(self.lang_manager.get("backup_code_title", "Enter Backup Code"))

    def get_code(self) -> Optional[str]:
        """Get entered code"""
        self.wait_window()
        return self.result

============================================================
FILE: data\login_cache.json
SIZE: 89 characters
============================================================

{
  "username": "user",
  "remember": true,
  "timestamp": "2025-07-03T04:24:57.383528"
}

============================================================
FILE: locales\ar.yaml
SIZE: 24141 characters
============================================================

# locales/ar.yaml - ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ≠ÿØÿ´ÿ© ŸàÿßŸÑŸÉÿßŸÖŸÑÿ©

# ÿπŸÜÿßŸàŸäŸÜ ÿßŸÑŸÜŸàÿßŸÅÿ∞
login_title: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"
main_window_title: "ŸÖÿØŸäÿ± ŸÖÿ®Ÿäÿπÿßÿ™ FTS"
add_edit_title: "ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ¨ÿ≤"
view_manager_title: "ŸÖÿØŸäÿ± ÿ∑ÿ±ŸÇ ÿßŸÑÿπÿ±ÿ∂"

# ÿ™ÿ≥ŸÖŸäÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
username_label: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"
password_label: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"
username_placeholder: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"
password_placeholder: "ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"
login_button: "ÿØÿÆŸàŸÑ"
show_password: "ÿ•ÿ∏Ÿáÿßÿ±"
toggle_theme: "ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ´ŸäŸÖ"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
error_empty_credentials: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±."
error_invalid_credentials: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠."
error_auth_exception: "ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ŸÇŸÇ."
error_login_process: "ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ."

# ============ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ============
# ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
file_menu: "ŸÖŸÑŸÅ"
edit_menu: "ÿ™ÿ≠ÿ±Ÿäÿ±"
view_menu: "ÿπÿ±ÿ∂"
tools_menu: "ÿ£ÿØŸàÿßÿ™"
admin_menu: "ŸÖÿ≥ÿ§ŸàŸÑ"
help_menu: "ŸÖÿ≥ÿßÿπÿØÿ©"

# ÿπŸÜÿßÿµÿ± ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÑŸÅ
logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨"
export_data: "ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"
close: "ÿ•ÿ∫ŸÑÿßŸÇ"

# ÿπŸÜÿßÿµÿ± ŸÇÿßÿ¶ŸÖÿ© ÿπÿ±ÿ∂
dark_mode: "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ"
language_menu: "ÿßŸÑŸÑÿ∫ÿ©"
arabic: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"
english: "English"
fullscreen: "ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"
performance_mode: "Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä"

# ÿπŸÜÿßÿµÿ± ŸÇÿßÿ¶ŸÖÿ© ÿ£ÿØŸàÿßÿ™
reports: "ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±"

# ÿπŸÜÿßÿµÿ± ŸÇÿßÿ¶ŸÖÿ© ŸÖÿ≥ÿ§ŸàŸÑ
user_management: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"
config_editor: "ŸÖÿ≠ÿ±ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
clear_cache: "ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©"
view_logs: "ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"

# ÿπŸÜÿßÿµÿ± ŸÇÿßÿ¶ŸÖÿ© ŸÖÿ≥ÿßÿπÿØÿ©
user_guide: "ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ£ŸÉŸäÿØ ÿ•ÿ∂ÿßŸÅŸäÿ©
confirm_logout: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü"
confirm_clear_cache: "ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©ÿü"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ≠ÿßŸÑÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
performance_mode_enabled: "ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä"
performance_mode_disabled: "ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä"
cache_cleared: "ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© ÿ®ŸÜÿ¨ÿßÿ≠"
fullscreen_enabled: "ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"
fullscreen_disabled: "ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"

# ÿ±ÿ≥ÿßÿ¶ŸÑ "ŸÇÿ±Ÿäÿ®ÿßŸã"
coming_soon: "ŸÇÿ±Ÿäÿ®ÿßŸã"
export_coming_soon: "ŸÖŸäÿ≤ÿ© ÿßŸÑÿ™ÿµÿØŸäÿ± ŸÇÿ±Ÿäÿ®ÿßŸã"
reports_coming_soon: "ŸÖŸäÿ≤ÿ© ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ŸÇÿ±Ÿäÿ®ÿßŸã"
user_management_coming_soon: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÇÿ±Ÿäÿ®ÿßŸã"
config_editor_coming_soon: "ŸÖÿ≠ÿ±ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿ±Ÿäÿ®ÿßŸã"
logs_viewer_coming_soon: "ÿπÿßÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÇÿ±Ÿäÿ®ÿßŸã"

# ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
guide_add: "ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ¨ÿ≤: ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ Ctrl+N"
guide_edit: "ŸÑŸÑÿ™ÿπÿØŸäŸÑ: ÿßŸÜŸÇÿ± ŸÖÿ≤ÿØŸàÿ¨ÿßŸã ÿπŸÑŸâ ÿ≠ÿ¨ÿ≤ ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ Ctrl+E"
guide_delete: "ŸÑŸÑÿ≠ÿ∞ŸÅ: ÿ≠ÿØÿØ ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ Ÿàÿßÿ∂ÿ∫ÿ∑ Delete"
guide_search: "ŸÑŸÑÿ®ÿ≠ÿ´: ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿµŸÜÿØŸàŸÇ ÿßŸÑÿ®ÿ≠ÿ´ ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ Ctrl+F"
guide_export: "ŸÑŸÑÿ™ÿµÿØŸäÿ±: ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÑŸÅ > ÿ™ÿµÿØŸäÿ± ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ Ctrl+S"

# ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨
app_name: "ŸÖÿØŸäÿ± ŸÖÿ®Ÿäÿπÿßÿ™ FTS"
developed_by: "ÿ™ŸÖ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿ®Ÿàÿßÿ≥ÿ∑ÿ©"
logged_as: "ŸÖÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉŸÄ"
user_role: "ÿßŸÑÿØŸàÿ±"

# ============ ÿ®ÿßŸÇŸä ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ£ÿµŸÑŸä ============

# ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
menu_settings: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
menu_change_language: "ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"
menu_toggle_theme: "ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ´ŸäŸÖ"
menu_account: "ÿßŸÑÿ≠ÿ≥ÿßÿ®"
menu_logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"
menu_exit: "ÿÆÿ±Ÿàÿ¨"
menu_views: "ÿ∑ÿ±ŸÇ ÿßŸÑÿπÿ±ÿ∂"
menu_view_manager: "ŸÖÿØŸäÿ± ÿ∑ÿ±ŸÇ ÿßŸÑÿπÿ±ÿ∂"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ£ŸÉŸäÿØ
confirm_change_language: "ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©ÿü"
confirm_exit: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü"
confirm_delete: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ¨ÿ≤ÿü"
confirm_delete_multiple: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ {} ÿ≠ÿ¨ÿ≤ÿü"
confirm_close: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ"

# ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑÿ≠ÿßŸÑÿ©
search_label: "ÿ®ÿ≠ÿ´:"
search_placeholder: "ÿßŸÉÿ™ÿ® ŸÑŸÑÿ®ÿ≠ÿ´..."
status_loading: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ..."
status_load_complete: "ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {} ÿ≥ÿ¨ŸÑ."
error_loading_records: "ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™."
loading_data: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™..."
refreshing_data: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™..."
saving_data: "ÿ¨ÿßÿ±Ÿä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™..."
processing: "ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©..."

# ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
add: "ÿ•ÿ∂ÿßŸÅÿ©"
edit: "ÿ™ÿπÿØŸäŸÑ"
delete: "ÿ≠ÿ∞ŸÅ"
save: "ÿ≠ŸÅÿ∏"
cancel: "ÿ•ŸÑÿ∫ÿßÿ°"
close: "ÿ•ÿ∫ŸÑÿßŸÇ"
refresh: "ÿ™ÿ≠ÿØŸäÿ´"
export: "ÿ™ÿµÿØŸäÿ±"
import: "ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ"
print: "ÿ∑ÿ®ÿßÿπÿ©"
apply: "ÿ™ÿ∑ÿ®ŸäŸÇ"
clear: "ŸÖÿ≥ÿ≠"
search: "ÿ®ÿ≠ÿ´"
filter: "ÿ™ÿµŸÅŸäÿ©"
sort: "ÿ™ÿ±ÿ™Ÿäÿ®"
select_all: "ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ"
clear_selection: "ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿØ"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
add_button: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ¨ÿ≤"
edit_button: "‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ¨ÿ≤"
delete_button: "üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿ≠ÿ¨ÿ≤"
refresh_button: "üîÑ ÿ™ÿ≠ÿØŸäÿ´"
export_button: "üì§ ÿ™ÿµÿØŸäÿ±"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
error_no_selection: "Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ≥ÿ¨ŸÑ."
select_booking_edit: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿ≠ÿ¨ÿ≤ ŸÑŸÑÿ™ÿπÿØŸäŸÑ"
select_booking_delete: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿ≠ÿ¨ÿ≤ ŸÑŸÑÿ≠ÿ∞ŸÅ"
select_one_booking_only: "ŸäŸÖŸÉŸÜ ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ¨ÿ≤ Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑ ŸÅŸä ŸÉŸÑ ŸÖÿ±ÿ©"
selected_count: "ŸÖÿ≠ÿØÿØ: {} ÿ≠ÿ¨ÿ≤"
no_selection: "ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ÿ≠ÿØŸäÿØ"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿ¨ÿßÿ≠ ŸàÿßŸÑÿÆÿ∑ÿ£
success: "ŸÜÿ¨ÿßÿ≠"
error: "ÿÆÿ∑ÿ£"
warning: "ÿ™ÿ≠ÿ∞Ÿäÿ±"
info: "ŸÖÿπŸÑŸàŸÖÿßÿ™"
success_save: "ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏ ÿ®ŸÜÿ¨ÿßÿ≠!"
success_update: "ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸÜÿ¨ÿßÿ≠!"
success_delete: "ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠!"
error_save: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"
error_update: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"
error_delete: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ¨ŸÑ"
error_load: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"
error_add_form: "ŸÅÿ¥ŸÑ ŸÅŸä ŸÅÿ™ÿ≠ ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©"
error_edit_form: "ŸÅÿ¥ŸÑ ŸÅŸä ŸÅÿ™ÿ≠ ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ÿπÿØŸäŸÑ"

# ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©/ÿßŸÑÿ™ÿπÿØŸäŸÑ
basic_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©"
trip_details: "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
passenger_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ±ŸÉÿßÿ®"
contact_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ"
pricing_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±"
additional_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©"

# ÿßŸÑÿ≠ŸÇŸàŸÑ
customer_name: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ"
hotel_name: "ÿßÿ≥ŸÖ ÿßŸÑŸÅŸÜÿØŸÇ"
agency: "ÿßŸÑŸàŸÉÿßŸÑÿ©"
booking_number: "ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"
room_number: "ÿ±ŸÇŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©"
trip_name: "ÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
trip_date: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
option: "ÿßŸÑÿÆŸäÿßÿ±"
destination: "ÿßŸÑŸàÿ¨Ÿáÿ©"
guide: "ÿßŸÑŸÖÿ±ÿ¥ÿØ"
product_id: "ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨"
pickup_time: "ŸàŸÇÿ™ ÿßŸÑÿßŸÜÿ∑ŸÑÿßŸÇ"
remarks: "ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™"
add_ons: "ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™"
adults: "ÿßŸÑÿ®ÿßŸÑÿ∫ŸäŸÜ"
children: "ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ"
students: "ÿßŸÑÿ∑ŸÑÿßÿ®"
youth: "ÿßŸÑÿ¥ÿ®ÿßÿ®"
infants: "ÿßŸÑÿ±ÿ∂ÿπ"
children_ages: "ÿ£ÿπŸÖÿßÿ± ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ"
phone_number: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ"
email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"
customer_country: "ÿ®ŸÑÿØ ÿßŸÑÿπŸÖŸäŸÑ"
total_price_usd: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (USD)"
total_price_eur: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (EUR)"
total_price_gbp: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (GBP)"
net_rate: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿµÿßŸÅŸä"
currency: "ÿßŸÑÿπŸÖŸÑÿ©"
cost_egp: "ÿßŸÑÿ™ŸÉŸÑŸÅÿ© (EGP)"
collecting_on_date: "ÿßŸÑÿ™ÿ≠ÿµŸäŸÑ ÿπŸÜÿØ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
management_option: "ÿÆŸäÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ©"
add_on: "ÿ•ÿ∂ÿßŸÅÿ©"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ≠ŸÇŸÇ
required_field: "Ÿáÿ∞ÿß ÿßŸÑÿ≠ŸÇŸÑ ŸÖÿ∑ŸÑŸàÿ®"
invalid_phone: "ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"
invalid_date: "ÿ™ÿßÿ±ŸäÿÆ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"
invalid_number: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿµÿ≠Ÿäÿ≠"
future_date: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÑÿß ŸäŸÖŸÉŸÜ ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÅŸä ÿßŸÑŸÖÿßÿ∂Ÿä"
negative_amount: "ÿßŸÑŸÖÿ®ŸÑÿ∫ ŸÑÿß ŸäŸÖŸÉŸÜ ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿ≥ÿßŸÑÿ®ÿßŸã"
invalid_email: "ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"

# ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
add_new_value: "ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ©"
enter_new_value: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©:"
value_added_successfully: "ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© '{}' ÿ®ŸÜÿ¨ÿßÿ≠"
failed_add_value: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© ÿ•ŸÑŸâ Airtable"
dropdown_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ŸÇŸäŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"
dropdown_manager_unavailable: "ŸÖÿØŸäÿ± ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠"
refresh_lists: "ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"
lists_status: "ÿ≠ÿßŸÑÿ© ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"
lists_updated: "ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠"
update_failed: "ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"
loading_lists: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ..."
updating_lists: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ..."
all_lists_working: "ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ™ÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠!"
dropdown_errors: "ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"
check_connection: "ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ:\n1. ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™\n2. ŸÖŸÅÿ™ÿßÿ≠ API ŸàŸÖÿπÿ±ŸÅ ÿßŸÑŸÇÿßÿπÿØÿ©\n3. Ÿàÿ¨ŸàÿØ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ŸÅŸä Airtable"

# ÿßŸÑÿ™ŸÜŸÇŸÑ
previous: "ÿßŸÑÿ≥ÿßÿ®ŸÇ"
next: "ÿßŸÑÿ™ÿßŸÑŸä"
first_page: "ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ŸàŸÑŸâ"
last_page: "ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©"
page: "ÿµŸÅÿ≠ÿ©"
of: "ŸÖŸÜ"
showing: "ÿπÿ±ÿ∂"
to: "ÿ•ŸÑŸâ"
total_records: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"
navigating_to: "ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ"

# ÿßŸÑŸÖÿ≥ŸàÿØÿßÿ™
draft: "ŸÖÿ≥ŸàÿØÿ©"
save_draft: "ÿ≠ŸÅÿ∏ ŸÉŸÖÿ≥ŸàÿØÿ©"
load_draft: "ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ≥ŸàÿØÿ©"
draft_saved: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ŸàÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠"
draft_save_failed: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ŸàÿØÿ©"
draft_found: "ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿ≥ŸàÿØÿ©"
load_draft_question: "ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿ≥ŸàÿØÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑŸáÿßÿü"
unsaved_changes: "ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ŸÅŸàÿ∏ÿ©"
save_draft_question: "ŸáŸÜÿßŸÉ ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ŸÅŸàÿ∏ÿ©.\n\nŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ŸÅÿ∏Ÿáÿß ŸÉŸÖÿ≥ŸàÿØÿ©ÿü"

# ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠
shortcuts: "ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™"
keyboard_shortcuts: "ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠"
required_fields: "ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©"
change_language: "ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"
change_theme: "ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ"

# Views Ÿàÿ∑ÿ±ŸÇ ÿßŸÑÿπÿ±ÿ∂
view_label: "ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂:"
all_records: "ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"
today_bookings: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸäŸàŸÖ"
this_week: "Ÿáÿ∞ÿß ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ"
this_month: "Ÿáÿ∞ÿß ÿßŸÑÿ¥Ÿáÿ±"
pending_bookings: "ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ©"
confirmed_bookings: "ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÖÿ§ŸÉÿØÿ©"
cancelled_bookings: "ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÖŸÑÿ∫ÿßÿ©"
my_bookings: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™Ÿä"
team_bookings: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÅÿ±ŸäŸÇ"
high_priority: "ÿ£ŸàŸÑŸàŸäÿ© ÿπÿßŸÑŸäÿ©"
vip_customers: "ÿπŸÖŸÑÿßÿ° VIP"
airport_transfers: "ŸÜŸÇŸÑ ÿßŸÑŸÖÿ∑ÿßÿ±"
hotel_transfers: "ŸÜŸÇŸÑ ÿßŸÑŸÅŸÜÿØŸÇ"
tour_bookings: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑÿ¨ŸàŸÑÿßÿ™"

# ŸÖÿØŸäÿ± Views
view_manager: "ŸÖÿØŸäÿ± ÿ∑ÿ±ŸÇ ÿßŸÑÿπÿ±ÿ∂"
assign_views_to_users: "ÿ™ÿπŸäŸäŸÜ ÿ∑ÿ±ŸÇ ÿßŸÑÿπÿ±ÿ∂ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"
select_view: "ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂:"
apply_to_selected: "ÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÑŸâ ÿßŸÑŸÖÿ≠ÿØÿØ"
apply_to_all_role: "ÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿØŸàÿ±"
apply_to_role: "ÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÑŸâ ÿßŸÑÿØŸàÿ±"
select_role_and_view: "ÿßÿÆÿ™ÿ± ÿßŸÑÿØŸàÿ± Ÿàÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂:"
select_view_first: "Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿπÿ±ÿ∂ ÿ£ŸàŸÑÿßŸã"
select_user_first: "Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£ŸàŸÑÿßŸã"
select_role_and_view_first: "Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿØŸàÿ± Ÿàÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂"
save_changes: "ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™"
save_all_changes: "ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™"
no_changes_to_save: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ŸÑŸÑÿ≠ŸÅÿ∏"
failed_load_users: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ"
failed_save_changes: "ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™"

# ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ≠ÿ¨ÿ≤
booking_status: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ¨ÿ≤"
status_active: "ŸÜÿ¥ÿ∑"
status_pending: "ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±"
status_confirmed: "ŸÖÿ§ŸÉÿØ"
status_cancelled: "ŸÖŸÑÿ∫Ÿä"
status_completed: "ŸÖŸÉÿ™ŸÖŸÑ"

# ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
statistics: "ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™"
total_bookings: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™"
today_count: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸäŸàŸÖ"
pending_count: "ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑŸÖŸàÿßŸÅŸÇÿ©"

# ÿßŸÑÿ™ÿµÿØŸäÿ±
export_to_excel: "ÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ Excel"
export_to_pdf: "ÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ PDF"
export_success: "ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠"
export_failed: "ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿµÿØŸäÿ±"
no_data_export: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±"

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿπÿßŸÖÿ©
please_wait: "Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±..."
loading: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ..."
done: "ÿ™ŸÖ"
yes: "ŸÜÿπŸÖ"
no: "ŸÑÿß"
ok: "ŸÖŸàÿßŸÅŸÇ"
confirm: "ÿ™ÿ£ŸÉŸäÿØ"
back: "ÿ±ÿ¨Ÿàÿπ"
forward: "ŸÑŸÑÿ£ŸÖÿßŸÖ"
help: "ŸÖÿ≥ÿßÿπÿØÿ©"
about: "ÿ≠ŸàŸÑ"
version: "ÿßŸÑÿ•ÿµÿØÿßÿ±"
copyright: "¬© 2024 FTS. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©."

# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ
system_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ"
network_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ¥ÿ®ŸÉÿ©"
permission_denied: "ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿµŸÑÿßÿ≠Ÿäÿ©"
session_expired: "ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©"
please_login_again: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ"

# ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™
date: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
time: "ÿßŸÑŸàŸÇÿ™"
datetime: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™"
today: "ÿßŸÑŸäŸàŸÖ"
yesterday: "ÿ£ŸÖÿ≥"
tomorrow: "ÿ∫ÿØÿßŸã"
this_week: "Ÿáÿ∞ÿß ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ"
last_week: "ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ ÿßŸÑŸÖÿßÿ∂Ÿä"
next_week: "ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ ÿßŸÑŸÇÿßÿØŸÖ"
this_month: "Ÿáÿ∞ÿß ÿßŸÑÿ¥Ÿáÿ±"
last_month: "ÿßŸÑÿ¥Ÿáÿ± ÿßŸÑŸÖÿßÿ∂Ÿä"
next_month: "ÿßŸÑÿ¥Ÿáÿ± ÿßŸÑŸÇÿßÿØŸÖ"
this_year: "Ÿáÿ∞Ÿá ÿßŸÑÿ≥ŸÜÿ©"
last_year: "ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸÖÿßÿ∂Ÿäÿ©"
next_year: "ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©"

# ÿ£ŸäÿßŸÖ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ
monday: "ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ"
tuesday: "ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°"
wednesday: "ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°"
thursday: "ÿßŸÑÿÆŸÖŸäÿ≥"
friday: "ÿßŸÑÿ¨ŸÖÿπÿ©"
saturday: "ÿßŸÑÿ≥ÿ®ÿ™"
sunday: "ÿßŸÑÿ£ÿ≠ÿØ"

# ÿßŸÑÿ£ÿ¥Ÿáÿ±
january: "ŸäŸÜÿßŸäÿ±"
february: "ŸÅÿ®ÿ±ÿßŸäÿ±"
march: "ŸÖÿßÿ±ÿ≥"
april: "ÿ£ÿ®ÿ±ŸäŸÑ"
may: "ŸÖÿßŸäŸà"
june: "ŸäŸàŸÜŸäŸà"
july: "ŸäŸàŸÑŸäŸà"
august: "ÿ£ÿ∫ÿ≥ÿ∑ÿ≥"
september: "ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±"
october: "ÿ£ŸÉÿ™Ÿàÿ®ÿ±"
november: "ŸÜŸàŸÅŸÖÿ®ÿ±"
december: "ÿØŸäÿ≥ŸÖÿ®ÿ±"

# ÿßŸÑÿ™ŸÜŸÇŸÑ
nav_home: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"
nav_today: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸäŸàŸÖ"
nav_pending: "ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ©"
nav_confirmed: "ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÖÿ§ŸÉÿØÿ©"
nav_reports: "ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±"

# ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
stats_total: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™"
stats_today: "ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸäŸàŸÖ"
stats_pending: "ŸÖÿπŸÑŸÇÿ©"

# ÿßŸÑÿ£ÿØŸàÿßÿ±
role_admin: "ŸÖÿØŸäÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ"
role_manager: "ŸÖÿØŸäÿ±"
role_editor: "ŸÖÿ≠ÿ±ÿ±"
role_viewer: "ŸÖÿ¥ÿßŸáÿØ"

# ÿßŸÑÿ®ÿ≠ÿ´
search_placeholder: "ÿ®ÿ≠ÿ´..."

# ÿπŸÜÿßŸàŸäŸÜ ÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ¨ÿØŸàŸÑ
booking_number: "ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"
trip_date: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
customer_name: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ"
hotel: "ÿßŸÑŸÅŸÜÿØŸÇ"
pickup_time: "ŸàŸÇÿ™ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ"
price: "ÿßŸÑÿ≥ÿπÿ±"
status: "ÿßŸÑÿ≠ÿßŸÑÿ©"

# ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ≠ÿ¨ÿ≤
status_confirmed: "ŸÖÿ§ŸÉÿØ"
status_pending: "ŸÖÿπŸÑŸÇ"
status_cancelled: "ŸÖŸÑÿ∫Ÿä"
status_completed: "ŸÖŸÉÿ™ŸÖŸÑ"
deleted: "ŸÖÿ≠ÿ∞ŸàŸÅ"

# ============ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ŸÅŸä ÿßŸÑŸáŸäÿØÿ± ============
# ÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
menu_profile: "ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä"
menu_settings: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
menu_language: "ÿßŸÑŸÑÿ∫ÿ©"
menu_about: "ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"
menu_logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"

# ŸÑŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä
profile_title: "ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä"
basic_info: "ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©"
usage_stats: "ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ"
actions: "ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™"
change_password: "ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"
update_email: "ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"
last_login: "ÿ¢ÿÆÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ"
login_count: "ÿπÿØÿØ ŸÖÿ±ÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ"
created_date: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ∂ŸÖÿßŸÖ"
member_since: "ÿπÿ∂Ÿà ŸÖŸÜÿ∞"
current_password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ©"
new_password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©"
confirm_password: "ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"
password_changed: "ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ®ŸÜÿ¨ÿßÿ≠"
incorrect_password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©"
passwords_dont_match: "ŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ©"
password_too_short: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ"
current_email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿßŸÑÿ≠ÿßŸÑŸä:"
new_email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿßŸÑÿ¨ÿØŸäÿØ"
enter_email: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"
email_update_request: "ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÑŸÑŸÖÿ≥ÿ§ŸàŸÑ"
phone: "ÿßŸÑŸáÿßÿ™ŸÅ"
department: "ÿßŸÑŸÇÿ≥ŸÖ"
airtable_view: "ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿÆÿµÿµÿ©"

# ŸÑŸÑÿ•ÿπÿØÿßÿØÿßÿ™
settings_title: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
appearance: "ÿßŸÑŸÖÿ∏Ÿáÿ±"
performance: "ÿßŸÑÿ£ÿØÿßÿ°"
advanced: "ŸÖÿ™ŸÇÿØŸÖ"
theme_mode: "Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ∏Ÿáÿ±"
primary_color: "ÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä"
font_size: "ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑"
preview: "ŸÖÿπÿßŸäŸÜÿ©"
preview_text: "Ÿáÿ∞Ÿá ŸÖÿπÿßŸäŸÜÿ© ŸÑÿ•ÿπÿØÿßÿØÿßÿ™ŸÉ"
auto_refresh: "ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä"
refresh_interval: "ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´"
enable_auto_refresh: "ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™"
records_per_page: "ÿπÿØÿØ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ©"
lazy_loading: "ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿ≥ŸàŸÑ"
enable_lazy_loading: "ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ©"
developer_mode: "Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ∑Ÿàÿ±"
enable_dev_mode: "ÿ•ÿ∏Ÿáÿßÿ± ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±"
export_settings: "ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
import_settings: "ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
reset_settings: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
export_to_file: "ÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ ŸÖŸÑŸÅ"
import_from_file: "ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸÜ ŸÖŸÑŸÅ"
reset_to_default: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÑŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"
save_settings: "ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"
settings_saved: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠"
settings_exported: "ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠"
settings_imported: "ÿ™ŸÖ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠"
settings_reset: "ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"
discard_changes: "ÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©ÿü"
confirm_reset: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©ÿü"

# ŸÑŸÑÿ∫ÿ©
language_title: "ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©"
language_desc: "ÿßÿÆÿ™ÿ± ŸÑÿ∫ÿ™ŸÉ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©"
current: "ÿßŸÑÿ≠ÿßŸÑŸäÿ©"

# ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
about_title: "ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"
build: "ÿßŸÑÿ•ÿµÿØÿßÿ±"
developer: "ÿßŸÑŸÖÿ∑Ÿàÿ±"
license: "ÿßŸÑÿ™ÿ±ÿÆŸäÿµ"
website: "ÿßŸÑŸÖŸàŸÇÿπ"
support: "ÿßŸÑÿØÿπŸÖ"
app_description: "FTS Travels Sales Manager ŸáŸà ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™ ŸàÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑÿ≥Ÿäÿßÿ≠Ÿäÿ©.\n\nŸäŸàŸÅÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ£ÿØŸàÿßÿ™ ŸÇŸàŸäÿ© ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÖŸÑÿßÿ° ŸàÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ŸàÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑŸÖÿßŸÑŸäÿ©."
feature_not_available: "Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©"
fill_all_fields: "Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ"
logout_error: "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"

palette: "ÿßŸÑÿ£ŸÑŸàÿßŸÜ"
choose_palette: "ÿßÿÆÿ™ÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ"
select_palette: "ÿßÿÆÿ™ÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ"
palette_desc: "ÿßÿÆÿ™ÿ± ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖŸÅÿ∂ŸÑ ŸÑÿØŸäŸÉ ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠"
purple_modern: "ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä ÿπÿµÿ±Ÿä"
blue_modern: "ÿ£ÿ≤ÿ±ŸÇ ÿπÿµÿ±Ÿä"
emerald_modern: "ÿ≤ŸÖÿ±ÿØŸä ÿπÿµÿ±Ÿä"
pink_modern: "Ÿàÿ±ÿØŸä ÿπÿµÿ±Ÿä"
orange_warm: "ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä ÿØÿßŸÅÿ¶"
indigo_elegant: "ŸÜŸäŸÑŸä ÿ£ŸÜŸäŸÇ"
blue_classic: "ÿ£ÿ≤ÿ±ŸÇ ŸÉŸÑÿßÿ≥ŸäŸÉŸä"
apply: "ÿ™ÿ∑ÿ®ŸäŸÇ"
palette_saved: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ŸÅÿ™ÿ≠ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©."
theme_dark: "ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ"
theme_light: "ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠"
theme_change: "ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ"
theme_change_msg: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ŸÅÿ™ÿ≠ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ¨ÿØŸäÿØ."

# =============================================================================
# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
# =============================================================================
basic_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©"
trip_details: "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
passenger_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ±ŸÉÿßÿ®"
contact_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ"
pricing_info: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±"

# =============================================================================
# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ - ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
# =============================================================================
customer_name: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ"
hotel_name: "ÿßÿ≥ŸÖ ÿßŸÑŸÅŸÜÿØŸÇ"
agency: "ÿßŸÑŸàŸÉÿßŸÑÿ©"
booking_number: "ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"
room_number: "ÿ±ŸÇŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©"

# =============================================================================
# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ - ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿ≠ŸÑÿ©
# =============================================================================
trip_name: "ÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
trip_date: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
option: "ÿßŸÑÿÆŸäÿßÿ±"
destination: "ÿßŸÑŸàÿ¨Ÿáÿ©"
guide: "ÿßŸÑŸÖÿ±ÿ¥ÿØ"
product_id: "ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨"
pickup_time: "ŸàŸÇÿ™ ÿßŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ"
remarks: "ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™"
add_ons: "ÿ•ÿ∂ÿßŸÅÿßÿ™"

# =============================================================================
# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ - ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ±ŸÉÿßÿ®
# =============================================================================
adults: "ÿßŸÑÿ®ÿßŸÑÿ∫ŸäŸÜ"
children: "ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ"
students: "ÿßŸÑÿ∑ŸÑÿßÿ®"
youth: "ÿßŸÑÿ¥ÿ®ÿßÿ®"
infants: "ÿßŸÑÿ±ÿ∂ÿπ"
children_ages: "ÿ£ÿπŸÖÿßÿ± ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ"

# =============================================================================
# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ - ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
# =============================================================================
phone_number: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ"
email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"
customer_country: "ÿ®ŸÑÿØ ÿßŸÑÿπŸÖŸäŸÑ"

# =============================================================================
# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ - ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±
# =============================================================================
total_price_usd: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä)"
total_price_eur: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (ŸäŸàÿ±Ÿà)"
total_price_gbp: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (ÿ¨ŸÜŸäŸá ÿ•ÿ≥ÿ™ÿ±ŸÑŸäŸÜŸä)"
net_rate: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿµÿßŸÅŸä"
currency: "ÿßŸÑÿπŸÖŸÑÿ©"
cost_egp: "ÿßŸÑÿ™ŸÉŸÑŸÅÿ© (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä)"
collecting_on_date: "ÿßŸÑÿ™ÿ≠ÿµŸäŸÑ ŸÅŸä ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ±ÿ≠ŸÑÿ©"
management_option: "ÿÆŸäÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ©"
add_on: "ÿ•ÿ∂ÿßŸÅÿ©"

# =============================================================================
# ÿ£ÿ≤ÿ±ÿßÿ± ŸàÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
# =============================================================================
search: "ÿ®ÿ≠ÿ´"
clear: "ŸÖÿ≥ÿ≠"
reset: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ"
apply: "ÿ™ÿ∑ÿ®ŸäŸÇ"
filter: "ŸÅŸÑÿ™ÿ±"
export: "ÿ™ÿµÿØŸäÿ±"
import: "ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ"
print: "ÿ∑ÿ®ÿßÿπÿ©"
help: "ŸÖÿ≥ÿßÿπÿØÿ©"
about: "ÿ≠ŸàŸÑ"
settings: "ÿ•ÿπÿØÿßÿØÿßÿ™"
preferences: "ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™"
language: "ÿßŸÑŸÑÿ∫ÿ©"
theme: "ÿßŸÑŸÖÿ∏Ÿáÿ±"
dark_mode: "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ∏ŸÑŸÖ"
light_mode: "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠"

# =============================================================================
# ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
# =============================================================================
active: "ŸÜÿ¥ÿ∑"
inactive: "ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑"
pending: "ŸÖÿπŸÑŸÇ"
confirmed: "ŸÖÿ§ŸÉÿØ"
cancelled: "ŸÖŸÑÿ∫Ÿä"
completed: "ŸÖŸÉÿ™ŸÖŸÑ"
in_progress: "ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞"
draft_status: "ŸÖÿ≥ŸàÿØÿ©"
published: "ŸÖŸÜÿ¥Ÿàÿ±"
archived: "ŸÖÿ§ÿ±ÿ¥ŸÅ"

# =============================================================================
# ÿ£ŸäÿßŸÖ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ
# =============================================================================
monday: "ÿßŸÑÿßÿ´ŸÜŸäŸÜ"
tuesday: "ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°"
wednesday: "ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°"
thursday: "ÿßŸÑÿÆŸÖŸäÿ≥"
friday: "ÿßŸÑÿ¨ŸÖÿπÿ©"
saturday: "ÿßŸÑÿ≥ÿ®ÿ™"
sunday: "ÿßŸÑÿ£ÿ≠ÿØ"

# =============================================================================
# ÿ£ÿ¥Ÿáÿ± ÿßŸÑÿ≥ŸÜÿ©
# =============================================================================
january: "ŸäŸÜÿßŸäÿ±"
february: "ŸÅÿ®ÿ±ÿßŸäÿ±"
march: "ŸÖÿßÿ±ÿ≥"
april: "ÿ£ÿ®ÿ±ŸäŸÑ"
may: "ŸÖÿßŸäŸà"
june: "ŸäŸàŸÜŸäŸà"
july: "ŸäŸàŸÑŸäŸà"
august: "ÿ£ÿ∫ÿ≥ÿ∑ÿ≥"
september: "ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±"
october: "ÿ£ŸÉÿ™Ÿàÿ®ÿ±"
november: "ŸÜŸàŸÅŸÖÿ®ÿ±"
december: "ÿØŸäÿ≥ŸÖÿ®ÿ±"

# =============================================================================
# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ≠ŸÇŸÇ
# =============================================================================
invalid_email: "ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"
invalid_phone: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"
invalid_date: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"
invalid_number: "ÿßŸÑÿ±ŸÇŸÖ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠"
field_too_long: "ÿßŸÑÿ≠ŸÇŸÑ ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã"
field_too_short: "ÿßŸÑÿ≠ŸÇŸÑ ŸÇÿµŸäÿ± ÿ¨ÿØÿßŸã"
passwords_dont_match: "ŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ©"
password_too_weak: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∂ÿπŸäŸÅÿ©"

# =============================================================================
# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿ¨ÿßÿ≠
# =============================================================================
data_loaded: "ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠"
settings_saved: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠"
export_completed: "ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠"
import_completed: "ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ®ŸÜÿ¨ÿßÿ≠"
backup_created: "ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠"
backup_restored: "ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠"

# =============================================================================
# ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£
# =============================================================================
file_not_found: "ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ"
access_denied: "ÿßŸÑŸàÿµŸàŸÑ ŸÖÿ±ŸÅŸàÿ∂"
network_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ¥ÿ®ŸÉÿ©"
server_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿÆÿßÿØŸÖ"
database_error: "ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"
permission_denied: "ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ© ŸÖÿ±ŸÅŸàÿ∂ÿ©"
invalid_credentials: "ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©"
session_expired: "ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©"
file_corrupted: "ÿßŸÑŸÖŸÑŸÅ ÿ™ÿßŸÑŸÅ"
disk_full: "ÿßŸÑŸÇÿ±ÿµ ŸÖŸÖÿ™ŸÑÿ¶"
memory_error: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©"
timeout_error: "ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±"

# =============================================================================
# ÿ£ŸÜŸàÿßÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™
# =============================================================================
document: "Ÿàÿ´ŸäŸÇÿ©"
image: "ÿµŸàÿ±ÿ©"
video: "ŸÅŸäÿØŸäŸà"
audio: "ÿµŸàÿ™"
spreadsheet: "ÿ¨ÿØŸàŸÑ ÿ®ŸäÿßŸÜÿßÿ™"
presentation: "ÿπÿ±ÿ∂ ÿ™ŸÇÿØŸäŸÖŸä"
pdf: "ŸÖŸÑŸÅ PDF"
text_file: "ŸÖŸÑŸÅ ŸÜÿµŸä"
archive: "ÿ£ÿ±ÿ¥ŸäŸÅ"
executable: "ŸÖŸÑŸÅ ÿ™ŸÜŸÅŸäÿ∞Ÿä"

# =============================================================================
# Ÿàÿ≠ÿØÿßÿ™ ÿßŸÑŸÇŸäÿßÿ≥
# =============================================================================
currency_usd: "ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä"
currency_eur: "ŸäŸàÿ±Ÿà"
currency_gbp: "ÿ¨ŸÜŸäŸá ÿ•ÿ≥ÿ™ÿ±ŸÑŸäŸÜŸä"
currency_egp: "ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä"
currency_sar: "ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä"
currency_aed: "ÿØÿ±ŸáŸÖ ÿ•ŸÖÿßÿ±ÿßÿ™Ÿä"

# =============================================================================
# ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™
# =============================================================================
read_only: "ŸÇÿ±ÿßÿ°ÿ© ŸÅŸÇÿ∑"
read_write: "ŸÇÿ±ÿßÿ°ÿ© ŸàŸÉÿ™ÿßÿ®ÿ©"
full_access: "ŸàÿµŸàŸÑ ŸÉÿßŸÖŸÑ"
admin: "ŸÖÿØŸäÿ±"
user: "ŸÖÿ≥ÿ™ÿÆÿØŸÖ"
guest: "ÿ∂ŸäŸÅ"

# =============================================================================
# ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
# =============================================================================
online: "ŸÖÿ™ÿµŸÑ"
offline: "ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ"
connecting: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ"
connected: "ŸÖÿ™ÿµŸÑ"
disconnected: "ŸÖŸÜŸÇÿ∑ÿπ"
reconnecting: "ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ"

# =============================================================================
# ÿ£ŸàŸÑŸàŸäÿßÿ™ ÿßŸÑŸÖŸáÿßŸÖ
# =============================================================================
high_priority: "ÿ£ŸàŸÑŸàŸäÿ© ÿπÿßŸÑŸäÿ©"
medium_priority: "ÿ£ŸàŸÑŸàŸäÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©"
low_priority: "ÿ£ŸàŸÑŸàŸäÿ© ŸÖŸÜÿÆŸÅÿ∂ÿ©"
urgent: "ŸÖÿ≥ÿ™ÿπÿ¨ŸÑ"
normal: "ÿπÿßÿØŸä"

# =============================================================================
# ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑ŸÇÿ≥ (ŸÑŸÑÿ≥Ÿäÿßÿ≠ÿ©)
# =============================================================================
sunny: "ŸÖÿ¥ŸÖÿ≥"
cloudy: "ÿ∫ÿßÿ¶ŸÖ"
rainy: "ŸÖŸÖÿ∑ÿ±"
windy: "ÿπÿßÿµŸÅ"
hot: "ÿ≠ÿßÿ±"
cold: "ÿ®ÿßÿ±ÿØ"
mild: "ŸÖÿπÿ™ÿØŸÑ"

# =============================================================================
# ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ±ÿ≠ŸÑÿßÿ™
# =============================================================================
day_trip: "ÿ±ÿ≠ŸÑÿ© ŸäŸàŸÖŸäÿ©"
overnight: "ÿ±ÿ≠ŸÑÿ© ŸÑŸäŸÑŸäÿ©"
weekend: "ÿ±ÿ≠ŸÑÿ© ŸÜŸáÿßŸäÿ© ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ"
package_tour: "ÿ®ÿßŸÉŸäÿ¨ ÿ≥Ÿäÿßÿ≠Ÿä"
private_tour: "ÿ±ÿ≠ŸÑÿ© ÿÆÿßÿµÿ©"
group_tour: "ÿ±ÿ≠ŸÑÿ© ÿ¨ŸÖÿßÿπŸäÿ©"
cultural_tour: "ÿ±ÿ≠ŸÑÿ© ÿ´ŸÇÿßŸÅŸäÿ©"
adventure_tour: "ÿ±ÿ≠ŸÑÿ© ŸÖÿ∫ÿßŸÖÿ±ÿßÿ™"
religious_tour: "ÿ±ÿ≠ŸÑÿ© ÿØŸäŸÜŸäÿ©"
business_trip: "ÿ±ÿ≠ŸÑÿ© ÿπŸÖŸÑ"

# =============================================================================
# Ÿàÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜŸÇŸÑ
# =============================================================================
bus: "ÿ≠ÿßŸÅŸÑÿ©"
car: "ÿ≥Ÿäÿßÿ±ÿ©"
van: "ŸÖŸäŸÜŸä ÿ®ÿßÿµ"
boat: "ŸÇÿßÿ±ÿ®"
train: "ŸÇÿ∑ÿßÿ±"
plane: "ÿ∑ÿßÿ¶ÿ±ÿ©"
taxi: "ÿ™ÿßŸÉÿ≥Ÿä"
walking: "ŸÖÿ¥Ÿä"
bicycle: "ÿØÿ±ÿßÿ¨ÿ©"

# =============================================================================
# ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ•ŸÇÿßŸÖÿ©
# =============================================================================
hotel: "ŸÅŸÜÿØŸÇ"
resort: "ŸÖŸÜÿ™ÿ¨ÿπ"
hostel: "ŸÜÿ≤ŸÑ"
apartment: "ÿ¥ŸÇÿ©"
villa: "ŸÅŸäŸÑÿß"
cruise: "ÿ±ÿ≠ŸÑÿ© ÿ®ÿ≠ÿ±Ÿäÿ©"
camping: "ÿ™ÿÆŸäŸäŸÖ"
bed_breakfast: "ÿ•ŸÅÿ∑ÿßÿ± Ÿàÿ•ŸÇÿßŸÖÿ©"

# =============================================================================
# ÿ£ŸÜŸàÿßÿπ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™
# =============================================================================
breakfast: "ÿ•ŸÅÿ∑ÿßÿ±"
lunch: "ÿ∫ÿØÿßÿ°"
dinner: "ÿπÿ¥ÿßÿ°"
snack: "Ÿàÿ¨ÿ®ÿ© ÿÆŸÅŸäŸÅÿ©"
buffet: "ÿ®ŸàŸÅŸäŸá"
a_la_carte: "Ÿàÿ¨ÿ®ÿ© ŸÖŸÅÿ™Ÿàÿ≠ÿ©"
vegetarian: "ŸÜÿ®ÿßÿ™Ÿä"
halal: "ÿ≠ŸÑÿßŸÑ"
kosher: "ŸÉŸàÿ¥ÿ±"

# =============================================================================
# ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿÆÿØŸÖÿ©
# =============================================================================
basic: "ÿ£ÿ≥ÿßÿ≥Ÿä"
standard: "ŸÇŸäÿßÿ≥Ÿä"
premium: "ŸÖŸÖŸäÿ≤"
luxury: "ŸÅÿßÿÆÿ±"
vip: "ŸÉÿ®ÿßÿ± ÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™"
economy: "ÿßŸÇÿ™ÿµÿßÿØŸä"
first_class: "ÿØÿ±ÿ¨ÿ© ÿ£ŸàŸÑŸâ"
business_class: "ÿØÿ±ÿ¨ÿ© ÿ±ÿ¨ÿßŸÑ ÿßŸÑÿ£ÿπŸÖÿßŸÑ"

# =============================================================================
# ÿ∑ÿ±ŸÇ ÿßŸÑÿØŸÅÿπ
# =============================================================================
cash: "ŸÜŸÇÿØÿßŸã"
credit_card: "ÿ®ÿ∑ÿßŸÇÿ© ÿßÿ¶ÿ™ŸÖÿßŸÜ"
debit_card: "ÿ®ÿ∑ÿßŸÇÿ© ÿÆÿµŸÖ"
bank_transfer: "ÿ™ÿ≠ŸàŸäŸÑ ÿ®ŸÜŸÉŸä"
paypal: "ÿ®ÿßŸä ÿ®ÿßŸÑ"
check: "ÿ¥ŸäŸÉ"
installments: "ÿ£ŸÇÿ≥ÿßÿ∑"
deposit: "ÿπÿ±ÿ®ŸàŸÜ"

# =============================================================================
# ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ≠ÿ¨ÿ≤
# =============================================================================
booking_confirmed: "ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ¨ÿ≤"
booking_pending: "ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ™ÿ£ŸÉŸäÿØ"
booking_cancelled: "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≠ÿ¨ÿ≤"
booking_completed: "ÿ™ŸÖ ÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑÿ≠ÿ¨ÿ≤"
booking_modified: "ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿ¨ÿ≤"
booking_expired: "ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ≠ÿ¨ÿ≤"
booking_refunded: "ÿ™ŸÖ ÿßÿ≥ÿ™ÿ±ÿØÿßÿØ ÿßŸÑÿ≠ÿ¨ÿ≤"

# =============================================================================
# ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿπŸÖŸÑÿßÿ°
# =============================================================================
individual: "ŸÅÿ±ÿØŸä"
group: "ÿ¨ŸÖÿßÿπŸä"
corporate: "ÿ¥ÿ±ŸÉÿ©"
travel_agent: "ŸàŸÉŸäŸÑ ÿ≥ŸÅÿ±"
tour_operator: "ŸÖŸÜÿ∏ŸÖ ÿ±ÿ≠ŸÑÿßÿ™"
online_booking: "ÿ≠ÿ¨ÿ≤ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"
walk_in: "ÿ≤Ÿäÿßÿ±ÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ©"
referral: "ÿ•ÿ≠ÿßŸÑÿ©"
repeat_customer: "ÿπŸÖŸäŸÑ ÿØÿßÿ¶ŸÖ"
vip_customer: "ÿπŸÖŸäŸÑ ŸÖŸÖŸäÿ≤"

============================================================
FILE: locales\en.yaml
SIZE: 24501 characters
============================================================

# locales/en.yaml - Complete Updated Version

# Window Titles
login_title: "Login"
main_window_title: "FTS Sales Manager"
add_edit_title: "Add/Edit Booking"
view_manager_title: "View Manager"

# Login Labels
username_label: "Username"
password_label: "Password"
username_placeholder: "Enter username"
password_placeholder: "Enter password"
login_button: "Log In"
show_password: "Show"
toggle_theme: "Toggle Theme"

# Login Messages
error_empty_credentials: "Please enter username and password."
error_invalid_credentials: "Invalid username or password."
error_auth_exception: "Authentication error."
error_login_process: "Error processing login."

# ============ Menu Bar ============
# Main Menus
file_menu: "File"
edit_menu: "Edit"
view_menu: "View"
tools_menu: "Tools"
admin_menu: "Admin"
help_menu: "Help"

# File Menu Items
logout: "Logout"
export_data: "Export Data"
close: "Close"

# View Menu Items
dark_mode: "Dark Mode"
language_menu: "Language"
arabic: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"
english: "English"
fullscreen: "Fullscreen"
performance_mode: "Performance Mode"

# Tools Menu Items
reports: "Reports"

# Admin Menu Items
user_management: "User Management"
config_editor: "Configuration Editor"
clear_cache: "Clear Cache"
view_logs: "View Logs"

# Help Menu Items
user_guide: "User Guide"

# Additional Confirmation Messages
confirm_logout: "Are you sure you want to logout?"
confirm_clear_cache: "Clear all cached data?"

# Additional Status Messages
performance_mode_enabled: "Performance mode enabled"
performance_mode_disabled: "Performance mode disabled"
cache_cleared: "Cache cleared successfully"
fullscreen_enabled: "Fullscreen enabled"
fullscreen_disabled: "Fullscreen disabled"

# Coming Soon Messages
coming_soon: "Coming soon"
export_coming_soon: "Export feature coming soon"
reports_coming_soon: "Reports feature coming soon"
user_management_coming_soon: "User management coming soon"
config_editor_coming_soon: "Configuration editor coming soon"
logs_viewer_coming_soon: "Logs viewer coming soon"

# User Guide
guide_add: "To add a booking: Click Add button or press Ctrl+N"
guide_edit: "To edit: Double-click on a booking or press Ctrl+E"
guide_delete: "To delete: Select bookings and press Delete"
guide_search: "To search: Use the search box or press Ctrl+F"
guide_export: "To export: Use File menu > Export or press Ctrl+S"

# About Info
app_name: "FTS Sales Manager"
developed_by: "Developed by"
logged_as: "Logged in as"
user_role: "Role"

# ============ Original Content ============

# Menus
menu_settings: "Settings"
menu_change_language: "Change Language"
menu_toggle_theme: "Toggle Theme"
menu_account: "Account"
menu_logout: "Log Out"
menu_exit: "Exit"
menu_views: "Views"
menu_view_manager: "View Manager"

# Confirmation Messages
confirm_change_language: "Change language?"
confirm_exit: "Are you sure you want to exit?"
confirm_delete: "Are you sure you want to delete this booking?"
confirm_delete_multiple: "Are you sure you want to delete {} bookings?"
confirm_close: "Confirm Close"

# Search and Status Bar
search_label: "Search:"
search_placeholder: "Type to search..."
status_loading: "Loading..."
status_load_complete: "{} records loaded."
error_loading_records: "Error loading records."
loading_data: "Loading data..."
refreshing_data: "Refreshing data..."
saving_data: "Saving data..."
processing: "Processing..."

# Action Buttons
add: "Add"
edit: "Edit"
delete: "Delete"
save: "Save"
cancel: "Cancel"
close: "Close"
refresh: "Refresh"
export: "Export"
import: "Import"
print: "Print"
apply: "Apply"
clear: "Clear"
search: "Search"
filter: "Filter"
sort: "Sort"
select_all: "Select All"
clear_selection: "Clear Selection"

# Action Messages
add_button: "‚ûï Add Booking"
edit_button: "‚úèÔ∏è Edit Booking"
delete_button: "üóëÔ∏è Delete Booking"
refresh_button: "üîÑ Refresh"
export_button: "üì§ Export"

# Selection Messages
error_no_selection: "Please select a record."
select_booking_edit: "Please select a booking to edit"
select_booking_delete: "Please select a booking to delete"
select_one_booking_only: "You can only edit one booking at a time"
selected_count: "Selected: {} booking(s)"
no_selection: "No selection"

# Success and Error Messages
success: "Success"
error: "Error"
warning: "Warning"
info: "Information"
success_save: "Saved successfully!"
success_update: "Updated successfully!"
success_delete: "Deleted successfully!"
error_save: "Failed to save data"
error_update: "Failed to update data"
error_delete: "Failed to delete record"
error_load: "Failed to load data"
error_add_form: "Failed to open add form"
error_edit_form: "Failed to open edit form"

# Add/Edit Window
basic_info: "Basic Information"
trip_details: "Trip Details"
passenger_info: "Passenger Information"
contact_info: "Contact Information"
pricing_info: "Pricing Information"
additional_info: "Additional Information"

# Fields
customer_name: "Customer Name"
hotel_name: "Hotel Name"
agency: "Agency"
booking_number: "Booking Number"
room_number: "Room Number"
trip_name: "Trip Name"
trip_date: "Trip Date"
option: "Option"
destination: "Destination"
guide: "Guide"
product_id: "Product ID"
pickup_time: "Pickup Time"
remarks: "Remarks"
add_ons: "Add-ons"
adults: "Adults"
children: "Children"
students: "Students"
youth: "Youth"
infants: "Infants"
children_ages: "Children Ages"
phone_number: "Phone Number"
email: "Email"
customer_country: "Customer Country"
total_price_usd: "Total Price (USD)"
total_price_eur: "Total Price (EUR)"
total_price_gbp: "Total Price (GBP)"
net_rate: "Net Rate"
currency: "Currency"
cost_egp: "Cost (EGP)"
collecting_on_date: "Collecting on Date"
management_option: "Management Option"
add_on: "Add-on"

# Validation Messages
required_field: "This field is required"
invalid_phone: "Invalid phone number"
invalid_date: "Invalid date format"
invalid_number: "Please enter a valid number"
future_date: "Date cannot be in the past"
negative_amount: "Amount cannot be negative"
invalid_email: "Invalid email format"

# Dropdowns
add_new_value: "Add new value"
enter_new_value: "Enter new value:"
value_added_successfully: "'{}' added successfully"
failed_add_value: "Failed to add value to Airtable"
dropdown_error: "Error loading dropdown values"
dropdown_manager_unavailable: "Dropdown manager is not available"
refresh_lists: "Refresh Lists"
lists_status: "Lists Status"
lists_updated: "Lists updated successfully"
update_failed: "Failed to update lists"
loading_lists: "Loading lists..."
updating_lists: "Updating lists..."
all_lists_working: "All dropdown lists are working correctly!"
dropdown_errors: "Dropdown Errors"
check_connection: "Check:\n1. Internet connection\n2. API Key and Base ID\n3. Tables exist in Airtable"

# Navigation
previous: "Previous"
next: "Next"
first_page: "First Page"
last_page: "Last Page"
page: "Page"
of: "of"
showing: "Showing"
to: "to"
total_records: "Total Records"
navigating_to: "Navigating to"

# Drafts
draft: "Draft"
save_draft: "Save as Draft"
load_draft: "Load Draft"
draft_saved: "Draft saved successfully"
draft_save_failed: "Failed to save draft"
draft_found: "Draft found"
load_draft_question: "A saved draft was found. Do you want to load it?"
unsaved_changes: "Unsaved changes"
save_draft_question: "There are unsaved changes.\n\nDo you want to save as draft?"

# Keyboard Shortcuts
shortcuts: "Shortcuts"
keyboard_shortcuts: "Keyboard Shortcuts"
required_fields: "Required fields"
change_language: "Change Language"
change_theme: "Change Theme"

# Views
view_label: "View:"
all_records: "All Records"
today_bookings: "Today's Bookings"
this_week: "This Week"
this_month: "This Month"
pending_bookings: "Pending Bookings"
confirmed_bookings: "Confirmed Bookings"
cancelled_bookings: "Cancelled Bookings"
my_bookings: "My Bookings"
team_bookings: "Team Bookings"
high_priority: "High Priority"
vip_customers: "VIP Customers"
airport_transfers: "Airport Transfers"
hotel_transfers: "Hotel Transfers"
tour_bookings: "Tour Bookings"

# View Manager
view_manager: "View Manager"
assign_views_to_users: "Assign Views to Users"
select_view: "Select View:"
apply_to_selected: "Apply to Selected"
apply_to_all_role: "Apply to All Users with Role"
apply_to_role: "Apply to Role"
select_role_and_view: "Select Role and View:"
select_view_first: "Please select a view first"
select_user_first: "Please select a user first"
select_role_and_view_first: "Please select role and view"
save_changes: "Save All Changes"
save_all_changes: "Save All Changes"
no_changes_to_save: "No changes to save"
failed_load_users: "Failed to load users"
failed_save_changes: "Failed to save changes"

# Booking Status
booking_status: "Booking Status"
status_active: "Active"
status_pending: "Pending"
status_confirmed: "Confirmed"
status_cancelled: "Cancelled"
status_completed: "Completed"

# Statistics
statistics: "Statistics"
total_bookings: "Total Bookings"
today_count: "Today's Bookings"
pending_count: "Pending Approval"

# Export
export_to_excel: "Export to Excel"
export_to_pdf: "Export to PDF"
export_success: "Export successful"
export_failed: "Export failed"
no_data_export: "No data to export"

# General Messages
please_wait: "Please wait..."
loading: "Loading..."
done: "Done"
yes: "Yes"
no: "No"
ok: "OK"
confirm: "Confirm"
back: "Back"
forward: "Forward"
help: "Help"
about: "About"
version: "Version"
copyright: "¬© 2024 FTS. All rights reserved."

# System Messages
system_error: "System Error"
network_error: "Network Error"
permission_denied: "Permission Denied"
session_expired: "Session Expired"
please_login_again: "Please login again"

# Date and Time
date: "Date"
time: "Time"
datetime: "Date & Time"
today: "Today"
yesterday: "Yesterday"
tomorrow: "Tomorrow"
this_week: "This Week"
last_week: "Last Week"
next_week: "Next Week"
this_month: "This Month"
last_month: "Last Month"
next_month: "Next Month"
this_year: "This Year"
last_year: "Last Year"
next_year: "Next Year"

# Days of Week
monday: "Monday"
tuesday: "Tuesday"
wednesday: "Wednesday"
thursday: "Thursday"
friday: "Friday"
saturday: "Saturday"
sunday: "Sunday"

# Months
january: "January"
february: "February"
march: "March"
april: "April"
may: "May"
june: "June"
july: "July"
august: "August"
september: "September"
october: "October"
november: "November"
december: "December"

# Navigation
nav_home: "Home"
nav_today: "Today's Bookings"
nav_pending: "Pending Bookings"
nav_confirmed: "Confirmed Bookings"
nav_reports: "Reports"

# Statistics
stats_total: "Total Bookings"
stats_today: "Today's Bookings"
stats_pending: "Pending"

# Roles
role_admin: "Administrator"
role_manager: "Manager"
role_editor: "Editor"
role_viewer: "Viewer"

# Search
search_placeholder: "Search..."

# Table column headers
booking_number: "Booking Nr."
trip_date: "Trip Date"
customer_name: "Customer Name"
hotel: "Hotel"
pickup_time: "Pickup Time"
price: "Price"
status: "Status"

# Booking statuses
status_confirmed: "Confirmed"
status_pending: "Pending"
status_cancelled: "Cancelled"
status_completed: "Completed"
deleted: "deleted"

# ============ Header Dropdown Menu ============
# Menu Items
menu_profile: "Profile"
menu_settings: "Settings"
menu_language: "Language"
menu_about: "About"
menu_logout: "Logout"

# Profile
profile_title: "User Profile"
basic_info: "Basic Information"
usage_stats: "Usage Statistics"
actions: "Actions"
change_password: "Change Password"
update_email: "Update Email"
last_login: "Last Login"
login_count: "Login Count"
created_date: "Created Date"
member_since: "Member Since"
current_password: "Current Password"
new_password: "New Password"
confirm_password: "Confirm Password"
password_changed: "Password changed successfully"
incorrect_password: "Current password is incorrect"
passwords_dont_match: "Passwords do not match"
password_too_short: "Password must be at least 8 characters"
current_email: "Current Email:"
new_email: "New Email"
enter_email: "Please enter an email address"
email_update_request: "Email update request has been sent to administrator"
phone: "Phone"
department: "Department"
airtable_view: "Assigned View"

# Settings
settings_title: "Settings"
appearance: "Appearance"
performance: "Performance"
advanced: "Advanced"
theme_mode: "Theme Mode"
primary_color: "Primary Color"
font_size: "Font Size"
preview: "Preview"
preview_text: "This is a preview of your settings"
auto_refresh: "Auto Refresh"
refresh_interval: "Refresh Interval"
enable_auto_refresh: "Enable automatic data refresh"
records_per_page: "Records per Page"
lazy_loading: "Lazy Loading"
enable_lazy_loading: "Load data on demand"
developer_mode: "Developer Mode"
enable_dev_mode: "Show debug information"
export_settings: "Export Settings"
import_settings: "Import Settings"
reset_settings: "Reset Settings"
export_to_file: "Export to File"
import_from_file: "Import from File"
reset_to_default: "Reset to Default"
save_settings: "Save Settings"
settings_saved: "Settings saved successfully"
settings_exported: "Settings exported successfully"
settings_imported: "Settings imported successfully"
settings_reset: "Settings reset to default"
discard_changes: "Discard unsaved changes?"
confirm_reset: "Reset all settings to default values?"

# Language
language_title: "Select Language"
language_desc: "Choose your preferred language"
current: "Current"

# About
about_title: "About"
build: "Build"
developer: "Developer"
license: "License"
website: "Website"
support: "Support"
app_description: "FTS Travels Sales Manager is an integrated system for managing tourism sales and bookings.\n\nThe system provides powerful tools for managing customers, bookings, and financial reports."
feature_not_available: "This feature is not available"
fill_all_fields: "Please fill all fields"
logout_error: "An error occurred during logout"

palette: "Colors"
choose_palette: "Choose Color Palette"
select_palette: "Select Color Palette"
palette_desc: "Choose your preferred color scheme for light theme"
purple_modern: "Modern Purple"
blue_modern: "Modern Blue"
emerald_modern: "Modern Emerald"
pink_modern: "Modern Pink"
orange_warm: "Warm Orange"
indigo_elegant: "Elegant Indigo"
blue_classic: "Classic Blue"
apply: "Apply"
palette_saved: "Color palette saved. Please reopen the window."
theme_dark: "Dark theme activated"
theme_light: "Light theme activated"
theme_change: "Theme Changed"
theme_change_msg: "Please reopen the window to apply the new theme colors."

# =============================================================================
# Tab Names
# =============================================================================
basic_info: "Basic Information"
trip_details: "Trip Details"
passenger_info: "Passenger Information"
contact_info: "Contact Information"
pricing_info: "Pricing Information"

# =============================================================================
# Field Names - Basic Information
# =============================================================================
customer_name: "Customer Name"
hotel_name: "Hotel Name"
agency: "Agency"
booking_number: "Booking Number"
room_number: "Room Number"

# =============================================================================
# Field Names - Trip Details
# =============================================================================
trip_name: "Trip Name"
trip_date: "Trip Date"
option: "Option"
destination: "Destination"
guide: "Guide"
product_id: "Product ID"
pickup_time: "Pickup Time"
remarks: "Remarks"
add_ons: "Add-ons"

# =============================================================================
# Field Names - Passenger Information
# =============================================================================
adults: "Adults"
children: "Children"
students: "Students"
youth: "Youth"
infants: "Infants"
children_ages: "Children Ages"

# =============================================================================
# Field Names - Contact Information
# =============================================================================
phone_number: "Phone Number"
email: "Email"
customer_country: "Customer Country"

# =============================================================================
# Field Names - Pricing Information
# =============================================================================
total_price_usd: "Total Price (USD)"
total_price_eur: "Total Price (EUR)"
total_price_gbp: "Total Price (GBP)"
net_rate: "Net Rate"
currency: "Currency"
cost_egp: "Cost (EGP)"
collecting_on_date: "Collecting on Trip Date"
management_option: "Management Option"
add_on: "Add-on"

# =============================================================================
# Buttons and Controls
# =============================================================================
search: "Search"
clear: "Clear"
reset: "Reset"
apply: "Apply"
filter: "Filter"
export: "Export"
import: "Import"
print: "Print"
help: "Help"
about: "About"
settings: "Settings"
preferences: "Preferences"
language: "Language"
theme: "Theme"
dark_mode: "Dark Mode"
light_mode: "Light Mode"

# =============================================================================
# Data States
# =============================================================================
active: "Active"
inactive: "Inactive"
pending: "Pending"
confirmed: "Confirmed"
cancelled: "Cancelled"
completed: "Completed"
in_progress: "In Progress"
draft_status: "Draft"
published: "Published"
archived: "Archived"

# =============================================================================
# Days of Week
# =============================================================================
monday: "Monday"
tuesday: "Tuesday"
wednesday: "Wednesday"
thursday: "Thursday"
friday: "Friday"
saturday: "Saturday"
sunday: "Sunday"

# =============================================================================
# Months of Year
# =============================================================================
january: "January"
february: "February"
march: "March"
april: "April"
may: "May"
june: "June"
july: "July"
august: "August"
september: "September"
october: "October"
november: "November"
december: "December"

# =============================================================================
# Validation Messages
# =============================================================================
invalid_email: "Invalid email address"
invalid_phone: "Invalid phone number"
invalid_date: "Invalid date"
invalid_number: "Invalid number"
field_too_long: "Field is too long"
field_too_short: "Field is too short"
passwords_dont_match: "Passwords don't match"
password_too_weak: "Password is too weak"

# =============================================================================
# Success Messages
# =============================================================================
data_loaded: "Data loaded successfully"
settings_saved: "Settings saved successfully"
export_completed: "Export completed successfully"
import_completed: "Import completed successfully"
backup_created: "Backup created successfully"
backup_restored: "Backup restored successfully"

# =============================================================================
# Error Messages
# =============================================================================
file_not_found: "File not found"
access_denied: "Access denied"
network_error: "Network error"
server_error: "Server error"
database_error: "Database error"
permission_denied: "Permission denied"
invalid_credentials: "Invalid credentials"
session_expired: "Session expired"
file_corrupted: "File corrupted"
disk_full: "Disk full"
memory_error: "Memory error"
timeout_error: "Timeout error"

# =============================================================================
# File Types
# =============================================================================
document: "Document"
image: "Image"
video: "Video"
audio: "Audio"
spreadsheet: "Spreadsheet"
presentation: "Presentation"
pdf: "PDF File"
text_file: "Text File"
archive: "Archive"
executable: "Executable"

# =============================================================================
# Units of Measurement
# =============================================================================
currency_usd: "US Dollar"
currency_eur: "Euro"
currency_gbp: "British Pound"
currency_egp: "Egyptian Pound"
currency_sar: "Saudi Riyal"
currency_aed: "UAE Dirham"

# =============================================================================
# Permission Types
# =============================================================================
read_only: "Read Only"
read_write: "Read & Write"
full_access: "Full Access"
admin: "Administrator"
user: "User"
guest: "Guest"

# =============================================================================
# Connection States
# =============================================================================
online: "Online"
offline: "Offline"
connecting: "Connecting"
connected: "Connected"
disconnected: "Disconnected"
reconnecting: "Reconnecting"

# =============================================================================
# Task Priorities
# =============================================================================
high_priority: "High Priority"
medium_priority: "Medium Priority"
low_priority: "Low Priority"
urgent: "Urgent"
normal: "Normal"

# =============================================================================
# Weather Conditions (for Tourism)
# =============================================================================
sunny: "Sunny"
cloudy: "Cloudy"
rainy: "Rainy"
windy: "Windy"
hot: "Hot"
cold: "Cold"
mild: "Mild"

# =============================================================================
# Trip Types
# =============================================================================
day_trip: "Day Trip"
overnight: "Overnight Trip"
weekend: "Weekend Trip"
package_tour: "Package Tour"
private_tour: "Private Tour"
group_tour: "Group Tour"
cultural_tour: "Cultural Tour"
adventure_tour: "Adventure Tour"
religious_tour: "Religious Tour"
business_trip: "Business Trip"

# =============================================================================
# Transportation
# =============================================================================
bus: "Bus"
car: "Car"
van: "Van"
boat: "Boat"
train: "Train"
plane: "Plane"
taxi: "Taxi"
walking: "Walking"
bicycle: "Bicycle"

# =============================================================================
# Accommodation Types
# =============================================================================
hotel: "Hotel"
resort: "Resort"
hostel: "Hostel"
apartment: "Apartment"
villa: "Villa"
cruise: "Cruise"
camping: "Camping"
bed_breakfast: "Bed & Breakfast"

# =============================================================================
# Meal Types
# =============================================================================
breakfast: "Breakfast"
lunch: "Lunch"
dinner: "Dinner"
snack: "Snack"
buffet: "Buffet"
a_la_carte: "A la Carte"
vegetarian: "Vegetarian"
halal: "Halal"
kosher: "Kosher"

# =============================================================================
# Service Levels
# =============================================================================
basic: "Basic"
standard: "Standard"
premium: "Premium"
luxury: "Luxury"
vip: "VIP"
economy: "Economy"
first_class: "First Class"
business_class: "Business Class"

# =============================================================================
# Payment Methods
# =============================================================================
cash: "Cash"
credit_card: "Credit Card"
debit_card: "Debit Card"
bank_transfer: "Bank Transfer"
paypal: "PayPal"
check: "Check"
installments: "Installments"
deposit: "Deposit"

# =============================================================================
# Booking Status
# =============================================================================
booking_confirmed: "Booking Confirmed"
booking_pending: "Booking Pending"
booking_cancelled: "Booking Cancelled"
booking_completed: "Booking Completed"
booking_modified: "Booking Modified"
booking_expired: "Booking Expired"
booking_refunded: "Booking Refunded"

# =============================================================================
# Customer Types
# =============================================================================
individual: "Individual"
group: "Group"
corporate: "Corporate"
travel_agent: "Travel Agent"
tour_operator: "Tour Operator"
online_booking: "Online Booking"
walk_in: "Walk-in"
referral: "Referral"
repeat_customer: "Repeat Customer"
vip_customer: "VIP Customer"

============================================================
FILE: utils\async_operations.py
SIZE: 736 characters
============================================================

# utils/async_operations.py
from concurrent.futures import ThreadPoolExecutor
import threading

class AsyncOperationManager:
    def __init__(self, max_workers=4):
        self.executor = ThreadPoolExecutor(max_workers=max_workers)
        self.pending_operations = {}

    def run_async(self, operation_id: str, func, *args, **kwargs):
        """ÿ™ÿ¥ÿ∫ŸäŸÑ ÿπŸÖŸÑŸäÿ© ÿ®ÿ¥ŸÉŸÑ ÿ∫Ÿäÿ± ŸÖÿ™ÿ≤ÿßŸÖŸÜ"""
        if operation_id in self.pending_operations:
            return self.pending_operations[operation_id]

        future = self.executor.submit(func, *args, **kwargs)
        self.pending_operations[operation_id] = future
        return future

    def shutdown(self):
        """ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿØŸäÿ±"""
        self.executor.shutdown(wait=True)

============================================================
FILE: utils\error_handler.py
SIZE: 1884 characters
============================================================

# utils/error_handler.py
from functools import wraps
import logging
import traceback
from typing import Callable, Optional
from tkinter import messagebox

def error_handler(error_key: str = "error_general", show_dialog: bool = True):
    """ŸÖŸèÿ≤ÿÆÿ±ŸÅ ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
    def decorator(func: Callable) -> Callable:
        @wraps(func)
        def wrapper(self, *args, **kwargs):
            try:
                return func(self, *args, **kwargs)
            except Exception as e:
                # ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ∑ÿ£
                logger.error(f"Error in {func.__name__}: {str(e)}")
                logger.error(traceback.format_exc())

                # ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ©
                if hasattr(self, 'status_bar'):
                    error_msg = self.lang_manager.get(error_key, str(e))
                    self.status_bar.set_status(error_msg, "error")

                # ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£
                if show_dialog and hasattr(self, 'lang_manager'):
                    messagebox.showerror(
                        self.lang_manager.get("error", "Error"),
                        error_msg
                    )

                # ŸàŸÖŸäÿ∂ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                if hasattr(self, 'winfo_exists') and self.winfo_exists():
                    try:
                        from utils.window_manager import WindowManager
                        WindowManager.flash_window(self, count=2, interval=300)
                    except:
                        pass

                # ÿ•ÿ∑ŸÑÿßŸÇ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£
                if hasattr(self, 'event_bus') and self.event_bus:
                    self.event_bus.emit("error_occurred", {
                        "function": func.__name__,
                        "error": str(e)
                    })

                return None
        return wrapper
    return decorator

============================================================
FILE: utils\image_utils.py
SIZE: 8538 characters
============================================================

# -*- coding: utf-8 -*-
"""
utils/image_utils.py

ÿ£ÿØŸàÿßÿ™ ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸàÿ± ŸÅŸä CustomTkinter
"""

import os
import sys
from PIL import Image
import customtkinter as ctk
from typing import Optional, Tuple, Union
import logging

logger = logging.getLogger(__name__)


class ImageLoader:
    """ŸÅÿ¶ÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ± ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""

    # ÿ∞ÿßŸÉÿ±ÿ© ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ§ŸÇÿ™ ŸÑŸÑÿµŸàÿ± ÿßŸÑŸÖÿ≠ŸÖŸÑÿ©
    _image_cache = {}

    @staticmethod
    def load_image(
        path: str,
        size: Optional[Tuple[int, int]] = None,
        maintain_aspect_ratio: bool = True
    ) -> Optional[ctk.CTkImage]:
        """
        ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© Ÿàÿ™ÿ≠ŸàŸäŸÑŸáÿß ÿ•ŸÑŸâ CTkImage

        Args:
            path: ŸÖÿ≥ÿßÿ± ÿßŸÑÿµŸàÿ±ÿ©
            size: ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® (width, height)
            maintain_aspect_ratio: ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿπÿ±ÿ∂ ÿ•ŸÑŸâ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ

        Returns:
            CTkImage ÿ£Ÿà None ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑ
        """
        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©
        cache_key = f"{path}_{size}_{maintain_aspect_ratio}"
        if cache_key in ImageLoader._image_cache:
            return ImageLoader._image_cache[cache_key]

        try:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖŸÑŸÅ
            if not os.path.exists(path):
                logger.warning(f"ŸÖŸÑŸÅ ÿßŸÑÿµŸàÿ±ÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ: {path}")
                return None

            # ŸÅÿ™ÿ≠ ÿßŸÑÿµŸàÿ±ÿ©
            pil_image = Image.open(path)

            # ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ RGBA ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÅÿ∂ŸÑ ÿ™ŸàÿßŸÅŸÇ
            if pil_image.mode != 'RGBA':
                # ÿ•ŸÜÿ¥ÿßÿ° ÿµŸàÿ±ÿ© RGBA ÿ¨ÿØŸäÿØÿ©
                rgba_image = Image.new('RGBA', pil_image.size, (255, 255, 255, 255))

                # ŸÑÿµŸÇ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©
                if pil_image.mode == 'P':  # ÿµŸàÿ±ÿ© ŸÖŸÅŸáÿ±ÿ≥ÿ©
                    pil_image = pil_image.convert('RGBA')
                rgba_image.paste(pil_image, (0, 0))
                pil_image = rgba_image

            # ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØŸá
            if size:
                if maintain_aspect_ratio:
                    pil_image.thumbnail(size, Image.Resampling.LANCZOS)
                    # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑŸÅÿπŸÑŸä ÿ®ÿπÿØ thumbnail
                    actual_size = pil_image.size
                else:
                    pil_image = pil_image.resize(size, Image.Resampling.LANCZOS)
                    actual_size = size
            else:
                actual_size = pil_image.size

            # ÿ•ŸÜÿ¥ÿßÿ° CTkImage
            ctk_image = ctk.CTkImage(
                light_image=pil_image,
                dark_image=pil_image,
                size=actual_size
            )

            # ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©
            ImageLoader._image_cache[cache_key] = ctk_image

            logger.info(f"ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠: {path}")
            return ctk_image

        except Exception as e:
            logger.error(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ© {path}: {e}")
            return None

    @staticmethod
    def load_icon(
        icon_name: str,
        size: Tuple[int, int] = (24, 24),
        directories: Optional[list] = None
    ) -> Optional[ctk.CTkImage]:
        """
        ÿ™ÿ≠ŸÖŸäŸÑ ÿ£ŸäŸÇŸàŸÜÿ© ŸÖŸÜ ŸÖÿ¨ŸÑÿØÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ©

        Args:
            icon_name: ÿßÿ≥ŸÖ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© (ÿ®ÿØŸàŸÜ ÿßŸÖÿ™ÿØÿßÿØ)
            size: ÿ≠ÿ¨ŸÖ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
            directories: ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™ ŸÑŸÑÿ®ÿ≠ÿ´ ŸÅŸäŸáÿß

        Returns:
            CTkImage ÿ£Ÿà None
        """
        if directories is None:
            directories = [
                "resources/icons",
                "assets/icons",
                "icons",
                "resources",
                "assets"
            ]

        extensions = ['.png', '.jpg', '.jpeg', '.ico', '.gif']

        for directory in directories:
            for ext in extensions:
                path = os.path.join(directory, f"{icon_name}{ext}")
                if os.path.exists(path):
                    return ImageLoader.load_image(path, size)

        logger.warning(f"ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©: {icon_name}")
        return None

    @staticmethod
    def create_placeholder_image(
        size: Tuple[int, int] = (50, 50),
        color: str = "#cccccc",
        text: str = "?"
    ) -> ctk.CTkImage:
        """
        ÿ•ŸÜÿ¥ÿßÿ° ÿµŸàÿ±ÿ© ÿ®ÿØŸäŸÑÿ© ÿπŸÜÿØ ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©

        Args:
            size: ÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸàÿ±ÿ©
            color: ŸÑŸàŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ©
            text: ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂

        Returns:
            CTkImage
        """
        # ÿ•ŸÜÿ¥ÿßÿ° ÿµŸàÿ±ÿ© ÿ¨ÿØŸäÿØÿ©
        image = Image.new('RGBA', size, color)

        # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÜÿµ ÿ£Ÿà ÿ±ÿ≥ŸàŸÖÿßÿ™ ŸáŸÜÿß ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
        # (Ÿäÿ™ÿ∑ŸÑÿ® ImageDraw)

        return ctk.CTkImage(
            light_image=image,
            dark_image=image,
            size=size
        )

    @staticmethod
    def clear_cache():
        """ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© ŸÑŸÑÿµŸàÿ±"""
        ImageLoader._image_cache.clear()
        logger.info("ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™ ŸÑŸÑÿµŸàÿ±")


class IconManager:
    """ŸÖÿØŸäÿ± ÿßŸÑÿ£ŸäŸÇŸàŸÜÿßÿ™ ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""

    # ÿ£ŸäŸÇŸàŸÜÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
    DEFAULT_ICONS = {
        "app": "‚úàÔ∏è",
        "add": "‚ûï",
        "edit": "‚úèÔ∏è",
        "delete": "üóëÔ∏è",
        "save": "üíæ",
        "cancel": "‚ùå",
        "refresh": "üîÑ",
        "search": "üîç",
        "settings": "‚öôÔ∏è",
        "user": "üë§",
        "logout": "üö™",
        "info": "‚ÑπÔ∏è",
        "warning": "‚ö†Ô∏è",
        "error": "‚ùå",
        "success": "‚úÖ",
        "calendar": "üìÖ",
        "clock": "üïê",
        "money": "üí∞",
        "document": "üìÑ",
        "folder": "üìÅ",
        "email": "üìß",
        "phone": "üìû",
        "location": "üìç",
        "star": "‚≠ê",
        "heart": "‚ù§Ô∏è"
    }

    @staticmethod
    def get_icon(name: str, fallback: str = "‚ùì") -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸäŸÇŸàŸÜÿ© ÿ•ŸäŸÖŸàÿ¨Ÿä"""
        return IconManager.DEFAULT_ICONS.get(name, fallback)

    @staticmethod
    def create_icon_button(
        parent,
        icon_name: str,
        text: str = "",
        command = None,
        size: Tuple[int, int] = (40, 40),
        **kwargs
    ) -> ctk.CTkButton:
        """
        ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ŸÖÿπ ÿ£ŸäŸÇŸàŸÜÿ©

        Args:
            parent: ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ£ÿ®
            icon_name: ÿßÿ≥ŸÖ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
            text: ŸÜÿµ ÿßŸÑÿ≤ÿ± (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
            command: ÿØÿßŸÑÿ© ÿßŸÑÿ£ŸÖÿ±
            size: ÿ≠ÿ¨ŸÖ ÿßŸÑÿ≤ÿ±
            **kwargs: ÿÆŸäÿßÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ≤ÿ±

        Returns:
            CTkButton
        """
        # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
        icon_image = ImageLoader.load_icon(icon_name, size=(24, 24))

        if icon_image:
            # ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ŸÖÿπ ÿµŸàÿ±ÿ©
            button = ctk.CTkButton(
                parent,
                image=icon_image,
                text=text,
                command=command,
                width=size[0],
                height=size[1],
                **kwargs
            )
        else:
            # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ•ŸäŸÖŸàÿ¨Ÿä ŸÉÿ®ÿØŸäŸÑ
            emoji = IconManager.get_icon(icon_name)
            button_text = f"{emoji} {text}" if text else emoji
            button = ctk.CTkButton(
                parent,
                text=button_text,
                command=command,
                width=size[0],
                height=size[1],
                **kwargs
            )

        return button


def setup_window_icon(window, icon_paths: Optional[list] = None):
    """
    ÿ™ÿπŸäŸäŸÜ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©

    Args:
        window: ŸÜÿßŸÅÿ∞ÿ© CTk ÿ£Ÿà Tk
        icon_paths: ŸÇÿßÿ¶ŸÖÿ© ŸÖÿ≥ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿßÿ™ ŸÑŸÑŸÖÿ≠ÿßŸàŸÑÿ©
    """
    if icon_paths is None:
        icon_paths = [
            "resources/app_icon.ico",
            "resources/icon.ico",
            "assets/icon.ico",
            "resources/app_icon.png",
            "resources/icon.png",
            "assets/icon.png"
        ]

    for path in icon_paths:
        try:
            if os.path.exists(path):
                if path.endswith('.ico'):
                    # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸÑŸÅ ICO ŸÖÿ®ÿßÿ¥ÿ±ÿ©
                    window.iconbitmap(path)
                    logger.info(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {path}")
                    return True
                else:
                    # ÿ™ÿ≠ŸàŸäŸÑ PNG ÿ•ŸÑŸâ PhotoImage
                    # ŸÖŸÑÿßÿ≠ÿ∏ÿ©: iconphoto Ÿäÿ™ÿ∑ŸÑÿ® PhotoImage ŸàŸÑŸäÿ≥ CTkImage
                    from tkinter import PhotoImage
                    icon = PhotoImage(file=path)
                    window.iconphoto(False, icon)
                    logger.info(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {path}")
                    return True
        except Exception as e:
            logger.debug(f"ŸÅÿ¥ŸÑ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© {path}: {e}")
            continue

    logger.warning("ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ£ŸäŸÇŸàŸÜÿ© ŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÑŸÜÿßŸÅÿ∞ÿ©")
    return False

============================================================
FILE: utils\login_visual_effects.py
SIZE: 11479 characters
============================================================

# -*- coding: utf-8 -*-
"""
utils/login_visual_effects.py

ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© Ÿàÿ≠ÿ±ŸÉÿßÿ™ ŸÖÿ™ŸÇÿØŸÖÿ© ŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
Advanced Visual Effects and Animations for Login Window
"""

import customtkinter as ctk
from typing import Optional, Tuple, Callable
import threading
import time
import math

class LoginVisualEffects:
    """ŸÉŸÑÿßÿ≥ ŸÑŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©"""

    @staticmethod
    def create_gradient_frame(parent, colors: Tuple[str, str], orientation='vertical', **kwargs):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ•ÿ∑ÿßÿ± ÿ®ÿ™ÿØÿ±ÿ¨ ŸÑŸàŸÜŸä"""
        # customtkinter ŸÑÿß ŸäÿØÿπŸÖ ÿßŸÑÿ™ÿØÿ±ÿ¨ÿßÿ™ ŸÖÿ®ÿßÿ¥ÿ±ÿ©ÿå ŸÑÿ∞ÿß ŸÜÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸàŸÜ Ÿàÿßÿ≠ÿØ
        # ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Canvas ŸÑŸÑÿ™ÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑŸÖÿπŸÇÿØÿ©
        frame = ctk.CTkFrame(parent, fg_color=colors[0], **kwargs)
        return frame

    @staticmethod
    def add_hover_effect(widget, normal_color: str, hover_color: str,
                        scale_factor: float = 1.05, duration: int = 200):
        """ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± hover ŸÖÿ™ŸÇÿØŸÖ"""
        original_width = None
        original_height = None

        def on_enter(event):
            nonlocal original_width, original_height
            try:
                # ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿ®ÿπÿßÿØ ÿßŸÑÿ£ÿµŸÑŸäÿ©
                if hasattr(widget, 'cget'):
                    original_width = widget.cget('width')
                    original_height = widget.cget('height')

                # ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑŸàŸÜ
                if hasattr(widget, 'configure'):
                    if 'fg_color' in widget.configure():
                        widget.configure(fg_color=hover_color)

                # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ™ŸÉÿ®Ÿäÿ± (ŸÖÿ≠ÿßŸÉÿßÿ©)
                if original_width and original_height and scale_factor > 1:
                    new_width = int(original_width * scale_factor)
                    new_height = int(original_height * scale_factor)
                    # ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ŸÉÿ®Ÿäÿ± ÿßŸÑŸÅÿπŸÑŸä ŸÅŸä customtkinter

            except Exception as e:
                pass

        def on_leave(event):
            try:
                # ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ£ÿµŸÑŸä
                if hasattr(widget, 'configure'):
                    if 'fg_color' in widget.configure():
                        widget.configure(fg_color=normal_color)

            except Exception as e:
                pass

        widget.bind("<Enter>", on_enter)
        widget.bind("<Leave>", on_leave)

    @staticmethod
    def create_shadow_effect(widget, parent, shadow_color='#00000020',
                           offset_x=0, offset_y=4, blur_radius=10):
        """ŸÖÿ≠ÿßŸÉÿßÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸÑ"""
        # ÿ•ŸÜÿ¥ÿßÿ° ÿ•ÿ∑ÿßÿ± ÿÆŸÑŸÅŸä ŸÑŸÑÿ∏ŸÑ
        shadow_frame = ctk.CTkFrame(
            parent,
            fg_color=shadow_color,
            corner_radius=widget.cget('corner_radius') if hasattr(widget, 'cget') else 0
        )

        # Ÿàÿ∂ÿπ ÿßŸÑÿ∏ŸÑ ÿÆŸÑŸÅ ÿßŸÑÿπŸÜÿµÿ±
        shadow_frame.place(
            in_=widget,
            x=offset_x,
            y=offset_y,
            relwidth=1,
            relheight=1
        )

        # ÿ±ŸÅÿπ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ£ÿµŸÑŸä ŸÅŸàŸÇ ÿßŸÑÿ∏ŸÑ
        widget.lift()

        return shadow_frame

    @staticmethod
    def animate_fade_in(widget, duration: int = 500, steps: int = 20):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä"""
        # customtkinter ŸÑÿß ŸäÿØÿπŸÖ transparency ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        # ŸÑÿ∞ÿß ŸÜÿ≠ÿßŸÉŸä ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜÿµÿ± ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã

        def fade_animation():
            widget.pack_forget()
            time.sleep(0.1)
            widget.pack()

        thread = threading.Thread(target=fade_animation, daemon=True)
        thread.start()

    @staticmethod
    def create_loading_animation(parent, size: int = 40, color: str = '#2563eb'):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ≥ŸàŸÖ ŸÖÿ™ÿ≠ÿ±ŸÉÿ© ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ"""
        loading_frame = ctk.CTkFrame(parent, fg_color="transparent")

        # ÿØÿßÿ¶ÿ±ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        spinner = ctk.CTkProgressBar(
            loading_frame,
            mode="indeterminate",
            width=size * 3,
            height=size // 4,
            progress_color=color
        )
        spinner.pack()
        spinner.start()

        # ŸÜÿµ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        loading_text = ctk.CTkLabel(
            loading_frame,
            text="Loading...",
            font=ctk.CTkFont(size=12),
            text_color=color
        )
        loading_text.pack(pady=(5, 0))

        return loading_frame, spinner

    @staticmethod
    def pulse_effect(widget, color1: str, color2: str, duration: int = 1000):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ®ÿ∂ ŸÑŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖŸáŸÖÿ©"""
        def pulse():
            toggle = True
            while True:
                try:
                    if hasattr(widget, 'winfo_exists') and widget.winfo_exists():
                        color = color1 if toggle else color2
                        widget.configure(fg_color=color)
                        toggle = not toggle
                        time.sleep(duration / 2000)  # ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ ÿ´ŸàÿßŸÜŸä
                    else:
                        break
                except:
                    break

        thread = threading.Thread(target=pulse, daemon=True)
        thread.start()

    @staticmethod
    def create_ripple_effect(button, ripple_color: str = '#ffffff40'):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ™ŸÖŸàÿ¨ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ±"""
        def on_click(event):
            # ŸÖÿ≠ÿßŸÉÿßÿ© ÿ®ÿ≥Ÿäÿ∑ÿ© ŸÑŸÑÿ™ÿ£ÿ´Ÿäÿ±
            original_color = button.cget('fg_color')
            button.configure(fg_color=ripple_color)
            button.after(200, lambda: button.configure(fg_color=original_color))

        button.bind("<Button-1>", on_click)

    @staticmethod
    def shake_effect(widget, amplitude: int = 10, duration: int = 500):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        original_x = widget.winfo_x()

        def shake():
            steps = 10
            for i in range(steps):
                if not widget.winfo_exists():
                    break

                # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≤ÿßÿ≠ÿ©
                progress = i / steps
                offset = int(amplitude * math.sin(progress * math.pi * 4) * (1 - progress))

                # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿ≤ÿßÿ≠ÿ©
                widget.place(x=original_x + offset)
                time.sleep(duration / steps / 1000)

            # ÿ•ÿπÿßÿØÿ© ŸÑŸÑŸÖŸàÿ∂ÿπ ÿßŸÑÿ£ÿµŸÑŸä
            if widget.winfo_exists():
                widget.place(x=original_x)

        thread = threading.Thread(target=shake, daemon=True)
        thread.start()

    @staticmethod
    def create_tooltip(widget, text: str, delay: int = 1000):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÑŸÖŸäÿ≠ ÿ£ÿØÿßÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        tooltip = None

        def show_tooltip(event):
            nonlocal tooltip

            # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÑŸÖŸäÿ≠
            tooltip = ctk.CTkToplevel(widget)
            tooltip.withdraw()
            tooltip.overrideredirect(True)

            # ÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿ™ŸÑŸÖŸäÿ≠
            tooltip_label = ctk.CTkLabel(
                tooltip,
                text=text,
                font=ctk.CTkFont(size=11),
                fg_color='#1e293b',
                text_color='white',
                corner_radius=6,
                padx=10,
                pady=5
            )
            tooltip_label.pack()

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ
            x = widget.winfo_rootx() + widget.winfo_width() // 2
            y = widget.winfo_rooty() - 30

            tooltip.geometry(f"+{x}+{y}")
            tooltip.deiconify()

        def hide_tooltip(event):
            nonlocal tooltip
            if tooltip:
                tooltip.destroy()
                tooltip = None

        widget.bind("<Enter>", lambda e: widget.after(delay, lambda: show_tooltip(e)))
        widget.bind("<Leave>", hide_tooltip)

    @staticmethod
    def apply_glass_effect(frame):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ≤ÿ¨ÿßÿ¨ (glassmorphism)"""
        # customtkinter ŸÑÿß ŸäÿØÿπŸÖ ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ© ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ©
        # ŸÑŸÉŸÜ ŸäŸÖŸÉŸÜ ŸÖÿ≠ÿßŸÉÿßÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿßŸÑÿ£ŸÑŸàÿßŸÜ
        frame.configure(
            fg_color='#ffffff10',  # ÿ¥ÿ®Ÿá ÿ¥ŸÅÿßŸÅ
            border_width=1,
            border_color='#ffffff30'
        )

    @staticmethod
    def create_gradient_button(parent, text: str, colors: Tuple[str, str], **kwargs):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ÿ®ÿ™ÿØÿ±ÿ¨ ŸÑŸàŸÜŸä"""
        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ£ŸàŸÑ ŸÉŸÑŸàŸÜ ÿ£ÿ≥ÿßÿ≥Ÿä ŸàÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ´ÿßŸÜŸä ŸÑŸÑŸÄ hover
        button = ctk.CTkButton(
            parent,
            text=text,
            fg_color=colors[0],
            hover_color=colors[1],
            **kwargs
        )

        # ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©
        LoginVisualEffects.create_ripple_effect(button)

        return button

    @staticmethod
    def create_animated_entry(parent, placeholder: str, **kwargs):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ÿ•ÿØÿÆÿßŸÑ ŸÖÿπ ÿ±ÿ≥ŸàŸÖ ŸÖÿ™ÿ≠ÿ±ŸÉÿ©"""
        entry = ctk.CTkEntry(parent, placeholder_text=placeholder, **kwargs)

        # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
        def on_focus_in(event):
            if hasattr(entry, 'configure'):
                entry.configure(border_width=2)

        def on_focus_out(event):
            if hasattr(entry, 'configure'):
                entry.configure(border_width=1)

        entry.bind("<FocusIn>", on_focus_in)
        entry.bind("<FocusOut>", on_focus_out)

        return entry

    @staticmethod
    def create_success_animation(parent, message: str = "Success!", duration: int = 2000):
        """ÿ±ÿ≥ŸàŸÖ ŸÖÿ™ÿ≠ÿ±ŸÉÿ© ŸÑŸÑŸÜÿ¨ÿßÿ≠"""
        success_frame = ctk.CTkFrame(
            parent,
            fg_color='#10b981',
            corner_radius=10
        )

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
        icon_label = ctk.CTkLabel(
            success_frame,
            text="‚úì",
            font=ctk.CTkFont(size=30, weight="bold"),
            text_color="white"
        )
        icon_label.pack(pady=(10, 5))

        # ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
        message_label = ctk.CTkLabel(
            success_frame,
            text=message,
            font=ctk.CTkFont(size=14),
            text_color="white"
        )
        message_label.pack(pady=(0, 10), padx=20)

        # ÿ•ÿ∏Ÿáÿßÿ± ŸÖÿ§ŸÇÿ™
        success_frame.pack(pady=20)
        success_frame.after(duration, success_frame.destroy)

        return success_frame

# ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿπŸÑŸâ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
def enhance_login_window(login_window):
    """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© ÿπŸÑŸâ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"""
    effects = LoginVisualEffects()

    # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
    if hasattr(login_window, 'btn_login'):
        effects.add_hover_effect(
            login_window.btn_login,
            '#2563eb',
            '#1d4ed8',
            scale_factor=1.02
        )
        effects.create_ripple_effect(login_window.btn_login)
        effects.create_tooltip(
            login_window.btn_login,
            "Press Enter to login quickly"
        )

    if hasattr(login_window, 'btn_cancel'):
        effects.add_hover_effect(
            login_window.btn_cancel,
            'transparent',
            '#fee2e2'
        )

    # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿπŸÑŸâ ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
    if hasattr(login_window, 'entry_username'):
        effects.create_tooltip(
            login_window.entry_username,
            "Enter your registered username"
        )

    if hasattr(login_window, 'entry_password'):
        effects.create_tooltip(
            login_window.entry_password,
            "Enter your secure password"
        )

    # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä
    if hasattr(login_window, 'scrollable_frame'):
        effects.animate_fade_in(login_window.scrollable_frame)

    return login_window

============================================================
FILE: utils\threading_utils.py
SIZE: 5475 characters
============================================================

# -*- coding: utf-8 -*-
"""
utils/threading_utils.py

ÿ£ÿØŸàÿßÿ™ ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿÆŸäŸàÿ∑ (Threading) ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ Tkinter
"""

import threading
import queue
from typing import Callable, Any, Optional
import tkinter as tk
from core.logger import logger


class GUIUpdater:
    """ŸÅÿ¶ÿ© ŸÑÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÜ ÿÆŸäŸàÿ∑ ŸÖÿÆÿ™ŸÑŸÅÿ© ÿ®ÿ¥ŸÉŸÑ ÿ¢ŸÖŸÜ"""

    def __init__(self):
        self.update_queue = queue.Queue()
        self.root_widget = None
        self.is_running = True

    def set_root_widget(self, widget):
        """ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"""
        self.root_widget = widget

    def schedule_update(self, func: Callable, *args, **kwargs):
        """ÿ¨ÿØŸàŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ŸÅŸä ÿßŸÑÿÆŸäÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä"""
        if self.root_widget and self.is_running:
            try:
                self.root_widget.after(0, func, *args, **kwargs)
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´: {e}")

    def stop(self):
        """ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ≠ÿØÿ´"""
        self.is_running = False


class ThreadPool:
    """ŸÖÿ¨ŸÖŸàÿπÿ© ÿÆŸäŸàÿ∑ ÿ®ÿ≥Ÿäÿ∑ÿ© ŸÑÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÖŸáÿßŸÖ"""

    def __init__(self, max_workers: int = 5):
        self.max_workers = max_workers
        self.tasks_queue = queue.Queue()
        self.workers = []
        self.is_running = True
        self._start_workers()

    def _start_workers(self):
        """ÿ®ÿØÿ° ÿÆŸäŸàÿ∑ ÿßŸÑÿπŸÖŸÑ"""
        for i in range(self.max_workers):
            worker = threading.Thread(target=self._worker_loop, daemon=True)
            worker.start()
            self.workers.append(worker)

    def _worker_loop(self):
        """ÿ≠ŸÑŸÇÿ© ÿßŸÑÿπŸÖŸÑ ŸÑŸÑÿÆŸäÿ∑"""
        while self.is_running:
            try:
                task = self.tasks_queue.get(timeout=1)
                if task is None:
                    break

                func, args, kwargs, callback, error_callback = task

                try:
                    result = func(*args, **kwargs)
                    if callback and _gui_updater:
                        _gui_updater.schedule_update(callback, result)
                except Exception as e:
                    logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÖŸáŸÖÿ©: {e}", exc_info=True)
                    if error_callback and _gui_updater:
                        _gui_updater.schedule_update(error_callback, e)

                self.tasks_queue.task_done()

            except queue.Empty:
                continue
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÑŸÇÿ© ÿßŸÑÿπŸÖŸÑ: {e}", exc_info=True)

    def schedule_task(self, func: Callable, args=None, kwargs=None,
                     callback: Optional[Callable] = None,
                     error_callback: Optional[Callable] = None):
        """ÿ¨ÿØŸàŸÑÿ© ŸÖŸáŸÖÿ© ŸÑŸÑÿ™ŸÜŸÅŸäÿ∞"""
        args = args or ()
        kwargs = kwargs or {}
        task = (func, args, kwargs, callback, error_callback)
        self.tasks_queue.put(task)

    def shutdown(self):
        """ÿ•ŸäŸÇÿßŸÅ ŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿÆŸäŸàÿ∑"""
        self.is_running = False

        # ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸáÿßŸÖ ŸÅÿßÿ±ÿ∫ÿ© ŸÑÿ•ŸäŸÇÿßÿ∏ ÿßŸÑÿÆŸäŸàÿ∑
        for _ in self.workers:
            self.tasks_queue.put(None)

        # ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿÆŸäŸàÿ∑
        for worker in self.workers:
            worker.join(timeout=2)


# ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©
_gui_updater: Optional[GUIUpdater] = None
_thread_pool: Optional[ThreadPool] = None


def initialize_threading(root_widget):
    """ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆŸäŸàÿ∑"""
    global _gui_updater, _thread_pool

    _gui_updater = GUIUpdater()
    _gui_updater.set_root_widget(root_widget)

    _thread_pool = ThreadPool(max_workers=3)

    logger.info("ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆŸäŸàÿ∑")


def shutdown_threading():
    """ÿ•ŸäŸÇÿßŸÅ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆŸäŸàÿ∑"""
    global _gui_updater, _thread_pool

    if _gui_updater:
        _gui_updater.stop()
        _gui_updater = None

    if _thread_pool:
        _thread_pool.shutdown()
        _thread_pool = None

    logger.info("ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆŸäŸàÿ∑")


def get_gui_updater() -> Optional[GUIUpdater]:
    """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿ≠ÿØÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
    return _gui_updater


def get_thread_pool() -> Optional[ThreadPool]:
    """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿÆŸäŸàÿ∑"""
    return _thread_pool


def run_in_thread(func: Callable, args=None, kwargs=None,
                 callback: Optional[Callable] = None,
                 error_callback: Optional[Callable] = None):
    """ÿ™ÿ¥ÿ∫ŸäŸÑ ÿØÿßŸÑÿ© ŸÅŸä ÿÆŸäÿ∑ ŸÖŸÜŸÅÿµŸÑ"""
    if _thread_pool:
        _thread_pool.schedule_task(func, args, kwargs, callback, error_callback)
    else:
        # ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸä ÿÆŸäÿ∑ ÿ¨ÿØŸäÿØ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        def wrapper():
            try:
                result = func(*(args or ()), **(kwargs or {}))
                if callback and _gui_updater:
                    _gui_updater.schedule_update(callback, result)
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÖŸáŸÖÿ©: {e}", exc_info=True)
                if error_callback and _gui_updater:
                    _gui_updater.schedule_update(error_callback, e)

        thread = threading.Thread(target=wrapper, daemon=True)
        thread.start()


def safe_gui_update(widget, func: Callable, *args, **kwargs):
    """ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ŸÖŸÜ ŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
    try:
        if widget and widget.winfo_exists():
            widget.after(0, func, *args, **kwargs)
    except tk.TclError:
        # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ≠ÿ∞ŸàŸÅÿ©
        pass
    except Exception as e:
        logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©: {e}")

============================================================
FILE: utils\validators.py
SIZE: 12546 characters
============================================================

# -*- coding: utf-8 -*-
"""
utils/validators.py

ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™
"""

import re
from typing import Tuple, Dict, List, Optional
import string
from datetime import datetime

from core.logger import logger


class InputValidator:
    """ŸÖÿØŸäÿ± ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™"""

    # Common patterns
    USERNAME_PATTERN = re.compile(r'^[a-zA-Z0-9_.-]+$')
    EMAIL_PATTERN = re.compile(
        r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    )
    PHONE_PATTERN = re.compile(r'^\+?[0-9\s\-\(\)]+$')

    # Common weak passwords
    COMMON_PASSWORDS = {
        'password', '123456', '123456789', 'qwerty', 'abc123',
        'password1', 'password123', 'admin', 'letmein', 'welcome',
        'monkey', '1234567890', 'qwertyuiop', 'admin123', 'root',
        'toor', 'pass', 'test', 'guest', 'master', 'god', '666666',
        '123123', '12345', '1234567', '12345678', '111111',
        '123321', 'pass123', 'pass1234'
    }

    @staticmethod
    def validate_username(username: str) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ

        Args:
            username: Username to validate

        Returns:
            Tuple of (is_valid, error_message)
        """
        # Check if empty
        if not username:
            return False, "Username is required"

        # Check length
        if len(username) < 3:
            return False, "Username must be at least 3 characters"

        if len(username) > 50:
            return False, "Username must not exceed 50 characters"

        # Check format
        if not InputValidator.USERNAME_PATTERN.match(username):
            return False, "Username can only contain letters, numbers, dots, hyphens and underscores"

        # Check for consecutive special characters
        if '..' in username or '--' in username or '__' in username:
            return False, "Username cannot contain consecutive special characters"

        # Check start/end
        if username[0] in '.-_' or username[-1] in '.-_':
            return False, "Username cannot start or end with special characters"

        return True, ""

    @staticmethod
    def validate_email(email: str) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä

        Args:
            email: Email to validate

        Returns:
            Tuple of (is_valid, error_message)
        """
        if not email:
            return False, "Email is required"

        # Basic format check
        if not InputValidator.EMAIL_PATTERN.match(email.lower()):
            return False, "Invalid email format"

        # Check length
        if len(email) > 255:
            return False, "Email address too long"

        # Check local part
        local = email.split('@')[0]
        if len(local) > 64:
            return False, "Email local part too long"

        return True, ""

    @staticmethod
    def validate_password(password: str) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©

        Args:
            password: Password to validate

        Returns:
            Tuple of (is_valid, error_message)
        """
        if not password:
            return False, "Password is required"

        if len(password) < 8:
            return False, "Password must be at least 8 characters"

        if len(password) > 128:
            return False, "Password too long"

        return True, ""

    @staticmethod
    def validate_password_complexity(
        password: str,
        require_uppercase: bool = True,
        require_lowercase: bool = True,
        require_numbers: bool = True,
        require_special: bool = True,
        min_length: int = 8
    ) -> Dict[str, bool]:
        """
        ÿ™ÿ≠ŸÑŸäŸÑ ÿ™ÿπŸÇŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±

        Args:
            password: Password to analyze
            require_uppercase: Require uppercase letters
            require_lowercase: Require lowercase letters
            require_numbers: Require numbers
            require_special: Require special characters
            min_length: Minimum length required

        Returns:
            Dictionary with complexity checks
        """
        complexity = {
            "length": len(password) >= min_length,
            "uppercase": not require_uppercase or bool(re.search(r'[A-Z]', password)),
            "lowercase": not require_lowercase or bool(re.search(r'[a-z]', password)),
            "numbers": not require_numbers or bool(re.search(r'\d', password)),
            "special": not require_special or bool(re.search(r'[!@#$%^&*(),.?":{}|<>]', password)),
            "no_spaces": ' ' not in password,
            "no_common": password.lower() not in InputValidator.COMMON_PASSWORDS,
            "no_repeating": not bool(re.search(r'(.)\1{2,}', password)),  # No 3+ repeating chars
            "no_sequential": not InputValidator._has_sequential_chars(password)
        }

        return complexity

    @staticmethod
    def _has_sequential_chars(password: str, length: int = 3) -> bool:
        """Check for sequential characters"""
        sequences = [
            'abcdefghijklmnopqrstuvwxyz',
            'zyxwvutsrqponmlkjihgfedcba',
            '0123456789',
            '9876543210',
            'qwertyuiop',
            'asdfghjkl',
            'zxcvbnm'
        ]

        password_lower = password.lower()
        for seq in sequences:
            for i in range(len(seq) - length + 1):
                if seq[i:i+length] in password_lower:
                    return True

        return False

    @staticmethod
    def calculate_password_score(password: str) -> int:
        """
        ÿ≠ÿ≥ÿßÿ® ŸÜŸÇÿßÿ∑ ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±

        Args:
            password: Password to score

        Returns:
            Score from 0-10
        """
        if not password:
            return 0

        score = 0

        # Get complexity
        complexity = InputValidator.validate_password_complexity(password)

        # Base score from requirements
        if complexity['length']:
            score += 2
        if complexity['uppercase']:
            score += 1
        if complexity['lowercase']:
            score += 1
        if complexity['numbers']:
            score += 1
        if complexity['special']:
            score += 1
        if complexity['no_common']:
            score += 1
        if complexity['no_repeating']:
            score += 1
        if complexity['no_sequential']:
            score += 1

        # Bonus for length
        if len(password) >= 12:
            score += 1
        if len(password) >= 16:
            score += 1
        if len(password) >= 20:
            score += 1

        # Cap at 10
        return min(score, 10)

    @staticmethod
    def validate_phone(phone: str, country_code: Optional[str] = None) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ

        Args:
            phone: Phone number to validate
            country_code: Optional country code for specific validation

        Returns:
            Tuple of (is_valid, error_message)
        """
        if not phone:
            return False, "Phone number is required"

        # Remove common formatting
        cleaned = re.sub(r'[\s\-\(\)]', '', phone)

        # Check if it's numeric (with optional +)
        if not re.match(r'^\+?\d+$', cleaned):
            return False, "Invalid phone number format"

        # Check length (international standards)
        if len(cleaned) < 7 or len(cleaned) > 15:
            return False, "Phone number length invalid"

        # Country-specific validation
        if country_code:
            if country_code.upper() == 'EG':  # Egypt
                if not (cleaned.startswith('+20') or cleaned.startswith('01')):
                    return False, "Invalid Egyptian phone number"

                # Remove country code for length check
                local = cleaned[3:] if cleaned.startswith('+20') else cleaned
                if not (len(local) == 10 or len(local) == 11):
                    return False, "Egyptian phone number must be 10 or 11 digits"

        return True, ""

    @staticmethod
    def sanitize_input(text: str, allow_html: bool = False) -> str:
        """
        ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™ ŸÖŸÜ ÿßŸÑÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ∂ÿßÿ±ÿ©

        Args:
            text: Text to sanitize
            allow_html: Whether to allow HTML tags

        Returns:
            Sanitized text
        """
        if not text:
            return ""

        # Remove null bytes
        text = text.replace('\x00', '')

        # Strip leading/trailing whitespace
        text = text.strip()

        if not allow_html:
            # Escape HTML entities
            text = (
                text.replace('&', '&amp;')
                    .replace('<', '&lt;')
                    .replace('>', '&gt;')
                    .replace('"', '&quot;')
                    .replace("'", '&#x27;')
            )

        return text

    @staticmethod
    def validate_date(
        date_str: str,
        format: str = '%Y-%m-%d',
        min_date: Optional[datetime] = None,
        max_date: Optional[datetime] = None
    ) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆ

        Args:
            date_str: Date string to validate
            format: Expected date format
            min_date: Minimum allowed date
            max_date: Maximum allowed date

        Returns:
            Tuple of (is_valid, error_message)
        """
        if not date_str:
            return False, "Date is required"

        try:
            date = datetime.strptime(date_str, format)

            if min_date and date < min_date:
                return False, f"Date must be after {min_date.strftime(format)}"

            if max_date and date > max_date:
                return False, f"Date must be before {max_date.strftime(format)}"

            return True, ""

        except ValueError:
            return False, f"Invalid date format. Expected: {format}"

    @staticmethod
    def validate_url(url: str, require_https: bool = False) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© URL

        Args:
            url: URL to validate
            require_https: Require HTTPS protocol

        Returns:
            Tuple of (is_valid, error_message)
        """
        if not url:
            return False, "URL is required"

        # URL pattern
        url_pattern = re.compile(
            r'^https?://'  # http:// or https://
            r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|'  # domain...
            r'localhost|'  # localhost...
            r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})'  # ...or ip
            r'(?::\d+)?'  # optional port
            r'(?:/?|[/?]\S+)$', re.IGNORECASE
        )

        if not url_pattern.match(url):
            return False, "Invalid URL format"

        if require_https and not url.startswith('https://'):
            return False, "URL must use HTTPS"

        return True, ""

    @staticmethod
    def validate_credit_card(card_number: str) -> Tuple[bool, str]:
        """
        ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ±ŸÇŸÖ ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿßÿ¶ÿ™ŸÖÿßŸÜ (Luhn algorithm)

        Args:
            card_number: Credit card number

        Returns:
            Tuple of (is_valid, error_message)
        """
        # Remove spaces and dashes
        card_number = re.sub(r'[\s-]', '', card_number)

        if not card_number.isdigit():
            return False, "Card number must contain only digits"

        if len(card_number) < 13 or len(card_number) > 19:
            return False, "Invalid card number length"

        # Luhn algorithm
        total = 0
        reverse_digits = card_number[::-1]

        for i, digit in enumerate(reverse_digits):
            n = int(digit)
            if i % 2 == 1:
                n *= 2
                if n > 9:
                    n -= 9
            total += n

        if total % 10 != 0:
            return False, "Invalid card number"

        return True, ""

============================================================
FILE: utils\window_manager.py
SIZE: 48019 characters
============================================================

# -*- coding: utf-8 -*-
"""
utils/window_manager.py - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ ÿØÿπŸÖ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© Ÿàÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ Ÿàÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ

ÿ£ÿØÿßÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜŸàÿßŸÅÿ∞ ŸÖÿπ:
- ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿØÿßÿ¶ŸÖÿßŸã
- ÿßŸÑÿ™ŸÉŸäŸÅ ŸÖÿπ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ©
- ÿ∂ŸÖÿßŸÜ ÿ∏ŸáŸàÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸàŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ£ÿÆÿ±Ÿâ
- ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿ∏ŸáŸàÿ± ÿßŸÑŸÜŸàÿßŸÅÿ∞ ŸÅŸä ÿßŸÑÿ¨ÿßŸÜÿ® ÿßŸÑÿ£ŸäŸÖŸÜ
- ÿ•ÿ∏Ÿáÿßÿ± ÿ≥ŸÑÿ≥ ÿ®ÿØŸàŸÜ ŸàŸÖŸäÿ∂
- ÿØÿπŸÖ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÉŸàÿ∂ÿπ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
- ÿØÿπŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ ŸÑŸÜŸàÿßŸÅÿ∞ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
- ÿØÿπŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ) ŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸàÿßŸÑÿ™ÿπÿØŸäŸÑ

ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©:
- ÿ•ÿ∂ÿßŸÅÿ© workarea_height_mode ŸÑÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)
- ÿ•ÿ∂ÿßŸÅÿ© get_available_screen_area ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ÿ®ÿØŸÇÿ©
- ÿ™ÿ≠ÿ≥ŸäŸÜ _apply_workarea_height_mode ŸÑÿ¨ŸÖŸäÿπ ÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
- ÿ•ÿ∂ÿßŸÅÿ© setup_add_edit_window ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸÖÿπ ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸàÿßŸÑÿ™ÿπÿØŸäŸÑ
- ÿØÿπŸÖ ŸÖÿ≠ÿ≥ŸÜ ŸÑÿ≠ÿ≥ÿßÿ® ÿßÿ±ÿ™ŸÅÿßÿπ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ ÿπŸÑŸâ Windows
- ÿ•ÿ∂ÿßŸÅÿ© ÿØÿπŸÖ ŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ≠Ÿàÿßÿ± ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
"""

import platform
import customtkinter as ctk
import tkinter as tk
from typing import Union, Optional, Callable, Tuple
from weakref import WeakSet
import time
import weakref


class WindowManager:
    """ŸÖÿØŸäÿ± ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ¢ŸÖŸÜÿ© ŸÑŸÑŸÜŸàÿßŸÅÿ∞ ŸàÿØÿπŸÖ ÿ¨ŸÖŸäÿπ ÿ£Ÿàÿ∂ÿßÿπ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ"""

    # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ WeakSet ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπ ÿßŸÑÿØÿßÿ¶ÿ±Ÿäÿ©
    _active_windows = WeakSet()

    @staticmethod
    def get_available_screen_area():
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑŸÜŸàÿßŸÅÿ∞ (ÿ®ÿØŸàŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)"""
        try:
            import tkinter as tk
            root = tk.Tk()
            root.withdraw()  # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ®ÿπÿßÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ©
            screen_width = root.winfo_screenwidth()
            screen_height = root.winfo_screenheight()

            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© (ÿ®ÿØŸàŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)
            try:
                # ÿπŸÑŸâ Windows
                if platform.system() == "Windows":
                    import ctypes
                    from ctypes import wintypes

                    # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
                    user32 = ctypes.windll.user32
                    rect = wintypes.RECT()
                    user32.SystemParametersInfoW(48, 0, ctypes.byref(rect), 0)  # SPI_GETWORKAREA

                    available_width = rect.right - rect.left
                    available_height = rect.bottom - rect.top
                    work_area_x = rect.left
                    work_area_y = rect.top

                    root.destroy()
                    return available_width, available_height, work_area_x, work_area_y

            except Exception as e:
                print(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ: {e}")

            # ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÇÿØŸäÿ± ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä (ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ ÿπÿßÿØÿ© 40-50 ÿ®ŸÉÿ≥ŸÑ)
            taskbar_height = 50
            available_width = screen_width
            available_height = screen_height - taskbar_height
            work_area_x = 0
            work_area_y = 0

            root.destroy()
            return available_width, available_height, work_area_x, work_area_y

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©: {e}")
            # ŸÇŸäŸÖ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ¢ŸÖŸÜÿ©
            return 1920, 1030, 0, 0

    @staticmethod
    def _apply_workarea_height_mode(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel], size: tuple = None):
        """ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ŸÖŸÜ ÿ£ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ•ŸÑŸâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
            available_width, available_height, work_x, work_y = WindowManager.get_available_screen_area()

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπÿ±ÿ∂
            if size and len(size) >= 1:
                window_width = size[0]
            else:
                # ÿπÿ±ÿ∂ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©/ÿßŸÑÿ™ÿπÿØŸäŸÑ
                window_width = min(600, int(available_width * 0.4))

            # ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÉÿßŸÖŸÑ
            window_height = available_height

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ ÿ£ŸÅŸÇŸäÿßŸã ŸÖÿπ Ÿàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸä ÿ£ÿπŸÑŸâ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
            x = (available_width - window_width) // 2
            y = work_y  # ÿ®ÿØÿßŸäÿ© ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ÿπÿßÿØÿ© 0)

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ÿ®ÿπÿßÿØ ŸàÿßŸÑŸÖŸàÿ∂ÿπ
            window.geometry(f"{window_width}x{window_height}+{x}+{y}")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            window.update_idletasks()
            window.update()

            print(f"ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ: {window_width}x{window_height}+{x}+{y}")
            print(f"ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ: {available_width}x{available_height} ŸÖŸÜ ({work_x},{work_y})")

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ: {e}")
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ÿ¢ŸÖŸÜÿ©
            try:
                screen_width = window.winfo_screenwidth()
                screen_height = window.winfo_screenheight()
                # ÿ™ŸÇÿØŸäÿ± ÿßÿ±ÿ™ŸÅÿßÿπ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ
                safe_height = screen_height - 50
                window_width = size[0] if size else 600
                x = (screen_width - window_width) // 2
                window.geometry(f"{window_width}x{safe_height}+{x}+0")
            except:
                pass

    @staticmethod
    def setup_centered_window(window: Union[ctk.CTk, ctk.CTkToplevel],
                             size: tuple = None,
                             parent: Optional[Union[ctk.CTk, ctk.CTkToplevel]] = None,
                             full_height_mode: bool = False,
                             workarea_height_mode: bool = False,  # ÿ¨ÿØŸäÿØ: ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ
                             **kwargs) -> None:
        """ÿ•ÿπÿØÿßÿØ ŸÜÿßŸÅÿ∞ÿ© ŸÖÿπ ÿ∂ŸÖÿßŸÜ ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÖÿπ ÿØÿπŸÖ ÿ£Ÿàÿ∂ÿßÿπ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©"""

        # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ£ŸàŸÑÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑŸàŸÖŸäÿ∂
        if isinstance(window, (ctk.CTkToplevel, tk.Toplevel)):
            window.withdraw()

        # ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ÿ¨ŸÖ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®
        if workarea_height_mode:
            # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)
            WindowManager._apply_workarea_height_mode(window, size)
        elif full_height_mode:
            # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ (ŸÅŸàŸÇ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ ÿ£Ÿäÿ∂ÿßŸã)
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπÿ±ÿ∂ (ÿ•ŸÖÿß ÿßŸÑŸÖÿ≠ÿØÿØ ÿ£Ÿà ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©)
            if size:
                window_width = size[0]
            else:
                window_width = min(500, int(screen_width * 0.4))  # ÿπÿ±ÿ∂ ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÖŸÜÿßÿ≥ÿ®

            # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ ÿ®ÿØŸàŸÜ ŸáŸàÿßŸÖÿ¥
            window_height = screen_height  # ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ

            window.geometry(f"{window_width}x{window_height}")
        elif size:
            window.geometry(f"{size[0]}x{size[1]}")

        # ŸÅÿ±ÿ∂ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿßŸÖŸÑ
        window.update_idletasks()
        window.update()

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸàÿ∂ÿπ
        if workarea_height_mode:
            # ÿßŸÑŸÖŸàÿ∂ÿπ ŸÖÿ≠ÿØÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã ŸÅŸä _apply_workarea_height_mode
            pass
        elif full_height_mode:
            # ÿßŸÑŸÖŸàÿ∂ÿπ ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()
            window_width = window.winfo_width() if window.winfo_width() > 1 else window.winfo_reqwidth()

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑
            x = (screen_width - window_width) // 2
            y = 0  # ÿ®ÿØŸàŸÜ ŸáÿßŸÖÿ¥ ÿπŸÑŸàŸä - ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÉÿßŸÖŸÑÿ©
            window_height = screen_height  # ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ®ŸÇÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿØÿßÿÆŸÑ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            x = max(10, min(x, screen_width - window_width - 10))

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖŸàÿ∂ÿπ ŸàÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
            window.geometry(f"{window_width}x{window_height}+{x}+{y}")
        else:
            # ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑÿπÿßÿØŸä
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÅÿπŸÑŸä
            if size:
                window_width, window_height = size
            else:
                window_width = window.winfo_reqwidth() if window.winfo_width() <= 1 else window.winfo_width()
                window_height = window.winfo_reqheight() if window.winfo_height() <= 1 else window.winfo_height()

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑
            x = (screen_width - window_width) // 2
            y = (screen_height - window_height) // 2

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ®ŸÇÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿØÿßÿÆŸÑ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            x = max(10, min(x, screen_width - window_width - 10))
            y = max(10, min(y, screen_height - window_height - 50))  # 50 ŸÑÿ™ÿ±ŸÉ ŸÖÿ≥ÿßÿ≠ÿ© ŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖŸàÿ∂ÿπ ŸàÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
            window.geometry(f"{window_width}x{window_height}+{x}+{y}")

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ÿßŸÇŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ÿ®ÿØŸàŸÜ ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ)
        kwargs['center'] = False  # ŸÖŸÜÿπ ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÖŸÉÿ±ÿ±
        kwargs['use_smooth_show'] = False  # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿÆŸÅŸäÿ© ÿ®ÿßŸÑŸÅÿπŸÑ
        kwargs['full_height_mode'] = full_height_mode  # ÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿπŸÑŸàŸÖÿ© ŸÑŸÑÿØÿßŸÑÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        kwargs['workarea_height_mode'] = workarea_height_mode  # ÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿπŸÑŸàŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        WindowManager.setup_window(window, parent=parent, **kwargs)

        # ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ¥ŸÉŸÑ ÿ≥ŸÑÿ≥
        if isinstance(window, (ctk.CTkToplevel, tk.Toplevel)):
            window.deiconify()
            window.lift()
            window.focus_force()

    @staticmethod
    def setup_window(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                    parent: Optional[Union[ctk.CTk, ctk.CTkToplevel]] = None,
                    center: bool = True,
                    center_on_screen: bool = True,  # ŸÑŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿØÿßÿ¶ŸÖÿßŸã
                    modal: bool = False,
                    focus: bool = True,
                    topmost_duration: int = 300,
                    min_size: tuple = None,
                    max_size: tuple = None,
                    size: tuple = None,
                    responsive: bool = True,  # ŸÑŸÑÿ™ŸÉŸäŸÅ ŸÖÿπ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                    max_screen_ratio: float = 0.9,  # ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÖŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                    use_smooth_show: bool = True,  # ŸÑŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ≥ŸÑÿ≥
                    fullscreen_default: bool = False,  # ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
                    full_height_mode: bool = False,  # ŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ
                    workarea_height_mode: bool = False) -> None:  # ÿ¨ÿØŸäÿØ: ŸÑÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑÿ™ÿ∏Ÿáÿ± ÿ®ÿ¥ŸÉŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÖÿπ ÿØÿπŸÖ ÿ¨ŸÖŸäÿπ ÿ£Ÿàÿ∂ÿßÿπ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ"""
        try:
            # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ§ŸÇÿ™ÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑŸàŸÖŸäÿ∂ (ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ™ŸÖŸàÿ∂ÿπ)
            if use_smooth_show and isinstance(window, (ctk.CTkToplevel, tk.Toplevel)):
                window.withdraw()

            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ∂ÿπŸäŸÅÿ©
            WindowManager._active_windows.add(window)

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
            if fullscreen_default:
                # ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÅŸàÿ±ÿßŸã
                WindowManager._apply_fullscreen(window)
                # ÿ™ÿ¨ÿßŸáŸÑ ÿ®ÿßŸÇŸä ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ≠ÿ¨ŸÖ ŸàÿßŸÑŸÖŸàÿ∂ÿπ
                center = False
                size = None
                full_height_mode = False
                workarea_height_mode = False
            elif workarea_height_mode:
                # ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
                WindowManager._apply_workarea_height_mode(window, size)
                center = False  # ŸÑÿß ŸÜÿ≠ÿ™ÿßÿ¨ ÿ™Ÿàÿ≥Ÿäÿ∑ ŸÑÿ£ŸÜ ÿßŸÑŸÖŸàÿ∂ÿπ ŸÖÿ≠ÿØÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã
            elif full_height_mode:
                # ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ
                WindowManager._apply_full_height_mode(window, size)
                center = False  # ŸÑÿß ŸÜÿ≠ÿ™ÿßÿ¨ ÿ™Ÿàÿ≥Ÿäÿ∑ ŸÑÿ£ŸÜ ÿßŸÑŸÖŸàÿ∂ÿπ ŸÖÿ≠ÿØÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã
            else:
                # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                screen_width = window.winfo_screenwidth()
                screen_height = window.winfo_screenheight()

                # ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ÿ¨ŸÖ ŸÖÿπ ÿßŸÑÿ™ŸÉŸäŸÅ ŸÖÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                if size and responsive:
                    # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÖÿπ ÿπÿØŸÖ ÿ™ÿ¨ÿßŸàÿ≤ ŸÜÿ≥ÿ®ÿ© ŸÖÿπŸäŸÜÿ© ŸÖŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                    max_width = int(screen_width * max_screen_ratio)
                    max_height = int(screen_height * max_screen_ratio)

                    # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ
                    actual_width = min(size[0], max_width)
                    actual_height = min(size[1], max_height)

                    window.geometry(f"{actual_width}x{actual_height}")
                elif size:
                    window.geometry(f"{size[0]}x{size[1]}")

                # ŸÅÿ±ÿ∂ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿßŸÖŸÑ
                window.update_idletasks()
                window.update()

                # ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ÿØŸàÿØ ŸÖÿπ ŸÖÿ±ÿßÿπÿßÿ© ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                if min_size:
                    window.minsize(min_size[0], min_size[1])
                if max_size and responsive:
                    # ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸäÿ™ŸÜÿßÿ≥ÿ® ŸÖÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                    adjusted_max_width = min(max_size[0], int(screen_width * max_screen_ratio))
                    adjusted_max_height = min(max_size[1], int(screen_height * max_screen_ratio))
                    window.maxsize(adjusted_max_width, adjusted_max_height)
                elif max_size:
                    window.maxsize(max_size[0], max_size[1])

                # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                if center:
                    if center_on_screen:
                        # ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÅŸàÿ±Ÿä ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                        WindowManager.center_window_on_screen(window)
                    else:
                        # ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿπŸÑŸâ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©
                        WindowManager.center_window(window, parent)

            # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ÿßÿ®ÿπÿ© (ŸÑŸÉŸÜ ŸÖÿπ ÿßŸÑÿ®ŸÇÿßÿ° ŸÅŸàŸÇŸáÿß)
            if parent and hasattr(window, 'transient'):
                try:
                    if parent.winfo_exists():
                        window.transient(parent)
                except:
                    pass

            # ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖÿÆŸÅŸäÿ©
            if use_smooth_show and isinstance(window, (ctk.CTkToplevel, tk.Toplevel)):
                window.deiconify()

            # ÿ±ŸÅÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑÿ™ÿ∏Ÿáÿ± ŸÅŸàŸÇ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ (ÿ•ŸÑÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÅŸä ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©)
            if not fullscreen_default:
                WindowManager.force_bring_to_front(window, topmost_duration)

            # ÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
            if focus:
                WindowManager.set_focus(window)

            # ÿ¨ÿπŸÑŸáÿß ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
            if modal and parent:
                WindowManager.make_modal(window, parent)

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ
            WindowManager._apply_platform_specific(window, fullscreen_default)

            # ÿ±ÿ®ÿ∑ ÿ≠ÿØÿ´ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©
            WindowManager._setup_close_handler(window)

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÖŸàÿ∂ÿπ ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿ®ÿπÿØ ÿ™ÿ£ÿÆŸäÿ± ÿ®ÿ≥Ÿäÿ∑ (ŸÅŸÇÿ∑ ŸÑŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿπÿßÿØŸäÿ©)
            if center and center_on_screen and not fullscreen_default and not full_height_mode and not workarea_height_mode:
                WindowManager.ensure_correct_position(window, delay=100)

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    @staticmethod
    def _apply_full_height_mode(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel], size: tuple = None):
        """ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ ÿ®ÿØŸàŸÜ ŸáŸàÿßŸÖÿ¥"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ®ÿπÿßÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπÿ±ÿ∂
            if size and len(size) >= 1:
                window_width = size[0]
            else:
                # ÿπÿ±ÿ∂ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
                window_width = min(500, int(screen_width * 0.4))

            # ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ ÿ®ÿØŸàŸÜ ŸáŸàÿßŸÖÿ¥
            window_height = screen_height

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ ÿ£ŸÅŸÇŸäÿßŸã ŸÖÿπ Ÿàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸä ÿ£ŸÇÿµŸâ ÿßŸÑÿ£ÿπŸÑŸâ
            x = (screen_width - window_width) // 2
            y = 0  # ÿ®ÿØŸàŸÜ ŸáÿßŸÖÿ¥ ÿπŸÑŸàŸä - ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÉÿßŸÖŸÑÿ©

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ÿ®ÿπÿßÿØ ŸàÿßŸÑŸÖŸàÿ∂ÿπ
            window.geometry(f"{window_width}x{window_height}+{x}+{y}")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            window.update_idletasks()
            window.update()

            print(f"ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ: {window_width}x{window_height}+{x}+{y}")

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ: {e}")
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
            try:
                screen_height = window.winfo_screenheight()
                window.geometry(f"500x{screen_height}+400+0")
            except:
                pass

    @staticmethod
    def _apply_fullscreen(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]):
        """ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ"""
        try:
            system = platform.system()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ®ÿπÿßÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ© Ÿàÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑÿ™ŸÖŸÑÿ£ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ£ŸàŸÑÿßŸã
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()
            window.geometry(f"{screen_width}x{screen_height}+0+0")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÇÿ®ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ÿßŸÑÿ©
            window.update_idletasks()
            window.update()

            if system == "Windows":
                # ŸÑŸÑŸÄ Windowsÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ state('zoomed') ŸÑŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ
                try:
                    window.state('zoomed')
                    print("ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Windows zoomed)")
                except Exception as e:
                    print(f"ŸÅÿ¥ŸÑ ŸÅŸä zoomedÿå ŸÖÿ≠ÿßŸàŸÑÿ© fullscreen: {e}")
                    # ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ zoomedÿå ÿ¨ÿ±ÿ® fullscreen
                    window.attributes('-fullscreen', True)
                    print("ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Windows fullscreen)")

            elif system == "Linux":
                # ŸÑŸÑŸÄ Linuxÿå ÿ¨ÿ±ÿ® zoomed ÿ£ŸàŸÑÿßŸã ÿ´ŸÖ fullscreen
                try:
                    window.attributes('-zoomed', True)
                    print("ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Linux zoomed)")
                except Exception as e:
                    print(f"ŸÅÿ¥ŸÑ ŸÅŸä zoomedÿå ŸÖÿ≠ÿßŸàŸÑÿ© fullscreen: {e}")
                    window.attributes('-fullscreen', True)
                    print("ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Linux fullscreen)")

            elif system == "Darwin":  # macOS
                window.attributes('-fullscreen', True)
                print("ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (macOS)")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ±ÿ© ÿ£ÿÆŸäÿ±ÿ©
            window.update_idletasks()
            window.update()

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©: {e}")
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ
            try:
                screen_width = window.winfo_screenwidth()
                screen_height = window.winfo_screenheight()
                window.geometry(f"{screen_width-50}x{screen_height-100}+25+25")
                print("ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ£ŸÇÿµŸâ ŸÉÿ®ÿØŸäŸÑ")
            except:
                pass

    @staticmethod
    def center_window_on_screen(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]) -> None:
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿØÿßÿ¶ŸÖÿßŸã ŸÖÿπ ÿ∂ŸÖÿßŸÜ ÿßŸÑÿØŸÇÿ©"""
        try:
            # ŸÅÿ±ÿ∂ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿßŸÖŸÑ ÿ£ŸàŸÑÿßŸã
            window.update_idletasks()
            window.update()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ŸÖŸàÿ´ŸàŸÇÿ©
            window_width, window_height = WindowManager._get_window_size(window)

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©ÿå ÿßŸÜÿ™ÿ∏ÿ± Ÿàÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
            if window_width <= 1 or window_height <= 1:
                window.update()
                window_width = window.winfo_reqwidth()
                window_height = window.winfo_reqheight()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            x = (screen_width - window_width) // 2
            y = (screen_height - window_height) // 2

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿØÿßÿÆŸÑ ÿ≠ÿØŸàÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÖÿπ ŸáÿßŸÖÿ¥ ÿ£ŸÖÿßŸÜ
            margin = 20
            x = max(margin, min(x, screen_width - window_width - margin))
            y = max(margin, min(y, screen_height - window_height - margin))

            # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖŸàÿ∂ÿπ ÿ®ÿØŸÇÿ©
            window.geometry(f"{window_width}x{window_height}+{x}+{y}")

            # ŸÅÿ±ÿ∂ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜŸáÿßÿ¶Ÿä
            window.update()

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©: {e}")

    @staticmethod
    def force_bring_to_front(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                           duration: int = 300) -> None:
        """ÿ±ŸÅÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑŸÑÿ£ÿπŸÑŸâ ÿ®ÿ¥ŸÉŸÑ ŸÇŸàŸä ŸÑÿ∂ŸÖÿßŸÜ ÿ∏ŸáŸàÿ±Ÿáÿß ŸÅŸàŸÇ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            # ÿ±ŸÅÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπÿØÿ© ŸÖÿ±ÿßÿ™ ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ
            window.lift()
            window.update()

            # ÿ¨ÿπŸÑŸáÿß ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ ŸÖÿ§ŸÇÿ™ÿßŸã
            window.attributes('-topmost', True)
            window.update()

            # ÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
            window.focus_force()
            window.focus_set()

            # ÿ±ŸÅÿπ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ
            window.lift()

            # ÿπŸÑŸâ Windowsÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ∑ÿ±ŸäŸÇÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
            if platform.system() == "Windows":
                window.wm_attributes('-topmost', True)
                window.update()

            if duration > 0:
                # ÿ•ÿ≤ÿßŸÑÿ© topmost ÿ®ÿπÿØ ŸÅÿ™ÿ±ÿ©
                window_ref = weakref.ref(window)
                window.after(duration, lambda: WindowManager._remove_topmost_safe(window_ref))

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    @staticmethod
    def adjust_window_size_to_screen(window: Union[ctk.CTk, ctk.CTkToplevel],
                                   preferred_width: int,
                                   preferred_height: int,
                                   max_screen_ratio: float = 0.9) -> Tuple[int, int]:
        """ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑŸäÿ™ŸÜÿßÿ≥ÿ® ŸÖÿπ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            screen_width = window.winfo_screenwidth()
            screen_height = window.winfo_screenheight()

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠
            max_width = int(screen_width * max_screen_ratio)
            max_height = int(screen_height * max_screen_ratio)

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ÿØŸàÿØ
            actual_width = min(preferred_width, max_width)
            actual_height = min(preferred_height, max_height)

            return actual_width, actual_height

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")
            return preferred_width, preferred_height

    @staticmethod
    def _get_window_size(window) -> Tuple[int, int]:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÅÿπŸÑŸä"""
        try:
            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ≠ÿ¨ŸÖ ŸÖŸÜ geometry
            geometry = window.geometry()
            if geometry:
                # ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ© "widthxheight+x+y"
                size_part = geometry.split('+')[0]
                if 'x' in size_part:
                    width, height = map(int, size_part.split('x'))
                    return width, height
        except:
            pass

        # ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ winfo_width/height
        width = window.winfo_width()
        height = window.winfo_height()

        # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖ 1ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ reqwidth/reqheight
        if width <= 1 or height <= 1:
            width = window.winfo_reqwidth()
            height = window.winfo_reqheight()

        return width, height

    @staticmethod
    def center_window(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                     parent: Optional[Union[ctk.CTk, ctk.CTkToplevel]] = None) -> None:
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© (ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÇÿØŸäŸÖÿ© - ŸÑŸÑÿ™ŸàÿßŸÅŸÇ)"""
        try:
            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ÿ®ÿπÿßÿØ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©
            window.update_idletasks()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            window_width, window_height = WindowManager._get_window_size(window)

            if parent and WindowManager._is_window_valid(parent):
                # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿπŸÑŸâ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©
                parent.update_idletasks()

                parent_x = parent.winfo_x()
                parent_y = parent.winfo_y()
                parent_width = parent.winfo_width()
                parent_height = parent.winfo_height()

                # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ŸÇŸäŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© ÿµÿ≠Ÿäÿ≠ÿ©
                if parent_width <= 1 or parent_height <= 1:
                    parent_width, parent_height = WindowManager._get_window_size(parent)

                x = parent_x + (parent_width - window_width) // 2
                y = parent_y + (parent_height - window_height) // 2
            else:
                # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                screen_width = window.winfo_screenwidth()
                screen_height = window.winfo_screenheight()

                x = (screen_width - window_width) // 2
                y = (screen_height - window_height) // 2

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿØÿßÿÆŸÑ ÿ≠ÿØŸàÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            x = max(0, x)
            y = max(0, y)

            # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖŸàÿ∂ÿπ ŸÅŸÇÿ∑ (ÿ®ÿØŸàŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ)
            window.geometry(f"+{x}+{y}")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            window.update()

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    @staticmethod
    def center_window_delayed(window: Union[ctk.CTk, ctk.CTkToplevel],
                            parent: Optional[Union[ctk.CTk, ctk.CTkToplevel]] = None,
                            delay: int = 50,
                            on_screen: bool = True) -> None:
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿπ ÿ™ÿ£ÿÆŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑÿ±ÿ≥ŸÖ"""
        if on_screen:
            window.after(delay, lambda: WindowManager.center_window_on_screen(window))
        else:
            window.after(delay, lambda: WindowManager.center_window(window, parent))

    @staticmethod
    def set_window_position(window: Union[ctk.CTk, ctk.CTkToplevel],
                          x: int, y: int) -> None:
        """ÿ™ÿπŸäŸäŸÜ ŸÖŸàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ¥ŸÉŸÑ ŸÖÿ®ÿßÿ¥ÿ±"""
        try:
            window.geometry(f"+{x}+{y}")
            window.update()
        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿπŸäŸäŸÜ ŸÖŸàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    @staticmethod
    def set_window_size_and_position(window: Union[ctk.CTk, ctk.CTkToplevel],
                                    width: int, height: int,
                                    x: Optional[int] = None,
                                    y: Optional[int] = None,
                                    responsive: bool = True) -> None:
        """ÿ™ÿπŸäŸäŸÜ ÿ≠ÿ¨ŸÖ ŸàŸÖŸàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿπ ÿÆŸäÿßÿ± ÿßŸÑÿ™ŸÉŸäŸÅ ŸÖÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            if responsive:
                width, height = WindowManager.adjust_window_size_to_screen(window, width, height)

            if x is not None and y is not None:
                window.geometry(f"{width}x{height}+{x}+{y}")
            else:
                window.geometry(f"{width}x{height}")
            window.update()
        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿπŸäŸäŸÜ ÿ≠ÿ¨ŸÖ ŸàŸÖŸàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    @staticmethod
    def _setup_close_handler(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]):
        """ÿ•ÿπÿØÿßÿØ ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            # ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿµŸÑŸä
            original_protocol = window.protocol("WM_DELETE_WINDOW")

            def safe_close():
                try:
                    # ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÜÿ¥ÿ∑ÿ©
                    WindowManager._active_windows.discard(window)

                    # ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿµŸÑŸä ÿ•ŸÜ Ÿàÿ¨ÿØ
                    if callable(original_protocol):
                        original_protocol()
                    elif hasattr(window, 'destroy'):
                        window.destroy()
                except Exception as e:
                    print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

            window.protocol("WM_DELETE_WINDOW", safe_close)

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿØÿßÿØ ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ: {e}")

    @staticmethod
    def _is_window_valid(window) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            return window is not None and window.winfo_exists()
        except:
            return False

    @staticmethod
    def bring_to_front(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                      duration: int = 300) -> None:
        """ÿ±ŸÅÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑŸÑÿ£ÿπŸÑŸâ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            window.lift()
            window.attributes('-topmost', True)

            if duration > 0:
                # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ weakref ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπ
                window_ref = weakref.ref(window)
                window.after(duration, lambda: WindowManager._remove_topmost_safe(window_ref))

            window.update()

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    @staticmethod
    def _remove_topmost_safe(window_ref: weakref.ref):
        """ÿ•ÿ≤ÿßŸÑÿ© ÿÆÿßÿµŸäÿ© topmost ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            window = window_ref()
            if window and WindowManager._is_window_valid(window):
                window.attributes('-topmost', False)
        except:
            pass

    @staticmethod
    def set_focus(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]) -> None:
        """ÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            window.focus_force()
            window.focus_set()

            # ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿ£ŸàŸÑ ÿπŸÜÿµÿ±
            for child in window.winfo_children():
                if isinstance(child, (ctk.CTkEntry, ctk.CTkButton, tk.Entry, tk.Button)):
                    child.focus_set()
                    break

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤: {e}")

    @staticmethod
    def make_modal(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                   parent: Union[ctk.CTk, ctk.CTkToplevel]) -> None:
        """ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            if WindowManager._is_window_valid(parent):
                window.transient(parent)

            window.grab_set()
            window.wait_visibility()

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©: {e}")

    @staticmethod
    def ensure_correct_position(window: Union[ctk.CTk, ctk.CTkToplevel],
                               delay: int = 50) -> None:
        """ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÖŸàÿ∂ÿπ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿπÿØ ÿ™ÿ£ÿÆŸäÿ±"""
        def check_and_fix():
            try:
                if WindowManager._is_window_valid(window):
                    # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸàÿ∂ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                    x = window.winfo_x()
                    y = window.winfo_y()

                    # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸä ŸÖŸàÿ∂ÿπ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ (ŸÖÿ´ŸÑ ÿßŸÑÿ¨ÿßŸÜÿ® ÿßŸÑÿ£ŸäŸÖŸÜ)
                    screen_width = window.winfo_screenwidth()
                    window_width = window.winfo_width()

                    # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÇÿ±Ÿäÿ®ÿ© ÿ¨ÿØÿßŸã ŸÖŸÜ ÿßŸÑÿ≠ÿßŸÅÿ© ÿßŸÑŸäŸÖŸÜŸâ
                    if x > screen_width - window_width - 100:
                        # ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑
                        WindowManager.center_window_on_screen(window)
            except:
                pass

        window.after(delay, check_and_fix)

    @staticmethod
    def _apply_platform_specific(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                                fullscreen: bool = False) -> None:
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿÆÿßÿµÿ© ÿ®ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ"""
        system = platform.system()

        try:
            if not WindowManager._is_window_valid(window):
                return

            # ÿ™ÿ¨ŸÜÿ® ÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ÿπÿ∂ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÅŸä Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
            if not fullscreen:
                if system == "Windows":
                    # ÿ•ÿπÿØÿßÿØÿßÿ™ Windows
                    window.attributes('-alpha', 0.0)
                    window.update()
                    window.attributes('-alpha', 1.0)

                    # ÿ™ÿ≠ÿ≥ŸäŸÜ DPI
                    try:
                        from ctypes import windll
                        windll.shcore.SetProcessDpiAwareness(1)
                    except:
                        pass

                elif system == "Darwin":  # macOS
                    window.update()
                    window.lift()
                    window.attributes('-topmost', True)
                    window.after(100, lambda: window.attributes('-topmost', False) if WindowManager._is_window_valid(window) else None)

                elif system == "Linux":
                    window.update()
                    window.lift()
            else:
                # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿÆÿßÿµÿ© ÿ®Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
                if system == "Windows":
                    # ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ° ŸÅŸä ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
                    try:
                        window.focus_force()
                        window.lift()
                    except:
                        pass

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ: {e}")

    @staticmethod
    def flash_window(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                    count: int = 3, interval: int = 500) -> None:
        """ŸàŸÖŸäÿ∂ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        def flash():
            try:
                for i in range(count * 2):
                    if not WindowManager._is_window_valid(window):
                        break

                    if i % 2 == 0:
                        window.attributes('-alpha', 0.7)
                    else:
                        window.attributes('-alpha', 1.0)
                    window.update()
                    time.sleep(interval / 1000)

                # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ©
                if WindowManager._is_window_valid(window):
                    window.attributes('-alpha', 1.0)

            except Exception as e:
                print(f"ÿÆÿ∑ÿ£ ŸÅŸä ŸàŸÖŸäÿ∂ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

        import threading
        flash_thread = threading.Thread(target=flash, daemon=True)
        flash_thread.start()

    @staticmethod
    def animate_window_open(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel],
                          duration: int = 200) -> None:
        """ÿ™ÿ≠ÿ±ŸäŸÉ ŸÅÿ™ÿ≠ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ© (ÿ™ÿ¨ŸÜÿ® ŸÖÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©)"""
        steps = 10
        step_duration = duration // steps

        try:
            if not WindowManager._is_window_valid(window):
                return

            # ÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÉ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÅŸä ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
            try:
                if (hasattr(window, 'attributes') and window.attributes('-fullscreen')) or \
                   (hasattr(window, 'state') and window.state() == 'zoomed'):
                    return
            except:
                pass

            window.attributes('-alpha', 0.0)
            window.update()

            for i in range(1, steps + 1):
                if not WindowManager._is_window_valid(window):
                    break

                alpha = i / steps
                window.attributes('-alpha', alpha)
                window.update()
                window.after(step_duration)

        except Exception:
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑÿå ÿßÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ±ÿ¶Ÿäÿ©
            if WindowManager._is_window_valid(window):
                window.attributes('-alpha', 1.0)

    @staticmethod
    def get_active_windows() -> list:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÜÿ¥ÿ∑ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        active = []

        # WeakSet Ÿäÿ™ÿπÿßŸÖŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖÿ≠ÿ∞ŸàŸÅÿ©
        for window in WindowManager._active_windows:
            try:
                if WindowManager._is_window_valid(window):
                    active.append(window)
            except:
                pass

        return active

    @staticmethod
    def close_all_windows(except_window: Optional[Union[ctk.CTk, ctk.CTkToplevel]] = None) -> None:
        """ÿ•ÿ∫ŸÑÿßŸÇ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©"""
        windows_to_close = []

        # ÿ¨ŸÖÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ŸÑŸÑÿ•ÿ∫ŸÑÿßŸÇ
        for window in WindowManager._active_windows:
            try:
                if window != except_window and WindowManager._is_window_valid(window):
                    windows_to_close.append(window)
            except:
                pass

        # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞
        for window in windows_to_close:
            try:
                window.destroy()
            except:
                pass

        # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        WindowManager._active_windows = WeakSet()
        if except_window and WindowManager._is_window_valid(except_window):
            WindowManager._active_windows.add(except_window)

    @staticmethod
    def arrange_cascade() -> None:
        """ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿ®ÿ¥ŸÉŸÑ ŸÖÿ™ÿ™ÿßŸÑŸä"""
        offset = 30

        active_windows = WindowManager.get_active_windows()
        for i, window in enumerate(active_windows):
            try:
                # ÿ™ÿ¨ŸÜÿ® ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÜŸàÿßŸÅÿ∞ ŸÅŸä ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
                try:
                    if (hasattr(window, 'attributes') and window.attributes('-fullscreen')) or \
                       (hasattr(window, 'state') and window.state() == 'zoomed'):
                        continue
                except:
                    pass

                window.geometry(f"+{50 + i * offset}+{50 + i * offset}")
            except:
                pass

    @staticmethod
    def setup_window_shortcuts(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]) -> None:
        """ÿ•ÿπÿØÿßÿØ ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ© ŸÖÿπ ÿØÿπŸÖ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            # ESC ŸÑŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ£Ÿà ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
            def handle_escape(event=None):
                try:
                    if WindowManager._is_window_valid(window):
                        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
                        is_fullscreen = False
                        try:
                            if hasattr(window, 'attributes'):
                                is_fullscreen = window.attributes('-fullscreen')
                            elif hasattr(window, 'state'):
                                is_fullscreen = window.state() == 'zoomed'
                        except:
                            pass

                        if is_fullscreen:
                            # ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
                            WindowManager._exit_fullscreen(window)
                        else:
                            # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                            window.destroy()
                except:
                    pass

            window.bind('<Escape>', handle_escape)

            # F11 ŸÑÿ™ÿ®ÿØŸäŸÑ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
            def toggle_fullscreen(event=None):
                try:
                    if WindowManager._is_window_valid(window):
                        WindowManager._toggle_fullscreen(window)
                except:
                    pass

            window.bind('<F11>', toggle_fullscreen)

            # Alt+F4 ŸÑŸÑÿ•ÿ∫ŸÑÿßŸÇ (Windows)
            if platform.system() == "Windows":
                window.bind('<Alt-F4>', lambda e: window.destroy() if WindowManager._is_window_valid(window) else None)

            # Alt+Enter ŸÑÿ™ÿ®ÿØŸäŸÑ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (ÿßÿÆÿ™ÿµÿßÿ± ÿ•ÿ∂ÿßŸÅŸä)
            window.bind('<Alt-Return>', toggle_fullscreen)

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿØÿßÿØ ÿßŸÑÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™: {e}")

    @staticmethod
    def _toggle_fullscreen(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]) -> None:
        """ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            system = platform.system()
            current_fullscreen = False

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            try:
                if system == "Windows":
                    current_fullscreen = window.state() == 'zoomed'
                else:
                    current_fullscreen = window.attributes('-fullscreen')
            except:
                pass

            # ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ©
            if current_fullscreen:
                WindowManager._exit_fullscreen(window)
            else:
                WindowManager._apply_fullscreen(window)

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ®ÿØŸäŸÑ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©: {e}")

    @staticmethod
    def _exit_fullscreen(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]) -> None:
        """ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return

            system = platform.system()

            if system == "Windows":
                try:
                    window.state('normal')
                    print("ÿ™ŸÖ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Windows normal)")
                except:
                    window.attributes('-fullscreen', False)
                    print("ÿ™ŸÖ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Windows fullscreen off)")

            elif system == "Linux":
                try:
                    window.attributes('-zoomed', False)
                    print("ÿ™ŸÖ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Linux zoomed off)")
                except:
                    window.attributes('-fullscreen', False)
                    print("ÿ™ŸÖ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (Linux fullscreen off)")

            elif system == "Darwin":  # macOS
                window.attributes('-fullscreen', False)
                print("ÿ™ŸÖ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© (macOS)")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            window.update_idletasks()
            window.update()

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©: {e}")

    @staticmethod
    def is_fullscreen(window: Union[ctk.CTk, ctk.CTkToplevel, tk.Tk, tk.Toplevel]) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            if not WindowManager._is_window_valid(window):
                return False

            system = platform.system()

            if system == "Windows":
                try:
                    return window.state() == 'zoomed'
                except:
                    try:
                        return window.attributes('-fullscreen')
                    except:
                        return False
            else:
                try:
                    return window.attributes('-fullscreen')
                except:
                    if system == "Linux":
                        try:
                            return window.attributes('-zoomed')
                        except:
                            return False
                    return False

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©: {e}")
            return False


# ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ÿ≥ÿ±Ÿäÿπÿ© ŸÖÿ≠ÿØÿ´ÿ©

def setup_window(window, **kwargs):
    """ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ÿ≥ÿ±Ÿäÿπÿ© ŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿπ ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã"""
    # ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©
    kwargs.setdefault('center_on_screen', True)
    kwargs.setdefault('responsive', True)
    kwargs.setdefault('use_smooth_show', True)
    WindowManager.setup_window(window, **kwargs)

# ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÜŸàÿßŸÅÿ∞ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸàÿßŸÑÿ≠Ÿàÿßÿ±ÿßÿ™ ŸÖÿπ ÿØÿπŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ
def setup_dialog_window(window, size=(600, 400), full_height=False, **kwargs):
    """ÿ•ÿπÿØÿßÿØ ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ŸÖÿπ ÿ∂ŸÖÿßŸÜ ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸàÿØÿπŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ"""
    if full_height:
        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ
        WindowManager.setup_centered_window(window, size=size, full_height_mode=True, modal=True, **kwargs)
    else:
        # ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿπÿßÿØŸä
        WindowManager.setup_centered_window(window, size=size, modal=True, **kwargs)

# ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ÿÆÿßÿµÿ© ŸÑŸÜŸàÿßŸÅÿ∞ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ
def setup_login_window(window, width=500, **kwargs):
    """ÿ•ÿπÿØÿßÿØ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ"""
    WindowManager.setup_centered_window(
        window,
        size=(width, 0),  # ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ Ÿàÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ
        full_height_mode=True,
        modal=True,
        **kwargs
    )

# ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸàÿßŸÑÿ™ÿπÿØŸäŸÑ

def setup_add_edit_window(window, width=600, **kwargs):
    """ÿ•ÿπÿØÿßÿØ ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)"""
    WindowManager.setup_centered_window(
        window,
        size=(width, 0),  # ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ Ÿàÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
        workarea_height_mode=True,
        modal=True,
        **kwargs
    )

def setup_dialog_window_workarea(window, size=(600, 400), workarea_height=False, **kwargs):
    """ÿ•ÿπÿØÿßÿØ ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ŸÖÿπ ÿÆŸäÿßÿ± ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ"""
    if workarea_height:
        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
        WindowManager.setup_centered_window(window, size=size, workarea_height_mode=True, modal=True, **kwargs)
    else:
        # ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿπÿßÿØŸä
        WindowManager.setup_centered_window(window, size=size, modal=True, **kwargs)

# ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
def setup_main_window(window, **kwargs):
    """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÉÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä"""
    kwargs.setdefault('fullscreen_default', True)
    kwargs.setdefault('center', False)
    kwargs.setdefault('use_smooth_show', False)
    WindowManager.setup_window(window, **kwargs)


# ÿ£ŸÖÿ´ŸÑÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≠ÿØÿ´ÿ©:
"""
# 1. ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ÿßŸÑÿ¨ÿØŸäÿØ - ÿßŸÑŸÖÿ∑ŸÑŸàÿ®):
add_window = ctk.CTkToplevel()
setup_add_edit_window(add_window, width=600, parent=main_window)

# 2. ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ:
dialog = ctk.CTkToplevel()
setup_dialog_window_workarea(dialog, size=(500, 0), workarea_height=True, parent=main_window)

# 3. ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©:
edit_window = ctk.CTkToplevel()
WindowManager.setup_centered_window(
    edit_window,
    size=(600, 0),
    workarea_height_mode=True,  # ŸÖŸÜ ÿ£ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ
    parent=main_window
)

# 4. ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ:
login_window = ctk.CTkToplevel()
setup_login_window(login_window, width=450, parent=main_window)

# 5. ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ÿπÿßÿØŸäÿ©:
dialog = ctk.CTkToplevel()
setup_dialog_window(dialog, size=(500, 300), parent=main_window)

# 6. ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©:
main_window = ctk.CTk()
setup_main_window(main_window, min_size=(1200, 700))

# 7. ŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑÿ£Ÿàÿ∂ÿßÿπ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©:

# Ÿàÿ∂ÿπ ÿπÿßÿØŸä (ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ¥ÿßÿ¥ÿ©)
normal_window = ctk.CTkToplevel()
setup_dialog_window(normal_window, size=(600, 400))

# Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ŸÖŸÜ ÿßŸÑÿ£ÿπŸÑŸâ ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ) - ÿßŸÑÿ¨ÿØŸäÿØ
workarea_window = ctk.CTkToplevel()
setup_add_edit_window(workarea_window, width=600)

# Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÉÿßŸÖŸÑ (ŸÅŸàŸÇ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ ÿ£Ÿäÿ∂ÿßŸã)
fullheight_window = ctk.CTkToplevel()
setup_login_window(fullheight_window, width=600)
"""

============================================================
FILE: views\add_edit_window.py
SIZE: 62579 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/add_edit_window.py - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸàŸÖÿ®ÿ≥ÿ∑ÿ© ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤

ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ:
- ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑ ŸàŸÖŸÜÿ∏ŸÖ
- ÿØÿπŸÖ offline mode
- ÿ±ÿ®ÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ŸÄ Airtable
- ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ´ŸäŸÖ
- ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑŸÖÿØÿπŸàŸÖÿ© ÿ®ÿßŸÑÿ®ÿ≠ÿ´
- ÿØÿπŸÖ ÿ¥ÿßŸÖŸÑ ŸÑÿ™ÿπÿØÿØ ÿßŸÑŸÑÿ∫ÿßÿ™ ŸÖÿπ ÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ŸàÿßŸÑÿ≠ŸÇŸàŸÑ
- ÿØÿπŸÖ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ© ŸÅŸÇÿ∑ (readonly fields) - ŸÖÿ≠ÿ≥ŸÜ
- ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸàŸÉÿßŸÑÿ©
- ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿπÿ±ÿ∂ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ
"""

import customtkinter as ctk
import tkinter as tk
from tkinter import messagebox
from typing import Dict, List, Any, Optional
from datetime import datetime
import json
import os
import threading
import time
import random
import string
from core.language_manager import LanguageManager
from utils.window_manager import WindowManager
from core.theme_color_manager import ThemeColorManager, ThemedWindow

# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖŸàÿ≠ÿØ
try:
    from views.components.combobox import (
        EnhancedSearchableComboBox,
        EnhancedSearchableComboBoxImproved,
        create_airtable_combo_for_field,
        create_enhanced_dropdown_with_improved_click
    )
    HAS_ENHANCED_COMBO = True
    HAS_IMPROVED_CLICK = True
except ImportError:
    HAS_ENHANCED_COMBO = False
    HAS_IMPROVED_CLICK = False
    EnhancedSearchableComboBox = None
    EnhancedSearchableComboBoxImproved = None

# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ™ŸÇŸàŸäŸÖ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
try:
    from tkcalendar import DateEntry
    HAS_CALENDAR = True
except ImportError:
    HAS_CALENDAR = False
    class DateEntry:
        def __init__(self, parent, **kwargs):
            self.var = kwargs.get('textvariable', tk.StringVar())
            self.entry = ctk.CTkEntry(parent, textvariable=self.var, placeholder_text="YYYY-MM-DD")
            self.entry.pack(fill="x")
        def get(self): return self.var.get()
        def set(self, value): self.var.set(value)

from core.logger import logger


class AddEditWindow(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ŸÖÿ≠ÿ≥ŸÜÿ© ŸàŸÖÿ®ÿ≥ÿ∑ÿ© ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"""

    def __init__(self, parent=None, config_mgr=None, db_mgr=None, airtable_model=None,
                 controller=None, dropdown_manager=None, lang_manager=None,
                 field_groups=None, field_type_map=None, mode="add", record_id=None,
                 initial_fields=None):
        super().__init__(parent)

        # ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        self.parent = parent
        self.config_mgr = config_mgr
        self.db_mgr = db_mgr
        self.airtable_model = airtable_model
        self.controller = controller
        self.dropdown_manager = dropdown_manager
        self.lang_manager = lang_manager
        self.mode = mode
        self.record_id = record_id
        self.initial_fields = initial_fields or {}

        # ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑŸÑÿ´ŸäŸÖ
        self.themed_window = ThemedWindow(self, controller.theme_manager if controller else None)

        # ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self._is_closing = False
        self._save_in_progress = False
        self._offline_mode = False

        # ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        self.field_groups = field_groups or self._get_default_field_groups()
        self.field_type_map = field_type_map or self._get_default_field_types()
        self.dropdown_mapping = self._get_dropdown_mapping()
        self.tab_names = list(self.field_groups.keys())

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self.current_step = 0
        self.field_vars = {}
        self.field_widgets = {}
        self.combo_boxes = {}
        self.enhanced_combos = {}
        self.dropdown_options = {}

        # ŸÖŸÑŸÅ ÿßŸÑŸÖÿ≥ŸàÿØÿ©
        self.draft_file = f"draft_{self.mode}_{datetime.now().strftime('%Y%m%d')}.json"

        # ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self._setup_window()
        self._load_dropdown_options()
        self._build_ui()
        self._setup_events()

        # ŸÖŸÑÿ° ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ - ŸÖÿ≠ÿ≥ŸÜ
        if self.mode == "edit" and self.initial_fields:
            # ÿ™ÿ£ÿÆŸäÿ± ÿ£ÿ∑ŸàŸÑ ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÉÿ™ŸÖÿßŸÑ ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            self.after(100, self._populate_fields)

            # ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
            self.after(150, self._force_readonly_fields_update)
            self.after(150, self._ensure_booking_number_display)
            self.after(150, self._verify_readonly_fields)

            # ÿ™ÿ≠ÿØŸäÿ´ ŸÜŸáÿßÿ¶Ÿä ÿ¥ÿßŸÖŸÑ
            self.after(200, self._force_ui_refresh)
        elif self.mode == "add":
            self._try_load_draft()

    def _get_default_field_groups(self):
        """ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
        return {
            "Basic Information": ["Customer Name", "Hotel Name", "Agency", "Booking Nr.", "Room number"],
            "Trip Details": ["trip Name", "Date Trip", "Option", "des", "Guide", "Product ID", "pickup time", "Remarks", "Add - Ons"],
            "Passenger Info": ["ADT", "CHD", "STD", "Youth", "Inf", "CHD Age"],
            "Contact Info": ["Customer Phone", "Customer Email", "Customer Country"],
            "Pricing Info": ["Total price USD", "Total price EUR", "Total price GBP", "Net Rate", "Currency", "Cost EGP", "Collecting on date Trip", "Management Option", "Add-on"]
        }

    def _get_default_field_types(self):
        """ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
        return {
            "Customer Name": "text", "Hotel Name": "text", "Agency": "dropdown",
            "Booking Nr.": "readonly",  # ‚Üê ÿ≠ŸÇŸÑ ŸÖÿ≠ŸÖŸä
            "Room number": "text", "trip Name": "dropdown", "Date Trip": "date", "Option": "dropdown",
            "des": "dropdown", "Guide": "dropdown", "Product ID": "text", "pickup time": "text",
            "Remarks": "text", "Add - Ons": "text", "ADT": "number", "CHD": "number", "STD": "number",
            "Youth": "number", "Inf": "number", "CHD Age": "text", "Customer Phone": "phone",
            "Customer Email": "email", "Customer Country": "text", "Total price USD": "currency",
            "Total price EUR": "currency", "Total price GBP": "currency", "Net Rate": "currency",
            "Currency": "text", "Cost EGP": "currency", "Collecting on date Trip": "text",
            "Management Option": "dropdown", "Add-on": "dropdown"
        }

    def _get_dropdown_mapping(self):
        """ÿ™ÿÆÿ∑Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.dropdown_manager and hasattr(self.dropdown_manager, 'get_field_mapping'):
            return self.dropdown_manager.get_field_mapping()
        return {
            "Agency": "agencies", "Guide": "guides", "Option": "options",
            "des": "destinations", "trip Name": "Trip Names",
            "Management Option": "management_options", "Add-on": "addons"
        }

    def _setup_window(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        # ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿµŸàÿµ ÿ£ŸàŸÑÿßŸã ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™
        self._setup_texts()

        title = f"‚ûï {self.texts['add']}" if self.mode == "add" else f"‚úèÔ∏è {self.texts['edit']}"
        self.title(title)

        # ÿ≠ÿ≥ÿßÿ® ÿ£ÿ®ÿπÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        screen_width = self.winfo_screenwidth()
        screen_height = self.winfo_screenheight()
        window_width = 1000
        window_height = screen_height - 100
        x = (screen_width - window_width) // 2
        y = 20

        self.geometry(f"{window_width}x{window_height}+{x}+{y}")
        self.minsize(700, 500)
        self.resizable(True, True)

        if self.parent:
            self.transient(self.parent)
            self.grab_set()

        self.protocol("WM_DELETE_WINDOW", self._confirm_close)

    def _load_dropdown_options(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if not self.dropdown_manager:
            self._offline_mode = True
            self._setup_offline_dropdowns()
            return

        try:
            status = self.dropdown_manager.get_status()
            if status.get('cached_count', 0) > 0:
                self._load_from_cache()
            else:
                self._load_dropdowns_async()
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ: {e}")
            self._offline_mode = True
            self._setup_offline_dropdowns()

    def _load_from_cache(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥"""
        try:
            all_dropdowns = self.dropdown_manager.get_all_dropdowns()
            for field_name, airtable_key in self.dropdown_mapping.items():
                self.dropdown_options[field_name] = all_dropdowns.get(airtable_key, [])
            if 'Trip Names' in all_dropdowns:
                self.dropdown_options['trip Name'] = all_dropdowns['Trip Names']
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑŸÉÿßÿ¥: {e}")
            self._setup_offline_dropdowns()

    def _load_dropdowns_async(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©"""
        def load_thread():
            try:
                all_dropdowns = self.dropdown_manager.get_all_dropdowns(timeout=15.0)
                for field_name, airtable_key in self.dropdown_mapping.items():
                    self.dropdown_options[field_name] = all_dropdowns.get(airtable_key, [])
                if 'Trip Names' in all_dropdowns:
                    self.dropdown_options['trip Name'] = all_dropdowns['Trip Names']
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ: {e}")
                self._offline_mode = True
                self.after(0, self._setup_offline_dropdowns)

        threading.Thread(target=load_thread, daemon=True).start()

    def _setup_offline_dropdowns(self):
        """ÿ•ÿπÿØÿßÿØ ŸÇŸàÿßÿ¶ŸÖ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
        defaults = {
            "Agency": ["Direct", "Online", "Partner"],
            "Guide": ["English", "Arabic", "German", "French"],
            "Option": ["Standard", "Premium", "VIP"],
            "des": ["Cairo", "Luxor", "Aswan", "Hurghada"],
            "trip Name": ["Pyramids Tour", "Nile Cruise", "Desert Safari"],
            "Management Option": ["Standard", "Express", "Custom"],
            "Add-on": ["Lunch", "Transport", "Guide", "Entrance Fees"]
        }
        for field_name in self.dropdown_mapping:
            if field_name not in self.dropdown_options:
                self.dropdown_options[field_name] = defaults.get(field_name, [])

    def _setup_texts(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿµŸàÿµ ŸàÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™"""
        if not self.lang_manager:
            self.texts = {
                "add": "Add", "edit": "Edit", "save": "Save", "cancel": "Cancel",
                "draft": "Draft", "previous": "Previous", "next": "Next",
                "refresh": "Refresh", "success": "Success", "error": "Error",
                "warning": "Warning", "required_field": "This field is required",
                "save_success": "Saved successfully!", "update_success": "Updated successfully!",
                "draft_saved": "Draft saved successfully", "loading": "Loading...",
                "processing": "Processing...", "updating": "Updating..."
            }
        else:
            self.texts = {
                "add": self.lang_manager.get("add", "Add"),
                "edit": self.lang_manager.get("edit", "Edit"),
                "save": self.lang_manager.get("save", "Save"),
                "cancel": self.lang_manager.get("cancel", "Cancel"),
                "draft": self.lang_manager.get("draft", "Draft"),
                "previous": self.lang_manager.get("previous", "Previous"),
                "next": self.lang_manager.get("next", "Next"),
                "refresh": self.lang_manager.get("refresh", "Refresh"),
                "success": self.lang_manager.get("success", "Success"),
                "error": self.lang_manager.get("error", "Error"),
                "warning": self.lang_manager.get("warning", "Warning"),
                "required_field": self.lang_manager.get("required_field", "This field is required"),
                "save_success": self.lang_manager.get("save_success", "Saved successfully!"),
                "update_success": self.lang_manager.get("update_success", "Updated successfully!"),
                "draft_saved": self.lang_manager.get("draft_saved", "Draft saved successfully"),
                "loading": self.lang_manager.get("loading", "Loading..."),
                "processing": self.lang_manager.get("processing", "Processing..."),
                "updating": self.lang_manager.get("updating", "Updating...")
            }

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        # ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        main_frame = ctk.CTkFrame(self)
        main_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
        self.progress_frame = ctk.CTkFrame(main_frame)
        self.progress_frame.pack(fill="x", pady=(0, 10))
        self._create_progress_buttons()

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        self.content_frame = ctk.CTkScrollableFrame(main_frame)
        self.content_frame.pack(fill="both", expand=True)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        self.tab_frames = []
        for tab_name in self.tab_names:
            tab_frame = ctk.CTkFrame(self.content_frame)
            tab_frame.pack_forget()
            self.tab_frames.append(tab_frame)
            self._create_tab_content(tab_frame, tab_name)

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ
        self._create_navigation_buttons(main_frame)

        # ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ£ŸàŸÑ
        self._show_tab(0)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ
        self.themed_window.apply_theme()

    def _create_progress_buttons(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÇÿØŸÖ"""
        self.progress_buttons = []
        for i, name in enumerate(self.tab_names):
            translated_name = self._translate_tab_name(name)
            btn = ctk.CTkButton(
                self.progress_frame,
                text=f"{i+1}. {translated_name}",
                command=lambda idx=i: self._show_tab(idx),
                width=150, height=30
            )
            btn.pack(side="left", padx=5)
            self.progress_buttons.append(btn)

    def _create_tab_content(self, parent, tab_name):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿ®ŸàŸäÿ®"""
        # ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ™ÿ®ŸàŸäÿ®
        title_frame = ctk.CTkFrame(parent, fg_color="transparent")
        title_frame.pack(fill="x", pady=(0, 20))

        title_label = ctk.CTkLabel(
            title_frame,
            text=self._translate_tab_name(tab_name),
            font=ctk.CTkFont(size=18, weight="bold")
        )
        title_label.pack()

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≠ŸÇŸàŸÑ
        fields_frame = ctk.CTkFrame(parent, fg_color="transparent")
        fields_frame.pack(fill="both", expand=True, padx=20)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ
        fields = self.field_groups.get(tab_name, [])
        for field_name in fields:
            self._create_field(fields_frame, field_name)

    def _create_field(self, parent, field_name):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ Ÿàÿßÿ≠ÿØ"""
        field_frame = ctk.CTkFrame(parent, fg_color="transparent")
        field_frame.pack(fill="x", pady=10)

        # ÿßŸÑÿ™ÿ≥ŸÖŸäÿ©
        label_text = self._translate_field_name(field_name)
        if field_name in ["Customer Name", "Agency", "Date Trip"]:
            label_text += " *"
        elif self.field_type_map.get(field_name) == "readonly":
            label_text += " üîí"  # ÿ±ŸÖÿ≤ ÿßŸÑŸÇŸÅŸÑ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©

        label = ctk.CTkLabel(
            field_frame, text=label_text, anchor="w",
            font=ctk.CTkFont(size=12, weight="bold")
        )
        label.pack(fill="x", pady=(0, 5))

        # ÿßŸÑÿ≠ŸÇŸÑ
        initial_value = self._get_initial_value(field_name)
        field_type = self.field_type_map.get(field_name, "text")

        var, widget = self._create_field_by_type(field_frame, field_name, field_type, initial_value)

        if var and widget:
            self.field_vars[field_name] = var
            self.field_widgets[field_name] = widget

    def _create_field_by_type(self, parent, field_name, field_type, initial_value):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ - ÿØÿßŸÑÿ© ŸÖŸàÿ≠ÿØÿ©"""
        if field_type == "dropdown":
            return self._create_dropdown_field(parent, field_name, initial_value)
        elif field_type == "number":
            return self._create_number_field(parent, initial_value)
        elif field_type == "date":
            return self._create_date_field(parent, initial_value)
        elif field_type == "readonly":
            return self._create_readonly_field(parent, initial_value)
        else:
            return self._create_text_field(parent, field_type, initial_value)

    def _create_dropdown_field(self, parent, field_name, initial_value):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿπ ÿ±ÿ®ÿ∑ ÿ£ÿ≠ÿØÿßÿ´ ÿÆÿßÿµÿ©"""
        values = self.dropdown_options.get(field_name, [])
        if initial_value and initial_value not in values:
            values = list(values) + [initial_value]

        # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖŸàÿ≠ÿØ
        if HAS_ENHANCED_COMBO and HAS_IMPROVED_CLICK:
            try:
                var, combo = create_enhanced_dropdown_with_improved_click(
                    parent=parent, field_name=field_name, initial_value=initial_value,
                    values=values, themed_window=self.themed_window
                )
                combo.pack(fill="x", pady=5)
                self.enhanced_combos[field_name] = combo

                # ÿ±ÿ®ÿ∑ ÿ≠ÿØÿ´ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÉÿßŸÑÿ© ŸÑÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
                if field_name == "Agency":
                    self._bind_agency_change_event(combo, var)

                return var, combo
            except Exception as e:
                logger.warning(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©: {e}")

        # ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπÿßÿØŸäÿ©
        var = tk.StringVar(value=initial_value)
        combo = ctk.CTkComboBox(
            parent, values=values, variable=var,
            state="readonly" if self._offline_mode else "normal"
        )
        self.themed_window.apply_to_widget(combo, 'combobox')
        combo.pack(fill="x", pady=5)
        self.combo_boxes[field_name] = combo

        # ÿ±ÿ®ÿ∑ ÿ≠ÿØÿ´ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÉÿßŸÑÿ© ŸÑÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
        if field_name == "Agency":
            self._bind_agency_change_event(combo, var)

        return var, combo

    def _bind_agency_change_event(self, combo, var):
        """ÿ±ÿ®ÿ∑ ÿ≠ÿØÿ´ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸàŸÉÿßŸÑÿ© ŸÑÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã"""
        def on_agency_change(*args):
            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸÜÿß ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸàŸÑŸäÿ≥ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            if self.mode == "add":
                agency_value = var.get()
                if agency_value and agency_value.strip():
                    # ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑÿ¨ÿØŸäÿØ
                    booking_nr = self._generate_booking_number(agency_value)
                    # ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
                    self._update_booking_number_field(booking_nr)
                    logger.info(f"ÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿ≠ÿ¨ÿ≤ ÿ¨ÿØŸäÿØ: {booking_nr} ŸÑŸÑŸàŸÉÿßŸÑÿ©: {agency_value}")

        # ÿ±ÿ®ÿ∑ ÿßŸÑÿ≠ÿØÿ´ ÿ®ŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑŸàŸÉÿßŸÑÿ©
        var.trace('w', on_agency_change)

        # ÿ±ÿ®ÿ∑ ÿ≠ÿØÿ´ ÿ•ÿ∂ÿßŸÅŸä ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
        if hasattr(combo, 'bind'):
            combo.bind('<<ComboboxSelected>>', lambda e: on_agency_change())

    def _generate_booking_number(self, agency_name):
        """ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿ≠ÿ¨ÿ≤ ÿ¨ÿØŸäÿØ ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸàŸÑ ÿ´ŸÑÿßÿ´ÿ© ÿ£ÿ≠ÿ±ŸÅ ŸÖŸÜ ÿßŸÑŸàŸÉÿßŸÑÿ©
            agency_prefix = agency_name[:3].upper().replace(' ', '')
            if len(agency_prefix) < 3:
                agency_prefix = agency_prefix.ljust(3, 'X')  # ŸÖŸÑÿ° ÿ®ŸÄ X ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ£ŸÇŸÑ ŸÖŸÜ 3 ÿ£ÿ≠ÿ±ŸÅ

            # ÿßŸÑÿ™ŸàŸÇŸäÿ™ ÿßŸÑÿ≠ÿßŸÑŸä ÿ®ÿµŸäÿ∫ÿ© hhmmss
            current_time = datetime.now()
            time_part = current_time.strftime("%H%M%S")

            # ÿÆŸÖÿ≥ÿ© ÿ£ÿ±ŸÇÿßŸÖ Ÿàÿ≠ÿ±ŸàŸÅ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
            random_chars = ''.join(random.choices(string.ascii_lowercase + string.digits, k=5))

            # ÿ™ÿ¨ŸÖŸäÿπ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
            booking_number = f"{agency_prefix}-{time_part}-{random_chars}"

            logger.info(f"ÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: {booking_number}")
            return booking_number

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸàŸÑŸäÿØ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: {e}")
            # ÿ±ŸÇŸÖ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
            fallback_time = datetime.now().strftime("%H%M%S")
            fallback_random = ''.join(random.choices(string.ascii_lowercase + string.digits, k=5))
            return f"BKG-{fallback_time}-{fallback_random}"

    def _update_booking_number_field(self, booking_number):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿ®ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©"""
        try:
            if "Booking Nr." in self.field_vars:
                booking_var = self.field_vars["Booking Nr."]
                booking_var.set(booking_number)

                # ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÄ widget ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
                if "Booking Nr." in self.field_widgets:
                    widget = self.field_widgets["Booking Nr."]

                    # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÄ widget ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                    try:
                        if hasattr(widget, 'configure'):
                            # ÿ™ŸÅÿπŸäŸÑ ŸÖÿ§ŸÇÿ™ ŸÑŸÑÿ™ÿ≠ÿØŸäÿ´
                            original_state = widget.cget('state')
                            widget.configure(state='normal')

                            # ŸÖÿ≥ÿ≠ Ÿàÿ•ÿØÿ±ÿßÿ¨ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
                            if hasattr(widget, 'delete') and hasattr(widget, 'insert'):
                                widget.delete(0, tk.END)
                                widget.insert(0, booking_number)

                            # ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©
                            widget.configure(state=original_state)

                    except Exception as widget_error:
                        logger.warning(f"ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ widget ŸÖÿ®ÿßÿ¥ÿ±ÿ©: {widget_error}")

                logger.info(f"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: {booking_number}")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: {e}")

    def _create_readonly_field(self, parent, initial_value):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ© ŸÅŸÇÿ∑ - ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ≠ÿ≥ŸÜ"""
        var = tk.StringVar()

        # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸàŸÑŸäÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
        if initial_value:
            processed_value = self._process_complex_value(initial_value)
            var.set(str(processed_value) if processed_value else "")

        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ CTkEntry ŸÖÿπ ÿ™ÿÆÿµŸäÿµ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
        widget = ctk.CTkEntry(
            parent,
            textvariable=var,
            state="readonly",
            fg_color="#f8f9fa",  # ŸÑŸàŸÜ ÿÆŸÑŸÅŸäÿ© ÿ£ŸÅÿ™ÿ≠ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
            text_color="#495057",  # ŸÑŸàŸÜ ŸÜÿµ ÿ£Ÿàÿ∂ÿ≠
            border_width=1,
            border_color="#dee2e6",
            font=ctk.CTkFont(size=12)
        )

        widget.pack(fill="x", pady=5)

        # ÿ•ÿ∂ÿßŸÅÿ© Ÿàÿ∏ŸäŸÅÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸäŸÖÿ©
        def update_readonly_value(new_value):
            """ÿ™ÿ≠ÿØŸäÿ´ ŸÇŸäŸÖÿ© ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä"""
            try:
                # ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©
                original_state = widget.cget('state')

                # ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ŸÇŸÑ ŸÖÿ§ŸÇÿ™ÿßŸã
                widget.configure(state='normal')

                # ŸÖÿ≥ÿ≠ Ÿàÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
                widget.delete(0, tk.END)
                widget.insert(0, str(new_value) if new_value else "")

                # ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                widget.configure(state='readonly')

                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿ£Ÿäÿ∂ÿßŸã
                var.set(str(new_value) if new_value else "")

            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä: {e}")

        # ÿ±ÿ®ÿ∑ ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿ®ÿßŸÑŸÄ widget
        widget.update_readonly_value = update_readonly_value

        return var, widget

    def _create_text_field(self, parent, field_type, initial_value):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ŸÜÿµ"""
        var = tk.StringVar(value=str(initial_value) if initial_value else "")
        placeholder = {"phone": "01x xxxx xxxx", "email": "example@email.com", "currency": "0.00"}.get(field_type, "")

        widget = ctk.CTkEntry(parent, textvariable=var, placeholder_text=placeholder)
        self.themed_window.apply_to_widget(widget, 'entry')
        widget.pack(fill="x", pady=5)
        return var, widget

    def _create_number_field(self, parent, initial_value):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖŸä"""
        var = tk.IntVar(value=int(initial_value) if initial_value else 0)
        widget = ctk.CTkEntry(parent, textvariable=var, justify="center")
        self.themed_window.apply_to_widget(widget, 'entry')
        widget.pack(fill="x", pady=5)
        return var, widget

    def _create_date_field(self, parent, initial_value):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ÿ™ÿßÿ±ŸäÿÆ"""
        date_value = self._parse_date(str(initial_value)) if initial_value else ""
        var = tk.StringVar(value=date_value)

        if HAS_CALENDAR:
            widget = DateEntry(parent, textvariable=var, date_pattern='yyyy-mm-dd')
            widget.pack(fill="x", pady=5)
        else:
            widget = ctk.CTkEntry(parent, textvariable=var, placeholder_text="YYYY-MM-DD")
            self.themed_window.apply_to_widget(widget, 'entry')
            widget.pack(fill="x", pady=5)

        return var, widget

    def _create_navigation_buttons(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ"""
        nav_frame = ctk.CTkFrame(parent)
        nav_frame.pack(fill="x", pady=10)

        # ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸäÿ≥ÿ±Ÿâ
        left_frame = ctk.CTkFrame(nav_frame, fg_color="transparent")
        left_frame.pack(side="left", fill="x", expand=True)

        self.prev_btn = ctk.CTkButton(left_frame, text=f"‚óÄ {self.texts['previous']}", command=self._prev_tab, width=100)
        self.prev_btn.pack(side="left", padx=5)

        self.next_btn = ctk.CTkButton(left_frame, text=f"{self.texts['next']} ‚ñ∂", command=self._next_tab, width=100)
        self.next_btn.pack(side="left", padx=5)

        self.refresh_btn = ctk.CTkButton(left_frame, text=f"üîÑ {self.texts['refresh']}", command=self._refresh_dropdowns, width=120)
        self.refresh_btn.pack(side="left", padx=5)

        # ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸäŸÖŸÜŸâ
        right_frame = ctk.CTkFrame(nav_frame, fg_color="transparent")
        right_frame.pack(side="right")

        self.cancel_btn = ctk.CTkButton(right_frame, text=f"‚ùå {self.texts['cancel']}", command=self._confirm_close, width=100)
        self.cancel_btn.pack(side="right", padx=5)

        self.draft_btn = ctk.CTkButton(right_frame, text=f"üìù {self.texts['draft']}", command=self._save_draft, width=100)
        self.draft_btn.pack(side="right", padx=5)

        self.save_btn = ctk.CTkButton(right_frame, text=f"üíæ {self.texts['save']}", command=self._save, width=120, font=ctk.CTkFont(size=14, weight="bold"))
        self.save_btn.pack(side="right", padx=5)

    def _setup_events(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸàÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠"""
        self.bind('<Control-s>', lambda e: self._save())
        self.bind('<Control-d>', lambda e: self._save_draft())
        self.bind('<Escape>', lambda e: self._confirm_close())
        self.bind('<Control-Right>', lambda e: self._next_tab())
        self.bind('<Control-Left>', lambda e: self._prev_tab())

    def _show_tab(self, index):
        """ÿπÿ±ÿ∂ ÿ™ÿ®ŸàŸäÿ® ŸÖÿ≠ÿØÿØ"""
        for frame in self.tab_frames:
            frame.pack_forget()

        if 0 <= index < len(self.tab_frames):
            self.tab_frames[index].pack(fill="both", expand=True)
            self.current_step = index

            self.prev_btn.configure(state="normal" if index > 0 else "disabled")
            self.next_btn.configure(state="normal" if index < len(self.tab_frames) - 1 else "disabled")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÇÿØŸÖ
            for i, btn in enumerate(self.progress_buttons):
                if i == index:
                    btn.configure(fg_color=self.themed_window.get_color('primary'))
                elif i < index:
                    btn.configure(fg_color=self.themed_window.get_color('success'))
                else:
                    btn.configure(fg_color=self.themed_window.get_color('surface'))

    def _prev_tab(self):
        """ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ≥ÿßÿ®ŸÇ"""
        if self.current_step > 0:
            self._show_tab(self.current_step - 1)

    def _next_tab(self):
        """ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ™ÿßŸÑŸä"""
        if self.current_step < len(self.tab_frames) - 1:
            self._show_tab(self.current_step + 1)

    def _save(self):
        """ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        if self._save_in_progress or not self._validate_form():
            return

        self._save_in_progress = True
        data = self._collect_data()

        def save_operation():
            try:
                if self.mode == "add":
                    result = self.controller.create_record(data)
                else:
                    result = self.controller.update_record(self.record_id, data)

                if result:
                    success_msg = self.texts['save_success'] if self.mode == "add" else self.texts['update_success']
                    self.after(0, lambda: [
                        messagebox.showinfo(self.texts['success'], success_msg),
                        self._delete_draft(),
                        self.destroy()
                    ])
                else:
                    raise Exception("ŸÅÿ¥ŸÑ ÿßŸÑÿ≠ŸÅÿ∏")
            except Exception as e:
                error_msg = f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: {str(e)}"
                self.after(0, lambda: messagebox.showerror(self.texts['error'], error_msg))
            finally:
                self._save_in_progress = False

        threading.Thread(target=save_operation, daemon=True).start()

    def _validate_form(self):
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨"""
        required_fields = ["Customer Name", "Agency", "Date Trip"]
        for field_name in required_fields:
            if field_name in self.field_widgets:
                value = self._get_widget_value(self.field_widgets[field_name])
                if not value or not value.strip():
                    messagebox.showerror(self.texts['error'], f"{self.texts['required_field']}: {self._translate_field_name(field_name)}")
                    return False
        return True

    def _collect_data(self):
        """ÿ¨ŸÖÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ"""
        data = {}
        for field_name, widget in self.field_widgets.items():
            value = self._get_widget_value(widget)
            if value:
                field_type = self.field_type_map.get(field_name, "text")
                if field_type == "number":
                    try:
                        data[field_name] = int(value)
                    except ValueError:
                        data[field_name] = 0
                elif field_type == "currency":
                    try:
                        data[field_name] = float(str(value).replace(',', '').strip())
                    except ValueError:
                        data[field_name] = value
                else:
                    data[field_name] = value
        return data

    def _get_widget_value(self, widget):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇŸäŸÖÿ© ŸÖŸÜ widget - ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        try:
            # ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ£ŸàŸÑŸâ: ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿπÿßÿØŸäÿ©
            if hasattr(widget, 'get'):
                value = widget.get()
                return value.strip() if isinstance(value, str) else value

        except tk.TclError as tcl_error:
            # ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©ÿå ÿ¨ÿ±ÿ® ÿ∑ÿ±ŸÇ ÿ®ÿØŸäŸÑÿ©
            try:
                # ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑
                if hasattr(widget, 'cget'):
                    textvariable = widget.cget('textvariable')
                    if textvariable and hasattr(textvariable, 'get'):
                        value = textvariable.get()
                        logger.debug(f"‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇŸäŸÖÿ© ŸÖŸÜ textvariable: {value}")
                        return value.strip() if isinstance(value, str) else value

                # ŸÖÿ≠ÿßŸàŸÑÿ© ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÖÿ®ÿßÿ¥ÿ±ÿ© (ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©)
                if hasattr(widget, 'configure'):
                    # ÿ™ŸÅÿπŸäŸÑ ŸÖÿ§ŸÇÿ™ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ©
                    original_state = widget.cget('state')
                    widget.configure(state='normal')

                    try:
                        value = widget.get()
                        widget.configure(state=original_state)
                        logger.debug(f"‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇŸäŸÖÿ© ÿ®ÿ™ŸÅÿπŸäŸÑ ŸÖÿ§ŸÇÿ™: {value}")
                        return value.strip() if isinstance(value, str) else value
                    except:
                        widget.configure(state=original_state)
                        raise

            except Exception as e:
                logger.error(f"‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ¨ŸÖŸäÿπ ŸÖÿ≠ÿßŸàŸÑÿßÿ™ ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÇŸäŸÖÿ©: {e}")

        except Exception as e:
            logger.error(f"‚ùå ÿÆÿ∑ÿ£ ÿπÿßŸÖ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ŸÇŸäŸÖÿ© widget: {e}")

        return ""

    def _save_draft(self):
        """ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ŸàÿØÿ©"""
        try:
            data = self._collect_data()
            draft_data = {
                "timestamp": datetime.now().isoformat(),
                "mode": self.mode,
                "data": data
            }

            os.makedirs("drafts", exist_ok=True)
            with open(f"drafts/{self.draft_file}", 'w', encoding='utf-8') as f:
                json.dump(draft_data, f, ensure_ascii=False, indent=2)

            messagebox.showinfo(self.texts['success'], self.texts['draft_saved'])
        except Exception as e:
            messagebox.showerror(self.texts['error'], f"ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ŸàÿØÿ©: {str(e)}")

    def _try_load_draft(self):
        """ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ≥ŸàÿØÿ©"""
        try:
            draft_path = f"drafts/{self.draft_file}"
            if os.path.exists(draft_path):
                if messagebox.askyesno("ŸÖÿ≥ŸàÿØÿ© ŸÖŸàÿ¨ŸàÿØÿ©", "ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ŸàÿØÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©ÿü"):
                    with open(draft_path, 'r', encoding='utf-8') as f:
                        draft_data = json.load(f)
                    self._load_draft_data(draft_data.get("data", {}))
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ŸàÿØÿ©: {e}")

    def _load_draft_data(self, data):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ŸàÿØÿ©"""
        for field_name, value in data.items():
            if field_name in self.field_vars:
                try:
                    var = self.field_vars[field_name]
                    if isinstance(var, tk.IntVar):
                        var.set(int(value) if value else 0)
                    else:
                        var.set(str(value) if value else "")
                except Exception as e:
                    logger.warning(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {field_name}: {e}")

    def _delete_draft(self):
        """ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ŸàÿØÿ©"""
        try:
            draft_path = f"drafts/{self.draft_file}"
            if os.path.exists(draft_path):
                os.remove(draft_path)
        except Exception as e:
            logger.warning(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ŸàÿØÿ©: {e}")

    def _refresh_dropdowns(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if not self.dropdown_manager:
            messagebox.showinfo(self.texts['error'], "ÿÆÿØŸÖÿ© ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ÿ©")
            return

        def refresh_thread():
            try:
                self.dropdown_manager.refresh_all()
                self._load_from_cache()
                self._update_combo_boxes()
                self.after(0, lambda: messagebox.showinfo(self.texts['success'], "ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠"))
            except Exception as e:
                self.after(0, lambda: messagebox.showerror(self.texts['error'], f"ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´: {str(e)}"))

        threading.Thread(target=refresh_thread, daemon=True).start()

    def _update_combo_boxes(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑÿπÿßÿØŸäÿ©
        for field_name, combo in self.combo_boxes.items():
            if field_name in self.dropdown_options:
                try:
                    current_value = combo.get()
                    new_values = self.dropdown_options[field_name]
                    combo.configure(values=new_values)
                    if current_value in new_values:
                        combo.set(current_value)
                except Exception as e:
                    logger.warning(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ {field_name}: {e}")

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
        for field_name, combo in self.enhanced_combos.items():
            if field_name in self.dropdown_options:
                try:
                    current_value = combo.get()
                    new_values = self.dropdown_options[field_name]
                    combo.set_values(new_values)
                    if current_value in new_values:
                        combo.set(current_value)
                except Exception as e:
                    logger.warning(f"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© {field_name}: {e}")

    def _confirm_close(self):
        """ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ"""
        if self._has_unsaved_changes():
            result = messagebox.askyesnocancel("ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ŸÅŸàÿ∏ÿ©", "ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ŸàÿØÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇÿü")
            if result is True:
                self._save_draft()
                self.destroy()
            elif result is False:
                self.destroy()
        else:
            self.destroy()

    def _has_unsaved_changes(self):
        """ŸÅÿ≠ÿµ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©"""
        if self.mode == "add":
            for var in self.field_vars.values():
                if isinstance(var, tk.IntVar) and var.get() != 0:
                    return True
                elif isinstance(var, tk.StringVar) and var.get():
                    return True
        return False

    def _populate_fields(self):
        """ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸäÿ© - ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        logger.info(f"üöÄ ÿ®ÿØÿ° ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ - ÿπÿØÿØ ÿßŸÑÿ≠ŸÇŸàŸÑ: {len(self.initial_fields)}")

        populated_count = 0
        failed_count = 0
        skipped_count = 0
        readonly_count = 0

        for field_name, value in self.initial_fields.items():
            try:
                # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿ≠ŸÇŸÑ
                if field_name not in self.field_vars:
                    logger.warning(f"‚ö†Ô∏è ÿßŸÑÿ≠ŸÇŸÑ '{field_name}' ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ŸÅŸä field_vars")
                    skipped_count += 1
                    continue

                # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÇŸäŸÖÿ©
                if value is None or (isinstance(value, str) and not value.strip()):
                    logger.debug(f"‚è≠Ô∏è ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ≠ŸÇŸÑ '{field_name}' - ŸÇŸäŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ©")
                    skipped_count += 1
                    continue

                processed_value = self._process_complex_value(value)
                logger.info(f"üîÑ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ≠ŸÇŸÑ '{field_name}': {value} ‚Üí {processed_value}")

                if not processed_value:
                    logger.warning(f"‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ŸÇŸäŸÖÿ© ÿßŸÑÿ≠ŸÇŸÑ '{field_name}': {value}")
                    failed_count += 1
                    continue

                # ŸÅÿ≠ÿµ ŸÜŸàÿπ ÿßŸÑÿ≠ŸÇŸÑ
                field_type = self.field_type_map.get(field_name, "text")

                # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ŸÅŸä ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿ£ŸàŸÑÿßŸã
                var = self.field_vars[field_name]

                if isinstance(var, tk.IntVar):
                    try:
                        int_value = int(float(str(processed_value))) if processed_value else 0
                        var.set(int_value)
                        logger.debug(f"üìä ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ© ÿ±ŸÇŸÖŸäÿ© ŸÑŸÑÿ≠ŸÇŸÑ '{field_name}': {int_value}")
                    except (ValueError, TypeError) as e:
                        logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ© ŸÑŸÑÿ≠ŸÇŸÑ '{field_name}': {e}")
                        var.set(0)
                        failed_count += 1
                        continue
                else:
                    var.set(str(processed_value))
                    logger.debug(f"üìù ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ© ŸÜÿµŸäÿ© ŸÑŸÑÿ≠ŸÇŸÑ '{field_name}': {processed_value}")

                # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                if field_type == "readonly":
                    readonly_count += 1
                    logger.info(f"üîí ŸÖÿπÿßŸÑÿ¨ÿ© ÿ≠ŸÇŸÑ ŸÖÿ≠ŸÖŸä: '{field_name}' = '{processed_value}'")

                    # ÿ™ÿ≠ÿØŸäÿ´ ŸÅŸàÿ±Ÿä ŸÑŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä
                    self._force_widget_update(field_name, processed_value)

                    # ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ∂ÿßŸÅŸä ŸÖÿ™ÿ£ÿÆÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ
                    self.after(50, lambda fn=field_name, pv=processed_value: self._force_widget_update(fn, pv))
                    self.after(100, lambda fn=field_name, pv=processed_value: self._force_widget_update(fn, pv))

                else:
                    # ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿπÿßÿØŸäÿ©
                    self._force_widget_update(field_name, processed_value)

                # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
                if field_name in self.combo_boxes or field_name in self.enhanced_combos:
                    self._handle_dropdown_value(field_name, processed_value)

                populated_count += 1

            except Exception as e:
                failed_count += 1
                logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸÑ '{field_name}': {e}")
                import traceback
                traceback.print_exc()

        logger.info(f"üìä ŸÜÿ™ÿßÿ¶ÿ¨ ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ:")
        logger.info(f"  ‚úÖ ŸÜÿ¨ÿ≠: {populated_count}")
        logger.info(f"  üîí ÿ≠ŸÇŸàŸÑ ŸÖÿ≠ŸÖŸäÿ©: {readonly_count}")
        logger.info(f"  ‚ùå ŸÅÿ¥ŸÑ: {failed_count}")
        logger.info(f"  ‚è≠Ô∏è ÿ™ŸÖ ÿ™ÿÆÿ∑Ÿä: {skipped_count}")

        # ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÖÿ™ÿ£ÿÆÿ±ÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
        self.after(100, self._force_readonly_fields_update)
        self.after(150, self._force_readonly_fields_update)
        self.after(150, self._verify_readonly_fields)

    def _force_readonly_fields_update(self):
        """ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿÆÿßÿµ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        logger.info("üîí ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©...")

        for field_name, value in self.initial_fields.items():
            field_type = self.field_type_map.get(field_name, "text")

            if field_type == "readonly" and value:
                processed_value = self._process_complex_value(value)
                if processed_value:
                    logger.info(f"üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä '{field_name}': {processed_value}")
                    self._force_widget_update(field_name, processed_value)

    def _verify_readonly_fields(self):
        """ŸÅÿ≠ÿµ ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        logger.info("üîç ŸÅÿ≠ÿµ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©...")

        for field_name in self.field_widgets.keys():
            field_type = self.field_type_map.get(field_name, "text")

            if field_type == "readonly":
                try:
                    widget = self.field_widgets[field_name]
                    var = self.field_vars.get(field_name)
                    expected_value = self.initial_fields.get(field_name)

                    if expected_value:
                        processed_expected = self._process_complex_value(expected_value)
                        current_var_value = var.get() if var else ""

                        # ŸÖÿ≠ÿßŸàŸÑÿ© ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÇŸäŸÖÿ© ŸÖŸÜ ÿßŸÑŸÄ widget
                        try:
                            widget_value = self._get_widget_value(widget)
                        except:
                            widget_value = ""

                        logger.info(f"üîç ŸÅÿ≠ÿµ '{field_name}':")
                        logger.info(f"  üìù ŸÖÿ™ŸàŸÇÿπ: '{processed_expected}'")
                        logger.info(f"  üîß ŸÖÿ™ÿ∫Ÿäÿ±: '{current_var_value}'")
                        logger.info(f"  üñºÔ∏è widget: '{widget_value}'")

                        # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖ ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ©ÿå ÿ£ÿµŸÑÿ≠Ÿáÿß
                        if str(current_var_value) != str(processed_expected) or str(widget_value) != str(processed_expected):
                            logger.warning(f"‚ö†Ô∏è ÿπÿØŸÖ ÿ™ÿ∑ÿßÿ®ŸÇ ŸÅŸä ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä '{field_name}' - ÿ•ÿµŸÑÿßÿ≠...")
                            self._force_widget_update(field_name, processed_expected)

                except Exception as e:
                    logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ŸÅÿ≠ÿµ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä '{field_name}': {e}")

    def _ensure_booking_number_display(self):
        """ÿ∂ŸÖÿßŸÜ ÿπÿ±ÿ∂ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠"""
        booking_field = "Booking Nr."

        if booking_field in self.initial_fields:
            booking_value = self.initial_fields[booking_field]
            processed_booking = self._process_complex_value(booking_value)

            logger.info(f"üé´ ÿ∂ŸÖÿßŸÜ ÿπÿ±ÿ∂ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: '{processed_booking}'")

            if processed_booking:
                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±
                if booking_field in self.field_vars:
                    self.field_vars[booking_field].set(processed_booking)

                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÄ widget ŸÖÿ®ÿßÿ¥ÿ±ÿ©
                if booking_field in self.field_widgets:
                    widget = self.field_widgets[booking_field]

                    try:
                        # ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                        original_state = widget.cget('state')
                        widget.configure(state='normal')
                        widget.delete(0, tk.END)
                        widget.insert(0, processed_booking)
                        widget.configure(state=original_state)

                        logger.info(f"‚úÖ ÿ™ŸÖ ÿ∂ŸÖÿßŸÜ ÿπÿ±ÿ∂ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: '{processed_booking}'")

                    except Exception as e:
                        logger.error(f"‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ∂ŸÖÿßŸÜ ÿπÿ±ÿ∂ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤: {e}")

    def _force_widget_update(self, field_name, value):
        """ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ widget ŸÖÿ≠ÿØÿØ - ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©"""
        try:
            if field_name in self.field_widgets:
                widget = self.field_widgets[field_name]

                # ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ≠ŸÇŸÑ ŸÖÿ≠ŸÖŸäÿßŸã
                field_type = self.field_type_map.get(field_name, "text")

                if field_type == "readonly":
                    # ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ≠ŸÖŸäÿ©
                    if hasattr(widget, 'update_readonly_value'):
                        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿßŸÑŸÖÿÆÿµÿµÿ©
                        widget.update_readonly_value(value)
                        logger.debug(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä '{field_name}' ÿ®ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿßŸÑŸÖÿÆÿµÿµÿ©: {value}")
                    else:
                        # ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ŸÇŸÑŸäÿØŸäÿ©
                        try:
                            original_state = widget.cget('state')
                            widget.configure(state='normal')
                            widget.delete(0, tk.END)
                            widget.insert(0, str(value))
                            widget.configure(state=original_state)
                            logger.debug(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä '{field_name}' ÿ®ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ŸÇŸÑŸäÿØŸäÿ©: {value}")
                        except Exception as readonly_error:
                            logger.error(f"‚ùå ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖÿ≠ŸÖŸä '{field_name}': {readonly_error}")

                            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ
                            if field_name in self.field_vars:
                                self.field_vars[field_name].set(str(value))

                # ŸÑŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿπÿßÿØŸäÿ©
                elif hasattr(widget, 'delete') and hasattr(widget, 'insert'):
                    try:
                        widget.delete(0, tk.END)
                        widget.insert(0, str(value))
                        logger.debug(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑÿπÿßÿØŸä '{field_name}': {value}")
                    except tk.TclError as e:
                        logger.error(f"‚ùå ÿÆÿ∑ÿ£ Tcl ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ '{field_name}': {e}")

                # ŸÑŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
                elif hasattr(widget, 'set'):
                    widget.set(str(value))
                    logger.debug(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© '{field_name}': {value}")

                # ÿ•ÿ¨ÿ®ÿßÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ±ÿ¶Ÿä
                widget.update_idletasks()

        except Exception as e:
            logger.error(f"‚ùå ÿÆÿ∑ÿ£ ÿπÿßŸÖ ŸÅŸä ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ widget '{field_name}': {e}")

    def _force_ui_refresh(self):
        """ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ÿßŸÖŸÑ ŸÑŸÑŸàÿßÿ¨Ÿáÿ©"""
        try:
            logger.info("üîÑ ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ÿßŸÖŸÑ ŸÑŸÑŸàÿßÿ¨Ÿáÿ©...")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
            for field_name, value in self.initial_fields.items():
                if field_name in self.field_vars and value:
                    try:
                        processed_value = self._process_complex_value(value)
                        if processed_value:
                            var = self.field_vars[field_name]
                            current_value = var.get()

                            # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖÿ© ŸÖÿÆÿ™ŸÑŸÅÿ©ÿå ÿ£ÿπÿØ ÿ™ÿπŸäŸäŸÜŸáÿß
                            if str(current_value) != str(processed_value):
                                if isinstance(var, tk.IntVar):
                                    var.set(int(float(str(processed_value))) if processed_value else 0)
                                else:
                                    var.set(str(processed_value))
                                logger.debug(f"üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ '{field_name}': {processed_value}")

                            # ÿ•ÿ¨ÿ®ÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÄ widget ŸÖÿ®ÿßÿ¥ÿ±ÿ©
                            self._force_widget_update(field_name, processed_value)

                    except Exception as e:
                        logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿßŸÖŸÑ ŸÑŸÑÿ≠ŸÇŸÑ '{field_name}': {e}")

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
            self.update_idletasks()
            self.update()

            logger.info("‚úÖ ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿßŸÖŸÑ ŸÑŸÑŸàÿßÿ¨Ÿáÿ©")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿßŸÖŸÑ: {e}")

    def _handle_dropdown_value(self, field_name, value):
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿÆÿßÿµÿ© ŸÑŸÇŸäŸÖ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© - ŸÖÿ≠ÿ≥ŸÜÿ©"""
        try:
            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑÿπÿßÿØŸäÿ©
            if field_name in self.combo_boxes:
                combo = self.combo_boxes[field_name]
                current_values = list(combo.cget("values"))

                # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©ÿå ÿ£ÿ∂ŸÅŸáÿß
                if value not in current_values:
                    new_values = current_values + [value]
                    combo.configure(values=new_values)
                    logger.info(f"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© '{value}' ÿ•ŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© '{field_name}'")

                # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ŸÖÿπ ÿ™ÿ£ÿÆŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ
                combo.set(value)
                self.after(50, lambda: combo.set(value))  # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖÿπ ÿ™ÿ£ÿÆŸäÿ±
                logger.debug(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπÿßÿØŸäÿ© '{field_name}': {value}")

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
            elif field_name in self.enhanced_combos:
                combo = self.enhanced_combos[field_name]

                # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
                current_values = []
                if hasattr(combo, 'values'):
                    current_values = list(combo.values)
                elif hasattr(combo, 'filtered_values'):
                    current_values = list(combo.filtered_values)

                # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©ÿå ÿ£ÿ∂ŸÅŸáÿß
                if value not in current_values:
                    if hasattr(combo, 'add_value'):
                        combo.add_value(value)
                    elif hasattr(combo, 'set_values'):
                        new_values = current_values + [value]
                        combo.set_values(new_values)
                    logger.info(f"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© '{value}' ÿ•ŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© '{field_name}'")

                # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ŸÖÿπ ÿ™ÿ£ÿÆŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ
                if hasattr(combo, 'set'):
                    combo.set(value)
                    self.after(50, lambda: combo.set(value))  # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖÿπ ÿ™ÿ£ÿÆŸäÿ±
                    logger.debug(f"ÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© '{field_name}': {value}")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ŸÇŸäŸÖÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© '{field_name}': {e}")

    def _verify_dropdown_values(self):
        """ŸÅÿ≠ÿµ ÿ•ÿ∂ÿßŸÅŸä ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ŸÅŸàÿ±Ÿä"""
        logger.info("üîç ÿ®ÿØÿ° ŸÅÿ≠ÿµ Ÿàÿ•ÿµŸÑÿßÿ≠ ŸÇŸäŸÖ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©...")

        fixed_count = 0

        for field_name in self.dropdown_mapping.keys():
            if field_name in self.field_vars:
                try:
                    expected_value = self.field_vars[field_name].get()

                    if not expected_value:
                        continue

                    if field_name in self.combo_boxes:
                        combo = self.combo_boxes[field_name]
                        actual_value = combo.get()

                        if str(expected_value) != str(actual_value):
                            logger.warning(f"‚ö†Ô∏è ÿπÿØŸÖ ÿ™ÿ∑ÿßÿ®ŸÇ ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© '{field_name}': ŸÖÿ™ŸàŸÇÿπ='{expected_value}', ŸÅÿπŸÑŸä='{actual_value}'")

                            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
                            current_values = list(combo.cget("values"))
                            if expected_value not in current_values:
                                new_values = current_values + [expected_value]
                                combo.configure(values=new_values)

                            # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ÿ®ŸÇŸàÿ©
                            combo.set(expected_value)
                            self.after(10, lambda v=expected_value, c=combo: c.set(v))
                            fixed_count += 1
                            logger.info(f"‚úÖ ÿ™ŸÖ ÿ•ÿµŸÑÿßÿ≠ ŸÇŸäŸÖÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© '{field_name}' ÿ•ŸÑŸâ '{expected_value}'")

                    elif field_name in self.enhanced_combos:
                        combo = self.enhanced_combos[field_name]
                        actual_value = combo.get() if hasattr(combo, 'get') else ""

                        if str(expected_value) != str(actual_value):
                            logger.warning(f"‚ö†Ô∏è ÿπÿØŸÖ ÿ™ÿ∑ÿßÿ®ŸÇ ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© '{field_name}': ŸÖÿ™ŸàŸÇÿπ='{expected_value}', ŸÅÿπŸÑŸä='{actual_value}'")

                            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
                            if hasattr(combo, 'add_value'):
                                combo.add_value(expected_value)

                            # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ©
                            if hasattr(combo, 'set'):
                                combo.set(expected_value)
                                self.after(10, lambda v=expected_value, c=combo: c.set(v))
                            fixed_count += 1
                            logger.info(f"‚úÖ ÿ™ŸÖ ÿ•ÿµŸÑÿßÿ≠ ŸÇŸäŸÖÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© '{field_name}' ÿ•ŸÑŸâ '{expected_value}'")

                except Exception as e:
                    logger.error(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ŸÅÿ≠ÿµ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© '{field_name}': {e}")

        if fixed_count > 0:
            logger.info(f"üîß ÿ™ŸÖ ÿ•ÿµŸÑÿßÿ≠ {fixed_count} ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ©")
            # ÿ™ÿ≠ÿØŸäÿ´ ŸÜŸáÿßÿ¶Ÿä ŸÑŸÑŸàÿßÿ¨Ÿáÿ©
            self.after(100, lambda: self.update_idletasks())

    def _process_complex_value(self, value):
        """ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑŸÇŸäŸÖ ÿßŸÑŸÖÿπŸÇÿØÿ© ŸÖŸÜ Airtable"""
        if value is None:
            return ""

        # ÿ•ÿ∂ÿßŸÅÿ© logging ŸÑŸÑÿ™ÿ¥ÿÆŸäÿµ
        logger.debug(f"Processing complex value: {type(value)} = {value}")

        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÄ dictionaries
        if isinstance(value, dict):
            # ÿ™ÿ±ÿ™Ÿäÿ® ÿ£ŸàŸÑŸàŸäÿ© ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÇŸäŸÖ
            for key in ['name', 'label', 'value', 'text', 'title', 'display_name', 'url', 'id']:
                if key in value and value[key]:
                    result = str(value[key]).strip()
                    logger.debug(f"Extracted from dict[{key}]: {result}")
                    return result
            # ÿ•ÿ∞ÿß ŸÑŸÖ ŸÜÿ¨ÿØ ÿ¥Ÿäÿ°ÿå ÿ£ÿ±ÿ¨ÿπ ÿ£ŸàŸÑ ŸÇŸäŸÖÿ© ÿ∫Ÿäÿ± ŸÅÿßÿ±ÿ∫ÿ©
            for key, val in value.items():
                if val and str(val).strip():
                    result = str(val).strip()
                    logger.debug(f"Fallback from dict[{key}]: {result}")
                    return result
            return ""

        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÄ arrays
        elif isinstance(value, list):
            if not value:
                return ""
            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿπŸÜÿµÿ± Ÿàÿßÿ≠ÿØÿå ÿßÿ≥ÿ™ÿÆÿØŸÖŸá
            if len(value) == 1:
                return self._process_complex_value(value[0])
            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿπŸÜÿµÿ±ÿå ÿßÿ¨ŸÖÿπŸáŸÖ
            processed_values = []
            for item in value:
                processed = self._process_complex_value(item)
                if processed:
                    processed_values.append(processed)
            result = ", ".join(processed_values) if processed_values else ""
            logger.debug(f"Processed array: {result}")
            return result

        # ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ®ÿ≥Ÿäÿ∑ÿ©
        else:
            result = str(value).strip() if value else ""
            logger.debug(f"Simple value: {result}")
            return result

    def _parse_date(self, date_str):
        """ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"""
        if not date_str:
            return ""
        try:
            if 'T' in date_str:
                return date_str.split('T')[0]
            if len(date_str) == 10 and date_str.count('-') == 2:
                return date_str
            return date_str
        except:
            return date_str

    def _translate_text(self, text):
        """ÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑŸÜÿµ ÿßŸÑÿπÿßŸÖ"""
        if not self.lang_manager:
            return text
        key = text.lower().replace(" ", "_")
        return self.lang_manager.get(key, text)

    def _translate_tab_name(self, tab_name):
        """ÿ™ÿ±ÿ¨ŸÖÿ© ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿ®ÿ¥ŸÉŸÑ ŸÖÿ≠ÿØÿØ"""
        if not self.lang_manager:
            return tab_name

        # ÿÆÿ±Ÿäÿ∑ÿ© ÿ™ÿ±ÿ¨ŸÖÿ© ŸÖÿ≠ÿØÿØÿ© ŸÑŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        tab_translations = {
            "Basic Information": "basic_info",
            "Trip Details": "trip_details",
            "Passenger Info": "passenger_info",
            "Contact Info": "contact_info",
            "Pricing Info": "pricing_info",
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©": "basic_info",
            "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿ≠ŸÑÿ©": "trip_details",
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ±ŸÉÿßÿ®": "passenger_info",
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ": "contact_info",
            "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±": "pricing_info"
        }

        key = tab_translations.get(tab_name, tab_name.lower().replace(" ", "_"))
        return self.lang_manager.get(key, tab_name)

    def _translate_field_name(self, field_name):
        """ÿ™ÿ±ÿ¨ŸÖÿ© ÿßÿ≥ŸÖ ÿßŸÑÿ≠ŸÇŸÑ"""
        if not self.lang_manager:
            return field_name

        # ÿÆÿ±Ÿäÿ∑ÿ© ÿ™ÿ±ÿ¨ŸÖÿ© ŸÖÿ≠ÿØÿØÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ
        field_translations = {
            "Customer Name": "customer_name",
            "Hotel Name": "hotel_name",
            "Agency": "agency",
            "Booking Nr.": "booking_number",
            "Room number": "room_number",
            "trip Name": "trip_name",
            "Date Trip": "trip_date",
            "Option": "option",
            "des": "destination",
            "Guide": "guide",
            "Product ID": "product_id",
            "pickup time": "pickup_time",
            "Remarks": "remarks",
            "Add - Ons": "add_ons",
            "ADT": "adults",
            "CHD": "children",
            "STD": "students",
            "Youth": "youth",
            "Inf": "infants",
            "CHD Age": "children_ages",
            "Customer Phone": "phone_number",
            "Customer Email": "email",
            "Customer Country": "customer_country",
            "Total price USD": "total_price_usd",
            "Total price EUR": "total_price_eur",
            "Total price GBP": "total_price_gbp",
            "Net Rate": "net_rate",
            "Currency": "currency",
            "Cost EGP": "cost_egp",
            "Collecting on date Trip": "collecting_on_date",
            "Management Option": "management_option",
            "Add-on": "add_on"
        }

        key = field_translations.get(field_name, field_name.lower().replace(" ", "_"))
        return self.lang_manager.get(key, field_name)

    def update_language(self, lang_manager):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÑÿ∫ÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.lang_manager = lang_manager
        self._setup_texts()  # ÿ•ÿπÿßÿØÿ© ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿµŸàÿµ

        # ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        title = "‚ûï " + self.texts.get("add", "Add") if self.mode == "add" else "‚úèÔ∏è " + self.texts.get("edit", "Edit")
        self.title(title)

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        if hasattr(self, 'progress_buttons'):
            for i, btn in enumerate(self.progress_buttons):
                if i < len(self.tab_names):
                    translated_name = self._translate_tab_name(self.tab_names[i])
                    btn.configure(text=f"{i+1}. {translated_name}")

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ
        if hasattr(self, 'prev_btn'):
            self.prev_btn.configure(text=f"‚óÄ {self.texts['previous']}")
        if hasattr(self, 'next_btn'):
            self.next_btn.configure(text=f"{self.texts['next']} ‚ñ∂")
        if hasattr(self, 'save_btn'):
            self.save_btn.configure(text=f"üíæ {self.texts['save']}")
        if hasattr(self, 'cancel_btn'):
            self.cancel_btn.configure(text=f"‚ùå {self.texts['cancel']}")
        if hasattr(self, 'draft_btn'):
            self.draft_btn.configure(text=f"üìù {self.texts['draft']}")
        if hasattr(self, 'refresh_btn'):
            self.refresh_btn.configure(text=f"üîÑ {self.texts['refresh']}")

    def _get_initial_value(self, field_name):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸàŸÑŸäÿ©"""
        value = self.initial_fields.get(field_name)
        return self._process_complex_value(value) if value else ""

    def destroy(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ"""
        self._is_closing = True
        try:
            # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÇŸàÿßŸÖŸäÿ≥
            for attr in ['field_vars', 'field_widgets', 'combo_boxes', 'enhanced_combos', 'dropdown_options']:
                if hasattr(self, attr):
                    getattr(self, attr).clear()
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ: {e}")
        finally:
            super().destroy()

============================================================
FILE: views\login_window.py
SIZE: 91114 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/login_window.py

ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ (ŸÖŸÜ ÿ£ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ≠ÿ™Ÿâ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ)
Enhanced Professional Login Window with Workarea Height Layout
"""

import customtkinter as ctk
from tkinter import messagebox
import json
import os
import re
import time
import hashlib
import secrets
import platform
from typing import Any, Callable, Optional, Dict, Tuple
from datetime import datetime, timedelta
import threading
from functools import wraps
import queue

# Core imports
from core.language_manager import LanguageManager
from core.theme_manager import ThemeManager
from core.logger import logger

# ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑŸÑÿ´ŸäŸÖÿßÿ™ ŸàÿßŸÑÿ£ŸÑŸàÿßŸÜ
from core.theme_color_manager import ThemeColorManager, ThemedWindow

# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÑŸàÿ≠ÿßÿ™ ÿßŸÑÿ£ŸÑŸàÿßŸÜ
try:
    from config.modern_color_palettes import get_color_palette, get_available_palettes
    COLOR_PALETTES_AVAILABLE = True
except ImportError:
    COLOR_PALETTES_AVAILABLE = False
    logger.warning("Color palettes module not found. Using default colors.")

# Security imports
try:
    from core.security.encryption import EncryptionManager
    from core.security.rate_limiter import RateLimiter
    from utils.validators import InputValidator
    from config.login_config import LOGIN_CONFIG
    from core.constants import LoginConstants
    try:
        from core.constants import WindowConstants
        if not hasattr(WindowConstants, 'SCREEN_HEIGHT_RATIO'):
            raise AttributeError("Missing SCREEN_HEIGHT_RATIO")
    except (ImportError, AttributeError):
        WindowConstants = None
except ImportError:
    EncryptionManager = None
    RateLimiter = None
    InputValidator = None
    LOGIN_CONFIG = {}
    WindowConstants = None

    class LoginConstants:
        MIN_PASSWORD_LENGTH = 8
        MAX_LOGIN_ATTEMPTS = 5
        LOGIN_TIMEOUT = 30
        SESSION_TIMEOUT = 1800
        PASSWORD_SPECIAL_CHARS = "!@#$%^&*()_+-=[]{}|;:,.<>?"
        LOCKOUT_DURATION = 300

# Window Constants - Updated for workarea height layout
class LocalWindowConstants:
    MIN_WINDOW_WIDTH = 380
    MIN_WINDOW_HEIGHT = 500
    MAX_WINDOW_WIDTH = 450
    DEFAULT_WINDOW_WIDTH = 400
    SCREEN_HEIGHT_RATIO = 0.85
    ANIMATION_DURATION = 300
    FLASH_INTERVAL = 300
    WORKAREA_HEIGHT_ENABLED = True  # ÿ™ŸÅÿπŸäŸÑ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
    FULL_HEIGHT_ENABLED = False     # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ

if WindowConstants is None:
    WindowConstants = LocalWindowConstants
else:
    for attr in ['SCREEN_HEIGHT_RATIO', 'DEFAULT_WINDOW_WIDTH', 'MAX_WINDOW_WIDTH', 'MIN_WINDOW_HEIGHT', 'WORKAREA_HEIGHT_ENABLED']:
        if not hasattr(WindowConstants, attr):
            setattr(WindowConstants, attr, getattr(LocalWindowConstants, attr))

# Window Manager import with workarea height support
try:
    from utils.window_manager import WindowManager, setup_dialog_window, setup_login_window, setup_add_edit_window, setup_dialog_window_workarea
    WINDOW_MANAGER_AVAILABLE = True
except ImportError:
    WINDOW_MANAGER_AVAILABLE = False
    WindowManager = None
    setup_dialog_window = None
    setup_login_window = None
    setup_add_edit_window = None
    setup_dialog_window_workarea = None


def login_error_handler(func):
    """Decorator ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿÆÿ∑ÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"""
    @wraps(func)
    def wrapper(self, *args, **kwargs):
        try:
            return func(self, *args, **kwargs)
        except Exception as e:
            logger.error(f"Error in {func.__name__}: {e}", exc_info=True)
            if hasattr(self, '_show_status'):
                self._show_status(f"Error: {str(e)}", "error")
    return wrapper


class LoginWindow(ctk.CTk):
    """
    ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
    """

    # ŸÇŸäŸÖ ÿ´ÿßÿ®ÿ™ÿ© ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© - ŸÖÿ≠ÿØÿ´ÿ© ŸÑÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
    WINDOW_MIN_WIDTH = 380
    WINDOW_MIN_HEIGHT = 500
    WINDOW_MAX_WIDTH = 450
    WINDOW_DEFAULT_WIDTH = 400
    WINDOW_SCREEN_RATIO = 0.85
    WINDOW_ANIMATION_DURATION = 300
    WINDOW_FLASH_INTERVAL = 300
    WORKAREA_HEIGHT_MODE = True   # ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
    COMPACT_MODE = False          # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿµŸÖŸäŸÖ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑

    def __init__(
        self,
        controller: Any = None,
        lang_manager: LanguageManager = None,
        theme_manager: ThemeManager = None,
        airtable_model: Any = None,
        user_mgr: Any = None,
        on_login_success: Callable[[Dict[str, Any]], None] = None,
        validate_credentials: Callable[[str, str], Optional[Dict[str, Any]]] = None,
        parent_window: Any = None,
        enable_2fa: bool = False,
        enable_encryption: bool = True,
        enable_rate_limiting: bool = True,
        workarea_height: bool = True  # ÿ¨ÿØŸäÿØ: ŸÑŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
    ):
        super().__init__()

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© parent_window
        self.parent_window = None
        if parent_window:
            if hasattr(parent_window, 'winfo_exists') and hasattr(parent_window, 'tk'):
                try:
                    parent_window.winfo_exists()
                    self.parent_window = parent_window
                except:
                    logger.debug("Parent window is not a valid Tkinter window")

        # ÿ•ÿπÿØÿßÿØ Ÿàÿ∂ÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
        self.workarea_height = workarea_height and self.WORKAREA_HEIGHT_MODE

        # Security features flags
        self.enable_2fa = enable_2fa
        self.enable_encryption = enable_encryption and EncryptionManager is not None
        self.enable_rate_limiting = enable_rate_limiting and RateLimiter is not None

        # Initialize security managers
        self.encryption_manager = EncryptionManager() if self.enable_encryption else None
        self.rate_limiter = RateLimiter() if self.enable_rate_limiting else None

        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™
        self.controller = controller
        self.airtable_model = airtable_model
        self.user_mgr = user_mgr

        # ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        if controller:
            self.lang_manager = lang_manager or (controller.lang_manager if hasattr(controller, 'lang_manager') else None)
            self.theme_manager = theme_manager or (controller.theme_manager if hasattr(controller, 'theme_manager') else None)
            self.on_login_success = on_login_success or (lambda user_info: controller.on_login_success(user_info))

            if user_mgr and hasattr(user_mgr, 'authenticate'):
                self.validate_credentials = user_mgr.authenticate
            else:
                self.validate_credentials = validate_credentials
        else:
            self.lang_manager = lang_manager
            self.theme_manager = theme_manager
            self.on_login_success = on_login_success
            self.validate_credentials = validate_credentials

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        if not self.lang_manager:
            raise ValueError("LanguageManager is required")
        if not self.theme_manager:
            raise ValueError("ThemeManager is required")

        # ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸÑŸÑÿ´ŸäŸÖÿßÿ™ ŸàÿßŸÑÿ£ŸÑŸàÿßŸÜ
        self.themed_window = ThemedWindow(self, self.theme_manager)

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿØÿßÿÆŸÑŸäÿ©
        self.remember_me = ctk.BooleanVar(value=False)
        self._closing = False
        self._login_attempts = 0
        self._show_password = False
        self._caps_lock_on = False
        self._session_token = None
        self._csrf_token = self._generate_csrf_token()

        try:
            # ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            self._setup_window()

            # ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
            self._build_workarea_ui()

            # ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
            self._load_saved_credentials()

            # Setup window with workarea height layout
            self._setup_window_with_manager()

            # Bind keyboard events
            self.after(50, self._bind_keyboard_events)

            # ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®
            def set_initial_focus():
                if self._closing or not self.winfo_exists():
                    return
                try:
                    if hasattr(self, 'entry_username') and self.entry_username.winfo_exists():
                        if self.entry_username.get():
                            if hasattr(self, 'entry_password') and self.entry_password.winfo_exists():
                                self.entry_password.focus_set()
                        else:
                            self.entry_username.focus_set()
                except Exception as e:
                    logger.debug(f"Error setting initial focus: {e}")

            if self.winfo_exists():
                self.after(100, set_initial_focus)

            # Start session timeout timer
            self._start_session_timer()

        except Exception as e:
            logger.error(f"Error during initialization: {e}")
            self._on_close()

    def _get_color(self, color_name: str, fallback: str = None) -> str:
        """ÿØÿßŸÑÿ© ŸÖŸàÿ≠ÿØÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÑŸàÿßŸÜ"""
        return self.themed_window.get_color(color_name, fallback)

    def _apply_theme(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ"""
        self.themed_window.apply_theme()

    def _calculate_optimal_window_size(self):
        """ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿ£ŸÖÿ´ŸÑ ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ≠ÿØŸàÿØ"""
        try:
            screen_width = self.winfo_screenwidth()
            screen_height = self.winfo_screenheight()

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπÿ±ÿ∂
            if screen_width < 500:
                window_width = int(screen_width * 0.85)
            elif screen_width < 800:
                window_width = min(400, int(screen_width * 0.5))
            else:
                window_width = 400

            # ÿ™ÿ≠ÿØŸäÿØ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ≠ÿØŸàÿØ ŸàŸÖŸÜÿßÿ≥ÿ® (ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÉÿßŸÖŸÑ)
            if screen_height <= 768:
                window_height = 600  # ÿßÿ±ÿ™ŸÅÿßÿπ ÿµÿ∫Ÿäÿ± ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ©
            elif screen_height <= 1080:
                window_height = 700  # ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿπÿßÿØŸäÿ©
            else:
                window_height = 750  # ÿßÿ±ÿ™ŸÅÿßÿπ ÿ£ŸÉÿ®ÿ± ŸÇŸÑŸäŸÑÿßŸã ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸàÿßŸÑÿ£ŸÇÿµŸâ
            window_height = max(window_height, self.WINDOW_MIN_HEIGHT)
            window_height = min(window_height, int(screen_height * 0.8))  # ŸÑÿß Ÿäÿ™ÿ¨ÿßŸàÿ≤ 80% ŸÖŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿ©

            logger.debug(f"Limited window size: {window_width}x{window_height} for screen {screen_width}x{screen_height}")

            return window_width, window_height

        except Exception as e:
            logger.error(f"Error calculating window size: {e}")
            return 400, 650  # ŸÇŸäŸÖ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÖÿ≠ÿØŸàÿØÿ©

    def _get_available_color_palettes(self):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÑŸàÿ≠ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠"""
        if COLOR_PALETTES_AVAILABLE:
            all_palettes = get_available_palettes()
            return [p for p in all_palettes if p != 'modern_dark']
        return []

    def _save_color_palette_preference(self, palette_name):
        """ÿ≠ŸÅÿ∏ ÿ™ŸÅÿ∂ŸäŸÑ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ"""
        if hasattr(self, 'controller') and hasattr(self.controller, 'config_manager'):
            self.controller.config_manager.set('light_color_palette', palette_name)
            self.controller.config_manager.save()
            logger.info(f"Saved color palette preference: {palette_name}")

    def _setup_window_with_manager(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ WindowManager ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ≠ÿØŸàÿØ"""
        window_width, window_height = self._calculate_optimal_window_size()

        if WINDOW_MANAGER_AVAILABLE:
            try:
                # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ≠ÿØŸàÿØ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÉÿßŸÖŸÑ
                if setup_dialog_window:
                    setup_dialog_window(
                        self,
                        size=(window_width, window_height),  # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ®
                        parent=self.parent_window,
                        focus=True,
                        topmost_duration=500
                    )
                    logger.debug("Login window setup with limited height using setup_dialog_window")

                else:
                    # ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÖÿπ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ≠ÿØŸàÿØ
                    WindowManager.setup_centered_window(
                        self,
                        size=(window_width, window_height),
                        parent=self.parent_window,
                        focus=True,
                        topmost_duration=500,
                        modal=True
                    )
                    logger.debug("Login window setup with limited height using direct method")

                # ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ™ÿßÿ≠ÿßŸã
                if hasattr(WindowManager, 'animate_window_open'):
                    WindowManager.animate_window_open(self, duration=self.WINDOW_ANIMATION_DURATION)

                # ÿ•ÿπÿØÿßÿØ ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                if hasattr(WindowManager, 'setup_window_shortcuts'):
                    WindowManager.setup_window_shortcuts(self)

            except Exception as e:
                logger.error(f"Error setting up window with WindowManager: {e}")
                self._fallback_window_setup()
        else:
            self._fallback_window_setup()

    def _fallback_window_setup(self):
        """ÿ•ÿπÿØÿßÿØ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ŸÑŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖÿ≠ÿØŸàÿØ"""
        try:
            window_width, window_height = self._calculate_optimal_window_size()

            screen_width = self.winfo_screenwidth()
            screen_height = self.winfo_screenheight()

            # ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑÿπÿßÿØŸä (Ÿàÿ≥ÿ∑ ÿßŸÑÿ¥ÿßÿ¥ÿ©)
            x = (screen_width - window_width) // 2
            y = (screen_height - window_height) // 2

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿØÿßÿÆŸÑ ÿ≠ÿØŸàÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            x = max(10, min(x, screen_width - window_width - 10))
            y = max(10, min(y, screen_height - window_height - 50))  # ÿ™ÿ±ŸÉ ŸÖÿ≥ÿßÿ≠ÿ© ŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ

            self.geometry(f"{window_width}x{window_height}+{x}+{y}")

            logger.debug(f"Fallback limited window setup: {window_width}x{window_height} at ({x}, {y})")

            self.lift()
            self.focus_force()

            if self.parent_window:
                try:
                    self.transient(self.parent_window)
                    self.grab_set()
                except:
                    pass

        except Exception as e:
            logger.error(f"Error in fallback window setup: {e}")

    def _generate_csrf_token(self) -> str:
        """Generate CSRF token for security"""
        return secrets.token_urlsafe(32)

    def _bind_keyboard_events(self):
        """Bind keyboard events"""
        if self._closing or not self.winfo_exists():
            return

        try:
            self.bind("<KeyPress>", self._check_caps_lock)
            self.bind("<KeyRelease>", self._check_caps_lock)
            self.bind("<Escape>", lambda e: self._on_close())
            self.bind("<F1>", lambda e: self._show_help())
        except Exception as e:
            logger.error(f"Error binding keyboard events: {e}")

    def _check_caps_lock(self, event=None):
        """Check if Caps Lock is on"""
        try:
            if not self.winfo_exists() or self._closing:
                return

            if hasattr(self, 'entry_password') and self.entry_password.focus_get() == self.entry_password:
                if event and event.keysym == 'Caps_Lock':
                    self._caps_lock_on = not self._caps_lock_on
                else:
                    try:
                        import ctypes
                        if platform.system() == "Windows":
                            hllDll = ctypes.WinDLL("User32.dll")
                            VK_CAPITAL = 0x14
                            self._caps_lock_on = bool(hllDll.GetKeyState(VK_CAPITAL) & 1)
                    except:
                        pass

                if self._caps_lock_on and hasattr(self, 'caps_lock_warning'):
                    self.caps_lock_warning.pack(anchor="w", pady=(1, 0))
                elif hasattr(self, 'caps_lock_warning'):
                    self.caps_lock_warning.pack_forget()
        except Exception as e:
            logger.debug(f"Error checking caps lock: {e}")

    def _start_session_timer(self):
        """Start session timeout timer"""
        self._last_activity = time.time()
        self._check_session_timeout()

    def _check_session_timeout(self):
        """Check for session timeout"""
        if self._closing or not self.winfo_exists():
            return

        if time.time() - self._last_activity > LoginConstants.SESSION_TIMEOUT:
            self._show_status(
                self.lang_manager.get("session_timeout", "Session timed out. Please login again."),
                "warning"
            )
            self._on_close()
        else:
            self.after(60000, self._check_session_timeout)

    def _update_activity(self):
        """Update last activity time"""
        self._last_activity = time.time()

    def safe_after(self, ms, func):
        """ÿ¨ÿØŸàŸÑÿ© ÿØÿßŸÑÿ© ÿ®ÿ¥ŸÉŸÑ ÿ¢ŸÖŸÜ"""
        try:
            if not self._closing and self.winfo_exists():
                return self.after(ms, func)
        except Exception as e:
            if "main thread is not in main loop" in str(e):
                try:
                    return self.after_idle(func)
                except:
                    pass
            logger.error(f"Error in safe_after: {e}")
        return None

    def _setup_window(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ"""
        self.title(self.lang_manager.get("login_window_title", "Login - FTS Sales Manager"))

        self.minsize(self.WINDOW_MIN_WIDTH, self.WINDOW_MIN_HEIGHT)
        self.resizable(False, False)  # ŸÖŸÜÿπ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ

        self.protocol("WM_DELETE_WINDOW", self._on_close)

        self._apply_theme()

        try:
            if os.path.exists("assets/icon.ico"):
                self.iconbitmap("assets/icon.ico")
            else:
                possible_paths = [
                    "assets/icon.ico",
                    "../assets/icon.ico",
                    "../../assets/icon.ico",
                    os.path.join(os.path.dirname(__file__), "../assets/icon.ico")
                ]
                for path in possible_paths:
                    if os.path.exists(path):
                        self.iconbitmap(path)
                        break
        except Exception as e:
            logger.debug(f"Could not set window icon: {e}")

    def _build_workarea_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿ™ÿÆÿ∑Ÿäÿ∑ ŸÖÿ∂ÿ∫Ÿàÿ∑ ŸàŸÖÿ≠ÿ≥ŸÜ"""

        # ÿ™ÿπŸäŸäŸÜ ŸÑŸàŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        self.configure(fg_color=self._get_color('background'))

        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖÿπ ŸáŸàÿßŸÖÿ¥ ŸÖÿπŸÇŸàŸÑÿ©
        main_padding = 10
        main_container = ctk.CTkFrame(self, fg_color=self._get_color('background'))
        main_container.pack(fill="both", expand=True, padx=main_padding, pady=main_padding)

        # ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        card_frame = ctk.CTkFrame(
            main_container,
            fg_color=self._get_color('surface'),
            corner_radius=16,
            border_width=0
        )
        card_frame.pack(fill="both", expand=True)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿπÿßÿØŸä (ÿ®ÿØŸàŸÜ scrollable frame ŸÑŸÑÿ™ŸàŸÅŸäÿ± ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©)
        content_padding = 15
        self.content_frame = ctk.CTkFrame(card_frame, fg_color="transparent")
        self.content_frame.pack(fill="both", expand=True, padx=content_padding, pady=content_padding)

        # ÿ®ŸÜÿßÿ° ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ŸÖÿπ ÿ™ÿ®ÿßÿπÿØ ŸÖÿ∂ÿ∫Ÿàÿ∑
        self._create_compact_header(self.content_frame)
        self._create_compact_login_form(self.content_frame)
        self._create_compact_buttons(self.content_frame)
        self._create_compact_status_area(self.content_frame)
        self._create_compact_footer(self.content_frame)

    def _ensure_content_visibility(self):
        """ÿ∂ŸÖÿßŸÜ ÿ•ÿ∏Ÿáÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ŸÅŸä ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±"""
        try:
            if hasattr(self, 'scrollable_frame') and self.scrollable_frame.winfo_exists():
                self.scrollable_frame.update_idletasks()
                self.scrollable_frame._parent_canvas.yview_moveto(0)
                self.update()
        except Exception as e:
            logger.debug(f"Error ensuring content visibility: {e}")

    def _create_compact_header(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ£ÿ≥ ŸÖÿ∂ÿ∫Ÿàÿ∑"""
        header_frame = ctk.CTkFrame(parent, fg_color="transparent")
        header_frame.pack(fill="x", pady=(5, 15))

        # ÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ¥ÿπÿßÿ± ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        logo_container = ctk.CTkFrame(header_frame, fg_color="transparent")
        logo_container.pack()

        # ÿ¥ÿπÿßÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑
        logo_size = 50
        logo_bg = ctk.CTkFrame(
            logo_container,
            width=logo_size,
            height=logo_size,
            corner_radius=logo_size//2,
            fg_color=self._get_color('primary')
        )
        logo_bg.pack()
        logo_bg.pack_propagate(False)

        # ÿ≠ŸÑŸÇÿ© ÿÆÿßÿ±ÿ¨Ÿäÿ© ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        logo_ring = ctk.CTkFrame(
            logo_container,
            width=logo_size + 8,
            height=logo_size + 8,
            corner_radius=(logo_size + 8)//2,
            fg_color=self._get_color('surface'),
            border_width=2,
            border_color=self._get_color('primary')
        )
        logo_ring.place(relx=0.5, rely=0.5, anchor="center")
        logo_bg.lift()

        # ŸÜÿµ ÿßŸÑÿ¥ÿπÿßÿ± ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
        logo_text = ctk.CTkLabel(
            logo_bg,
            text="FTS",
            font=ctk.CTkFont(family="Helvetica", size=18, weight="bold"),
            text_color="white"
        )
        logo_text.place(relx=0.5, rely=0.5, anchor="center")

        # ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
        self.title_label = ctk.CTkLabel(
            header_frame,
            text="FTS Sales Manager",
            font=ctk.CTkFont(family="Helvetica", size=20, weight="bold"),
            text_color=self._get_color('text_primary')
        )
        self.title_label.pack(pady=(10, 3))

        # ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑŸÅÿ±ÿπŸä ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
        self.subtitle_label = ctk.CTkLabel(
            header_frame,
            text=self.lang_manager.get("login_subtitle", "Secure access to your sales dashboard"),
            font=ctk.CTkFont(family="Helvetica", size=12),
            text_color=self._get_color('text_secondary'),
            wraplength=320
        )
        self.subtitle_label.pack(pady=(0, 8))

        # ÿÆÿ∑ ŸÅÿßÿµŸÑ ÿ±ŸÅŸäÿπ
        separator = ctk.CTkFrame(header_frame, height=1, fg_color=self._get_color('input_border'))
        separator.pack(fill="x", pady=(10, 0))

    def _create_compact_login_form(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ŸÖÿ∂ÿ∫Ÿàÿ∑"""
        form_frame = ctk.CTkFrame(parent, fg_color="transparent")
        form_frame.pack(fill="x", pady=(12, 10))

        # ÿ≠ŸÇŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        self._create_compact_input_field(
            form_frame,
            label_text=self.lang_manager.get("username", "Username"),
            placeholder=self.lang_manager.get("enter_username", "Enter your username"),
            icon="üë§",
            field_name="username"
        )

        # ÿ≠ŸÇŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        self._create_compact_password_field(form_frame)

        # ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™
        self._create_compact_options(form_frame)

        # 2FA field if enabled
        if self.enable_2fa:
            self._create_compact_2fa_field(form_frame)

    def _create_compact_input_field(self, parent, label_text, placeholder, icon, field_name):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ÿ•ÿØÿÆÿßŸÑ ŸÖÿ∂ÿ∫Ÿàÿ∑"""
        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        label_font_size = 13
        field_height = 36
        padding_bottom = 5
        field_padding = 8

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑÿ≠ŸÇŸÑ
        label = ctk.CTkLabel(
            parent,
            text=label_text,
            font=ctk.CTkFont(family="Helvetica", size=label_font_size, weight="bold"),
            text_color=self._get_color('text_primary'),
            anchor="w"
        )
        label.pack(fill="x", pady=(0, padding_bottom))

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≠ŸÇŸÑ
        field_container = ctk.CTkFrame(
            parent,
            fg_color=self._get_color('input_bg'),
            corner_radius=10,
            border_width=1,
            border_color=self._get_color('input_border')
        )
        field_container.pack(fill="x", pady=(0, field_padding))

        # ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿØÿßÿÆŸÑŸä
        field_frame = ctk.CTkFrame(field_container, fg_color="transparent")
        field_frame.pack(fill="x", padx=10, pady=6)

        # ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
        icon_label = ctk.CTkLabel(
            field_frame,
            text=icon,
            font=ctk.CTkFont(size=15),
            text_color=self._get_color('text_secondary'),
            width=28
        )
        icon_label.pack(side="left", padx=(0, 6))

        # ÿ≠ŸÇŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
        if field_name == "username":
            self.entry_username = ctk.CTkEntry(
                field_frame,
                placeholder_text=placeholder,
                height=field_height,
                font=ctk.CTkFont(family="Helvetica", size=13),
                fg_color=self._get_color('surface'),
                border_width=0,
                text_color=self._get_color('text_primary'),
                placeholder_text_color=self._get_color('text_secondary')
            )
            self.entry_username.pack(side="left", fill="x", expand=True)

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
            self.themed_window.apply_to_widget(self.entry_username, 'entry')

            # ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
            self.entry_username.bind("<Return>", lambda e: self.entry_password.focus_set())
            self.entry_username.bind("<FocusIn>", lambda e: self._on_field_focus(field_container, True))
            self.entry_username.bind("<FocusOut>", lambda e: self._on_field_focus(field_container, False))
            self.entry_username.bind("<KeyRelease>", lambda e: self._validate_username())
            self.entry_username.bind("<Button-1>", lambda e: self._update_activity())

            # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑÿÆÿ∑ÿ£
            self.username_error = ctk.CTkLabel(
                parent,
                text="",
                font=ctk.CTkFont(size=10),
                text_color=self._get_color('danger'),
                anchor="w"
            )

    def _create_workarea_password_field(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ≠ÿ≥ŸÜÿ©
        label_font_size = 14
        field_height = 40
        button_size = 36
        padding_bottom = 8
        field_padding = 12

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑÿ≠ŸÇŸÑ
        self.password_label = ctk.CTkLabel(
            parent,
            text=self.lang_manager.get("password", "Password"),
            font=ctk.CTkFont(family="Helvetica", size=label_font_size, weight="bold"),
            text_color=self._get_color('text_primary'),
            anchor="w"
        )
        self.password_label.pack(fill="x", pady=(0, padding_bottom))

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≠ŸÇŸÑ
        field_container = ctk.CTkFrame(
            parent,
            fg_color=self._get_color('input_bg'),
            corner_radius=12,
            border_width=2,
            border_color=self._get_color('input_border')
        )
        field_container.pack(fill="x", pady=(0, field_padding))

        field_frame = ctk.CTkFrame(field_container, fg_color="transparent")
        field_frame.pack(fill="x", padx=12, pady=8)

        # ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
        lock_icon = ctk.CTkLabel(
            field_frame,
            text="üîí",
            font=ctk.CTkFont(size=16),
            text_color=self._get_color('text_secondary'),
            width=30
        )
        lock_icon.pack(side="left", padx=(0, 8))

        # ÿ≠ŸÇŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        self.entry_password = ctk.CTkEntry(
            field_frame,
            placeholder_text=self.lang_manager.get("enter_password", "Enter your password"),
            show="‚Ä¢",
            height=field_height,
            font=ctk.CTkFont(family="Helvetica", size=14),
            fg_color=self._get_color('surface'),
            border_width=0,
            text_color=self._get_color('text_primary'),
            placeholder_text_color=self._get_color('text_secondary')
        )
        self.entry_password.pack(side="left", fill="x", expand=True)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.entry_password, 'entry')

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
        controls_frame = ctk.CTkFrame(field_frame, fg_color="transparent")
        controls_frame.pack(side="left", padx=(8, 0))

        # ÿ≤ÿ± ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ°
        self.toggle_pass_btn = ctk.CTkButton(
            controls_frame,
            text="üëÅ",
            width=button_size,
            height=button_size,
            fg_color=self._get_color('input_bg'),
            hover_color=self._get_color('border'),
            text_color=self._get_color('text_secondary'),
            command=self._toggle_password_visibility,
            corner_radius=8,
            border_width=1,
            border_color=self._get_color('input_border'),
            font=ctk.CTkFont(size=14)
        )
        self.toggle_pass_btn.pack(side="left", padx=(0, 4))

        # ÿ≤ÿ± ÿ™ŸàŸÑŸäÿØ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±
        self.gen_pass_btn = ctk.CTkButton(
            controls_frame,
            text="üîë",
            width=button_size,
            height=button_size,
            fg_color=self._get_color('input_bg'),
            hover_color=self._get_color('border'),
            text_color=self._get_color('text_secondary'),
            command=self._generate_strong_password,
            corner_radius=8,
            border_width=1,
            border_color=self._get_color('input_border'),
            font=ctk.CTkFont(size=14)
        )
        self.gen_pass_btn.pack(side="left")

        # ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        self.entry_password.bind("<Return>", lambda e: self._login())
        self.entry_password.bind("<FocusIn>", lambda e: self._on_field_focus(field_container, True))
        self.entry_password.bind("<FocusOut>", lambda e: self._on_field_focus(field_container, False))
        self.entry_password.bind("<KeyRelease>", self._update_password_strength)
        self.entry_password.bind("<Button-1>", lambda e: self._update_activity())

        # ÿ™ÿ≠ÿ∞Ÿäÿ± Caps Lock
        self.caps_lock_warning = ctk.CTkLabel(
            parent,
            text="‚ö†Ô∏è " + self.lang_manager.get("caps_lock_on", "Caps Lock is ON"),
            font=ctk.CTkFont(size=11),
            text_color="#F59E0B"
        )

        # ŸÖÿ§ÿ¥ÿ± ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        self._create_workarea_password_strength(parent)

    def _create_workarea_password_strength(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ§ÿ¥ÿ± ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        container_height = 45
        bar_height = 8
        padding_y = (8, 0)

        self.strength_container = ctk.CTkFrame(parent, fg_color="transparent", height=container_height)
        self.strength_container.pack(fill="x", pady=padding_y)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
        strength_bg = ctk.CTkFrame(
            self.strength_container,
            height=bar_height,
            corner_radius=bar_height//2,
            fg_color=self._get_color('input_border')
        )
        strength_bg.pack(fill="x", pady=(0, 5))

        self.strength_bar = ctk.CTkProgressBar(
            strength_bg,
            height=bar_height,
            corner_radius=bar_height//2,
            progress_color=self._get_color('secondary'),
            fg_color=self._get_color('input_border')
        )
        self.strength_bar.pack(fill="both", expand=True)
        self.strength_bar.set(0)

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑŸÇŸàÿ© ŸàÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™
        info_frame = ctk.CTkFrame(self.strength_container, fg_color="transparent")
        info_frame.pack(fill="x")

        self.strength_label = ctk.CTkLabel(
            info_frame,
            text="",
            font=ctk.CTkFont(family="Helvetica", size=12, weight="bold")
        )
        self.strength_label.pack(side="left")

        self.requirements_text = ctk.CTkLabel(
            info_frame,
            text="",
            font=ctk.CTkFont(size=11),
            text_color=self._get_color('text_secondary')
        )
        self.requirements_text.pack(side="right")

    def _create_workarea_2fa_field(self, parent):
        """Create 2FA field for workarea layout"""
        self.twofa_frame = ctk.CTkFrame(parent, fg_color="transparent")

        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ
        label_font_size = 14
        field_height = 40
        icon_font_size = 16
        entry_font_size = 14
        padding_bottom = 8

        # 2FA label
        self.twofa_label = ctk.CTkLabel(
            self.twofa_frame,
            text=self.lang_manager.get("2fa_code", "2FA Code"),
            font=ctk.CTkFont(family="Helvetica", size=label_font_size, weight="bold"),
            text_color=self._get_color('text_primary'),
            anchor="w"
        )
        self.twofa_label.pack(fill="x", pady=(0, padding_bottom))

        # 2FA entry container
        field_container = ctk.CTkFrame(
            self.twofa_frame,
            fg_color=self._get_color('input_bg'),
            corner_radius=12,
            border_width=2,
            border_color=self._get_color('input_border')
        )
        field_container.pack(fill="x")

        field_frame = ctk.CTkFrame(field_container, fg_color="transparent")
        field_frame.pack(fill="x", padx=12, pady=8)

        # 2FA icon
        icon_label = ctk.CTkLabel(
            field_frame,
            text="üîê",
            font=ctk.CTkFont(size=icon_font_size),
            text_color=self._get_color('text_secondary'),
            width=30
        )
        icon_label.pack(side="left", padx=(0, 8))

        # 2FA entry
        self.entry_2fa = ctk.CTkEntry(
            field_frame,
            placeholder_text=self.lang_manager.get("enter_2fa_code", "Enter 6-digit code"),
            height=field_height,
            font=ctk.CTkFont(family="Helvetica", size=entry_font_size),
            fg_color=self._get_color('surface'),
            border_width=0,
            text_color=self._get_color('text_primary'),
            placeholder_text_color=self._get_color('text_secondary')
        )
        self.entry_2fa.pack(side="left", fill="x", expand=True)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.entry_2fa, 'entry')

        # Initially hidden
        self.twofa_frame.pack_forget()

    def _create_workarea_options(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿÆŸäÿßÿ±ÿßÿ™ ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        options_frame = ctk.CTkFrame(parent, fg_color="transparent")
        options_frame.pack(fill="x", pady=(10, 0))

        # ÿÆŸäÿßÿ± ÿ™ÿ∞ŸÉÿ±ŸÜŸä
        self.remember_check = ctk.CTkCheckBox(
            options_frame,
            text=self.lang_manager.get("remember_me", "Remember me"),
            variable=self.remember_me,
            font=ctk.CTkFont(family="Helvetica", size=13),
            text_color=self._get_color('text_primary'),
            fg_color=self._get_color('primary'),
            hover_color=self._get_color('primary_hover'),
            border_color=self._get_color('input_border'),
            border_width=2,
            corner_radius=6,
            command=self._update_activity
        )
        self.remember_check.pack(side="left")

        # ÿ±ÿßÿ®ÿ∑ ŸÜÿ≥Ÿäÿ™ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        self.forgot_btn = ctk.CTkButton(
            options_frame,
            text=self.lang_manager.get("forgot_password", "Forgot password?"),
            font=ctk.CTkFont(family="Helvetica", size=12, weight="normal"),
            fg_color="transparent",
            hover_color=self._get_color('input_bg'),
            text_color=self._get_color('primary'),
            command=self._show_forgot_password
        )
        self.forgot_btn.pack(side="right")

    def _create_workarea_buttons(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        button_frame = ctk.CTkFrame(parent, fg_color="transparent")
        button_frame.pack(fill="x", pady=(20, 15))

        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ≠ÿ≥ŸÜÿ©
        button_height = 45
        button_font_size = 15
        button_spacing = 10

        # ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
        self.btn_login = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("login", "Sign In"),
            command=self._login,
            height=button_height,
            font=ctk.CTkFont(family="Helvetica", size=button_font_size, weight="bold"),
            corner_radius=12,
            fg_color=self._get_color('primary'),
            hover_color=self._get_color('primary_hover'),
            text_color="white"
        )
        self.btn_login.pack(fill="x", pady=(0, button_spacing))

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.btn_login, 'button')

        # ÿ≤ÿ± ÿßŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ´ÿßŸÜŸàŸä
        self.btn_cancel = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self._on_close,
            height=button_height,
            font=ctk.CTkFont(family="Helvetica", size=button_font_size, weight="bold"),
            corner_radius=12,
            fg_color=self._get_color('input_bg'),
            hover_color=("#FFE4E6", "#4B5563"),
            text_color=self._get_color('danger'),
            border_width=2,
            border_color=self._get_color('danger')
        )
        self.btn_cancel.pack(fill="x")

    def _create_compact_password_field(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ŸÇŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑"""
        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        label_font_size = 13
        field_height = 36
        button_size = 32
        padding_bottom = 5
        field_padding = 8

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑÿ≠ŸÇŸÑ
        self.password_label = ctk.CTkLabel(
            parent,
            text=self.lang_manager.get("password", "Password"),
            font=ctk.CTkFont(family="Helvetica", size=label_font_size, weight="bold"),
            text_color=self._get_color('text_primary'),
            anchor="w"
        )
        self.password_label.pack(fill="x", pady=(0, padding_bottom))

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≠ŸÇŸÑ
        field_container = ctk.CTkFrame(
            parent,
            fg_color=self._get_color('input_bg'),
            corner_radius=10,
            border_width=1,
            border_color=self._get_color('input_border')
        )
        field_container.pack(fill="x", pady=(0, field_padding))

        field_frame = ctk.CTkFrame(field_container, fg_color="transparent")
        field_frame.pack(fill="x", padx=10, pady=6)

        # ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
        lock_icon = ctk.CTkLabel(
            field_frame,
            text="üîí",
            font=ctk.CTkFont(size=15),
            text_color=self._get_color('text_secondary'),
            width=28
        )
        lock_icon.pack(side="left", padx=(0, 6))

        # ÿ≠ŸÇŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        self.entry_password = ctk.CTkEntry(
            field_frame,
            placeholder_text=self.lang_manager.get("enter_password", "Enter your password"),
            show="‚Ä¢",
            height=field_height,
            font=ctk.CTkFont(family="Helvetica", size=13),
            fg_color=self._get_color('surface'),
            border_width=0,
            text_color=self._get_color('text_primary'),
            placeholder_text_color=self._get_color('text_secondary')
        )
        self.entry_password.pack(side="left", fill="x", expand=True)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.entry_password, 'entry')

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        controls_frame = ctk.CTkFrame(field_frame, fg_color="transparent")
        controls_frame.pack(side="left", padx=(6, 0))

        # ÿ≤ÿ± ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ŸÖÿ∂ÿ∫Ÿàÿ∑
        self.toggle_pass_btn = ctk.CTkButton(
            controls_frame,
            text="üëÅ",
            width=button_size,
            height=button_size,
            fg_color=self._get_color('input_bg'),
            hover_color=self._get_color('border'),
            text_color=self._get_color('text_secondary'),
            command=self._toggle_password_visibility,
            corner_radius=8,
            border_width=1,
            border_color=self._get_color('input_border'),
            font=ctk.CTkFont(size=13)
        )
        self.toggle_pass_btn.pack(side="left", padx=(0, 3))

        # ÿ≤ÿ± ÿ™ŸàŸÑŸäÿØ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑
        self.gen_pass_btn = ctk.CTkButton(
            controls_frame,
            text="üîë",
            width=button_size,
            height=button_size,
            fg_color=self._get_color('input_bg'),
            hover_color=self._get_color('border'),
            text_color=self._get_color('text_secondary'),
            command=self._generate_strong_password,
            corner_radius=8,
            border_width=1,
            border_color=self._get_color('input_border'),
            font=ctk.CTkFont(size=13)
        )
        self.gen_pass_btn.pack(side="left")

        # ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        self.entry_password.bind("<Return>", lambda e: self._login())
        self.entry_password.bind("<FocusIn>", lambda e: self._on_field_focus(field_container, True))
        self.entry_password.bind("<FocusOut>", lambda e: self._on_field_focus(field_container, False))
        self.entry_password.bind("<KeyRelease>", self._update_password_strength)
        self.entry_password.bind("<Button-1>", lambda e: self._update_activity())

        # ÿ™ÿ≠ÿ∞Ÿäÿ± Caps Lock ŸÖÿ∂ÿ∫Ÿàÿ∑
        self.caps_lock_warning = ctk.CTkLabel(
            parent,
            text="‚ö†Ô∏è " + self.lang_manager.get("caps_lock_on", "Caps Lock is ON"),
            font=ctk.CTkFont(size=10),
            text_color="#F59E0B"
        )

        # ŸÖÿ§ÿ¥ÿ± ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
        self._create_compact_password_strength(parent)

    def _create_compact_password_strength(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ§ÿ¥ÿ± ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑"""
        container_height = 40
        bar_height = 6
        padding_y = (5, 0)

        self.strength_container = ctk.CTkFrame(parent, fg_color="transparent", height=container_height)
        self.strength_container.pack(fill="x", pady=padding_y)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
        strength_bg = ctk.CTkFrame(
            self.strength_container,
            height=bar_height,
            corner_radius=bar_height//2,
            fg_color=self._get_color('input_border')
        )
        strength_bg.pack(fill="x", pady=(0, 4))

        self.strength_bar = ctk.CTkProgressBar(
            strength_bg,
            height=bar_height,
            corner_radius=bar_height//2,
            progress_color=self._get_color('secondary'),
            fg_color=self._get_color('input_border')
        )
        self.strength_bar.pack(fill="both", expand=True)
        self.strength_bar.set(0)

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑŸÇŸàÿ© ŸàÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        info_frame = ctk.CTkFrame(self.strength_container, fg_color="transparent")
        info_frame.pack(fill="x")

        self.strength_label = ctk.CTkLabel(
            info_frame,
            text="",
            font=ctk.CTkFont(family="Helvetica", size=11, weight="bold")
        )
        self.strength_label.pack(side="left")

        self.requirements_text = ctk.CTkLabel(
            info_frame,
            text="",
            font=ctk.CTkFont(size=10),
            text_color=self._get_color('text_secondary')
        )
        self.requirements_text.pack(side="right")

    def _create_compact_2fa_field(self, parent):
        """Create compact 2FA field"""
        self.twofa_frame = ctk.CTkFrame(parent, fg_color="transparent")

        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        label_font_size = 13
        field_height = 36
        icon_font_size = 15
        entry_font_size = 13
        padding_bottom = 5

        # 2FA label
        self.twofa_label = ctk.CTkLabel(
            self.twofa_frame,
            text=self.lang_manager.get("2fa_code", "2FA Code"),
            font=ctk.CTkFont(family="Helvetica", size=label_font_size, weight="bold"),
            text_color=self._get_color('text_primary'),
            anchor="w"
        )
        self.twofa_label.pack(fill="x", pady=(0, padding_bottom))

        # 2FA entry container
        field_container = ctk.CTkFrame(
            self.twofa_frame,
            fg_color=self._get_color('input_bg'),
            corner_radius=10,
            border_width=1,
            border_color=self._get_color('input_border')
        )
        field_container.pack(fill="x")

        field_frame = ctk.CTkFrame(field_container, fg_color="transparent")
        field_frame.pack(fill="x", padx=10, pady=6)

        # 2FA icon
        icon_label = ctk.CTkLabel(
            field_frame,
            text="üîê",
            font=ctk.CTkFont(size=icon_font_size),
            text_color=self._get_color('text_secondary'),
            width=28
        )
        icon_label.pack(side="left", padx=(0, 6))

        # 2FA entry
        self.entry_2fa = ctk.CTkEntry(
            field_frame,
            placeholder_text=self.lang_manager.get("enter_2fa_code", "Enter 6-digit code"),
            height=field_height,
            font=ctk.CTkFont(family="Helvetica", size=entry_font_size),
            fg_color=self._get_color('surface'),
            border_width=0,
            text_color=self._get_color('text_primary'),
            placeholder_text_color=self._get_color('text_secondary')
        )
        self.entry_2fa.pack(side="left", fill="x", expand=True)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.entry_2fa, 'entry')

        # Initially hidden
        self.twofa_frame.pack_forget()

    def _create_compact_options(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿÆŸäÿßÿ±ÿßÿ™ ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©"""
        options_frame = ctk.CTkFrame(parent, fg_color="transparent")
        options_frame.pack(fill="x", pady=(8, 0))

        # ÿÆŸäÿßÿ± ÿ™ÿ∞ŸÉÿ±ŸÜŸä ŸÖÿ∂ÿ∫Ÿàÿ∑
        self.remember_check = ctk.CTkCheckBox(
            options_frame,
            text=self.lang_manager.get("remember_me", "Remember me"),
            variable=self.remember_me,
            font=ctk.CTkFont(family="Helvetica", size=12),
            text_color=self._get_color('text_primary'),
            fg_color=self._get_color('primary'),
            hover_color=self._get_color('primary_hover'),
            border_color=self._get_color('input_border'),
            border_width=1,
            corner_radius=5,
            command=self._update_activity
        )
        self.remember_check.pack(side="left")

        # ÿ±ÿßÿ®ÿ∑ ŸÜÿ≥Ÿäÿ™ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑
        self.forgot_btn = ctk.CTkButton(
            options_frame,
            text=self.lang_manager.get("forgot_password", "Forgot password?"),
            font=ctk.CTkFont(family="Helvetica", size=11, weight="normal"),
            fg_color="transparent",
            hover_color=self._get_color('input_bg'),
            text_color=self._get_color('primary'),
            command=self._show_forgot_password
        )
        self.forgot_btn.pack(side="right")

    def _create_compact_buttons(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©"""
        button_frame = ctk.CTkFrame(parent, fg_color="transparent")
        button_frame.pack(fill="x", pady=(15, 12))

        # ÿ£ÿ≠ÿ¨ÿßŸÖ ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        button_height = 40
        button_font_size = 14
        button_spacing = 8

        # ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
        self.btn_login = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("login", "Sign In"),
            command=self._login,
            height=button_height,
            font=ctk.CTkFont(family="Helvetica", size=button_font_size, weight="bold"),
            corner_radius=10,
            fg_color=self._get_color('primary'),
            hover_color=self._get_color('primary_hover'),
            text_color="white"
        )
        self.btn_login.pack(fill="x", pady=(0, button_spacing))

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.btn_login, 'button')

        # ÿ≤ÿ± ÿßŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ´ÿßŸÜŸàŸä
        self.btn_cancel = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self._on_close,
            height=button_height,
            font=ctk.CTkFont(family="Helvetica", size=button_font_size, weight="bold"),
            corner_radius=10,
            fg_color=self._get_color('input_bg'),
            hover_color=("#FFE4E6", "#4B5563"),
            text_color=self._get_color('danger'),
            border_width=1,
            border_color=self._get_color('danger')
        )
        self.btn_cancel.pack(fill="x")

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        self.themed_window.apply_to_widget(self.btn_cancel, 'button')

        # SSO buttons (if configured) - ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        if LOGIN_CONFIG.get("sso", {}).get("enabled", False):
            self._create_compact_sso_buttons(button_frame)

    def _create_compact_sso_buttons(self, parent):
        """Create compact SSO login buttons"""
        sso_frame = ctk.CTkFrame(parent, fg_color="transparent")
        sso_frame.pack(fill="x", pady=(10, 0))

        # Divider ŸÖÿ∂ÿ∫Ÿàÿ∑
        divider_frame = ctk.CTkFrame(sso_frame, fg_color="transparent")
        divider_frame.pack(fill="x", pady=(0, 8))

        line_left = ctk.CTkFrame(divider_frame, height=1, fg_color=self._get_color('input_border'))
        line_left.pack(side="left", fill="x", expand=True)

        ctk.CTkLabel(
            divider_frame,
            text=self.lang_manager.get("or_login_with", "Or login with"),
            font=ctk.CTkFont(size=11),
            text_color=self._get_color('text_secondary')
        ).pack(side="left", padx=8)

        line_right = ctk.CTkFrame(divider_frame, height=1, fg_color=self._get_color('input_border'))
        line_right.pack(side="left", fill="x", expand=True)

        # SSO buttons ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        sso_providers = LOGIN_CONFIG.get("sso", {}).get("providers", [])
        sso_button_height = 35

        for provider in sso_providers:
            btn = ctk.CTkButton(
                sso_frame,
                text=f"{provider.get('icon', 'üîó')} {provider.get('name', 'SSO')}",
                command=lambda p=provider: self._sso_login(p),
                height=sso_button_height,
                fg_color=self._get_color('input_bg'),
                hover_color=self._get_color('input_border'),
                text_color=self._get_color('text_primary'),
                border_width=1,
                border_color=self._get_color('input_border'),
                font=ctk.CTkFont(size=12),
                corner_radius=8
            )
            btn.pack(fill="x", pady=3)

    def _create_compact_status_area(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÜÿ∑ŸÇÿ© ÿ≠ÿßŸÑÿ© ŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©"""
        container_height = 45
        status_font_size = 12
        security_font_size = 10
        padding_y = (5, 8)

        self.status_container = ctk.CTkFrame(parent, fg_color="transparent", height=container_height)
        self.status_container.pack(fill="x", pady=padding_y)
        self.status_container.pack_propagate(False)

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        self.status_label = ctk.CTkLabel(
            self.status_container,
            text="",
            font=ctk.CTkFont(family="Helvetica", size=status_font_size),
            wraplength=340
        )
        self.status_label.pack(expand=True)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
        progress_height = 3
        self.progress = ctk.CTkProgressBar(
            parent,
            mode="indeterminate",
            height=progress_height,
            corner_radius=progress_height//2,
            progress_color=self._get_color('primary'),
            fg_color=self._get_color('input_border')
        )

        # Security status ŸÖÿ∂ÿ∫Ÿàÿ∑
        if self.enable_encryption or self.enable_rate_limiting:
            security_frame = ctk.CTkFrame(parent, fg_color="transparent")
            security_frame.pack(fill="x", pady=(3, 0))

            security_items = []
            if self.enable_encryption:
                security_items.append("üîê Encrypted")
            if self.enable_rate_limiting:
                security_items.append("üõ°Ô∏è Protected")

            ctk.CTkLabel(
                security_frame,
                text=" ‚Ä¢ ".join(security_items),
                font=ctk.CTkFont(size=security_font_size),
                text_color=self._get_color('text_secondary')
            ).pack()

    def _create_compact_footer(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ∞ŸäŸäŸÑ ŸÖÿ∂ÿ∫Ÿàÿ∑"""
        # ÿÆÿ∑ ŸÅÿßÿµŸÑ ÿ±ŸÅŸäÿπ
        separator = ctk.CTkFrame(parent, height=1, fg_color=self._get_color('input_border'))
        separator.pack(fill="x", pady=(8, 10))

        footer_frame = ctk.CTkFrame(parent, fg_color="transparent")
        footer_frame.pack(fill="x")

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        controls_frame = ctk.CTkFrame(footer_frame, fg_color="transparent")
        controls_frame.pack(pady=(0, 8))

        button_configs = [
            ("üåê", "English" if self.lang_manager.current_lang == "ar" else "ÿπÿ±ÿ®Ÿä", self._toggle_language),
            ("üé®", self.lang_manager.get("theme", "Theme"), self._toggle_theme),
            ("üí¨", self.lang_manager.get("help", "Help"), self._show_help)
        ]

        # ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ© ŸàÿßŸÑŸàÿ∂ÿπ ŸÅÿßÿ™ÿ≠
        if COLOR_PALETTES_AVAILABLE and self.theme_manager.get_current_appearance_mode() == "light":
            button_configs.insert(2, ("üé®", self.lang_manager.get("palette", "Colors"), self._show_palette_menu))

        # ÿ£ÿ≠ÿ¨ÿßŸÖ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        button_width = 80
        button_height = 28
        button_font_size = 10

        for i, (icon, text, command) in enumerate(button_configs):
            btn = ctk.CTkButton(
                controls_frame,
                text=f"{icon} {text}",
                width=button_width,
                height=button_height,
                command=command,
                font=ctk.CTkFont(family="Helvetica", size=button_font_size),
                corner_radius=6,
                fg_color=self._get_color('input_bg'),
                hover_color=self._get_color('input_border'),
                text_color=self._get_color('text_secondary'),
                border_width=1,
                border_color=self._get_color('input_border')
            )
            btn.pack(side="left", padx=3)

            if i == 0:
                self.btn_language = btn
            elif i == 1:
                self.btn_theme = btn
            elif text == self.lang_manager.get("palette", "Colors"):
                self.btn_palette = btn
            elif text == self.lang_manager.get("help", "Help"):
                self.btn_help = btn

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ•ÿµÿØÿßÿ± ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑ÿ©
        version_label = ctk.CTkLabel(
            footer_frame,
            text="FTS Sales Manager v2.0 ¬© 2024",
            font=ctk.CTkFont(family="Helvetica", size=9),
            text_color=self._get_color('text_secondary')
        )
        version_label.pack(pady=(4, 0))

    def _create_workarea_sso_buttons(self, parent):
        """Create SSO login buttons for workarea layout"""
        sso_frame = ctk.CTkFrame(parent, fg_color="transparent")
        sso_frame.pack(fill="x", pady=(15, 0))

        # Divider
        divider_frame = ctk.CTkFrame(sso_frame, fg_color="transparent")
        divider_frame.pack(fill="x", pady=(0, 10))

        line_left = ctk.CTkFrame(divider_frame, height=2, fg_color=self._get_color('input_border'))
        line_left.pack(side="left", fill="x", expand=True)

        ctk.CTkLabel(
            divider_frame,
            text=self.lang_manager.get("or_login_with", "Or login with"),
            font=ctk.CTkFont(size=12),
            text_color=self._get_color('text_secondary')
        ).pack(side="left", padx=12)

        line_right = ctk.CTkFrame(divider_frame, height=2, fg_color=self._get_color('input_border'))
        line_right.pack(side="left", fill="x", expand=True)

        # SSO buttons
        sso_providers = LOGIN_CONFIG.get("sso", {}).get("providers", [])
        sso_button_height = 40

        for provider in sso_providers:
            btn = ctk.CTkButton(
                sso_frame,
                text=f"{provider.get('icon', 'üîó')} {provider.get('name', 'SSO')}",
                command=lambda p=provider: self._sso_login(p),
                height=sso_button_height,
                fg_color=self._get_color('input_bg'),
                hover_color=self._get_color('input_border'),
                text_color=self._get_color('text_primary'),
                border_width=2,
                border_color=self._get_color('input_border'),
                font=ctk.CTkFont(size=13),
                corner_radius=10
            )
            btn.pack(fill="x", pady=4)

    def _create_workarea_status_area(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÜÿ∑ŸÇÿ© ÿ≠ÿßŸÑÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        container_height = 50
        status_font_size = 13
        security_font_size = 11
        padding_y = (5, 10)

        self.status_container = ctk.CTkFrame(parent, fg_color="transparent", height=container_height)
        self.status_container.pack(fill="x", pady=padding_y)
        self.status_container.pack_propagate(False)

        # ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑÿ≠ÿßŸÑÿ©
        self.status_label = ctk.CTkLabel(
            self.status_container,
            text="",
            font=ctk.CTkFont(family="Helvetica", size=status_font_size),
            wraplength=350
        )
        self.status_label.pack(expand=True)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
        progress_height = 4
        self.progress = ctk.CTkProgressBar(
            parent,
            mode="indeterminate",
            height=progress_height,
            corner_radius=progress_height//2,
            progress_color=self._get_color('primary'),
            fg_color=self._get_color('input_border')
        )

        # Security status
        if self.enable_encryption or self.enable_rate_limiting:
            security_frame = ctk.CTkFrame(parent, fg_color="transparent")
            security_frame.pack(fill="x", pady=(5, 0))

            security_items = []
            if self.enable_encryption:
                security_items.append("üîê Encrypted")
            if self.enable_rate_limiting:
                security_items.append("üõ°Ô∏è Protected")

            ctk.CTkLabel(
                security_frame,
                text=" ‚Ä¢ ".join(security_items),
                font=ctk.CTkFont(size=security_font_size),
                text_color=self._get_color('text_secondary')
            ).pack()

    def _create_workarea_footer(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ∞ŸäŸäŸÑ ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        # ÿÆÿ∑ ŸÅÿßÿµŸÑ
        separator = ctk.CTkFrame(parent, height=2, fg_color=self._get_color('input_border'))
        separator.pack(fill="x", pady=(15, 12))

        footer_frame = ctk.CTkFrame(parent, fg_color="transparent")
        footer_frame.pack(fill="x")

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
        controls_frame = ctk.CTkFrame(footer_frame, fg_color="transparent")
        controls_frame.pack(pady=(0, 10))

        button_configs = [
            ("üåê", "English" if self.lang_manager.current_lang == "ar" else "ÿπÿ±ÿ®Ÿä", self._toggle_language),
            ("üé®", self.lang_manager.get("theme", "Theme"), self._toggle_theme),
            ("üí¨", self.lang_manager.get("help", "Help"), self._show_help)
        ]

        # ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ© ŸàÿßŸÑŸàÿ∂ÿπ ŸÅÿßÿ™ÿ≠
        if COLOR_PALETTES_AVAILABLE and self.theme_manager.get_current_appearance_mode() == "light":
            button_configs.insert(2, ("üé®", self.lang_manager.get("palette", "Colors"), self._show_palette_menu))

        # ÿ£ÿ≠ÿ¨ÿßŸÖ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÖÿ≠ÿ≥ŸÜÿ©
        button_width = 90
        button_height = 32
        button_font_size = 11

        for i, (icon, text, command) in enumerate(button_configs):
            btn = ctk.CTkButton(
                controls_frame,
                text=f"{icon} {text}",
                width=button_width,
                height=button_height,
                command=command,
                font=ctk.CTkFont(family="Helvetica", size=button_font_size),
                corner_radius=8,
                fg_color=self._get_color('input_bg'),
                hover_color=self._get_color('input_border'),
                text_color=self._get_color('text_secondary'),
                border_width=1,
                border_color=self._get_color('input_border')
            )
            btn.pack(side="left", padx=4)

            if i == 0:
                self.btn_language = btn
            elif i == 1:
                self.btn_theme = btn
            elif text == self.lang_manager.get("palette", "Colors"):
                self.btn_palette = btn
            elif text == self.lang_manager.get("help", "Help"):
                self.btn_help = btn

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ•ÿµÿØÿßÿ±
        version_label = ctk.CTkLabel(
            footer_frame,
            text="FTS Sales Manager v2.0 ¬© 2024",
            font=ctk.CTkFont(family="Helvetica", size=10),
            text_color=self._get_color('text_secondary')
        )
        version_label.pack(pady=(5, 0))

    def _show_palette_menu(self):
        """ÿπÿ±ÿ∂ ŸÇÿßÿ¶ŸÖÿ© ÿßÿÆÿ™Ÿäÿßÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ ŸÖÿ≠ÿ≥ŸÜÿ©"""
        if not COLOR_PALETTES_AVAILABLE:
            return

        # ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ≠ÿ≥ŸÜ
        palette_window_size = "350x450"
        options_height = 250
        title_font = 18
        desc_font = 12
        radio_font = 13
        button_width = 110
        button_height = 36

        # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ŸÅÿ±ÿπŸäÿ© ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÑŸàÿ≠ÿ©
        palette_window = ctk.CTkToplevel(self)
        palette_window.title(self.lang_manager.get("choose_palette", "Choose Color Palette"))
        palette_window.geometry(palette_window_size)
        palette_window.resizable(False, False)

        # ÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        palette_window.transient(self)
        palette_window.grab_set()

        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title = ctk.CTkLabel(
            palette_window,
            text=self.lang_manager.get("select_palette", "Select Color Palette"),
            font=ctk.CTkFont(size=title_font, weight="bold")
        )
        title.pack(pady=(20, 10))

        # ÿßŸÑŸàÿµŸÅ
        desc = ctk.CTkLabel(
            palette_window,
            text=self.lang_manager.get("palette_desc", "Choose your preferred color scheme for light theme"),
            font=ctk.CTkFont(size=desc_font),
            text_color=self._get_color('text_secondary')
        )
        desc.pack(pady=(0, 15))

        # ÿ•ÿ∑ÿßÿ± ŸÑŸÑÿÆŸäÿßÿ±ÿßÿ™
        options_frame = ctk.CTkScrollableFrame(
            palette_window,
            width=300,
            height=options_height
        )
        options_frame.pack(pady=10, padx=20)

        # ŸÇÿßŸÖŸàÿ≥ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑŸÑŸàÿ≠ÿßÿ™
        palette_names = {
            'modern_purple': ('üü£', self.lang_manager.get("purple_modern", "Modern Purple")),
            'modern_blue': ('üîµ', self.lang_manager.get("blue_modern", "Modern Blue")),
            'modern_emerald': ('üü¢', self.lang_manager.get("emerald_modern", "Modern Emerald")),
            'modern_pink': ('ü©∑', self.lang_manager.get("pink_modern", "Modern Pink")),
            'modern_orange': ('üü†', self.lang_manager.get("orange_warm", "Warm Orange")),
            'modern_indigo': ('üü™', self.lang_manager.get("indigo_elegant", "Elegant Indigo")),
            'classic_blue': ('üî∑', self.lang_manager.get("blue_classic", "Classic Blue"))
        }

        # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        current_palette = 'modern_purple'
        if hasattr(self, 'controller') and hasattr(self.controller, 'config_manager'):
            current_palette = self.controller.config_manager.get('light_color_palette', 'modern_purple')

        # ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ™ÿ™ÿ®ÿπ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
        selected_palette = ctk.StringVar(value=current_palette)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ±ÿßÿØŸäŸà
        for palette_key in self._get_available_color_palettes():
            if palette_key in palette_names:
                icon, name = palette_names[palette_key]

                # ÿ•ÿ∑ÿßÿ± ŸÑŸÑÿÆŸäÿßÿ±
                option_frame = ctk.CTkFrame(options_frame, fg_color="transparent")
                option_frame.pack(fill="x", pady=4)

                # ÿ≤ÿ± ÿßŸÑÿ±ÿßÿØŸäŸà
                radio = ctk.CTkRadioButton(
                    option_frame,
                    text=f"{icon} {name}",
                    variable=selected_palette,
                    value=palette_key,
                    font=ctk.CTkFont(size=radio_font),
                    fg_color=get_color_palette(palette_key)['primary']
                )
                radio.pack(side="left", padx=10)

                # ŸÖÿπÿßŸäŸÜÿ© ÿµÿ∫Ÿäÿ±ÿ© ŸÑŸÑÿ£ŸÑŸàÿßŸÜ
                preview_frame = ctk.CTkFrame(option_frame, fg_color="transparent")
                preview_frame.pack(side="right", padx=10)

                colors = get_color_palette(palette_key)
                for color_key in ['primary', 'success', 'danger']:
                    color_box = ctk.CTkFrame(
                        preview_frame,
                        width=18,
                        height=18,
                        corner_radius=4,
                        fg_color=colors[color_key]
                    )
                    color_box.pack(side="left", padx=1)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        button_frame = ctk.CTkFrame(palette_window, fg_color="transparent")
        button_frame.pack(pady=20)

        def apply_palette():
            """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ©"""
            new_palette = selected_palette.get()
            self._save_color_palette_preference(new_palette)

            self._show_status(
                self.lang_manager.get("palette_saved", "Color palette saved. Please reopen the window."),
                "success"
            )

            palette_window.destroy()
            self.after(1500, self._on_close)

        # ÿ£ÿ≤ÿ±ÿßÿ±
        apply_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("apply", "Apply"),
            command=apply_palette,
            width=button_width,
            height=button_height,
            fg_color=self._get_color('primary'),
            hover_color=self._get_color('primary_hover')
        )
        apply_btn.pack(side="left", padx=5)

        # ÿ≤ÿ± ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°
        cancel_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=palette_window.destroy,
            width=button_width,
            height=button_height,
            fg_color="transparent",
            hover_color=self._get_color('input_bg'),
            text_color=self._get_color('text_primary'),
            border_width=1,
            border_color=self._get_color('input_border')
        )
        cancel_btn.pack(side="left", padx=5)

        # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        palette_window.update_idletasks()
        x = (palette_window.winfo_screenwidth() - palette_window.winfo_width()) // 2
        y = (palette_window.winfo_screenheight() - palette_window.winfo_height()) // 2
        palette_window.geometry(f"+{x}+{y}")

    def _on_field_focus(self, field_container, focused):
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸàŸÑ"""
        if focused:
            field_container.configure(
                border_color=self._get_color('input_focus'),
                border_width=3,
                fg_color=self._get_color('surface')
            )
        else:
            field_container.configure(
                border_color=self._get_color('input_border'),
                border_width=2,
                fg_color=self._get_color('input_bg')
            )

    def _validate_username(self) -> bool:
        """Validate username input"""
        username = self.entry_username.get().strip()

        if not username:
            return True

        if InputValidator:
            is_valid, error_msg = InputValidator.validate_username(username)
        else:
            is_valid = len(username) >= 3 and re.match(r'^[a-zA-Z0-9_.-]+$', username)
            error_msg = "" if is_valid else self.lang_manager.get("invalid_username", "Invalid username format")

        if not is_valid:
            self.username_error.configure(text=error_msg)
            self.username_error.pack(anchor="w", pady=(2, 0))
            return False
        else:
            self.username_error.pack_forget()
            return True

    def _update_password_strength(self, event=None):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ§ÿ¥ÿ± ŸÇŸàÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÉÿßŸÖŸÑ"""
        password = self.entry_password.get()

        if not password:
            self.strength_bar.set(0)
            self.strength_label.configure(text="")
            self.requirements_text.configure(text="")
            return

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÇŸàÿ©
        has_length = len(password) >= 8
        has_upper = bool(re.search(r'[A-Z]', password))
        has_lower = bool(re.search(r'[a-z]', password))
        has_digit = bool(re.search(r'\d', password))
        has_special = bool(re.search(r'[!@#$%^&*(),.?":{}|<>]', password))

        score = sum([has_length, has_upper, has_lower, has_digit, has_special])
        progress = score / 5
        self.strength_bar.set(progress)

        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ŸàÿßŸÑŸÑŸàŸÜ
        if score <= 2:
            text = self.lang_manager.get("pwd_weak", "Weak")
            color = self._get_color('danger')
            req_text = "Need more variety"
        elif score <= 3:
            text = self.lang_manager.get("pwd_fair", "Fair")
            color = "#F59E0B"
            req_text = "Add more elements"
        elif score <= 4:
            text = self.lang_manager.get("pwd_good", "Good")
            color = "#10B981"
            req_text = "Almost perfect!"
        else:
            text = self.lang_manager.get("pwd_strong", "Strong")
            color = self._get_color('success')
            req_text = "Perfect ‚úì"

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self.strength_bar.configure(progress_color=color)
        self.strength_label.configure(text=text, text_color=color)
        self.requirements_text.configure(text=req_text)

    def _toggle_password_visibility(self):
        """Toggle password visibility"""
        self._show_password = not self._show_password
        if self._show_password:
            self.entry_password.configure(show="")
            self.toggle_pass_btn.configure(text="üëÅ‚Äçüó®")
        else:
            self.entry_password.configure(show="‚Ä¢")
            self.toggle_pass_btn.configure(text="üëÅ")
        self._update_activity()

    def _generate_strong_password(self):
        """Generate a strong password"""
        import string

        length = 16
        chars = string.ascii_letters + string.digits + string.punctuation

        password = ''.join(secrets.choice(chars) for _ in range(length))

        while not all([
            any(c.isupper() for c in password),
            any(c.islower() for c in password),
            any(c.isdigit() for c in password),
            any(c in string.punctuation for c in password)
        ]):
            password = ''.join(secrets.choice(chars) for _ in range(length))

        self.entry_password.delete(0, "end")
        self.entry_password.insert(0, password)
        self._show_password = True
        self._toggle_password_visibility()
        self._toggle_password_visibility()

        self._update_password_strength()

        self._show_status(
            self.lang_manager.get("password_generated", "Strong password generated"),
            "success"
        )

    def _toggle_language(self):
        """Toggle language"""
        new_lang = "en" if self.lang_manager.current_lang == "ar" else "ar"
        self.lang_manager.set_language(new_lang)

        self._update_ui_texts()

        lang_text = "English" if new_lang == "ar" else "ÿπÿ±ÿ®Ÿä"
        self.btn_language.configure(text=f"üåê {lang_text}")

        self._update_activity()

    def _toggle_theme(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ´ŸäŸÖ ŸÖÿπ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸàÿ≠ÿØ"""
        # ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ
        self.theme_manager.toggle_appearance_mode()
        self._apply_theme()

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ
        self.themed_window.refresh_theme()

        # ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿßŸÑÿ™ÿ∫ŸäŸäÿ±
        current_mode = self.theme_manager.get_current_appearance_mode()
        if current_mode == "dark":
            self._show_status(
                self.lang_manager.get("theme_dark", "Dark theme activated"),
                "info"
            )
        else:
            self._show_status(
                self.lang_manager.get("theme_light", "Light theme activated"),
                "info"
            )

        # ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿπŸÜÿßÿµÿ±
        self._refresh_ui_colors()

        # ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        messagebox.showinfo(
            self.lang_manager.get("theme_change", "Theme Changed"),
            self.lang_manager.get("theme_change_msg", "Please reopen the window to apply the new theme colors.")
        )

        self._update_activity()

    def _refresh_ui_colors(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ±"""
        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        self.themed_window.apply_to_widget(self.btn_login, 'button')
        self.themed_window.apply_to_widget(self.btn_cancel, 'button')

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ŸÇŸàŸÑ
        for widget in [self.entry_username, self.entry_password]:
            self.themed_window.apply_to_widget(widget, 'entry')

        # ÿ™ÿ≠ÿØŸäÿ´ 2FA ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
        if hasattr(self, 'entry_2fa'):
            self.themed_window.apply_to_widget(self.entry_2fa, 'entry')

    def _show_help(self):
        """Show help dialog"""
        help_text = self.lang_manager.get(
            "login_help",
            "Login Help:\n\n"
            "‚Ä¢ Enter your username and password\n"
            "‚Ä¢ Click 'Sign In' or press Enter\n"
            "‚Ä¢ Use 'Remember me' to save your username\n"
            "‚Ä¢ Contact admin if you forgot your password\n\n"
            "Security Tips:\n"
            "‚Ä¢ Use strong passwords (8+ chars, mixed case, numbers, symbols)\n"
            "‚Ä¢ Don't share your credentials\n"
            "‚Ä¢ Log out when done"
        )

        messagebox.showinfo(
            self.lang_manager.get("help", "Help"),
            help_text
        )

    def _show_forgot_password(self):
        """Show forgot password dialog"""
        messagebox.showinfo(
            self.lang_manager.get("forgot_password", "Forgot Password"),
            self.lang_manager.get("forgot_password_msg",
                                 "Please contact your administrator to reset your password.\n\n"
                                 "Or contact Automation Team:\n"
                                 "Email: eladawy522@gmail.com\nPhone: +201068177086")
        )

    @login_error_handler
    def _login(self):
        """Enhanced login handler with security features"""
        self._update_activity()

        username = self.entry_username.get().strip()
        password = self.entry_password.get().strip()

        if not username:
            self._show_status(
                self.lang_manager.get("error_username_required", "Please enter your username"),
                "error"
            )
            self._flash_window()
            self.entry_username.focus_set()
            return

        if not password:
            self._show_status(
                self.lang_manager.get("error_password_required", "Please enter your password"),
                "error"
            )
            self._flash_window()
            self.entry_password.focus_set()
            return

        if not self._validate_username():
            self._flash_window()
            return

        if self.enable_rate_limiting:
            identifier = f"{username}:{self._get_client_identifier()}"
            allowed, message = self.rate_limiter.check_rate_limit(identifier)

            if not allowed:
                self._show_status(message, "error")
                self._flash_window(count=3)
                self._set_form_state(False)
                return

        twofa_code = None
        if self.enable_2fa and hasattr(self, 'entry_2fa'):
            twofa_code = self.entry_2fa.get().strip()

        remember_user = self.remember_me.get()

        self._set_form_state(False)
        self._show_progress()

        result_queue = queue.Queue()

        def login_process():
            try:
                if self.enable_rate_limiting:
                    self.rate_limiter.record_attempt(identifier)

                user_info = None

                if self.validate_credentials:
                    if self.enable_2fa:
                        try:
                            user_info = self.validate_credentials(username, password, twofa_code)
                        except TypeError:
                            user_info = self.validate_credentials(username, password)
                    else:
                        user_info = self.validate_credentials(username, password)

                elif self.user_mgr and hasattr(self.user_mgr, 'authenticate'):
                    user_info = self.user_mgr.authenticate(username, password)
                else:
                    logger.error("No authentication method available")
                    result_queue.put(("error", "Authentication service not available"))
                    return

                if user_info:
                    if self.enable_rate_limiting:
                        self.rate_limiter.clear_attempts(identifier)

                    if remember_user:
                        self._save_credentials(username)
                    else:
                        self._clear_saved_credentials()

                    self._session_token = secrets.token_urlsafe(32)

                    user_info['session_token'] = self._session_token
                    user_info['login_time'] = datetime.now().isoformat()

                    result_queue.put(("success", user_info))
                else:
                    self._login_attempts += 1
                    result_queue.put(("failed", None))

            except Exception as e:
                logger.error(f"Login error: {e}", exc_info=True)
                result_queue.put(("error", str(e)))

        thread = threading.Thread(target=login_process, daemon=True)
        thread.start()

        def check_result():
            try:
                result = result_queue.get_nowait()
                status, data = result

                if status == "success":
                    self._on_login_success(data)
                elif status == "failed":
                    self._on_login_failed()
                elif status == "error":
                    self._on_login_error(data)

            except queue.Empty:
                if not self._closing and self.winfo_exists():
                    self.after(100, check_result)
            except Exception as e:
                logger.error(f"Error checking login result: {e}")
                self._on_login_error(str(e))

        self.after(100, check_result)

    def _on_login_success(self, user_info):
        """Handle successful login"""
        if self._closing or not self.winfo_exists():
            return

        self._hide_progress()

        username = user_info.get('username', 'Unknown')
        logger.info(f"Login successful for user: {username}")

        self._show_status(
            self.lang_manager.get("login_success", "Login successful! Welcome back."),
            "success"
        )

        if WINDOW_MANAGER_AVAILABLE:
            WindowManager.flash_window(self, count=1, interval=200)

        if self.on_login_success:
            self.after(500, lambda: self.on_login_success(user_info))

        self.after(800, self._on_close)

    def _on_login_failed(self):
        """Handle failed login"""
        if self._closing or not self.winfo_exists():
            return

        self._hide_progress()
        self._set_form_state(True)

        self._flash_window(count=2)

        remaining = LoginConstants.MAX_LOGIN_ATTEMPTS - self._login_attempts

        if remaining > 0:
            msg = self.lang_manager.get("invalid_credentials", "Invalid username or password")
            msg += f"\n{remaining} {self.lang_manager.get('attempts_remaining', 'attempts remaining')}"
            self._show_status(msg, "error")

            self.entry_password.delete(0, "end")
            self.entry_password.focus_set()

            if self.enable_2fa and self._login_attempts > 2:
                self.twofa_frame.pack(fill="x", pady=(8, 0))
        else:
            self._show_status(
                self.lang_manager.get("account_locked",
                                    "Too many failed attempts.\nPlease contact administrator."),
                "error"
            )
            self._set_form_state(False)
            self._flash_window(count=5)

    def _on_login_error(self, error_msg):
        """Handle login error"""
        if self._closing or not self.winfo_exists():
            return

        self._hide_progress()
        self._set_form_state(True)

        self._show_status(
            f"{self.lang_manager.get('error', 'Error')}: {error_msg}",
            "error"
        )

        self._flash_window()

    def _get_client_identifier(self) -> str:
        """Get client identifier for rate limiting"""
        return platform.node()

    def _flash_window(self, count: int = 2, interval: int = 300):
        """Flash window for attention"""
        if WINDOW_MANAGER_AVAILABLE:
            try:
                WindowManager.flash_window(self, count=count, interval=self.WINDOW_FLASH_INTERVAL)
            except Exception as e:
                logger.debug(f"Error flashing window: {e}")
                self.bell()
        else:
            self.bell()

    def _show_status(self, message: str, status_type: str = "info"):
        """ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ÿ®ÿ™ÿµŸÖŸäŸÖ ŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖŸàÿ≠ÿØÿ©"""
        colors = {
            "info": self._get_color('primary'),
            "success": self._get_color('success'),
            "error": self._get_color('danger'),
            "warning": "#F59E0B"
        }

        color = colors.get(status_type, colors["info"])

        if hasattr(self, 'status_label') and self.status_label.winfo_exists():
            icons = {
                "info": "‚ÑπÔ∏è",
                "success": "‚úÖ",
                "error": "‚ùå",
                "warning": "‚ö†Ô∏è"
            }
            icon = icons.get(status_type, "")

            display_message = f"{icon} {message}" if icon else message
            self.status_label.configure(text=display_message, text_color=color)

    def _show_progress(self):
        """Show progress bar"""
        if hasattr(self, 'progress') and self.progress.winfo_exists():
            self.status_label.configure(text="")
            self.progress.pack(fill="x", pady=(0, 5))
            self.progress.start()

    def _hide_progress(self):
        """Hide progress bar"""
        try:
            if hasattr(self, 'progress') and self.progress and self.progress.winfo_exists():
                self.progress.stop()
                self.progress.pack_forget()
        except:
            pass

    def _set_form_state(self, enabled: bool):
        """Enable/disable form elements"""
        if self._closing or not self.winfo_exists():
            return

        state = "normal" if enabled else "disabled"

        elements = [
            'entry_username', 'entry_password', 'btn_login', 'btn_cancel',
            'remember_check', 'toggle_pass_btn', 'gen_pass_btn',
            'btn_language', 'btn_theme', 'btn_help', 'forgot_btn',
            'entry_2fa'
        ]

        for element_name in elements:
            if hasattr(self, element_name):
                element = getattr(self, element_name)
                try:
                    if element and element.winfo_exists():
                        element.configure(state=state)
                except:
                    pass

    def _save_credentials(self, username: str):
        """Save login credentials securely"""
        try:
            data = {
                "username": username,
                "remember": True,
                "timestamp": datetime.now().isoformat()
            }

            if self.enable_encryption:
                encrypted_data = self.encryption_manager.encrypt_data(json.dumps(data))
                save_data = {"encrypted": True, "data": encrypted_data}
            else:
                save_data = data

            os.makedirs("data", exist_ok=True)

            with open("data/login_cache.json", "w", encoding="utf-8") as f:
                json.dump(save_data, f, ensure_ascii=False, indent=2)

            logger.debug(f"Saved credentials for user: {username}")

        except Exception as e:
            logger.error(f"Error saving credentials: {e}")

    def _load_saved_credentials(self):
        """Load saved login credentials"""
        try:
            cache_file = "data/login_cache.json"

            if os.path.exists(cache_file):
                with open(cache_file, "r", encoding="utf-8") as f:
                    save_data = json.load(f)

                if save_data.get("encrypted") and self.enable_encryption:
                    decrypted = self.encryption_manager.decrypt_data(save_data["data"])
                    data = json.loads(decrypted)
                else:
                    data = save_data

                if data.get("remember") and data.get("username"):
                    self.entry_username.insert(0, data["username"])
                    self.remember_me.set(True)
                    logger.debug(f"Loaded saved credentials for: {data['username']}")

        except Exception as e:
            logger.error(f"Error loading saved credentials: {e}")

    def _clear_saved_credentials(self):
        """Clear saved login credentials"""
        try:
            cache_file = "data/login_cache.json"

            if os.path.exists(cache_file):
                os.remove(cache_file)
                logger.debug("Cleared saved credentials")

        except Exception as e:
            logger.error(f"Error clearing saved credentials: {e}")

    def _update_ui_texts(self):
        """Update all UI texts"""
        self.title(self.lang_manager.get("login_window_title", "Login - FTS Sales Manager"))

        self.subtitle_label.configure(text=self.lang_manager.get("login_subtitle", "Secure access to your sales dashboard"))

        if hasattr(self, 'username_label'):
            self.username_label.configure(text=self.lang_manager.get("username", "Username"))
        self.password_label.configure(text=self.lang_manager.get("password", "Password"))

        self.entry_username.configure(placeholder_text=self.lang_manager.get("enter_username", "Enter your username"))
        self.entry_password.configure(placeholder_text=self.lang_manager.get("enter_password", "Enter your password"))

        self.remember_check.configure(text=self.lang_manager.get("remember_me", "Remember me"))
        self.forgot_btn.configure(text=self.lang_manager.get("forgot_password", "Forgot password?"))

        self.btn_login.configure(text=self.lang_manager.get("login", "Sign In"))
        self.btn_cancel.configure(text=self.lang_manager.get("cancel", "Cancel"))
        self.btn_theme.configure(text="üé® " + self.lang_manager.get("theme", "Theme"))
        self.btn_help.configure(text="üí¨ " + self.lang_manager.get("help", "Help"))

        self.caps_lock_warning.configure(text="‚ö†Ô∏è " + self.lang_manager.get("caps_lock_on", "Caps Lock is ON"))

        if hasattr(self, 'twofa_label'):
            self.twofa_label.configure(text=self.lang_manager.get("2fa_code", "2FA Code"))
            self.entry_2fa.configure(placeholder_text=self.lang_manager.get("enter_2fa_code", "Enter 6-digit code"))

    def _sso_login(self, provider: dict):
        """Handle SSO login"""
        self._show_status(
            f"Logging in with {provider.get('name', 'SSO')}...",
            "info"
        )
        # Implement SSO logic here

    def _on_close(self):
        """Enhanced close handler"""
        if self._closing:
            return

        self._closing = True
        logger.info("Closing login window")

        try:
            for after_id in self.tk.call('after', 'info'):
                try:
                    self.after_cancel(after_id)
                except:
                    pass
        except:
            pass

        try:
            if hasattr(self, 'progress') and self.progress and self.progress.winfo_exists():
                self.progress.stop()
        except:
            pass

        try:
            if hasattr(self, 'entry_password') and self.entry_password.winfo_exists():
                self.entry_password.delete(0, "end")
        except:
            pass

        try:
            self.quit()
            self.destroy()
        except:
            pass

============================================================
FILE: views\main_window.py
SIZE: 55631 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/main_window.py - ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸàÿßŸÑŸÖŸÇŸÑŸÑÿ©

ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖÿπ ÿØŸÖÿ¨ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© ŸÅŸä ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑
ÿ™ŸÅÿ™ÿ≠ ŸÅŸä Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÉŸàÿ∂ÿπ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÖÿπ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ°
"""

import customtkinter as ctk
import threading
import os
import tkinter as tk
from tkinter import messagebox
from typing import Any, Dict, List
from datetime import datetime
import platform
import weakref
from functools import wraps

# ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
from core.language_manager import LanguageManager
from core.theme_manager import ThemeManager
from core.theme_color_manager import ThemeColorManager, ThemedWindow
from core.logger import logger
from core.permissions import permission_manager
from utils.window_manager import WindowManager

# ÿßŸÑÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
from core.state_manager import StateManager, WindowState
from core.event_system import EventBus
from utils.async_operations import AsyncOperationManager

# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™
from views.components.header import HeaderComponent
from views.components.sidebar import SidebarComponent
from views.components.data_table import DataTableComponent
from views.components.toolbar import ToolbarComponent
from views.components.status_bar import StatusBarComponent
from views.components.menu_bar import MenuBarComponent
from utils.image_utils import setup_window_icon


def safe_operation(func):
    """Decorator ŸÑŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ¢ŸÖŸÜÿ©"""
    @wraps(func)
    def wrapper(self, *args, **kwargs):
        if not self._is_window_valid():
            return None
        try:
            return func(self, *args, **kwargs)
        except Exception as e:
            logger.debug(f"Safe operation error in {func.__name__}: {e}")
            return None
    return wrapper


def error_handler(func):
    """Decorator ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿπÿßŸÖÿ©"""
    @wraps(func)
    def wrapper(self, *args, **kwargs):
        try:
            return func(self, *args, **kwargs)
        except Exception as e:
            logger.error(f"Error in {func.__name__}: {e}")
            return None
    return wrapper


class SafeAfterManager:
    """ŸÖÿØŸäÿ± ÿ¢ŸÖŸÜ ŸÖÿ®ÿ≥ÿ∑ ŸÑŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÖÿ¨ÿØŸàŸÑÿ©"""

    def __init__(self, window):
        self.window_ref = weakref.ref(window)
        self.operations = {}
        self.next_id = 1
        self._shutdown = False

    def schedule(self, delay, operation, *args, **kwargs):
        if self._shutdown:
            return None

        window = self.window_ref()
        if not window or not self._is_window_valid(window):
            return None

        operation_id = f"op_{self.next_id}"
        self.next_id += 1

        def safe_wrapper():
            self.operations.pop(operation_id, None)
            current_window = self.window_ref()
            if not self._shutdown and current_window and self._is_window_valid(current_window):
                try:
                    operation(*args, **kwargs)
                except Exception as e:
                    logger.debug(f"Scheduled operation error: {e}")

        try:
            after_id = window.after(delay, safe_wrapper)
            self.operations[operation_id] = after_id
            return operation_id
        except:
            return None

    def cancel_all(self):
        self._shutdown = True
        window = self.window_ref()
        if window and self._is_window_valid(window):
            for after_id in self.operations.values():
                try:
                    window.after_cancel(after_id)
                except:
                    pass
        self.operations.clear()

    def _is_window_valid(self, window):
        try:
            return window.winfo_exists() and not getattr(window, '_window_destroyed', False)
        except:
            return False


class MainWindow(ctk.CTk):
    """ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑"""

    def __init__(self, lang_manager: LanguageManager, theme_manager: ThemeManager,
                 airtable_model: Any, controller: Any, user_record: Dict[str, Any],
                 parent_window: Any = None):
        super().__init__()

        # ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        self.parent_window = parent_window
        self.lang_manager = lang_manager
        self.theme_manager = theme_manager
        self.airtable_model = airtable_model
        self.controller = controller
        self.user_record = user_record

        # ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ ŸàÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        self.themed_window = ThemedWindow(self, theme_manager)
        self.all_records = []
        self.filtered_records = []
        self.selected_records = []
        self.current_page = 1
        self.records_per_page = 50

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑÿ©
        self._is_fullscreen = False
        self._closing = False
        self._window_destroyed = False

        # ŸÖÿØŸäÿ± ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÖÿ¨ÿØŸàŸÑÿ©
        self.safe_after = SafeAfterManager(self)

        # ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        self._init_systems()

        # ÿ•ÿπÿØÿßÿØ Ÿàÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self._setup_window()
        self._apply_theme()
        self._build_ui()

        # ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸàÿßŸÑÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™
        WindowManager.setup_window(self, parent=self.parent_window, center=False,
                                 modal=False, focus=True, topmost_duration=500,
                                 min_size=(1200, 700), fullscreen_default=True)

        self._setup_shortcuts()

        # ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© Ÿàÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        self.safe_after.schedule(100, self._apply_fullscreen_mode)
        self.safe_after.schedule(500, self._load_data)

        # ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
        self.protocol("WM_DELETE_WINDOW", self._on_close)
        self.bind("<Destroy>", self._on_window_destroy)

    def _init_systems(self):
        """ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©"""
        try:
            self.state_manager = StateManager()
            self.event_bus = EventBus()
            self.async_manager = AsyncOperationManager()

            self.window_state = WindowState()
            self.state_manager.register_state("main_window", self.window_state)

            if self.event_bus:
                self.event_bus.subscribe("data_loaded", self._on_data_loaded_event)
                self.event_bus.subscribe("search_completed", self._on_search_completed_event)
                self.event_bus.subscribe("error_occurred", self._on_error_event)
        except Exception as e:
            logger.warning(f"Failed to initialize some systems: {e}")
            self.state_manager = None
            self.event_bus = None
            self.async_manager = None

    def _on_window_destroy(self, event=None):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        if event and event.widget == self:
            self._window_destroyed = True
            self._closing = True
            if hasattr(self, 'safe_after'):
                self.safe_after.cancel_all()

    def _is_window_valid(self):
        """ŸÅÿ≠ÿµ ÿµÿ≠ÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        try:
            return not self._window_destroyed and not self._closing and self.winfo_exists()
        except:
            self._window_destroyed = True
            return False

    @safe_operation
    def _safe_status_update(self, message, status_type="info"):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ŸÖŸÜ ŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ©"""
        if hasattr(self, 'status_bar') and self.status_bar:
            try:
                self.status_bar.set_status(message, status_type)
            except:
                pass

    @safe_operation
    def _safe_toolbar_update(self, **kwargs):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ŸÖŸÜ ŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ£ÿØŸàÿßÿ™"""
        if hasattr(self, 'toolbar') and self.toolbar:
            for method_name, value in kwargs.items():
                if hasattr(self.toolbar, method_name):
                    try:
                        getattr(self.toolbar, method_name)(value)
                    except:
                        pass

    def _setup_window(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        username = self.user_record.get('fields', {}).get('Username', 'User')
        self.title(f"{self.lang_manager.get('main_window_title', 'FTS Sales Manager')} - {username}")

        self._set_window_icon()

        screen_width = self.winfo_screenwidth()
        screen_height = self.winfo_screenheight()
        self.geometry(f"{screen_width}x{screen_height}+0+0")
        self.minsize(1200, 700)

    def _set_window_icon(self):
        """ÿ™ÿπŸäŸäŸÜ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        icon_paths = [
            "resources/app_icon.ico", "resources/fts_icon.ico", "resources/icon.ico",
            "assets/icon.ico", "resources/app_icon.png", "resources/company_logo.png",
            "resources/icon.png", "assets/icon.png"
        ]
        setup_window_icon(self, icon_paths)

    def _apply_theme(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ"""
        self.themed_window.apply_theme()
        if hasattr(self.theme_manager, 'is_windows7_theme') and self.theme_manager.is_windows7_theme():
            self._apply_windows7_theme()

    def _apply_windows7_theme(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ´ŸäŸÖ Windows 7"""
        try:
            if hasattr(self.theme_manager, 'get_theme_colors'):
                colors = self.theme_manager.get_theme_colors()
                self.configure(fg_color=colors.get("window_bg", self.themed_window.get_color('background')))
            if platform.system() == "Windows":
                self.wm_attributes('-alpha', 0.98)
        except Exception as e:
            logger.debug(f"Error applying Windows 7 theme: {e}")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©"""
        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        self.main_container = ctk.CTkFrame(self, corner_radius=0, fg_color="transparent")
        self.main_container.pack(fill="both", expand=True)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
        self._create_menu_bar()

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™
        self._create_header()
        self._create_separator()
        self._create_content_area()
        self._create_status_bar()

    def _create_menu_bar(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"""
        if hasattr(self.theme_manager, 'is_windows7_theme') and self.theme_manager.is_windows7_theme():
            self._create_windows7_menu_bar()
        else:
            self._create_standard_menu_bar()

    def _create_windows7_menu_bar(self):
        """ÿ¥ÿ±Ÿäÿ∑ ŸÇŸàÿßÿ¶ŸÖ Windows 7"""
        colors = getattr(self.theme_manager, 'get_theme_colors', lambda: {
            "menu_bg": "#F0F0F0", "text_color": "#000000",
            "menu_hover": "#E5F1FB", "menu_border": "#D4D4D4"
        })()

        menubar_frame = ctk.CTkFrame(self, height=28, fg_color=colors.get("menu_bg", "#F0F0F0"), corner_radius=0)
        menubar_frame.pack(fill="x")
        menubar_frame.pack_propagate(False)

        # ÿ•ÿ∂ÿßŸÅÿ© border ŸàŸÇŸàÿßÿ¶ŸÖ
        menu_border = ctk.CTkFrame(menubar_frame, height=1, fg_color=colors.get("menu_border", "#D4D4D4"))
        menu_border.pack(side="bottom", fill="x")

        menu_items = [
            (self.lang_manager.get("menu_file", "File"), self._show_menu),
            (self.lang_manager.get("menu_edit", "Edit"), self._show_menu),
            (self.lang_manager.get("menu_view", "View"), self._show_menu),
            (self.lang_manager.get("menu_tools", "Tools"), self._show_menu),
            (self.lang_manager.get("menu_help", "Help"), self._show_menu)
        ]

        for item_text, command in menu_items:
            btn = ctk.CTkButton(menubar_frame, text=item_text, width=70, height=26, corner_radius=0,
                              fg_color="transparent", text_color=colors.get("text_color", "#000000"),
                              hover_color=colors.get("menu_hover", "#E5F1FB"),
                              font=ctk.CTkFont(family="Segoe UI", size=12), command=command)
            btn.pack(side="left", padx=2, pady=1)

        self.windows7_menubar = menubar_frame

    def _create_standard_menu_bar(self):
        """ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÇŸäÿßÿ≥Ÿä"""
        menu_callbacks = {
            'logout': self._logout, 'export': self._export_data, 'close': self._on_close,
            'add': self._add_record, 'edit': self._edit_record, 'delete': self._delete_record,
            'select_all': self._select_all, 'clear_selection': self._clear_selection,
            'toggle_theme': self._toggle_theme, 'change_language': self._change_language_from_menu,
            'refresh': self._refresh_data, 'fullscreen_changed': self._on_fullscreen_changed,
            'performance_mode': self._on_performance_mode_changed, 'search': self._focus_search,
            'statistics': self._show_statistics, 'reports': self._show_reports,
            'user_management': self._show_placeholder, 'config_editor': self._show_placeholder,
            'clear_cache': self._clear_cache, 'view_logs': self._show_placeholder,
            'shortcuts': self._show_help, 'user_guide': self._show_user_guide,
            'about': self._show_about, 'themes_menu': self._show_placeholder,
        }

        self.menu_bar = MenuBarComponent(parent_window=self, lang_manager=self.lang_manager,
                                       user_record=self.user_record, callbacks=menu_callbacks)

    def _create_header(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸáŸäÿØÿ±"""
        header_frame = ctk.CTkFrame(self.main_container, height=80, corner_radius=0,
                                  fg_color=self.themed_window.get_color('surface'))
        header_frame.pack(fill="x")
        header_frame.pack_propagate(False)

        self.header = HeaderComponent(header_frame, lang_manager=self.lang_manager,
                                    user_record=self.user_record, controller=self.controller,
                                    on_search=self._on_search, on_refresh=self._refresh_data,
                                    on_language_change=self._handle_language_change,
                                    on_theme_change=self._handle_theme_change)
        self.header.pack(fill="both", expand=True, padx=20, pady=10)

        self._add_language_button()

    def _add_language_button(self):
        """ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ÿßŸÑŸÑÿ∫ÿ©"""
        current_lang = self.lang_manager.current_lang
        button_text = "üåê EN" if current_lang == "ar" else "üåê AR"

        parent = getattr(self.header, 'right_frame', self.header)
        self.language_button = ctk.CTkButton(parent, text=button_text, width=100, height=36,
                                           command=self._toggle_language, font=ctk.CTkFont(size=14, weight="bold"),
                                           corner_radius=8, fg_color=("#007ACC", "#0E639C"),
                                           hover_color=("#005A9E", "#1177BB"))
        self.language_button.pack(side="right", padx=10)

    def _create_separator(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿÆÿ∑ ŸÅÿßÿµŸÑ"""
        separator = ctk.CTkFrame(self.main_container, height=2, fg_color=self.themed_window.get_color('border'))
        separator.pack(fill="x")

    def _create_content_area(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ"""
        content_frame = ctk.CTkFrame(self.main_container, corner_radius=0, fg_color="transparent")
        content_frame.pack(fill="both", expand=True)

        # ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä
        self._create_sidebar(content_frame)

        # ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ
        self._create_work_area(content_frame)

    def _create_sidebar(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä"""
        self.sidebar_container = ctk.CTkFrame(parent, width=280, corner_radius=0,
                                            fg_color=self.themed_window.get_color('input_bg'))
        self.sidebar_container.pack(side="left", fill="y")
        self.sidebar_container.pack_propagate(False)

        shadow_frame = ctk.CTkFrame(self.sidebar_container, width=2, fg_color=self.themed_window.get_color('border'))
        shadow_frame.pack(side="right", fill="y")

        self.sidebar = SidebarComponent(self.sidebar_container, self.lang_manager, on_navigate=self._on_navigate)
        self.sidebar.pack(fill="both", expand=True, padx=15, pady=15)

    def _create_work_area(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑ"""
        work_area_container = ctk.CTkFrame(parent, corner_radius=0, fg_color=self.themed_window.get_color('surface'))
        work_area_container.pack(side="left", fill="both", expand=True)

        work_area = ctk.CTkFrame(work_area_container, corner_radius=10, fg_color=self.themed_window.get_color('background'))
        work_area.pack(fill="both", expand=True, padx=20, pady=15)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ£ÿØŸàÿßÿ™
        self._create_toolbar(work_area)

        # ÿ¨ÿØŸàŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        self._create_data_table(work_area)

    def _create_toolbar(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ£ÿØŸàÿßÿ™"""
        toolbar_container = ctk.CTkFrame(parent, height=60, corner_radius=8, fg_color=self.themed_window.get_color('surface'))
        toolbar_container.pack(fill="x", padx=15, pady=(15, 10))
        toolbar_container.pack_propagate(False)

        self.toolbar = ToolbarComponent(toolbar_container, self.lang_manager, on_add=self._add_record,
                                      on_edit=self._edit_record, on_delete=self._delete_record,
                                      on_refresh=self._refresh_data, on_export=self._export_data)
        self.toolbar.pack(fill="both", expand=True, padx=10, pady=10)

    def _create_data_table(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿØŸàŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        table_container = ctk.CTkFrame(parent, corner_radius=8, fg_color=self.themed_window.get_color('surface'))
        table_container.pack(fill="both", expand=True, padx=15, pady=(0, 15))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ¨ÿØŸàŸÑ
        table_header = ctk.CTkFrame(table_container, height=40, corner_radius=0, fg_color=self.themed_window.get_color('input_bg'))
        table_header.pack(fill="x")
        table_header.pack_propagate(False)

        self.table_title = ctk.CTkLabel(table_header, text=self.lang_manager.get("bookings_list", "Bookings List"),
                                      font=ctk.CTkFont(size=16, weight="bold"),
                                      text_color=self.themed_window.get_color('text_primary'))
        self.table_title.pack(side="left", padx=20, pady=10)

        # ÿßŸÑÿ¨ÿØŸàŸÑ
        self.data_table = DataTableComponent(table_container, self.lang_manager,
                                           on_row_double_click=self._on_row_double_click,
                                           on_selection_change=self._on_selection_change)
        self.data_table.pack(fill="both", expand=True, padx=15, pady=15)

    def _create_status_bar(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ©"""
        status_container = ctk.CTkFrame(self.main_container, height=35, corner_radius=0,
                                      fg_color=self.themed_window.get_color('input_bg'))
        status_container.pack(fill="x", side="bottom")
        status_container.pack_propagate(False)

        status_separator = ctk.CTkFrame(status_container, height=1, fg_color=self.themed_window.get_color('border'))
        status_separator.pack(fill="x", side="top")

        self.status_bar = StatusBarComponent(status_container, self.lang_manager)
        self.status_bar.pack(fill="both", expand=True, padx=20, pady=5)

    def _setup_shortcuts(self):
        """ÿ•ÿπÿØÿßÿØ ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠"""
        WindowManager.setup_window_shortcuts(self)

        shortcuts = {
            "<Control-n>": lambda e: self._add_record(), "<Control-e>": lambda e: self._edit_record(),
            "<Delete>": lambda e: self._delete_record(), "<F5>": lambda e: self._refresh_data(),
            "<Control-f>": lambda e: self._focus_search(), "<Control-a>": lambda e: self._select_all(),
            "<Control-s>": lambda e: self._export_data(), "<F1>": lambda e: self._show_help(),
            "<Control-l>": lambda e: self._toggle_language(), "<Control-t>": lambda e: self._toggle_theme(),
            "<Control-Shift-L>": lambda e: self._logout(), "<Control-Shift-F>": lambda e: self._show_placeholder(),
            "<Control-p>": lambda e: self._show_placeholder(), "<F11>": lambda e: self._toggle_fullscreen(),
            "<Escape>": lambda e: self._exit_fullscreen(), "<Alt-Return>": lambda e: self._toggle_fullscreen(),
        }

        for key, command in shortcuts.items():
            self.bind(key, command)

    @error_handler
    def _apply_fullscreen_mode(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        try:
            system = platform.system()
            if system == "Windows":
                self.state('zoomed')
            elif system == "Linux":
                try:
                    self.attributes('-zoomed', True)
                except:
                    self.attributes('-fullscreen', True)
            elif system == "Darwin":
                self.attributes('-fullscreen', True)

            self._is_fullscreen = True
            self._safe_status_update(self.lang_manager.get("fullscreen_enabled", "Fullscreen mode enabled"), "success")
            if self._is_window_valid():
                self.update_idletasks()
        except Exception as e:
            logger.error(f"Fullscreen error: {e}")
            screen_width = self.winfo_screenwidth()
            screen_height = self.winfo_screenheight()
            self.geometry(f"{screen_width-100}x{screen_height-100}+50+50")
            self._is_fullscreen = False

    @error_handler
    def _toggle_fullscreen(self):
        """ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        system = platform.system()

        if system == "Windows":
            current_state = self.state()
            if current_state == 'zoomed':
                self.state('normal')
                self._is_fullscreen = False
            else:
                self.state('zoomed')
                self._is_fullscreen = True
        else:
            try:
                current_state = self.attributes('-fullscreen')
                new_state = not current_state
                self.attributes('-fullscreen', new_state)
                self._is_fullscreen = new_state
            except:
                if system == "Linux":
                    current_state = self.attributes('-zoomed')
                    new_state = not current_state
                    self.attributes('-zoomed', new_state)
                    self._is_fullscreen = new_state

        status = "enabled" if self._is_fullscreen else "disabled"
        self._safe_status_update(self.lang_manager.get(f"fullscreen_{status}", f"Fullscreen {status}"), "info")

        if hasattr(self, 'menu_bar') and self.menu_bar:
            try:
                self.menu_bar.update_fullscreen_state(self._is_fullscreen)
            except:
                pass

    @safe_operation
    def _exit_fullscreen(self):
        """ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        if self._is_fullscreen:
            system = platform.system()
            if system == "Windows":
                self.state('normal')
            else:
                try:
                    self.attributes('-fullscreen', False)
                except:
                    if system == "Linux":
                        self.attributes('-zoomed', False)

            self._is_fullscreen = False
            self._safe_status_update(self.lang_manager.get("fullscreen_disabled", "Fullscreen disabled"), "info")

    # ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ====================

    @error_handler
    def _load_data(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        self._safe_status_update(self.lang_manager.get("loading_data", "Loading data..."))
        self._safe_toolbar_update(set_loading=True)

        if self.window_state:
            self.window_state.is_loading = True

        def load_thread():
            try:
                records = self.controller.fetch_all_records()
                if self._is_window_valid():
                    self.safe_after.schedule(0, self._on_data_loaded, records)
            except Exception as e:
                if self._is_window_valid():
                    self.safe_after.schedule(0, self._on_load_error, str(e))

        threading.Thread(target=load_thread, daemon=True).start()

    @safe_operation
    def _on_data_loaded(self, records):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        self.all_records = records
        self.filtered_records = records

        if self.window_state:
            self.window_state.update_records(records)
            self.window_state.is_loading = False

        if hasattr(self, 'data_table') and self.data_table:
            try:
                self.data_table.display_data(records)
            except Exception as e:
                logger.error(f"Display data error: {e}")

        status_msg = self.lang_manager.get("status_load_complete", "{} records loaded").format(len(records))
        self._safe_status_update(status_msg, "success")
        self._safe_toolbar_update(set_loading=False)
        self._update_stats()

        if self.event_bus:
            self.event_bus.emit("data_loaded", {"count": len(records), "timestamp": datetime.now()})

    @safe_operation
    def _on_load_error(self, error_message):
        """ŸÖÿπÿßŸÑÿ¨ ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ"""
        self._safe_status_update(f"{self.lang_manager.get('error', 'Error')}: {error_message}", "error")
        self._safe_toolbar_update(set_loading=False)

        try:
            WindowManager.flash_window(self, count=2, interval=300)
            messagebox.showerror(self.lang_manager.get("error", "Error"),
                               f"{self.lang_manager.get('error_load', 'Failed to load data')}:\n{error_message}")
        except:
            pass

    @error_handler
    def _refresh_data(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        self._safe_status_update(self.lang_manager.get("refreshing_data", "Refreshing data..."))
        self._safe_toolbar_update(set_loading=True)

        def refresh_thread():
            try:
                records = self.controller.fetch_all_records(force_refresh=True)
                if self._is_window_valid():
                    self.safe_after.schedule(0, self._on_data_refreshed, records)
            except Exception as e:
                if self._is_window_valid():
                    self.safe_after.schedule(0, self._on_refresh_error, str(e))

        threading.Thread(target=refresh_thread, daemon=True).start()

    @safe_operation
    def _on_data_refreshed(self, records):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        self.all_records = records
        self.filtered_records = records

        if hasattr(self, 'data_table') and self.data_table:
            try:
                self.data_table.display_data(records)
            except Exception as e:
                logger.error(f"Display refreshed data error: {e}")

        status_msg = self.lang_manager.get("success_update", "Data updated successfully") + f" - {len(records)} " + \
                    self.lang_manager.get("total_records", "records")
        self._safe_status_update(status_msg, "success")
        self._safe_toolbar_update(set_loading=False)
        self._update_stats()

        self.selected_records = []
        self._safe_toolbar_update(update_selection=0)

    @safe_operation
    def _on_refresh_error(self, error_message):
        """ŸÖÿπÿßŸÑÿ¨ ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿ´"""
        self._safe_status_update(f"{self.lang_manager.get('error_update', 'Update error')}: {error_message}", "error")
        self._safe_toolbar_update(set_loading=False)

        try:
            WindowManager.flash_window(self, count=2, interval=300)
            messagebox.showerror(self.lang_manager.get("error", "Error"),
                               f"{self.lang_manager.get('error_update', 'Failed to update data')}:\n{error_message}")
        except:
            pass

    @safe_operation
    def _on_search(self, search_text):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ®ÿ≠ÿ´"""
        if not search_text:
            self.filtered_records = self.all_records
        else:
            search_lower = search_text.lower()
            self.filtered_records = [r for r in self.all_records
                                   if search_lower in str(r.get('fields', {})).lower()]

        if self.window_state:
            self.window_state.filtered_records = self.filtered_records
            self.window_state.search_query = search_text

        if hasattr(self, 'data_table') and self.data_table:
            try:
                self.data_table.display_data(self.filtered_records)
            except Exception as e:
                logger.error(f"Display search results error: {e}")

        status_msg = (f"{self.lang_manager.get('showing', 'Showing')} {len(self.filtered_records)} "
                     f"{self.lang_manager.get('of', 'of')} {len(self.all_records)} "
                     f"{self.lang_manager.get('total_records', 'records')}")
        self._safe_status_update(status_msg)

        if self.event_bus:
            self.event_bus.emit("search_completed", {"query": search_text, "results": len(self.filtered_records)})

    def _update_stats(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™"""
        try:
            if hasattr(self, 'sidebar') and self.sidebar and hasattr(self.sidebar, 'update_stats'):
                stats = {
                    'total': len(self.all_records),
                    'today': self._count_records('today'),
                    'pending': self._count_records('pending')
                }
                self.sidebar.update_stats(stats)
        except Exception as e:
            logger.debug(f"Update stats error: {e}")

    def _count_records(self, count_type):
        """ÿπÿØ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ"""
        try:
            if count_type == 'today':
                today = str(datetime.now().date())
                return sum(1 for r in self.all_records
                          if r.get('fields', {}).get('Date Trip', '')[:10] == today)
            elif count_type == 'pending':
                return sum(1 for r in self.all_records
                          if r.get('fields', {}).get('Booking Status', '').lower() == 'pending')
            return 0
        except Exception as e:
            logger.debug(f"Count records error: {e}")
            return 0

    # ==================== ÿØŸàÿßŸÑ CRUD ====================

    @error_handler
    def _add_record(self):
        """ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ¨ÿ≤ ÿ¨ÿØŸäÿØ"""
        try:
            WindowManager.bring_to_front(self, duration=100)
            self.controller.open_add_form()
            self.safe_after.schedule(1000, self._refresh_data)
        except Exception as e:
            messagebox.showerror(self.lang_manager.get("error", "Error"),
                               self.lang_manager.get("error_add_form", "Failed to open add form"))

    @error_handler
    def _edit_record(self):
        """ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖÿ≠ÿØÿØ"""
        if not self.selected_records:
            WindowManager.flash_window(self, count=2, interval=300)
            messagebox.showwarning(self.lang_manager.get("warning", "Warning"),
                                 self.lang_manager.get("select_booking_edit", "Please select a booking to edit"))
            return

        if len(self.selected_records) > 1:
            WindowManager.flash_window(self, count=2, interval=300)
            messagebox.showwarning(self.lang_manager.get("warning", "Warning"),
                                 self.lang_manager.get("select_one_booking_only", "You can only edit one booking at a time"))
            return

        try:
            WindowManager.bring_to_front(self, duration=100)
            record = self.selected_records[0]
            self.controller.set_selected_record(record)
            self.controller.open_edit_form()
            self.safe_after.schedule(1000, self._refresh_data)
        except Exception as e:
            messagebox.showerror(self.lang_manager.get("error", "Error"),
                               self.lang_manager.get("error_edit_form", "Failed to open edit form"))

    @error_handler
    def _delete_record(self):
        """ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖÿ≠ÿØÿØ"""
        if not self.selected_records:
            WindowManager.flash_window(self, count=2, interval=300)
            messagebox.showwarning(self.lang_manager.get("warning", "Warning"),
                                 self.lang_manager.get("select_booking_delete", "Please select a booking to delete"))
            return

        # ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ
        count = len(self.selected_records)
        if count > 1:
            msg = self.lang_manager.get("confirm_delete_multiple", "Are you sure you want to delete {} bookings?").format(count)
        else:
            msg = self.lang_manager.get("confirm_delete", "Are you sure you want to delete this booking?")

        if not messagebox.askyesno(self.lang_manager.get("confirm", "Confirm"), msg):
            return

        def delete_thread():
            try:
                success_count = 0
                for record in self.selected_records:
                    self.controller.set_selected_record(record)
                    if self.controller.delete_record():
                        success_count += 1

                if self._is_window_valid():
                    self.safe_after.schedule(0, self._on_delete_complete, success_count, len(self.selected_records))
            except Exception as e:
                if self._is_window_valid():
                    self.safe_after.schedule(0, self._show_delete_error, str(e))

        self._safe_status_update(self.lang_manager.get("processing", "Processing..."))
        threading.Thread(target=delete_thread, daemon=True).start()

    @safe_operation
    def _on_delete_complete(self, success_count, total_count):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑÿ≠ÿ∞ŸÅ"""
        if success_count == total_count:
            msg = self.lang_manager.get("success_delete", "Deleted successfully") + f" ({success_count})"
            self._safe_status_update(msg, "success")
            messagebox.showinfo(self.lang_manager.get("success", "Success"), msg)
        else:
            msg = f"{success_count} {self.lang_manager.get('of', 'of')} {total_count} {self.lang_manager.get('deleted', 'deleted')}"
            self._safe_status_update(msg, "warning")
            WindowManager.flash_window(self, count=2, interval=300)
            messagebox.showwarning(self.lang_manager.get("warning", "Warning"), msg)

        self._refresh_data()
        if hasattr(self, 'data_table') and self.data_table:
            try:
                self.data_table.clear_selection()
            except:
                pass

        self.selected_records = []
        self._safe_toolbar_update(update_selection=0)

    @safe_operation
    def _show_delete_error(self, error_msg):
        """ÿπÿ±ÿ∂ ÿÆÿ∑ÿ£ ÿßŸÑÿ≠ÿ∞ŸÅ"""
        try:
            messagebox.showerror(self.lang_manager.get("error", "Error"),
                               f"{self.lang_manager.get('error_delete', 'Failed to delete record')}:\n{error_msg}")
        except:
            pass

    # ==================== ÿØŸàÿßŸÑ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ====================

    @safe_operation
    def _on_row_double_click(self, record):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑŸÜŸÇÿ± ÿßŸÑŸÖÿ≤ÿØŸàÿ¨"""
        if record:
            self.selected_records = [record]
            self._safe_toolbar_update(update_selection=1)
            self._edit_record()

    @safe_operation
    def _on_selection_change(self, selected_records):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿØ"""
        self.selected_records = selected_records
        count = len(selected_records)
        self._safe_toolbar_update(update_selection=count)

        if count == 0:
            status_msg = f"{self.lang_manager.get('showing', 'Showing')} {len(self.filtered_records)} {self.lang_manager.get('total_records', 'records')}"
        else:
            status_msg = self.lang_manager.get("selected_count", "Selected: {} booking(s)").format(count)

        self._safe_status_update(status_msg)

    @safe_operation
    def _on_navigate(self, destination):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ™ŸÜŸÇŸÑ"""
        self._safe_status_update(f"{self.lang_manager.get('navigating_to', 'Navigating to')}: {destination}")

    # ==================== ÿØŸàÿßŸÑ ÿßŸÑŸÑÿ∫ÿ© ŸàÿßŸÑÿ´ŸäŸÖ ====================

    @error_handler
    def _toggle_language(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ©"""
        current_lang = self.lang_manager.current_lang
        new_lang = "en" if current_lang == "ar" else "ar"

        confirm_msg = self.lang_manager.get("confirm_change_language", "Change language?")
        if messagebox.askyesno(self.lang_manager.get("menu_change_language", "Change Language"), confirm_msg):
            self.lang_manager.set_language(new_lang)

            button_text = "üåê EN" if new_lang == "ar" else "üåê AR"
            if hasattr(self, 'language_button') and self.language_button:
                try:
                    self.language_button.configure(text=button_text)
                except:
                    pass

            self._update_all_texts()

            if hasattr(self.controller, 'update_all_windows_language'):
                try:
                    self.controller.update_all_windows_language()
                except:
                    pass

            self._safe_status_update(self.lang_manager.get("success_save", "Language changed successfully"), "success")

    @error_handler
    def _toggle_theme(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ´ŸäŸÖ"""
        current_mode = self.theme_manager.get_current_appearance_mode()
        new_mode = "dark" if current_mode == "light" else "light"

        self.theme_manager.apply_appearance_mode(new_mode)
        ctk.set_appearance_mode(new_mode)

        self.themed_window.refresh_theme()
        self._refresh_all_components_theme()

        theme_name = "Dark" if new_mode == "dark" else "Light"
        self._safe_status_update(f"Theme changed to {theme_name}", "success")

    @safe_operation
    def _handle_language_change(self, new_language):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ŸÖŸÜ ÿßŸÑŸáŸäÿØÿ±"""
        self.lang_manager.set_language(new_language)

        button_text = "üåê EN" if new_language == "ar" else "üåê AR"
        if hasattr(self, 'language_button') and self.language_button:
            try:
                self.language_button.configure(text=button_text)
            except:
                pass

        self._update_all_texts()

        if hasattr(self.controller, 'update_all_windows_language'):
            try:
                self.controller.update_all_windows_language()
            except:
                pass

        self._safe_status_update(self.lang_manager.get("success_save", "Language changed successfully"), "success")

    @safe_operation
    def _handle_theme_change(self, new_theme):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ ŸÖŸÜ ÿßŸÑŸáŸäÿØÿ±"""
        ctk.set_appearance_mode(new_theme.lower())

        if hasattr(self.theme_manager, 'apply_appearance_mode'):
            self.theme_manager.apply_appearance_mode(new_theme.lower())
        elif hasattr(self.theme_manager, 'current_mode'):
            self.theme_manager.current_mode = new_theme.lower()

        self._apply_theme()
        self.refresh_theme()

        if hasattr(self, 'menu_bar') and self.menu_bar:
            try:
                self.menu_bar.update_dark_mode(new_theme.lower() == "dark")
            except:
                pass

        theme_name = "Dark" if new_theme.lower() == "dark" else "Light"
        self._safe_status_update(f"Theme changed to {theme_name}", "success")

    @safe_operation
    def _update_all_texts(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿµŸàÿµ"""
        username = self.user_record.get('fields', {}).get('Username', 'User')
        self.title(f"{self.lang_manager.get('main_window_title', 'FTS Sales Manager')} - {username}")

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™
        components = ['header', 'sidebar', 'toolbar', 'data_table', 'status_bar']
        for component_name in components:
            if hasattr(self, component_name):
                component = getattr(self, component_name)
                if component and hasattr(component, 'update_texts'):
                    try:
                        component.update_texts(self.lang_manager)
                    except Exception as e:
                        logger.debug(f"Update texts error for {component_name}: {e}")

        if hasattr(self, 'menu_bar') and self.menu_bar and hasattr(self.menu_bar, 'update_texts'):
            try:
                self.menu_bar.update_texts()
            except:
                pass

        if hasattr(self, 'table_title') and self.table_title:
            try:
                self.table_title.configure(text=self.lang_manager.get("bookings_list", "Bookings List"))
            except:
                pass

    @safe_operation
    def _refresh_all_components_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ´ŸäŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™"""
        if hasattr(self, 'main_container') and self.main_container:
            self.themed_window.apply_to_widget(self.main_container, 'frame')

        components = ['header', 'sidebar', 'toolbar', 'data_table', 'status_bar']
        for component_name in components:
            if hasattr(self, component_name):
                component = getattr(self, component_name)
                if component:
                    try:
                        if hasattr(component, 'refresh_theme'):
                            component.refresh_theme()
                        elif hasattr(component, 'apply_theme'):
                            component.apply_theme(self.themed_window)
                    except Exception as e:
                        logger.debug(f"Refresh theme error for {component_name}: {e}")

        if hasattr(self, 'windows7_menubar'):
            self._update_windows7_menubar_theme()

    def _update_windows7_menubar_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ´ŸäŸÖ ÿ¥ÿ±Ÿäÿ∑ ŸÇŸàÿßÿ¶ŸÖ Windows 7"""
        try:
            colors = getattr(self.theme_manager, 'get_theme_colors', lambda: {
                "menu_bg": self.themed_window.get_color('surface'),
                "text_color": self.themed_window.get_color('text_primary'),
                "menu_hover": self.themed_window.get_color('input_bg')
            })()

            if hasattr(self, 'windows7_menubar') and self.windows7_menubar:
                self.windows7_menubar.configure(fg_color=colors.get("menu_bg"))

                for widget in self.windows7_menubar.winfo_children():
                    if isinstance(widget, ctk.CTkButton):
                        widget.configure(text_color=colors.get("text_color"), hover_color=colors.get("menu_hover"))
        except Exception as e:
            logger.debug(f"Windows 7 menubar theme update error: {e}")

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿπÿßŸÖ"""
        try:
            self._apply_theme()
            if hasattr(self, 'main_container') and self.main_container:
                self.main_container.configure(fg_color="transparent")
            self._refresh_all_components_theme()
        except Exception as e:
            logger.error(f"Refresh theme error: {e}")

    def get_themed_color(self, color_name: str, fallback: str = None) -> str:
        """ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÑŸàÿßŸÜ"""
        return self.themed_window.get_color(color_name, fallback)

    # ==================== ÿØŸàÿßŸÑ ÿßŸÑÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ====================

    @safe_operation
    def _focus_search(self):
        """ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿ≠ŸÇŸÑ ÿßŸÑÿ®ÿ≠ÿ´"""
        if hasattr(self.header, 'search_entry') and self.header.search_entry:
            self.header.search_entry.focus_set()
            WindowManager.bring_to_front(self, duration=100)

    @safe_operation
    def _select_all(self):
        """ÿ™ÿ≠ÿØŸäÿØ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™"""
        if hasattr(self.data_table, 'tree') and self.data_table.tree:
            self.data_table.tree.selection_set(self.data_table.tree.get_children())
            self._on_selection_change(self.all_records)

    @safe_operation
    def _clear_selection(self):
        """ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿØ"""
        if hasattr(self.data_table, 'clear_selection'):
            self.data_table.clear_selection()
        self.selected_records = []
        self._safe_toolbar_update(update_selection=0)

    # ==================== ÿØŸàÿßŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ====================

    def _show_menu(self):
        """ÿπÿ±ÿ∂ ŸÇÿßÿ¶ŸÖÿ© ÿπÿßŸÖÿ© (Windows 7)"""
        pass

    def _show_placeholder(self):
        """ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© placeholder ŸÑŸÑŸÖŸäÿ≤ÿßÿ™ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±"""
        self._safe_status_update(self.lang_manager.get("coming_soon", "Coming soon"), "info")

    @error_handler
    def _logout(self):
        """ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"""
        if messagebox.askyesno(self.lang_manager.get("confirm", "Confirm"),
                             self.lang_manager.get("confirm_logout", "Are you sure you want to logout?")):
            self.destroy()
            if hasattr(self.controller, 'on_logout'):
                try:
                    self.controller.on_logout()
                except:
                    pass
            if hasattr(self.controller, 'run'):
                try:
                    self.controller.run()
                except:
                    pass

    @error_handler
    def _export_data(self):
        """ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        self._safe_status_update(self.lang_manager.get("export", "Export") + " - " +
                                 self.lang_manager.get("coming_soon", "Coming soon"))
        WindowManager.flash_window(self, count=2, interval=300)
        messagebox.showinfo(self.lang_manager.get("info", "Information"),
                          self.lang_manager.get("export_coming_soon", "Export feature coming soon"))

    @safe_operation
    def _change_language_from_menu(self, lang_code: str):
        """ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©"""
        if self.lang_manager.current_lang != lang_code:
            self.lang_manager.set_language(lang_code)

            button_text = "üåê EN" if lang_code == "ar" else "üåê AR"
            if hasattr(self, 'language_button') and self.language_button:
                try:
                    self.language_button.configure(text=button_text)
                except:
                    pass

            self._update_all_texts()

            if hasattr(self.controller, 'update_all_windows_language'):
                try:
                    self.controller.update_all_windows_language()
                except:
                    pass

            self._safe_status_update(self.lang_manager.get("success_save", "Language changed successfully"), "success")

    @safe_operation
    def _on_fullscreen_changed(self, is_fullscreen: bool):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        self._is_fullscreen = is_fullscreen
        status = "enabled" if is_fullscreen else "disabled"
        self._safe_status_update(self.lang_manager.get(f"fullscreen_{status}", f"Fullscreen {status}"), "info")

    @safe_operation
    def _on_performance_mode_changed(self, is_enabled: bool):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä"""
        status_key = "performance_mode_enabled" if is_enabled else "performance_mode_disabled"
        self._safe_status_update(self.lang_manager.get(status_key, f"Performance mode {'enabled' if is_enabled else 'disabled'}"), "info")

        if hasattr(self.data_table, 'tree') and self.data_table.tree:
            height = 20 if is_enabled else 15
            self.data_table.tree.configure(height=height)

    @error_handler
    def _show_statistics(self):
        """ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™"""
        stats_msg = f"""
{self.lang_manager.get("statistics", "Statistics")}:

{self.lang_manager.get("total_records", "Total Records")}: {len(self.all_records)}
{self.lang_manager.get("today_bookings", "Today's Bookings")}: {self._count_records('today')}
{self.lang_manager.get("pending_bookings", "Pending Bookings")}: {self._count_records('pending')}
"""
        messagebox.showinfo(self.lang_manager.get("statistics", "Statistics"), stats_msg)

    @error_handler
    def _show_reports(self):
        """ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±"""
        self._safe_status_update(self.lang_manager.get("reports_coming_soon", "Reports feature coming soon"), "info")
        messagebox.showinfo(self.lang_manager.get("info", "Information"),
                          self.lang_manager.get("reports_coming_soon", "Reports feature coming soon"))

    @error_handler
    def _clear_cache(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©"""
        if messagebox.askyesno(self.lang_manager.get("confirm", "Confirm"),
                             self.lang_manager.get("confirm_clear_cache", "Clear all cached data?")):
            self._safe_status_update(self.lang_manager.get("cache_cleared", "Cache cleared successfully"), "success")

    @error_handler
    def _show_help(self):
        """ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©"""
        help_text = f"""
{self.lang_manager.get("keyboard_shortcuts", "Keyboard Shortcuts")}:

- Ctrl+N - {self.lang_manager.get("add_button", "Add Booking")}
- Ctrl+E - {self.lang_manager.get("edit_button", "Edit Booking")}
- Delete - {self.lang_manager.get("delete_button", "Delete Booking")}
- F5 - {self.lang_manager.get("refresh", "Refresh")}
- Ctrl+F - {self.lang_manager.get("search", "Search")}
- Ctrl+A - {self.lang_manager.get("select_all", "Select All")}
- Escape - {self.lang_manager.get("exit_fullscreen", "Exit Fullscreen")}
- F11 - {self.lang_manager.get("fullscreen", "Toggle Fullscreen")}
- F1 - {self.lang_manager.get("help", "Help")}
"""
        messagebox.showinfo(self.lang_manager.get("keyboard_shortcuts", "Keyboard Shortcuts"), help_text)

    @error_handler
    def _show_user_guide(self):
        """ÿπÿ±ÿ∂ ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        guide_msg = f"""
{self.lang_manager.get("user_guide", "User Guide")}:

1. {self.lang_manager.get("guide_add", "To add a booking: Click Add button or press Ctrl+N")}
2. {self.lang_manager.get("guide_edit", "To edit: Double-click on a booking or press Ctrl+E")}
3. {self.lang_manager.get("guide_delete", "To delete: Select bookings and press Delete")}
4. {self.lang_manager.get("guide_search", "To search: Use the search box or press Ctrl+F")}
5. {self.lang_manager.get("guide_fullscreen", "To toggle fullscreen: Press F11 or Alt+Enter")}
"""
        messagebox.showinfo(self.lang_manager.get("user_guide", "User Guide"), guide_msg)

    @error_handler
    def _show_about(self):
        """ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨"""
        about_msg = f"""
{self.lang_manager.get("app_name", "FTS Sales Manager")}
{self.lang_manager.get("version", "Version")}: 2.0

{self.lang_manager.get("developed_by", "Developed by")}: FTS Development Team
{self.lang_manager.get("copyright", "¬© 2024 FTS. All rights reserved.")}

{self.lang_manager.get("logged_as", "Logged in as")}: {self.user_record.get('fields', {}).get('Username', 'User')}
{self.lang_manager.get("user_role", "Role")}: {self.user_record.get('fields', {}).get('Role', 'User')}
"""
        messagebox.showinfo(self.lang_manager.get("about", "About"), about_msg)

    # ==================== ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ¨ÿØŸäÿØÿ© ====================

    def _on_data_loaded_event(self, data):
        """ŸÖÿπÿßŸÑÿ¨ ÿ≠ÿØÿ´ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™"""
        logger.info(f"Data loaded event: {data}")

    def _on_search_completed_event(self, data):
        """ŸÖÿπÿßŸÑÿ¨ ÿ≠ÿØÿ´ ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑÿ®ÿ≠ÿ´"""
        logger.info(f"Search completed: {data}")

    def _on_error_event(self, data):
        """ŸÖÿπÿßŸÑÿ¨ ÿ≠ÿØÿ´ ÿßŸÑÿÆÿ∑ÿ£"""
        logger.error(f"Error event: {data}")

    # ==================== ÿ≠ŸÅÿ∏ Ÿàÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ====================

    def _save_window_state(self):
        """ÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        try:
            window_state = {
                'fullscreen': self._is_fullscreen,
                'geometry': self.geometry() if not self._is_fullscreen else None,
                'state': self.state() if hasattr(self, 'state') else None
            }

            if hasattr(self.controller, 'config_mgr'):
                self.controller.config_mgr.set('main_window_state', window_state)
                logger.debug("Window state saved")
        except Exception as e:
            logger.error(f"Save window state error: {e}")

    def _restore_window_state(self):
        """ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        try:
            if hasattr(self.controller, 'config_mgr'):
                window_state = self.controller.config_mgr.get('main_window_state', {})

                if window_state.get('fullscreen', True):
                    self.safe_after.schedule(200, self._apply_fullscreen_mode)
                elif window_state.get('geometry'):
                    self.geometry(window_state['geometry'])
                else:
                    self.safe_after.schedule(200, self._apply_fullscreen_mode)
        except Exception as e:
            logger.error(f"Restore window state error: {e}")
            self.safe_after.schedule(200, self._apply_fullscreen_mode)

    # ==================== ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ====================

    def _on_close(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        if self._closing:
            return

        try:
            if messagebox.askyesno(self.lang_manager.get("confirm", "Confirm"),
                                 self.lang_manager.get("confirm_exit", "Are you sure you want to exit?")):
                self._closing = True
                self._window_destroyed = True

                # ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ÿßŸÑÿ© Ÿàÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ
                self._save_window_state()

                if hasattr(self, 'safe_after'):
                    self.safe_after.cancel_all()

                if hasattr(self, 'async_manager') and self.async_manager:
                    try:
                        self.async_manager.shutdown()
                    except:
                        pass

                # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÅÿ±ÿπŸäÿ©
                if hasattr(self.controller, 'open_edit_windows'):
                    for window in list(self.controller.open_edit_windows):
                        try:
                            if hasattr(window, 'winfo_exists') and window.winfo_exists():
                                window.destroy()
                        except:
                            pass
                    try:
                        self.controller.open_edit_windows.clear()
                    except:
                        pass

                # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖÿ™ÿ≠ŸÉŸÖ
                if hasattr(self.controller, 'cleanup'):
                    try:
                        self.controller.cleanup()
                    except:
                        pass

                # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                try:
                    self.quit()
                    self.destroy()
                except:
                    try:
                        self.withdraw()
                    except:
                        pass
        except Exception as e:
            logger.error(f"Close error: {e}")
            self._closing = True
            self._window_destroyed = True
            try:
                self.destroy()
            except:
                pass

============================================================
FILE: views\splash_screen.py
SIZE: 11100 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/splash_screen.py

ÿ¥ÿßÿ¥ÿ© ÿ™ÿ±ÿ≠Ÿäÿ® ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ:
- ÿ¥ÿπÿßÿ± ŸÖÿ™ÿ≠ÿ±ŸÉ
- ÿ¥ÿ±Ÿäÿ∑ ÿ™ŸÇÿØŸÖ
- ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ•ÿµÿØÿßÿ±
- ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿ©
"""

import tkinter as tk
import customtkinter as ctk
from typing import Optional, Callable
import threading
import time
from PIL import Image, ImageTk
import os


class SplashScreen(ctk.CTkToplevel):
    """
    ÿ¥ÿßÿ¥ÿ© ÿ™ÿ±ÿ≠Ÿäÿ® ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© Ÿàÿ™ÿ≠ŸÖŸäŸÑ ÿØŸäŸÜÿßŸÖŸäŸÉŸä
    """

    def __init__(self,
                 duration: int = 3000,
                 app_name: str = "FTS Sales Manager",
                 version: str = "2.0",
                 logo_path: Optional[str] = None,
                 loading_callback: Optional[Callable[['SplashScreen'], None]] = None,
                 master: Optional[tk.Tk] = None) -> None:
        """
        ÿ™ŸáŸäÿ¶ÿ© ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ±ÿ≠Ÿäÿ® ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©

        :param duration: ŸÖÿØÿ© ÿßŸÑÿπÿ±ÿ∂ ÿ®ÿßŸÑŸÖŸÑŸÑŸä ÿ´ÿßŸÜŸäÿ©
        :param app_name: ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        :param version: ÿ±ŸÇŸÖ ÿßŸÑÿ•ÿµÿØÿßÿ±
        :param logo_path: ŸÖÿ≥ÿßÿ± ÿßŸÑÿ¥ÿπÿßÿ± (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        :param loading_callback: ÿØÿßŸÑÿ© ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©
        :param master: ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© (ŸÑÿ™ÿ¨ŸÜÿ® ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© tk ÿ•ÿ∂ÿßŸÅŸäÿ©)
        """
        # ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÖÿÆŸÅŸäÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸèŸÖÿ±ÿ±
        if master is None:
            self._temp_root = tk.Tk()
            self._temp_root.withdraw()
            super().__init__(self._temp_root)
        else:
            self._temp_root = None
            super().__init__(master)

        self.app_name = app_name
        self.version = version
        self.logo_path = logo_path
        self.loading_callback = loading_callback
        self._loading_complete = False
        self._min_display_time = 1500  # ÿπÿ±ÿ∂ ŸÑŸÖÿØÿ© 1.5 ÿ´ÿßŸÜŸäÿ© ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.overrideredirect(True)  # ÿ•ÿ≤ÿßŸÑÿ© ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.attributes("-topmost", True)  # ŸÅŸàŸÇ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ¥ŸÅÿßŸÅÿ© ŸÇŸÑŸäŸÑÿßŸã (Windows/Linux)
        try:
            self.attributes("-alpha", 0.95)
        except:
            pass

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ
        ctk.set_appearance_mode("dark")
        ctk.set_default_color_theme("blue")

        # ÿ®ŸÜÿßÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        self._build_ui()

        # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self._center_window()

        # ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÉ
        self._start_animations()

        # ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
        if loading_callback:
            # ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©
            self._start_background_loading()
        else:
            # ÿ•ÿ∫ŸÑÿßŸÇ ÿ®ÿπÿØ ÿßŸÑŸÖÿØÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©
            self.after(duration, self._close_splash)

    def _build_ui(self) -> None:
        """ÿ®ŸÜÿßÿ° ŸÖÿ≠ÿ™ŸàŸâ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ±ÿ≠Ÿäÿ®"""
        # ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÖÿπ ÿÆŸÑŸÅŸäÿ© ŸÖÿ™ÿØÿ±ÿ¨ÿ©
        self.main_frame = ctk.CTkFrame(
            self,
            fg_color=("#1a1a1a", "#1a1a1a"),
            corner_radius=20,
            border_width=2,
            border_color=("#3498db", "#2980b9")
        )
        self.main_frame.pack(expand=True, fill="both", padx=2, pady=2)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        content_frame = ctk.CTkFrame(
            self.main_frame,
            fg_color="transparent"
        )
        content_frame.pack(expand=True, fill="both", padx=40, pady=40)

        # ÿßŸÑÿ¥ÿπÿßÿ± ÿ£Ÿà ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
        if self.logo_path and os.path.exists(self.logo_path):
            try:
                # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©
                logo_image = Image.open(self.logo_path)
                logo_image = logo_image.resize((120, 120), Image.Resampling.LANCZOS)
                self.logo_photo = ctk.CTkImage(
                    light_image=logo_image,
                    dark_image=logo_image,
                    size=(120, 120)
                )
                logo_label = ctk.CTkLabel(
                    content_frame,
                    image=self.logo_photo,
                    text=""
                )
                logo_label.pack(pady=(0, 20))
            except:
                # ÿπÿ±ÿ∂ ÿ£ŸäŸÇŸàŸÜÿ© ŸÜÿµŸäÿ© ŸÅŸä ÿ≠ÿßŸÑÿ© ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©
                self._create_text_logo(content_frame)
        else:
            # ÿ£ŸäŸÇŸàŸÜÿ© ŸÜÿµŸäÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
            self._create_text_logo(content_frame)

        # ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        self.app_label = ctk.CTkLabel(
            content_frame,
            text=self.app_name,
            font=ctk.CTkFont(size=32, weight="bold"),
            text_color=("#ffffff", "#ffffff")
        )
        self.app_label.pack(pady=(0, 10))

        # ÿßŸÑÿ•ÿµÿØÿßÿ±
        version_label = ctk.CTkLabel(
            content_frame,
            text=f"Version {self.version}",
            font=ctk.CTkFont(size=14),
            text_color=("#cccccc", "#cccccc")
        )
        version_label.pack()

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
        self.progress_frame = ctk.CTkFrame(
            content_frame,
            fg_color="transparent"
        )
        self.progress_frame.pack(fill="x", pady=(30, 10))

        self.progress_bar = ctk.CTkProgressBar(
            self.progress_frame,
            width=300,
            height=6,
            corner_radius=3,
            fg_color=("#333333", "#333333"),
            progress_color=("#3498db", "#2980b9")
        )
        self.progress_bar.pack()
        self.progress_bar.set(0)

        # ŸÜÿµ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        self.loading_label = ctk.CTkLabel(
            content_frame,
            text="Initializing...",
            font=ctk.CTkFont(size=12),
            text_color=("#aaaaaa", "#aaaaaa")
        )
        self.loading_label.pack()

        # ÿ≠ŸÇŸàŸÇ ÿßŸÑŸÜÿ¥ÿ±
        copyright_label = ctk.CTkLabel(
            content_frame,
            text="¬© 2024 FTS - All Rights Reserved",
            font=ctk.CTkFont(size=10),
            text_color=("#666666", "#666666")
        )
        copyright_label.pack(side="bottom", pady=(20, 0))

    def _create_text_logo(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿπÿßÿ± ŸÜÿµŸä"""
        logo_frame = ctk.CTkFrame(
            parent,
            fg_color=("#3498db", "#2980b9"),
            corner_radius=60,
            width=120,
            height=120
        )
        logo_frame.pack(pady=(0, 20))
        logo_frame.pack_propagate(False)

        logo_text = ctk.CTkLabel(
            logo_frame,
            text="FTS",
            font=ctk.CTkFont(size=48, weight="bold"),
            text_color=("#ffffff", "#ffffff")
        )
        logo_text.place(relx=0.5, rely=0.5, anchor="center")

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ≠ÿ¨ŸÖ
        window_width = 400
        window_height = 500

        # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ®ÿπÿßÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ©
        screen_width = self.winfo_screenwidth()
        screen_height = self.winfo_screenheight()

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ
        x = (screen_width - window_width) // 2
        y = (screen_height - window_height) // 2

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ÿ¨ŸÖ ŸàÿßŸÑŸÖŸàÿ∂ÿπ
        self.geometry(f"{window_width}x{window_height}+{x}+{y}")

    def _start_animations(self):
        """ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÉÿßÿ™"""
        # ÿ™ÿ£ÿ´Ÿäÿ± fade in
        self._fade_in()

        # ÿ™ÿ≠ÿ±ŸäŸÉ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
        self._animate_progress()

        # ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        self._update_loading_text()

    def _fade_in(self):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä"""
        alpha = 0.0

        def update_alpha():
            nonlocal alpha
            if alpha < 0.95:
                alpha += 0.05
                try:
                    self.attributes("-alpha", alpha)
                except:
                    pass
                self.after(20, update_alpha)

        try:
            self.attributes("-alpha", 0.0)
            self.after(10, update_alpha)
        except:
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿπÿØŸÖ ÿØÿπŸÖ ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ©
            pass

    def _animate_progress(self):
        """ÿ™ÿ≠ÿ±ŸäŸÉ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ"""
        self.progress_value = 0.0

        def update_progress():
            if self.progress_value < 1.0:
                # ÿ≤ŸäÿßÿØÿ© ÿ®ÿ∑Ÿäÿ¶ÿ© ŸÅŸä ÿßŸÑÿ®ÿØÿßŸäÿ©ÿå ÿ≥ÿ±Ÿäÿπÿ© ŸÅŸä ÿßŸÑŸÜŸáÿßŸäÿ©
                if self.progress_value < 0.8:
                    increment = 0.01
                else:
                    increment = 0.02

                self.progress_value += increment
                self.progress_bar.set(min(self.progress_value, 1.0))

                # ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ 50ms
                self.after(50, update_progress)
            elif self._loading_complete:
                # ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
                self._close_splash()

        update_progress()

    def _update_loading_text(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿ¥ŸÉŸÑ ÿØŸàÿ±Ÿä"""
        messages = [
            "Initializing...",
            "Loading configuration...",
            "Connecting to database...",
            "Loading user data...",
            "Preparing interface...",
            "Almost ready..."
        ]

        index = 0

        def update_text():
            nonlocal index
            if not self._loading_complete:
                self.loading_label.configure(text=messages[index % len(messages)])
                index += 1

                # ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ 500ms
                self.after(500, update_text)

        update_text()

    def _start_background_loading(self):
        """ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©"""
        start_time = time.time()

        def loading_thread():
            try:
                # ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿØÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
                if self.loading_callback:
                    self.loading_callback(self)
            except Exception as e:
                print(f"Error during loading: {e}")
            finally:
                # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿ±ÿ∂ ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÑŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÖŸÜ ÿßŸÑŸàŸÇÿ™
                elapsed = (time.time() - start_time) * 1000
                if elapsed < self._min_display_time:
                    time.sleep((self._min_display_time - elapsed) / 1000)

                self._loading_complete = True

        thread = threading.Thread(target=loading_thread, daemon=True)
        thread.start()

    def _close_splash(self):
        """ÿ•ÿ∫ŸÑÿßŸÇ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ±ÿ≠Ÿäÿ® ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ± fade out"""
        def fade_out(alpha=0.95):
            if alpha > 0.0:
                alpha -= 0.05
                try:
                    self.attributes("-alpha", alpha)
                except:
                    pass
                self.after(20, lambda: fade_out(alpha))
            else:
                # ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
                if self._temp_root:
                    self._temp_root.destroy()
                self.destroy()

        # ÿ®ÿØÿ° fade out
        fade_out()

    def update_progress(self, value: float, message: str = ""):
        """
        ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÇÿØŸÖ ŸäÿØŸàŸäÿßŸã

        :param value: ŸÇŸäŸÖÿ© ÿßŸÑÿ™ŸÇÿØŸÖ (0.0 - 1.0)
        :param message: ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        """
        self.progress_value = value
        self.progress_bar.set(value)

        if message:
            self.loading_label.configure(text=message)

    def set_loading_complete(self):
        """Ÿàÿ∂ÿπ ÿπŸÑÿßŸÖÿ© ÿßŸÉÿ™ŸÖÿßŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ"""
        self._loading_complete = True
        self.update_progress(1.0, "Ready!")

        # ÿ•ÿ∫ŸÑÿßŸÇ ÿ®ÿπÿØ ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ±
        self.after(500, self._close_splash)

============================================================
FILE: views\components\autocomplete_entry.py
SIZE: 19262 characters
============================================================

# -*- coding: utf-8 -*-
"""
components/enhanced_autocomplete_entry.py - ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸàÿßŸÑŸÖÿ´ÿ®ÿ™ÿ©

ÿ•ÿµŸÑÿßÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ:
‚úÖ ÿ•ÿØÿßÿ±ÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÑŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©
‚úÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿ≠ÿØÿßÿ´ ŸÖÿ≥ÿ™ŸÇÿ±ÿ©
‚úÖ ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ ŸÅÿπÿßŸÑ
‚úÖ ÿ£ÿØÿßÿ° ŸÖÿ≠ÿ≥ŸÜ
‚úÖ ÿ≥ŸáŸàŸÑÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ
"""

import customtkinter as ctk
import tkinter as tk
from typing import List, Callable, Optional, Any, Union
import threading
import time
from dataclasses import dataclass
from enum import Enum


class SuggestionType(Enum):
    EXACT = "exact"
    STARTS_WITH = "starts"
    CONTAINS = "contains"
    FUZZY = "fuzzy"


@dataclass
class Suggestion:
    text: str
    type: SuggestionType = SuggestionType.EXACT
    score: float = 1.0
    description: str = ""


class EnhancedAutoCompleteEntry(ctk.CTkFrame):
    """ÿ≠ŸÇŸÑ ÿ•ÿØÿÆÿßŸÑ ŸÖÿπ ÿ•ŸÉŸÖÿßŸÑ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÖÿ≠ÿ≥ŸÜ ŸàŸÖÿ´ÿ®ÿ™"""

    def __init__(self,
                 parent,
                 values: List[str] = None,
                 placeholder: str = "ÿßÿ®ÿ≠ÿ´...",
                 width: int = 300,
                 height: int = 35,
                 max_suggestions: int = 8,
                 min_chars: int = 1,
                 enable_fuzzy: bool = True,
                 fuzzy_threshold: float = 0.6,
                 on_select: Callable[[str], None] = None,
                 **kwargs):

        super().__init__(parent, width=width, height=height, **kwargs)

        # ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        self.values = values or []
        self.placeholder = placeholder
        self.max_suggestions = max_suggestions
        self.min_chars = min_chars
        self.enable_fuzzy = enable_fuzzy
        self.fuzzy_threshold = fuzzy_threshold
        self.on_select = on_select

        # ÿßŸÑÿ≠ÿßŸÑÿ©
        self.suggestions: List[Suggestion] = []
        self.selected_index = -1
        self.is_popup_open = False
        self.current_value = ""

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        self.text_var = tk.StringVar()
        self.text_var.trace_add('write', self._on_text_change)

        # ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self._build_ui()
        self._setup_bindings()

        # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©
        self.popup_window = None
        self.suggestion_widgets = []

        # ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ§ŸÇÿ™ ŸÑŸÑÿ®ÿ≠ÿ´
        self._search_cache = {}
        self._last_search_time = 0
        self._search_delay = 0.3  # ÿ´ÿßŸÜŸäÿ©

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ®ÿ≥Ÿäÿ∑ÿ©"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´
        self.search_frame = ctk.CTkFrame(self, fg_color="transparent")
        self.search_frame.pack(fill="both", expand=True, padx=2, pady=2)

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ®ÿ≠ÿ´
        self.search_icon = ctk.CTkLabel(
            self.search_frame,
            text="üîç",
            width=25,
            font=ctk.CTkFont(size=14)
        )
        self.search_icon.pack(side="left", padx=(5, 0))

        # ÿ≠ŸÇŸÑ ÿßŸÑŸÜÿµ
        self.entry = ctk.CTkEntry(
            self.search_frame,
            textvariable=self.text_var,
            placeholder_text=self.placeholder,
            height=self.cget("height") - 4
        )
        self.entry.pack(side="left", fill="both", expand=True, padx=5)

        # ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠
        self.clear_btn = ctk.CTkButton(
            self.search_frame,
            text="‚úï",
            width=25,
            height=25,
            command=self.clear,
            font=ctk.CTkFont(size=10)
        )
        # ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠ ÿ®ÿØÿßŸäÿ©

    def _setup_bindings(self):
        """ÿ•ÿπÿØÿßÿØ ÿ£ÿ≠ÿØÿßÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ŸàÿßŸÑŸÖÿßŸàÿ≥"""
        # ÿ£ÿ≠ÿØÿßÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠
        self.entry.bind('<Down>', self._on_arrow_down)
        self.entry.bind('<Up>', self._on_arrow_up)
        self.entry.bind('<Return>', self._on_enter)
        self.entry.bind('<Escape>', self._on_escape)
        self.entry.bind('<Tab>', self._on_tab)

        # ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤
        self.entry.bind('<FocusIn>', self._on_focus_in)
        self.entry.bind('<FocusOut>', self._on_focus_out)

        # ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÜŸÇÿ±
        self.entry.bind('<Button-1>', self._on_click)

    def _on_text_change(self, *args):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        text = self.text_var.get()
        self.current_value = text

        # ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠
        if text:
            self.clear_btn.pack(side="right", padx=(0, 5))
        else:
            self.clear_btn.pack_forget()

        # ÿ™ÿ≠ÿØŸäÿ´ ŸàŸÇÿ™ ÿßŸÑÿ®ÿ≠ÿ´
        self._last_search_time = time.time()

        # ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿ™ÿ£ÿÆŸäÿ±
        if hasattr(self, '_search_timer'):
            self.after_cancel(self._search_timer)

        self._search_timer = self.after(
            int(self._search_delay * 1000),
            self._perform_search
        )

    def _perform_search(self):
        """ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ®ÿ≠ÿ´"""
        text = self.current_value.strip()

        if len(text) < self.min_chars:
            self._close_popup()
            return

        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
        if text in self._search_cache:
            suggestions = self._search_cache[text]
        else:
            suggestions = self._generate_suggestions(text)
            # ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™ (ŸÖÿπ ÿ≠ÿØ ÿ£ŸÇÿµŸâ)
            if len(self._search_cache) < 50:
                self._search_cache[text] = suggestions

        self.suggestions = suggestions

        if suggestions:
            self._show_popup()
        else:
            self._close_popup()

    def _generate_suggestions(self, query: str) -> List[Suggestion]:
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™"""
        suggestions = []
        query_lower = query.lower()

        for value in self.values:
            value_lower = value.lower()

            # ÿ™ÿ∑ÿßÿ®ŸÇ ÿ™ÿßŸÖ
            if query_lower == value_lower:
                suggestions.append(Suggestion(
                    text=value,
                    type=SuggestionType.EXACT,
                    score=1.0
                ))
            # Ÿäÿ®ÿØÿ£ ÿ®ÿßŸÑÿßÿ≥ÿ™ÿπŸÑÿßŸÖ
            elif value_lower.startswith(query_lower):
                suggestions.append(Suggestion(
                    text=value,
                    type=SuggestionType.STARTS_WITH,
                    score=0.9
                ))
            # Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿßŸÑÿßÿ≥ÿ™ÿπŸÑÿßŸÖ
            elif query_lower in value_lower:
                suggestions.append(Suggestion(
                    text=value,
                    type=SuggestionType.CONTAINS,
                    score=0.7
                ))
            # ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ
            elif self.enable_fuzzy:
                similarity = self._calculate_similarity(query_lower, value_lower)
                if similarity >= self.fuzzy_threshold:
                    suggestions.append(Suggestion(
                        text=value,
                        type=SuggestionType.FUZZY,
                        score=similarity * 0.6
                    ))

        # ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
        suggestions.sort(key=lambda s: -s.score)
        return suggestions[:self.max_suggestions]

    def _calculate_similarity(self, text1: str, text2: str) -> float:
        """ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ¥ÿßÿ®Ÿá ÿ®ŸäŸÜ ŸÜÿµŸäŸÜ (ÿ®ÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©)"""
        if not text1 or not text2:
            return 0.0

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ£ÿ≠ÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©
        common = sum(1 for c in text1 if c in text2)
        max_len = max(len(text1), len(text2))

        return common / max_len if max_len > 0 else 0.0

    def _show_popup(self):
        """ÿπÿ±ÿ∂ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©"""
        if self.is_popup_open:
            self._update_popup()
            return

        try:
            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©
            self._create_popup()
            self.is_popup_open = True

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿπÿ±ÿ∂ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©: {e}")

    def _create_popup(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©"""
        # ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÇÿØŸäŸÖÿ© ÿ•ŸÜ Ÿàÿ¨ÿØÿ™
        if self.popup_window:
            try:
                self.popup_window.destroy()
            except:
                pass

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàŸÇÿπ
        x = self.winfo_rootx()
        y = self.winfo_rooty() + self.winfo_height()
        width = self.winfo_width()
        height = min(250, len(self.suggestions) * 35 + 10)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.popup_window = ctk.CTkToplevel(self)
        self.popup_window.wm_overrideredirect(True)
        self.popup_window.geometry(f"{width}x{height}+{x}+{y}")

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
        self.scroll_frame = ctk.CTkScrollableFrame(
            self.popup_window,
            width=width-10,
            height=height-10
        )
        self.scroll_frame.pack(fill="both", expand=True, padx=5, pady=5)

        self._populate_suggestions()

    def _populate_suggestions(self):
        """ŸÖŸÑÿ° ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™"""
        # ŸÖÿ≥ÿ≠ ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
        for widget in self.suggestion_widgets:
            try:
                widget.destroy()
            except:
                pass

        self.suggestion_widgets.clear()

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        for i, suggestion in enumerate(self.suggestions):
            btn = ctk.CTkButton(
                self.scroll_frame,
                text=suggestion.text,
                height=30,
                anchor="w",
                command=lambda s=suggestion: self._select_suggestion(s)
            )
            btn.pack(fill="x", pady=1)

            # ÿ±ÿ®ÿ∑ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÖÿßŸàÿ≥
            btn.bind('<Enter>', lambda e, idx=i: self._highlight_suggestion(idx))

            self.suggestion_widgets.append(btn)

    def _update_popup(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©"""
        if self.popup_window and self.popup_window.winfo_exists():
            self._populate_suggestions()

    def _close_popup(self):
        """ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©"""
        if self.popup_window:
            try:
                self.popup_window.destroy()
            except:
                pass
            finally:
                self.popup_window = None

        self.is_popup_open = False
        self.selected_index = -1

    def _select_suggestion(self, suggestion: Suggestion):
        """ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÇÿ™ÿ±ÿßÿ≠"""
        self.text_var.set(suggestion.text)
        self.current_value = suggestion.text
        self._close_popup()

        # ÿßÿ≥ÿ™ÿØÿπÿßÿ° callback
        if self.on_select:
            try:
                self.on_select(suggestion.text)
            except Exception as e:
                print(f"ÿÆÿ∑ÿ£ ŸÅŸä callback: {e}")

    def _highlight_suggestion(self, index: int):
        """ÿ™ŸÖŸäŸäÿ≤ ÿßŸÇÿ™ÿ±ÿßÿ≠"""
        self.selected_index = index

        # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ŸÖŸäŸäÿ≤ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        for btn in self.suggestion_widgets:
            btn.configure(fg_color=["gray75", "gray25"])

        # ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑÿ≤ÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
        if 0 <= index < len(self.suggestion_widgets):
            self.suggestion_widgets[index].configure(fg_color=["gray65", "gray35"])

    # ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
    def _on_arrow_down(self, event):
        """ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿ≥ŸÅŸÑ"""
        if not self.is_popup_open or not self.suggestions:
            return

        if self.selected_index < len(self.suggestions) - 1:
            self.selected_index += 1
        else:
            self.selected_index = 0

        self._highlight_suggestion(self.selected_index)
        return "break"

    def _on_arrow_up(self, event):
        """ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿπŸÑŸâ"""
        if not self.is_popup_open or not self.suggestions:
            return

        if self.selected_index > 0:
            self.selected_index -= 1
        else:
            self.selected_index = len(self.suggestions) - 1

        self._highlight_suggestion(self.selected_index)
        return "break"

    def _on_enter(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Enter"""
        if self.is_popup_open and 0 <= self.selected_index < len(self.suggestions):
            self._select_suggestion(self.suggestions[self.selected_index])
        return "break"

    def _on_escape(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Escape"""
        if self.is_popup_open:
            self._close_popup()
        else:
            self.clear()
        return "break"

    def _on_tab(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Tab"""
        if self.is_popup_open and 0 <= self.selected_index < len(self.suggestions):
            self._select_suggestion(self.suggestions[self.selected_index])
            return "break"

    def _on_focus_in(self, event):
        """ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ"""
        if self.current_value and len(self.current_value) >= self.min_chars:
            self._perform_search()

    def _on_focus_out(self, event):
        """ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤"""
        # ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ŸÑÿ•ÿ™ÿßÿ≠ÿ© ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™
        self.after(100, self._check_focus_out)

    def _check_focus_out(self):
        """ŸÅÿ≠ÿµ ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿßŸÑŸÅÿπŸÑŸä"""
        try:
            focused = self.focus_get()
            if not focused or focused not in [self.entry] + self.suggestion_widgets:
                self._close_popup()
        except:
            self._close_popup()

    def _on_click(self, event):
        """ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≠ŸÇŸÑ ÿßŸÑŸÜÿµ"""
        if self.current_value and len(self.current_value) >= self.min_chars:
            self._perform_search()

    # ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿπÿßŸÖÿ©
    def get(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖÿ©"""
        return self.current_value

    def set(self, value: str):
        """ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ©"""
        self.text_var.set(value)
        self.current_value = value

    def clear(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ"""
        self.text_var.set("")
        self.current_value = ""
        self._close_popup()

    def set_values(self, values: List[str]):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÇŸäŸÖ"""
        self.values = values
        self._search_cache.clear()  # ŸÖÿ≥ÿ≠ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™

    def add_value(self, value: str):
        """ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ©"""
        if value and value not in self.values:
            self.values.append(value)
            self._search_cache.clear()

    def focus_set(self):
        """ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ"""
        self.entry.focus_set()


# ŸÖÿ´ÿßŸÑ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
if __name__ == "__main__":
    import customtkinter as ctk

    class TestApp:
        def __init__(self):
            ctk.set_appearance_mode("dark")
            ctk.set_default_color_theme("blue")

            self.root = ctk.CTk()
            self.root.title("Enhanced AutoComplete Entry - Test")
            self.root.geometry("600x400")

            # ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©
            self.test_values = [
                "ÿßŸÑŸÇÿßŸáÿ±ÿ©", "ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©", "ÿßŸÑÿ¨Ÿäÿ≤ÿ©", "ÿ¥ÿ±ŸÖ ÿßŸÑÿ¥ŸäÿÆ", "ÿßŸÑÿ∫ÿ±ÿØŸÇÿ©",
                "ÿ£ÿ≥ŸàÿßŸÜ", "ÿßŸÑÿ£ŸÇÿµÿ±", "ŸÖÿ±ÿ≥Ÿâ ŸÖÿ∑ÿ±Ÿàÿ≠", "ÿ∑ÿßÿ®ÿß", "ÿØŸáÿ®",
                "Cairo", "Alexandria", "Giza", "Sharm El Sheikh", "Hurghada",
                "Aswan", "Luxor", "Marsa Matrouh", "Taba", "Dahab",
                "New York", "Los Angeles", "Chicago", "Houston",
                "London", "Paris", "Berlin", "Rome", "Madrid"
            ]

            self.setup_ui()

        def setup_ui(self):
            """ÿ•ÿπÿØÿßÿØ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±"""
            # ÿßŸÑÿπŸÜŸàÿßŸÜ
            title = ctk.CTkLabel(
                self.root,
                text="üîç Enhanced AutoComplete Entry",
                font=ctk.CTkFont(size=24, weight="bold")
            )
            title.pack(pady=20)

            # ŸàÿµŸÅ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
            improvements = """
‚úÖ ÿ£ÿØÿßÿ° ŸÖÿ≠ÿ≥ŸÜ ŸàŸÖÿ≥ÿ™ŸÇÿ±
‚úÖ ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ ŸÅÿπÿßŸÑ
‚úÖ Ÿàÿßÿ¨Ÿáÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ≥ŸÑÿ≥ÿ©
‚úÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿ≠ÿØÿßÿ´ ŸÖÿ≠ÿ≥ŸÜÿ©
‚úÖ ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ§ŸÇÿ™ ÿ∞ŸÉŸä
            """

            desc_label = ctk.CTkLabel(
                self.root,
                text=improvements,
                font=ctk.CTkFont(size=12),
                justify="left"
            )
            desc_label.pack(pady=10)

            # ÿ≠ŸÇŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ŸàŸÑ - ÿ®ÿ≠ÿ´ ÿπÿßÿØŸä
            label1 = ctk.CTkLabel(
                self.root,
                text="üåç ÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿØŸÜ (ÿ®ÿ≠ÿ´ ÿπÿßÿØŸä):",
                font=ctk.CTkFont(size=14, weight="bold")
            )
            label1.pack(pady=(20, 5))

            self.autocomplete1 = EnhancedAutoCompleteEntry(
                self.root,
                values=self.test_values,
                placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿØŸäŸÜÿ©...",
                width=500,
                enable_fuzzy=False,
                on_select=self.on_select1
            )
            self.autocomplete1.pack(pady=5)

            # ÿ≠ŸÇŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ´ÿßŸÜŸä - ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ
            label2 = ctk.CTkLabel(
                self.root,
                text="üîç ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ (ÿ¨ÿ±ÿ®: Cair ÿ£Ÿà ŸÇÿßŸáÿ±):",
                font=ctk.CTkFont(size=14, weight="bold")
            )
            label2.pack(pady=(20, 5))

            self.autocomplete2 = EnhancedAutoCompleteEntry(
                self.root,
                values=self.test_values,
                placeholder="ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ±ŸÜ...",
                width=500,
                enable_fuzzy=True,
                fuzzy_threshold=0.5,
                on_select=self.on_select2
            )
            self.autocomplete2.pack(pady=5)

            # ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
            self.result_label = ctk.CTkLabel(
                self.root,
                text="üéØ ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿ®ÿπÿØ",
                font=ctk.CTkFont(size=16)
            )
            self.result_label.pack(pady=20)

            # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
            controls_frame = ctk.CTkFrame(self.root)
            controls_frame.pack(pady=20)

            clear_btn = ctk.CTkButton(
                controls_frame,
                text="üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸÑ",
                command=self.clear_all,
                width=120
            )
            clear_btn.pack(side="left", padx=5)

            add_btn = ctk.CTkButton(
                controls_frame,
                text="‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿµÿ±",
                command=self.add_item,
                width=120
            )
            add_btn.pack(side="left", padx=5)

        def on_select1(self, value):
            """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ£ŸàŸÑ"""
            self.result_label.configure(
                text=f"üåç ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿßÿØŸä: {value}",
                text_color="green"
            )

        def on_select2(self, value):
            """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ±ŸÜ"""
            self.result_label.configure(
                text=f"üîç ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ±ŸÜ: {value}",
                text_color="blue"
            )

        def clear_all(self):
            """ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ"""
            self.autocomplete1.clear()
            self.autocomplete2.clear()
            self.result_label.configure(
                text="üóëÔ∏è ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ",
                text_color="orange"
            )

        def add_item(self):
            """ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿµÿ± ÿ¨ÿØŸäÿØ"""
            import random
            new_items = ["ÿ∑ŸàŸÉŸäŸà", "ÿ≥ŸäÿØŸÜŸä", "ÿ™Ÿàÿ±ŸàŸÜÿ™Ÿà", "ÿØÿ®Ÿä", "ÿßŸÑŸÉŸàŸäÿ™"]
            new_item = random.choice(new_items)

            self.autocomplete1.add_value(new_item)
            self.autocomplete2.add_value(new_item)

            self.result_label.configure(
                text=f"‚ûï ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ©: {new_item}",
                text_color="purple"
            )

        def run(self):
            """ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
            self.root.mainloop()

    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±
    app = TestApp()
    app.run()


============================================================
FILE: views\components\combobox.py
SIZE: 70009 characters
============================================================

# -*- coding: utf-8 -*-
"""
enhanced_combobox.py - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸàŸÖÿ®ÿ≥ÿ∑ÿ© ŸÖŸàÿ≠ÿØÿ© ŸÖÿπ ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© - ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ£ÿ≥ŸáŸÖ

ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ:
- ÿ¢ŸÑŸäÿ© ŸÜŸÇÿ± ŸÖÿ≠ÿ≥ŸÜÿ© (ÿßŸÑŸÜŸÇÿ± ÿßŸÑÿ£ŸàŸÑ ŸÑŸÑÿ™ÿ±ŸÉŸäÿ≤ÿå ÿßŸÑÿ´ÿßŸÜŸä ŸÑŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©)
- ÿ®ÿ≠ÿ´ ŸÅŸàÿ±Ÿä ŸÖÿπ ÿ£ŸÑŸàÿßŸÜ ÿ≤ÿ±ŸÇÿßÿ° ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±
- ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑ ŸàŸÖŸÜÿ∏ŸÖ
- ÿØŸÖÿ¨ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ŸÅŸä ŸÖŸÉŸàŸÜ Ÿàÿßÿ≠ÿØ
- ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© Ÿàÿ™ÿ≠ÿØŸäÿ´ ŸÖŸàŸÇÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
- ÿπÿ±ÿ∂ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ£ÿ≥ŸÅŸÑ ÿ£Ÿà ÿ£ÿπŸÑŸâ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
- ŸÅŸÑÿ™ÿ±ÿ© ÿ≠Ÿäÿ© ŸÖÿπ ÿ£ÿ≥ŸáŸÖ ÿ™ÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ŸÖÿ´ÿßŸÑŸä (ŸÖŸèÿµŸÑÿ≠ÿ© - ŸÑÿß ÿ™ÿÆÿ∑Ÿä)
"""

import customtkinter as ctk
import tkinter as tk
from typing import List, Callable, Optional
import time


class EnhancedSearchableComboBox(ctk.CTkFrame):
    """ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖŸàÿ≠ÿØÿ© ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ Ÿàÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© - ŸÖÿπ ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑÿ£ÿ≥ŸáŸÖ"""

    def __init__(self, parent, values: List[str] = None, placeholder: str = "ÿßŸÉÿ™ÿ® ŸÑŸÑÿ®ÿ≠ÿ´...",
                 width: int = 300, height: int = 35, max_results: int = 10,
                 on_select: Callable[[str], None] = None, debug_mode: bool = False, **kwargs):

        super().__init__(parent, width=width, height=height, **kwargs)

        # ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        self.values = values or []
        self.placeholder = placeholder
        self.max_results = max_results
        self.on_select = on_select
        self.debug_mode = debug_mode

        # ÿßŸÑÿ≠ÿßŸÑÿ©
        self.filtered_values = self.values.copy()
        self.selected_value = ""
        self.selected_index = -1
        self.is_dropdown_open = False

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑŸÜŸÇÿ±
        self._last_click_time = 0
        self._has_focus = False
        self._updating_text = False
        self._closing = False

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self._last_window_x = 0
        self._last_window_y = 0
        self._last_entry_x = 0
        self._last_entry_y = 0
        self._position_check_id = None
        self._dropdown_above = False

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ©
        self._last_text = ""
        self._filter_timer = None

        # Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        self.text_var = tk.StringVar()
        self.text_var.trace_add('write', self._on_text_change)

        # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©
        self.dropdown_window = None
        self.option_buttons = []

        # ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self._build_ui()
        self._setup_events()

        if self.debug_mode:
            print(f"‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ComboBox ŸÖÿπ {len(self.values)} ÿπŸÜÿµÿ±")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ"""
        self.main_frame = ctk.CTkFrame(self, fg_color="transparent")
        self.main_frame.pack(fill="both", expand=True, padx=2, pady=2)

        # ÿ≠ŸÇŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
        self.entry = ctk.CTkEntry(
            self.main_frame,
            textvariable=self.text_var,
            placeholder_text=self.placeholder,
            height=self.cget("height") - 4
        )
        self.entry.pack(side="left", fill="both", expand=True, padx=(2, 1))

        # ÿ≤ÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        self.dropdown_btn = ctk.CTkButton(
            self.main_frame,
            text="‚ñº",
            width=30,
            height=self.cget("height") - 4,
            command=self._toggle_dropdown
        )
        self.dropdown_btn.pack(side="right", padx=(1, 2))

    def _setup_events(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ - ŸÖŸèÿµŸÑÿ≠ ŸÑÿ™ÿ¨ŸÜÿ® ÿ™ÿØÿßÿÆŸÑ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿ≥ŸáŸÖ"""
        # ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÜŸÇÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
        self.entry.bind('<Button-1>', self._on_enhanced_click)
        self.entry.bind('<FocusIn>', self._on_focus_in)
        self.entry.bind('<FocusOut>', self._on_focus_out)

        # ÿ£ÿ≠ÿØÿßÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ - ŸÖÿπÿßŸÑÿ¨ Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
        self.entry.bind('<KeyRelease>', self._on_key_release_enhanced)
        self.entry.bind('<KeyPress>', self._on_key_press)

        # ÿ™ŸÖ ÿ≠ÿ∞ŸÅ binds ÿßŸÑŸÖŸÜŸÅÿµŸÑÿ© ŸÑŸÑÿ£ÿ≥ŸáŸÖ ŸÑÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ™ÿÆÿ∑Ÿä:
        # self.entry.bind('<Down>', self._on_arrow_down)      # ŸÖŸèÿ≤ÿßŸÑ
        # self.entry.bind('<Up>', self._on_arrow_up)          # ŸÖŸèÿ≤ÿßŸÑ
        # self.entry.bind('<Return>', self._on_enter)         # ŸÖŸèÿ≤ÿßŸÑ
        # self.entry.bind('<Escape>', self._on_escape)        # ŸÖŸèÿ≤ÿßŸÑ

        # ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿßŸÑŸÜŸÇÿ± ÿßŸÑÿÆÿßÿ±ÿ¨Ÿä
        self._setup_outside_click_detection()

        # ÿ™ÿ™ÿ®ÿπ ÿ™ÿ≠ÿ±ŸÉ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self._start_position_tracking()

    def _on_key_press(self, event):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠"""
        key = event.keysym

        if self.debug_mode:
            print(f"‚å®Ô∏è ŸÖŸÅÿ™ÿßÿ≠ ŸÖÿ∂ÿ∫Ÿàÿ∑: {key}")

        # ŸÑÿß ŸÜÿ™ÿ¨ÿßŸáŸÑ ÿ£Ÿä ŸÖŸÅÿßÿ™Ÿäÿ≠ ŸáŸÜÿß - ŸÜÿ™ÿ±ŸÉ ŸÑŸÑŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ™ÿßŸÑŸä

    def _on_key_release_enhanced(self, event):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ≠ÿ±Ÿäÿ± ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ - ŸÖÿπÿßŸÑÿ¨ Ÿàÿßÿ≠ÿØ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ"""
        key = event.keysym

        if self.debug_mode:
            print(f"‚å®Ô∏è ŸÖŸÅÿ™ÿßÿ≠ ŸÖÿ≠ÿ±ÿ±: {key} - ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖŸÅÿ™Ÿàÿ≠ÿ©: {self.is_dropdown_open} - ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑÿ≠ÿßŸÑŸä: {self.selected_index}")

        # ŸÖÿπÿßŸÑÿ¨ÿ© ŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ£ŸàŸÑÿßŸã - ŸÖÿπÿßŸÑÿ¨ Ÿàÿ≠ŸäÿØ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
        if key == 'Down':
            self._handle_arrow_down_enhanced()
            return "break"
        elif key == 'Up':
            self._handle_arrow_up_enhanced()
            return "break"
        elif key == 'Return':
            self._handle_enter_enhanced()
            return "break"
        elif key == 'Escape':
            self._handle_escape_enhanced()
            return "break"

        # ŸÑŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ£ÿÆÿ±Ÿâÿå ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ©
        control_keys = ['Tab', 'Shift_L', 'Shift_R', 'Control_L', 'Control_R', 'Alt_L', 'Alt_R',
                       'Left', 'Right', 'Home', 'End', 'Page_Up', 'Page_Down']

        if key not in control_keys and not self._updating_text:
            # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿßŸäŸÖÿ± ÿßŸÑÿ≥ÿßÿ®ŸÇ
            if self._filter_timer:
                self.after_cancel(self._filter_timer)

            # ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ±
            self._filter_timer = self.after(50, self._perform_live_filtering)

    def _handle_arrow_down_enhanced(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿ≥ŸÅŸÑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ - ŸÖÿπ ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä Ÿàÿ∑ÿ®ŸäÿπŸä ŸàÿØÿπŸÖ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä"""
        if self.debug_mode:
            print(f"‚¨áÔ∏è ÿ≥ŸáŸÖ ÿ£ÿ≥ŸÅŸÑ - ŸÖŸÅÿ™Ÿàÿ≠ÿ©: {self.is_dropdown_open}, ÿ£ÿ≤ÿ±ÿßÿ±: {len(self.option_buttons)}, ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑÿ≠ÿßŸÑŸä: {self.selected_index}")

        if not self.is_dropdown_open:
            self._open_dropdown()
            return

        if not self.option_buttons:
            if self.debug_mode:
                print("‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ≤ÿ±ÿßÿ± ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜŸáÿß")
            return

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑÿ¨ÿØŸäÿØ ÿ®ÿπŸÜÿßŸäÿ© ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
        old_index = self.selected_index
        if self.selected_index == -1:
            new_index = 0
        else:
            new_index = (self.selected_index + 1) % len(self.option_buttons)

        # ÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ (ÿπÿßÿØŸä ÿ£ŸÖ ÿØÿßÿ¶ÿ±Ÿä)
        is_circular_navigation = (old_index == len(self.option_buttons) - 1 and new_index == 0)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã
        self._highlight_option(new_index)

        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ
        if is_circular_navigation:
            # ÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑÿ£ÿπŸÑŸâ (ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ©)
            self._scroll_to_top_smooth()
            if self.debug_mode:
                print(f"üîÑ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä: ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ŸàŸÑ - {old_index} ‚Üí {new_index}")
        else:
            # ÿ™ŸÖÿ±Ÿäÿ± ÿπÿßÿØŸä
            self._scroll_to_option_smooth(new_index, direction="down")

        if self.debug_mode:
            print(f"‚¨áÔ∏è ÿ™ÿ≠ÿØŸäÿØ ŸÖÿ§ŸÉÿØ: {old_index} ‚Üí {new_index} (ÿßŸÑÿπŸÜÿµÿ±: {self.filtered_values[new_index] if new_index < len(self.filtered_values) else 'N/A'})")

    def _handle_arrow_up_enhanced(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿπŸÑŸâ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ - ŸÖÿπ ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä Ÿàÿ∑ÿ®ŸäÿπŸä ŸàÿØÿπŸÖ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä"""
        if self.debug_mode:
            print(f"‚¨ÜÔ∏è ÿ≥ŸáŸÖ ÿ£ÿπŸÑŸâ - ŸÖŸÅÿ™Ÿàÿ≠ÿ©: {self.is_dropdown_open}, ÿ£ÿ≤ÿ±ÿßÿ±: {len(self.option_buttons)}, ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑÿ≠ÿßŸÑŸä: {self.selected_index}")

        if not self.is_dropdown_open:
            return

        if not self.option_buttons:
            if self.debug_mode:
                print("‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿ≤ÿ±ÿßÿ± ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜŸáÿß")
            return

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑÿ¨ÿØŸäÿØ ÿ®ÿπŸÜÿßŸäÿ© ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
        old_index = self.selected_index
        if self.selected_index == -1:
            new_index = len(self.option_buttons) - 1
        else:
            new_index = (self.selected_index - 1) % len(self.option_buttons)

        # ÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ (ÿπÿßÿØŸä ÿ£ŸÖ ÿØÿßÿ¶ÿ±Ÿä)
        is_circular_navigation = (old_index == 0 and new_index == len(self.option_buttons) - 1)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã
        self._highlight_option(new_index)

        # ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ
        if is_circular_navigation:
            # ÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑÿ£ÿ≥ŸÅŸÑ (ÿßŸÑÿ∞Ÿáÿßÿ® ŸÑŸÑŸÜŸáÿßŸäÿ©)
            self._scroll_to_bottom_smooth()
            if self.debug_mode:
                print(f"üîÑ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä: ÿßŸÑÿ∞Ÿáÿßÿ® ŸÑŸÑÿ¢ÿÆÿ± - {old_index} ‚Üí {new_index}")
        else:
            # ÿ™ŸÖÿ±Ÿäÿ± ÿπÿßÿØŸä
            self._scroll_to_option_smooth(new_index, direction="up")

        if self.debug_mode:
            print(f"‚¨ÜÔ∏è ÿ™ÿ≠ÿØŸäÿØ ŸÖÿ§ŸÉÿØ: {old_index} ‚Üí {new_index} (ÿßŸÑÿπŸÜÿµÿ±: {self.filtered_values[new_index] if new_index < len(self.filtered_values) else 'N/A'})")

    def _handle_enter_enhanced(self):
        """ŸÖÿπÿßŸÑÿ¨ ŸÖŸÅÿ™ÿßÿ≠ Enter ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        if self.debug_mode:
            print(f"‚èé Enter - ŸÖŸÅÿ™Ÿàÿ≠ÿ©: {self.is_dropdown_open}, ŸÖÿ≠ÿØÿØ: {self.selected_index}")

        if self.is_dropdown_open and 0 <= self.selected_index < len(self.filtered_values):
            selected_value = self.filtered_values[self.selected_index]
            if self.debug_mode:
                print(f"‚èé ÿßÿÆÿ™Ÿäÿßÿ±: {selected_value}")
            self._select_value(selected_value)

    def _handle_escape_enhanced(self):
        """ŸÖÿπÿßŸÑÿ¨ ŸÖŸÅÿ™ÿßÿ≠ Escape ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        if self.debug_mode:
            print(f"‚éã Escape - ŸÖŸÅÿ™Ÿàÿ≠ÿ©: {self.is_dropdown_open}")

        if self.is_dropdown_open:
            self._close_dropdown()
        else:
            self.clear()

    def _perform_live_filtering(self):
        """ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ© - ŸÜÿ≥ÿÆÿ© ŸÖÿ≠ÿ≥ŸÜÿ©"""
        try:
            current_text = self.entry.get()

            # ÿ™ÿ¨ŸÜÿ® ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖÿ™ŸÉÿ±ÿ±ÿ©
            if current_text == self._last_text:
                return

            self._last_text = current_text

            if self.debug_mode:
                print(f"üîÑ ŸÅŸÑÿ™ÿ±ÿ© ÿ≠Ÿäÿ©: '{current_text}' - ŸÖŸÅÿ™Ÿàÿ≠ÿ©: {self.is_dropdown_open}")

            # ÿ≠ŸÅÿ∏ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ© ÿ≠ÿßŸÑŸäÿßŸã
            previously_selected_value = None
            if 0 <= self.selected_index < len(self.filtered_values):
                previously_selected_value = self.filtered_values[self.selected_index]

            # ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑŸÅŸÑÿ™ÿ±ÿ©
            previous_count = len(self.filtered_values)
            self._search_values(current_text)
            current_count = len(self.filtered_values)

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖŸÅÿ™Ÿàÿ≠ÿ©ÿå ÿ≠ÿØÿ´Ÿáÿß
            if self.is_dropdown_open:
                if self.debug_mode:
                    print(f"üîÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {previous_count} ‚Üí {current_count}")

                self._update_dropdown_live()

                # ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπŸÜÿµÿ± ÿ£Ÿà ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ£ŸàŸÑ
                if previously_selected_value and previously_selected_value in self.filtered_values:
                    new_index = self.filtered_values.index(previously_selected_value)
                    self._highlight_option(new_index)
                elif self.filtered_values:
                    self._highlight_option(0)

                # ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿ¨ŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ•ÿ∞ÿß ÿ™ÿ∫Ÿäÿ± ÿπÿØÿØ ÿßŸÑÿπŸÜÿßÿµÿ±
                if current_count != previous_count:
                    self._resize_dropdown_for_new_content()

            elif current_text.strip() and self._has_focus and len(self.filtered_values) > 0:
                # ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÜÿ™ÿßÿ¶ÿ¨
                if self.debug_mode:
                    print(f"üéØ ŸÅÿ™ÿ≠ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÖÿπ {len(self.filtered_values)} ŸÜÿ™Ÿäÿ¨ÿ©")
                self._open_dropdown_with_animation()

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ©: {e}")
                import traceback
                traceback.print_exc()

    def _start_position_tracking(self):
        """ÿ®ÿØÿ° ÿ™ÿ™ÿ®ÿπ ŸÖŸàŸÇÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        def track_position():
            try:
                if self.is_dropdown_open and self.dropdown_window:
                    self._update_dropdown_position_if_needed()

                # ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿßŸÑÿ™ÿßŸÑŸä
                self._position_check_id = self.after(50, track_position)
            except:
                if self._position_check_id:
                    self.after_cancel(self._position_check_id)
                    self._position_check_id = None

        self._position_check_id = self.after(100, track_position)

    def _update_dropdown_position_if_needed(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸàŸÇÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ•ÿ∞ÿß ÿ™ÿ∫Ÿäÿ± ŸÖŸàŸÇÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ£Ÿà ÿßŸÑÿ≠ŸÇŸÑ"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸàŸÇÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ≠ÿßŸÑŸä
            main_window = self.winfo_toplevel()
            current_window_x = main_window.winfo_x()
            current_window_y = main_window.winfo_y()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸàŸÇÿπ ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÑÿ≠ÿßŸÑŸä
            current_entry_x = self.winfo_rootx()
            current_entry_y = self.winfo_rooty()

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÖŸàŸÇÿπ
            if (current_window_x != self._last_window_x or
                current_window_y != self._last_window_y or
                current_entry_x != self._last_entry_x or
                current_entry_y != self._last_entry_y):

                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏
                self._last_window_x = current_window_x
                self._last_window_y = current_window_y
                self._last_entry_x = current_entry_x
                self._last_entry_y = current_entry_y

                # ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸàŸÇÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                self._reposition_dropdown()

                if self.debug_mode:
                    print(f"üîÑ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸàŸÇÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: ({current_entry_x}, {current_entry_y})")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÖŸàŸÇÿπ: {e}")

    def _calculate_best_dropdown_position(self):
        """ÿ≠ÿ≥ÿßÿ® ÿ£ŸÅÿ∂ŸÑ ŸÖŸàŸÇÿπ ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© (ÿ£ÿπŸÑŸâ ÿ£Ÿà ÿ£ÿ≥ŸÅŸÑ) ŸÖÿπ ÿØÿπŸÖ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ©"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            screen_width = self.winfo_screenwidth()
            screen_height = self.winfo_screenheight()

            # ŸÖŸàŸÇÿπ Ÿàÿ≠ÿ¨ŸÖ ÿßŸÑÿ≠ŸÇŸÑ
            entry_x = self.winfo_rootx()
            entry_y = self.winfo_rooty()
            entry_width = self.winfo_width()
            entry_height = self.winfo_height()

            # ÿ≠ÿ¨ŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ŸàŸÇÿπ ŸÖÿπ ŸÖÿ±ÿßÿπÿßÿ© ÿßŸÑŸÅŸÑÿ™ÿ±ÿ©
            dropdown_width = max(entry_width, 300)

            # ÿ≠ÿ≥ÿßÿ® ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿπÿØÿØ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©
            items_count = len(self.filtered_values) if self.filtered_values else 1  # 1 ŸÑŸÑÿ±ÿ≥ÿßŸÑÿ©
            dropdown_height = min(items_count * 35 + 20, 350)  # ÿ≠ÿØ ÿ£ŸÇÿµŸâ 350 ÿ®ŸÉÿ≥ŸÑ

            # ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿßÿ≠ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿπÿØÿØ ŸÉÿ®Ÿäÿ± ŸÖŸÜ ÿßŸÑÿπŸÜÿßÿµÿ±
            if items_count > 10:
                dropdown_height = min(10 * 35 + 20, 350)

            # ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ÿ£ÿ≥ŸÅŸÑ Ÿàÿ£ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ
            space_below = screen_height - (entry_y + entry_height)
            space_above = entry_y

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ£ŸÖÿ´ŸÑ
            show_above = space_below < dropdown_height and space_above > space_below

            if show_above:
                # ÿπÿ±ÿ∂ ÿ£ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ
                final_y = entry_y - dropdown_height
                self._dropdown_above = True
            else:
                # ÿπÿ±ÿ∂ ÿ£ÿ≥ŸÅŸÑ ÿßŸÑÿ≠ŸÇŸÑ
                final_y = entry_y + entry_height
                self._dropdown_above = False

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ ÿÆÿ±Ÿàÿ¨ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜ ÿ≠ÿØŸàÿØ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            final_x = max(0, min(entry_x, screen_width - dropdown_width))
            final_y = max(0, min(final_y, screen_height - dropdown_height))

            if self.debug_mode:
                direction = "ÿ£ÿπŸÑŸâ" if show_above else "ÿ£ÿ≥ŸÅŸÑ"
                print(f"üìç ŸÖŸàŸÇÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {direction} - ({final_x}, {final_y}) - {dropdown_width}x{dropdown_height} - ÿπŸÜÿßÿµÿ±: {items_count}")

            return final_x, final_y, dropdown_width, dropdown_height

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàŸÇÿπ: {e}")
            # ŸÇŸäŸÖ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
            return self.winfo_rootx(), self.winfo_rooty() + self.winfo_height(), 300, 200

    def _reposition_dropdown(self):
        """ÿ•ÿπÿßÿØÿ© ÿ™ŸÖŸàÿ∂ÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if not self.dropdown_window:
            return

        try:
            x, y, width, height = self._calculate_best_dropdown_position()
            self.dropdown_window.geometry(f"{width}x{height}+{x}+{y}")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ŸÖŸàÿ∂ÿπ: {e}")

    def _on_enhanced_click(self, event):
        """ÿ¢ŸÑŸäÿ© ÿßŸÑŸÜŸÇÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©: ÿßŸÑÿ£ŸàŸÑ ŸÑŸÑÿ™ÿ±ŸÉŸäÿ≤ÿå ÿßŸÑÿ´ÿßŸÜŸä ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©"""
        current_time = time.time()
        time_since_last = current_time - self._last_click_time

        if self.debug_mode:
            print(f"üñ±Ô∏è ŸÜŸÇÿ± - ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤: {self._has_focus}, ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {self.is_dropdown_open}")

        if not self._has_focus:
            # ÿßŸÑŸÜŸÇÿ±ÿ© ÿßŸÑÿ£ŸàŸÑŸâ: ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ Ÿàÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÜÿµ
            self._handle_first_click()
        elif time_since_last < 0.5:
            # ÿßŸÑŸÜŸÇÿ±ÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©: ŸÅÿ™ÿ≠/ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            self._toggle_dropdown()
        else:
            # ŸÜŸÇÿ±ÿ© ÿ®ÿπÿØ ŸÅÿ™ÿ±ÿ©: ÿ•ÿπÿßÿØÿ© Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ§ÿ¥ÿ±
            self._position_cursor(event)

        self._last_click_time = current_time
        return "break"

    def _handle_first_click(self):
        """ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜŸÇÿ±ÿ© ÿßŸÑÿ£ŸàŸÑŸâ"""
        self.entry.focus_set()
        self._has_focus = True

        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÜÿµ ÿßŸÑŸÖŸàÿ¨ŸàÿØ
        current_text = self.entry.get()
        if current_text:
            self.entry.select_range(0, 'end')

        if self.debug_mode:
            print(f"üéØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿßŸÑÿ£ŸàŸÑ - ÿßŸÑŸÜÿµ: '{current_text}'")

    def _position_cursor(self, event):
        """Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ§ÿ¥ÿ± ŸÅŸä ŸÖŸàŸÇÿπ ÿßŸÑŸÜŸÇÿ±"""
        try:
            text = self.entry.get()
            if text:
                # ÿ™ŸÇÿØŸäÿ± ŸÖŸàŸÇÿπ ÿßŸÑŸÖÿ§ÿ¥ÿ±
                entry_width = self.entry.winfo_width()
                char_width = entry_width / max(len(text), 1)
                cursor_pos = min(len(text), max(0, int(event.x / char_width)))
                self.entry.icursor(cursor_pos)
        except:
            self.entry.icursor(tk.END)

    def _on_focus_in(self, event):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤"""
        self._has_focus = True
        if self.debug_mode:
            print("üéØ ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤")

    def _on_focus_out(self, event):
        """ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤"""
        self._has_focus = False
        if self.debug_mode:
            print("üîç ŸÅŸÇÿØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤")

        # ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        self.after(50, self._check_and_close)

    def _check_and_close(self):
        """ŸÅÿ≠ÿµ Ÿàÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±"""
        if not self.is_dropdown_open or self._closing:
            return

        try:
            focused = self.focus_get()
            if not self._is_focus_inside(focused):
                self._close_dropdown()
        except:
            self._close_dropdown()

    def _is_focus_inside(self, widget):
        """ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿØÿßÿÆŸÑ ÿßŸÑŸÖŸÉŸàŸÜ"""
        if not widget:
            return False

        safe_widgets = [self, self.entry, self.dropdown_btn, self.main_frame]
        if self.dropdown_window:
            safe_widgets.append(self.dropdown_window)
        safe_widgets.extend(self.option_buttons)

        # ŸÅÿ≠ÿµ ŸÖÿ®ÿßÿ¥ÿ± ŸàŸáÿ±ŸÖŸä ŸÖÿ≠ÿØŸàÿØ
        current = widget
        for _ in range(5):
            if current in safe_widgets:
                return True
            try:
                current = current.master
            except:
                break
        return False

    def _setup_outside_click_detection(self):
        """ÿ•ÿπÿØÿßÿØ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿßŸÑŸÜŸÇÿ± ÿßŸÑÿÆÿßÿ±ÿ¨Ÿä"""
        def check_outside():
            try:
                if self.is_dropdown_open and not self._is_focus_inside(self.focus_get()):
                    self._close_dropdown()
            except:
                pass
            self.after(100, check_outside)

        self.after(100, check_outside)

    def _toggle_dropdown(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ©"""
        if self.is_dropdown_open:
            self._close_dropdown()
        else:
            self._open_dropdown()

    def _open_dropdown(self):
        """ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© - ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        if self.is_dropdown_open or self._closing:
            return

        try:
            # ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿπ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ©
            current_text = self.entry.get().strip()
            if current_text:
                self._search_values(current_text)
            else:
                self.filtered_values = self.values.copy()

            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ≠ÿ™Ÿâ ŸÑŸà ŸÑŸÖ ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ (ŸÑÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ©)
            self._create_dropdown_window()
            self.is_dropdown_open = True

            # ÿ™ÿ≠ÿØŸäÿ´ ÿ±ŸÖÿ≤ ÿßŸÑÿ≤ÿ± ÿ≠ÿ≥ÿ® ŸÖŸàŸÇÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            self.dropdown_btn.configure(text="‚ñ≤")

            # ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ£Ÿà ÿ±ÿ≥ÿßŸÑÿ© ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÜÿ™ÿßÿ¶ÿ¨
            if not self.filtered_values and current_text:
                self._show_no_results_message()
            elif self.filtered_values:
                self._populate_dropdown()
                # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ£ŸàŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÑÿ™ŸÖŸÉŸäŸÜ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ÿßŸÑÿ£ÿ≥ŸáŸÖ
                if self.option_buttons:
                    self._highlight_option(0)
                    if self.debug_mode:
                        print(f"üéØ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ£ŸàŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã: {self.filtered_values[0]}")

            if self.debug_mode:
                direction = "ÿ£ÿπŸÑŸâ" if self._dropdown_above else "ÿ£ÿ≥ŸÅŸÑ"
                if self.filtered_values:
                    print(f"‚úÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© {direction} ŸÖÿπ {len(self.filtered_values)} ÿπŸÜÿµÿ±")
                else:
                    print(f"‚úÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© {direction} - ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {e}")

    def _create_dropdown_window(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        # ÿ™ŸÜÿ∏ŸäŸÅ ÿ≥ÿßÿ®ŸÇ
        if self.dropdown_window:
            try:
                self.dropdown_window.destroy()
            except:
                pass

        self.option_buttons.clear()

        try:
            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàŸÇÿπ ŸàÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿ£ŸÖÿ´ŸÑ
            x, y, width, height = self._calculate_best_dropdown_position()

            # ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            self._last_window_x = self.winfo_toplevel().winfo_x()
            self._last_window_y = self.winfo_toplevel().winfo_y()
            self._last_entry_x = self.winfo_rootx()
            self._last_entry_y = self.winfo_rooty()

            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            main_window = self.winfo_toplevel()
            self.dropdown_window = ctk.CTkToplevel(main_window)
            self.dropdown_window.wm_overrideredirect(True)
            self.dropdown_window.geometry(f"{width}x{height}+{x}+{y}")

            # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ∏Ÿáÿ± ŸÅŸàŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
            self.dropdown_window.lift()
            self.dropdown_window.attributes('-topmost', True)

            # ÿ•ÿ∑ÿßÿ± ŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±
            self.list_frame = ctk.CTkScrollableFrame(
                self.dropdown_window,
                width=width-10,
                height=height-10
            )
            self.list_frame.pack(fill="both", expand=True, padx=5, pady=5)

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ©: {e}")

    def _populate_dropdown(self):
        """ŸÖŸÑÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ - ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿπŸÖŸÑ ŸÖÿπ ÿßŸÑÿ£ÿ≥ŸáŸÖ"""
        if not self.filtered_values:
            if self.debug_mode:
                print("‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸäŸÖ ŸÑÿπÿ±ÿ∂Ÿáÿß ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ©")
            return

        if self.debug_mode:
            print(f"üìã ŸÖŸÑÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ŸÄ {len(self.filtered_values)} ÿπŸÜÿµÿ±")

        for i, value in enumerate(self.filtered_values):
            try:
                btn = ctk.CTkButton(
                    self.list_frame,
                    text=value,
                    height=35,
                    anchor="w",
                    fg_color="transparent",
                    text_color=("#1976D2", "#FFFFFF"),
                    hover_color=("#E3F2FD", "#1E90FF"),  # ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°
                    command=lambda v=value: self._select_value(v)
                )
                btn.pack(fill="x", pady=1, padx=2)

                # ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ®ÿßŸÑŸÖÿßŸàÿ≥ ŸÅŸÇÿ∑ (ŸÑÿß ÿ™ÿ™ÿØÿÆŸÑ ŸÖÿπ ÿßŸÑÿ£ÿ≥ŸáŸÖ)
                btn.bind('<Enter>', lambda e, idx=i: self._on_mouse_enter(idx))
                btn.bind('<Leave>', lambda e, idx=i: self._on_mouse_leave(idx))

                self.option_buttons.append(btn)

                if self.debug_mode and i < 3:  # ÿ∑ÿ®ÿßÿπÿ© ÿ£ŸàŸÑ 3 ÿπŸÜÿßÿµÿ± ŸÅŸÇÿ∑
                    print(f"  ‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± {i}: {value}")

            except Exception as e:
                if self.debug_mode:
                    print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≤ÿ± {i}: {e}")

        # ŸÅÿ±ÿ∂ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂
        try:
            self.list_frame.update_idletasks()
            if self.debug_mode:
                print(f"‚úÖ ÿ™ŸÖ ŸÖŸÑÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ŸÜÿ¨ÿßÿ≠: {len(self.option_buttons)} ÿ≤ÿ±")
        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂: {e}")

    def _select_value(self, value: str):
        """ÿßÿÆÿ™Ÿäÿßÿ± ŸÇŸäŸÖÿ©"""
        if self.debug_mode:
            print(f"üéØ ÿßÿÆÿ™Ÿäÿßÿ±: {value}")

        self._updating_text = True
        try:
            self.selected_value = value
            self.text_var.set(value)
            self.entry.delete(0, tk.END)
            self.entry.insert(0, value)

            self._close_dropdown()
            self.entry.focus_set()

            # ÿßÿ≥ÿ™ÿØÿπÿßÿ° callback
            if self.on_select:
                self.after(20, lambda: self.on_select(value))

        finally:
            self._updating_text = False

    def _close_dropdown(self):
        """ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖÿπ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ©"""
        if not self.is_dropdown_open or self._closing:
            return

        self._closing = True
        try:
            if self.dropdown_window:
                self.dropdown_window.destroy()
                self.dropdown_window = None

            self.option_buttons.clear()
            self.is_dropdown_open = False
            self.selected_index = -1
            self.dropdown_btn.configure(text="‚ñº")
            self._dropdown_above = False

            # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ŸÑŸÑŸÇŸäŸÖ ÿßŸÑŸÉÿßŸÖŸÑÿ© ÿπŸÜÿØ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
            if not self.entry.get().strip():
                self.filtered_values = self.values.copy()

            if self.debug_mode:
                print("üîí ÿ™ŸÖ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖÿπ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ©")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ: {e}")
        finally:
            self._closing = False

    def _search_values(self, query: str):
        """ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÇŸäŸÖ ŸÖÿπ ÿØÿπŸÖ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        if not query:
            self.filtered_values = self.values.copy()
            if self.debug_mode:
                print(f"üîç ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´: ÿπŸàÿØÿ© ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸäŸÖ ({len(self.filtered_values)} ÿπŸÜÿµÿ±)")
            return

        query_lower = query.lower().strip()
        if not query_lower:
            self.filtered_values = self.values.copy()
            return

        results = []
        exact_matches = []
        start_matches = []
        contains_matches = []

        # ÿ™ÿµŸÜŸäŸÅ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ™ÿ∑ÿßÿ®ŸÇ ŸÑŸÅŸÑÿ™ÿ±ÿ© ÿ£ŸÅÿ∂ŸÑ
        for value in self.values:
            value_lower = value.lower()

            if value_lower == query_lower:
                # ÿ™ÿ∑ÿßÿ®ŸÇ ÿ™ÿßŸÖ
                exact_matches.append(value)
            elif value_lower.startswith(query_lower):
                # ÿ™ÿ∑ÿßÿ®ŸÇ ŸÖŸÜ ÿßŸÑÿ®ÿØÿßŸäÿ©
                start_matches.append(value)
            elif query_lower in value_lower:
                # ÿ™ÿ∑ÿßÿ®ŸÇ ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜ
                contains_matches.append(value)

        # ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨: ÿßŸÑÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ÿßŸÖ ÿ£ŸàŸÑÿßŸãÿå ÿ´ŸÖ ŸÖŸÜ ÿßŸÑÿ®ÿØÿßŸäÿ©ÿå ÿ´ŸÖ ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜ
        results = exact_matches + start_matches + contains_matches
        self.filtered_values = results[:self.max_results]

        if self.debug_mode:
            total_matches = len(exact_matches) + len(start_matches) + len(contains_matches)
            print(f"üîç ÿ®ÿ≠ÿ´ ŸÖÿ≠ÿ≥ŸÜ '{query}':")
            print(f"  üìä ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨: {len(exact_matches)} ÿ™ÿßŸÖ + {len(start_matches)} ÿ®ÿØÿßŸäÿ© + {len(contains_matches)} ŸÖÿ≠ÿ™ŸàŸâ = {total_matches}")
            print(f"  üìã ŸÖÿπÿ±Ÿàÿ∂: {len(self.filtered_values)} ŸÖŸÜ ÿ£ÿµŸÑ {total_matches}")
            if self.filtered_values:
                print(f"  üéØ ÿ£ŸàŸÑ 3 ŸÜÿ™ÿßÿ¶ÿ¨: {self.filtered_values[:3]}")

    def _on_text_change(self, *args):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ - Ÿäÿ™ŸÉÿßŸÖŸÑ ŸÖÿπ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ©"""
        if self._updating_text:
            return

        # ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ© ÿ≥ÿ™ÿ™ŸÖ ÿπÿ®ÿ± _on_key_release_enhanced

    def _update_dropdown_live(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ®ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≠Ÿäÿ© - ŸÖÿ≠ÿ≥ŸÜ"""
        if not self.dropdown_window or not self.list_frame:
            if self.debug_mode:
                print("‚ùå ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿßŸÅÿ∞ÿ© ŸÇÿßÿ¶ŸÖÿ© ŸÑÿ™ÿ≠ÿØŸäÿ´Ÿáÿß")
            return

        try:
            if self.debug_mode:
                print(f"üîÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {len(self.filtered_values)} ÿπŸÜÿµÿ±")

            # ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ≥ÿßÿ®ŸÇ
            for widget in self.list_frame.winfo_children():
                widget.destroy()

            # ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸàÿßŸÑŸÅŸáÿ±ÿ≥
            self.option_buttons.clear()
            self.selected_index = -1  # ÿ≥Ÿäÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜŸá ŸÅŸä _perform_live_filtering

            # ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ¨ÿØŸäÿØ
            current_text = self.entry.get().strip()

            if not self.filtered_values and current_text:
                # ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÜÿ™ÿßÿ¶ÿ¨
                self._show_no_results_message()
            elif not self.filtered_values and not current_text:
                # ÿ•ÿ∞ÿß ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑŸÜÿµÿå ÿ£ÿπÿØ ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸäŸÖ
                self.filtered_values = self.values.copy()
                self._populate_dropdown()
            else:
                # ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©
                self._populate_dropdown()

            # ŸÅÿ±ÿ∂ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂
            self.list_frame.update_idletasks()
            self.dropdown_window.update_idletasks()

            if self.debug_mode:
                print(f"‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {len(self.option_buttons)} ÿ≤ÿ± ŸÖÿπÿ±Ÿàÿ∂")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠Ÿä: {e}")
                import traceback
                traceback.print_exc()

    def _show_no_results_message(self):
        """ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÜÿ™ÿßÿ¶ÿ¨"""
        if not self.dropdown_window or not self.list_frame:
            return

        try:
            if self.debug_mode:
                print("üì≠ ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÜÿ™ÿßÿ¶ÿ¨")

            # ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ≥ÿßÿ®ŸÇ
            for widget in self.list_frame.winfo_children():
                widget.destroy()

            self.option_buttons.clear()
            self.selected_index = -1

            # ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ÿßŸÑÿ© "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨"
            no_results_frame = ctk.CTkFrame(self.list_frame, fg_color="transparent")
            no_results_frame.pack(fill="both", expand=True, pady=10, padx=10)

            no_results_label = ctk.CTkLabel(
                no_results_frame,
                text="üîç ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿ∑ÿßÿ®ŸÇÿ©",
                height=35,
                text_color=("gray", "lightgray"),
                font=ctk.CTkFont(size=12, slant="italic")
            )
            no_results_label.pack(expand=True)

            # ŸÅÿ±ÿ∂ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂
            self.list_frame.update_idletasks()
            self.dropdown_window.update_idletasks()

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿØŸÖ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨: {e}")

    def _resize_dropdown_for_new_content(self):
        """ÿ™ÿ∫ŸäŸäÿ± ÿ≠ÿ¨ŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ¨ÿØŸäÿØ"""
        if not self.dropdown_window:
            return

        try:
            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿ¨ÿØŸäÿØ
            x, y, width, height = self._calculate_best_dropdown_position()

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿ¨ÿØŸäÿØ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ± ÿ≥ŸÑÿ≥
            current_geometry = self.dropdown_window.geometry()
            if f"{width}x{height}+{x}+{y}" != current_geometry:
                self.dropdown_window.geometry(f"{width}x{height}+{x}+{y}")

                # ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                if hasattr(self, 'list_frame'):
                    self.list_frame.configure(width=width-10, height=height-10)

                if self.debug_mode:
                    print(f"üìè ÿ™ÿ∫ŸäŸäÿ± ÿ≠ÿ¨ŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ•ŸÑŸâ: {width}x{height}")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ: {e}")

    def _open_dropdown_with_animation(self):
        """ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ± ÿ≥ŸÑÿ≥"""
        if self.is_dropdown_open or self._closing:
            return

        try:
            # ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            self._open_dropdown()

            # ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿ∏ŸáŸàÿ± ÿ≥ŸÑÿ≥
            if self.dropdown_window:
                # ÿ®ÿØÿßŸäÿ© ÿ®ÿ¥ŸÅÿßŸÅŸäÿ© ŸÖŸÜÿÆŸÅÿ∂ÿ©
                self.dropdown_window.attributes('-alpha', 0.7)

                # ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ© ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã
                def fade_in(alpha=0.7):
                    if alpha < 1.0 and self.dropdown_window:
                        try:
                            self.dropdown_window.attributes('-alpha', alpha)
                            self.after(20, lambda: fade_in(min(1.0, alpha + 0.1)))
                        except:
                            pass

                fade_in()

                if self.debug_mode:
                    print("‚ú® ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÅÿ™ÿ≠ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä: {e}")

    def _highlight_option(self, index: int):
        """ÿ™ŸÖŸäŸäÿ≤ ÿÆŸäÿßÿ± ÿ®ÿßŸÑÿ£ÿ≥ŸáŸÖ - ŸÖŸèÿµŸÑÿ≠ ŸÑÿ∂ŸÖÿßŸÜ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸáÿ±ÿ≥ ÿ®ÿØŸÇÿ©"""
        if not (0 <= index < len(self.option_buttons)):
            if self.debug_mode:
                print(f"‚ö†Ô∏è ŸÅŸáÿ±ÿ≥ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ ŸÑŸÑÿ™ŸÖŸäŸäÿ≤: {index} (ÿßŸÑŸÖÿ™ÿßÿ≠: 0-{len(self.option_buttons)-1})")
            return

        try:
            # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ŸÖŸäŸäÿ≤ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            for i, btn in enumerate(self.option_buttons):
                btn.configure(fg_color="transparent")

            # ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑÿ≤ÿ± ÿßŸÑŸÖÿ≠ÿØÿØ ÿ®ÿßŸÑÿ£ÿ≤ÿ±ŸÇ
            self.option_buttons[index].configure(fg_color=("#E3F2FD", "#1E90FF"))

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑŸÖÿ≠ÿØÿØ - Ÿáÿ∞ÿß ŸÖŸáŸÖ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿÆÿ∑Ÿä!
            self.selected_index = index

            if self.debug_mode:
                value = self.filtered_values[index] if index < len(self.filtered_values) else "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ"
                print(f"üéØ ÿ™ŸÖŸäŸäÿ≤ ŸÖÿ§ŸÉÿØ: ÿßŸÑÿπŸÜÿµÿ± {index}: {value} - ÿßŸÑŸÅŸáÿ±ÿ≥ ŸÖÿ≠ÿØÿ´ ÿ•ŸÑŸâ: {self.selected_index}")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑÿÆŸäÿßÿ± {index}: {e}")

    def _on_mouse_enter(self, index: int):
        """ÿ™ŸÖŸäŸäÿ≤ ÿπŸÜÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ®ÿßŸÑŸÖÿßŸàÿ≥ (ŸÑÿß Ÿäÿ∫Ÿäÿ± selected_index)"""
        if not (0 <= index < len(self.option_buttons)):
            return

        try:
            # ÿ™ŸÖŸäŸäÿ≤ ÿ®ÿµÿ±Ÿä ÿÆŸÅŸäŸÅ ŸÅŸÇÿ∑
            if index != self.selected_index:
                self.option_buttons[index].configure(fg_color=("#F8F9FA", "#2A2D3A"))
        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑŸÖÿßŸàÿ≥ {index}: {e}")

    def _on_mouse_leave(self, index: int):
        """ÿ•ÿ≤ÿßŸÑÿ© ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑŸÖÿßŸàÿ≥ (ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ£ÿ≥ŸáŸÖ)"""
        if 0 <= index < len(self.option_buttons):
            try:
                if index != self.selected_index:
                    self.option_buttons[index].configure(fg_color="transparent")
            except Exception as e:
                if self.debug_mode:
                    print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ≤ÿßŸÑÿ© ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑŸÖÿßŸàÿ≥ {index}: {e}")

    def _scroll_to_option(self, index: int):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä Ÿàÿ™ÿØÿ±Ÿäÿ¨Ÿä ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© - Ÿäÿπÿ±ÿ∂ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ© ŸÅŸÇÿ∑"""
        if not (0 <= index < len(self.option_buttons)) or not hasattr(self, 'list_frame'):
            return

        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ canvas ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±
            if not hasattr(self.list_frame, '_parent_canvas') or not self.list_frame._parent_canvas:
                return

            canvas = self.list_frame._parent_canvas

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            canvas_height = canvas.winfo_height()
            scroll_top, scroll_bottom = canvas.yview()

            # ÿ≠ÿ≥ÿßÿ® ŸÖŸàŸÇÿπ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
            item_height = 37  # ÿßÿ±ÿ™ŸÅÿßÿπ ŸÉŸÑ ÿπŸÜÿµÿ± (35 + padding)
            item_top = index * item_height
            item_bottom = item_top + item_height

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            total_height = len(self.option_buttons) * item_height
            visible_top = scroll_top * total_height
            visible_bottom = scroll_bottom * total_height

            # ŸáÿßŸÖÿ¥ ÿ£ŸÖÿßŸÜ ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ± (ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜÿµÿ± ÿ®Ÿàÿ∂Ÿàÿ≠)
            margin = item_height * 0.5

            # ŸÅÿ≠ÿµ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜÿµÿ± ŸÖÿ±ÿ¶ŸäÿßŸã ÿ®ÿßŸÑŸÅÿπŸÑ
            is_visible = (item_top >= visible_top - margin and
                         item_bottom <= visible_bottom + margin)

            if is_visible:
                # ÿßŸÑÿπŸÜÿµÿ± ŸÖÿ±ÿ¶Ÿä - ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±
                if self.debug_mode:
                    print(f"üìú ÿßŸÑÿπŸÜÿµÿ± {index} ŸÖÿ±ÿ¶Ÿä ÿ®ÿßŸÑŸÅÿπŸÑ - ŸÑÿß ÿ™ŸÖÿ±Ÿäÿ±")
                return

            # ÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ®
            if item_top < visible_top:
                # ÿßŸÑÿπŸÜÿµÿ± ÿ£ÿπŸÑŸâ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© - ÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿπŸÑŸâ
                self._scroll_up_to_show(canvas, index, item_height, total_height)
            else:
                # ÿßŸÑÿπŸÜÿµÿ± ÿ£ÿ≥ŸÅŸÑ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© - ÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿ≥ŸÅŸÑ
                self._scroll_down_to_show(canvas, index, item_height, total_height)

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä: {e}")

    def _scroll_up_to_show(self, canvas, index, item_height, total_height):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä ŸÑÿ£ÿπŸÑŸâ ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜÿµÿ±"""
        try:
            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® (ŸÖÿπ ŸáÿßŸÖÿ¥ ÿµÿ∫Ÿäÿ±)
            target_top = max(0, (index - 1) * item_height)
            new_scroll_position = target_top / total_height

            # ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä
            current_position = canvas.yview()[0]
            step = min(0.1, abs(new_scroll_position - current_position) / 3)

            if new_scroll_position < current_position:
                target_position = max(new_scroll_position, current_position - step)
                canvas.yview_moveto(target_position)

                if self.debug_mode:
                    print(f"üìú‚¨ÜÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿπŸÑŸâ: ÿßŸÑÿπŸÜÿµÿ± {index} (ŸÖŸàŸÇÿπ: {target_position:.3f})")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿπŸÑŸâ: {e}")

    def _scroll_down_to_show(self, canvas, index, item_height, total_height):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä ŸÑÿ£ÿ≥ŸÅŸÑ ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿßŸÑŸäÿ©"""
        try:
            canvas_height = canvas.winfo_height()
            visible_items = max(1, int(canvas_height / item_height))

            # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜÿµÿ± ŸÅŸä ÿ£ÿ≥ŸÅŸÑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©
            target_bottom_item = min(len(self.option_buttons) - 1, index + 1)
            target_top_item = max(0, target_bottom_item - visible_items + 1)

            target_top = target_top_item * item_height
            new_scroll_position = min(1.0, target_top / total_height)

            # ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä
            current_position = canvas.yview()[0]
            step = min(0.1, abs(new_scroll_position - current_position) / 3)

            if new_scroll_position > current_position:
                target_position = min(new_scroll_position, current_position + step)
                canvas.yview_moveto(target_position)

                if self.debug_mode:
                    print(f"üìú‚¨áÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿ≥ŸÅŸÑ: ÿßŸÑÿπŸÜÿµÿ± {index} (ŸÖŸàŸÇÿπ: {target_position:.3f}) - ÿπŸÜÿßÿµÿ± ŸÖÿ±ÿ¶Ÿäÿ©: {visible_items}")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿ≥ŸÅŸÑ: {e}")

    def _scroll_to_option_smooth(self, index: int, direction: str = "auto"):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ≥ŸÑÿ≥ ŸàŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿπŸÜÿµÿ± ŸÖÿπ ŸÖÿ±ÿßÿπÿßÿ© ÿßŸÑÿßÿ™ÿ¨ÿßŸá"""
        if not (0 <= index < len(self.option_buttons)) or not hasattr(self, 'list_frame'):
            return

        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ canvas ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±
            if not hasattr(self.list_frame, '_parent_canvas') or not self.list_frame._parent_canvas:
                return

            canvas = self.list_frame._parent_canvas

            # ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ≥ŸÖÿßÿ≠ ŸÑŸÑÿ™ÿ≠ÿØŸäÿØ ÿ®ÿßŸÑÿ≠ÿØŸàÿ´ ÿ£ŸàŸÑÿßŸã
            def perform_smooth_scroll():
                try:
                    # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ©
                    canvas_height = canvas.winfo_height()
                    scroll_top, scroll_bottom = canvas.yview()

                    # ÿ≠ÿ≥ÿßÿ® ŸÖŸàŸÇÿπ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
                    item_height = 37  # ÿßÿ±ÿ™ŸÅÿßÿπ ŸÉŸÑ ÿπŸÜÿµÿ±
                    item_top = index * item_height
                    item_bottom = item_top + item_height

                    # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
                    total_height = len(self.option_buttons) * item_height
                    visible_top = scroll_top * total_height
                    visible_bottom = scroll_bottom * total_height

                    # ŸáÿßŸÖÿ¥ ÿ£ŸÖÿßŸÜ (ŸÜÿµŸÅ ÿπŸÜÿµÿ±)
                    margin = item_height * 0.5

                    # ŸÅÿ≠ÿµ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜÿµÿ± ŸÖÿ±ÿ¶ŸäÿßŸã ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
                    is_fully_visible = (item_top >= visible_top + margin and
                                       item_bottom <= visible_bottom - margin)

                    if is_fully_visible:
                        if self.debug_mode:
                            print(f"üìú‚úÖ ÿßŸÑÿπŸÜÿµÿ± {index} ŸÖÿ±ÿ¶Ÿä ÿ®ÿßŸÑŸÉÿßŸÖŸÑ - ŸÑÿß ÿ™ŸÖÿ±Ÿäÿ± ŸÖÿ∑ŸÑŸàÿ®")
                        return

                    # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ≠ÿ≥ÿ® ÿßŸÑÿßÿ™ÿ¨ÿßŸá
                    if direction == "down":
                        self._smart_scroll_down(canvas, index, item_height, total_height, canvas_height)
                    elif direction == "up":
                        self._smart_scroll_up(canvas, index, item_height, total_height, canvas_height)
                    else:
                        # ÿ™ŸÖÿ±Ÿäÿ± ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàŸÇÿπ
                        self._scroll_to_option(index)

                except Exception as e:
                    if self.debug_mode:
                        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÑÿ≥: {e}")

            # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ®ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ±
            self.after(10, perform_smooth_scroll)

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÑÿ≥: {e}")

    def _smart_scroll_down(self, canvas, index, item_height, total_height, canvas_height):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä ŸÑÿ£ÿ≥ŸÅŸÑ - Ÿäÿπÿ±ÿ∂ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã"""
        try:
            visible_items = max(1, int(canvas_height / item_height) - 1)  # ÿ™ÿ±ŸÉ ŸÖÿ≥ÿßÿ≠ÿ© ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜÿµÿ± ŸÅŸä ÿßŸÑŸÜÿµŸÅ ÿßŸÑÿ≥ŸÅŸÑŸä ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©ÿå ŸÇŸÖ ÿ®ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
            current_scroll_top = canvas.yview()[0]
            current_top_item = int((current_scroll_top * total_height) / item_height)

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÖÿ≠ÿØÿØ ŸÇÿ±Ÿäÿ®ÿßŸã ŸÖŸÜ ŸÜŸáÿßŸäÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©
            if index >= current_top_item + visible_items - 2:
                # ÿ≠ÿ≥ÿßÿ® ŸÖŸàŸÇÿπ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ¨ÿØŸäÿØ ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿπŸÜÿßÿµÿ± ÿ•ÿ∂ÿßŸÅŸäÿ©
                new_top_item = min(len(self.option_buttons) - visible_items,
                                 max(0, index - visible_items + 3))

                new_scroll_position = (new_top_item * item_height) / total_height
                new_scroll_position = min(1.0, new_scroll_position)

                # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
                canvas.yview_moveto(new_scroll_position)

                if self.debug_mode:
                    print(f"üìú‚¨áÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä ŸÑÿ£ÿ≥ŸÅŸÑ: ÿßŸÑÿπŸÜÿµÿ± {index} - ÿπÿ±ÿ∂ ŸÖŸÜ {new_top_item}")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä ŸÑÿ£ÿ≥ŸÅŸÑ: {e}")

    def _smart_scroll_up(self, canvas, index, item_height, total_height, canvas_height):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä ŸÑÿ£ÿπŸÑŸâ - Ÿäÿπÿ±ÿ∂ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã"""
        try:
            visible_items = max(1, int(canvas_height / item_height) - 1)

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜÿµÿ± ŸÅŸä ÿßŸÑŸÜÿµŸÅ ÿßŸÑÿπŸÑŸàŸä ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©ÿå ŸÇŸÖ ÿ®ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
            current_scroll_top = canvas.yview()[0]
            current_top_item = int((current_scroll_top * total_height) / item_height)

            # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÖÿ≠ÿØÿØ ŸÇÿ±Ÿäÿ®ÿßŸã ŸÖŸÜ ÿ®ÿØÿßŸäÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©
            if index <= current_top_item + 1:
                # ÿ≠ÿ≥ÿßÿ® ŸÖŸàŸÇÿπ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ¨ÿØŸäÿØ ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿπŸÜÿßÿµÿ± ÿ≥ÿßÿ®ŸÇÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
                new_top_item = max(0, index - 2)

                new_scroll_position = (new_top_item * item_height) / total_height
                new_scroll_position = max(0.0, new_scroll_position)

                # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
                canvas.yview_moveto(new_scroll_position)

                if self.debug_mode:
                    print(f"üìú‚¨ÜÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä ŸÑÿ£ÿπŸÑŸâ: ÿßŸÑÿπŸÜÿµÿ± {index} - ÿπÿ±ÿ∂ ŸÖŸÜ {new_top_item}")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä ŸÑÿ£ÿπŸÑŸâ: {e}")

    def _scroll_to_top_smooth(self):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ≥ŸÑÿ≥ ŸÑŸÑÿ£ÿπŸÑŸâ (ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä - ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ©)"""
        if not hasattr(self, 'list_frame') or not hasattr(self.list_frame, '_parent_canvas'):
            return

        try:
            canvas = self.list_frame._parent_canvas
            if not canvas:
                return

            # ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä ŸÑŸÑÿ£ÿπŸÑŸâ
            def smooth_scroll_to_top(current_position=None):
                if current_position is None:
                    current_position = canvas.yview()[0]

                if current_position <= 0.05:  # ŸàÿµŸÑ ŸÑŸÑÿ£ÿπŸÑŸâ ÿ™ŸÇÿ±Ÿäÿ®ÿßŸã
                    canvas.yview_moveto(0.0)  # ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑÿ£ÿπŸÑŸâ ÿ™ŸÖÿßŸÖÿßŸã
                    if self.debug_mode:
                        print("üîÑ‚¨ÜÔ∏è ŸàÿµŸÑ ŸÑŸÑÿ£ÿπŸÑŸâ - ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä ŸÖŸÉÿ™ŸÖŸÑ")
                    return

                # ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä
                step = min(0.15, current_position / 3)
                new_position = max(0.0, current_position - step)
                canvas.yview_moveto(new_position)

                # ÿßŸÑÿßÿ≥ÿ™ŸÖÿ±ÿßÿ± ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
                self.after(30, lambda: smooth_scroll_to_top(new_position))

            smooth_scroll_to_top()

            if self.debug_mode:
                print("üîÑ‚¨ÜÔ∏è ÿ®ÿØÿ° ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÑÿ≥ ŸÑŸÑÿ£ÿπŸÑŸâ (ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä)")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑÿ£ÿπŸÑŸâ: {e}")

    def _scroll_to_bottom_smooth(self):
        """ÿ™ŸÖÿ±Ÿäÿ± ÿ≥ŸÑÿ≥ ŸÑŸÑÿ£ÿ≥ŸÅŸÑ (ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä - ÿßŸÑÿ∞Ÿáÿßÿ® ŸÑŸÑŸÜŸáÿßŸäÿ©)"""
        if not hasattr(self, 'list_frame') or not hasattr(self.list_frame, '_parent_canvas'):
            return

        try:
            canvas = self.list_frame._parent_canvas
            if not canvas:
                return

            # ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä ŸÑŸÑÿ£ÿ≥ŸÅŸÑ
            def smooth_scroll_to_bottom(current_position=None):
                if current_position is None:
                    current_position = canvas.yview()[0]

                if current_position >= 0.95:  # ŸàÿµŸÑ ŸÑŸÑÿ£ÿ≥ŸÅŸÑ ÿ™ŸÇÿ±Ÿäÿ®ÿßŸã
                    canvas.yview_moveto(1.0)  # ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑÿ£ÿ≥ŸÅŸÑ ÿ™ŸÖÿßŸÖÿßŸã
                    if self.debug_mode:
                        print("üîÑ‚¨áÔ∏è ŸàÿµŸÑ ŸÑŸÑÿ£ÿ≥ŸÅŸÑ - ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä ŸÖŸÉÿ™ŸÖŸÑ")
                    return

                # ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä
                step = min(0.15, (1.0 - current_position) / 3)
                new_position = min(1.0, current_position + step)
                canvas.yview_moveto(new_position)

                # ÿßŸÑÿßÿ≥ÿ™ŸÖÿ±ÿßÿ± ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
                self.after(30, lambda: smooth_scroll_to_bottom(new_position))

            smooth_scroll_to_bottom()

            if self.debug_mode:
                print("üîÑ‚¨áÔ∏è ÿ®ÿØÿ° ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÑÿ≥ ŸÑŸÑÿ£ÿ≥ŸÅŸÑ (ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä)")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑÿ£ÿ≥ŸÅŸÑ: {e}")

    # ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ£ÿµŸÑŸäÿ© (ŸÑŸÑÿ™ŸàÿßŸÅŸÇ - ŸÑŸÉŸÜ ŸÑŸÜ ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿπÿØ ÿßŸÑÿ¢ŸÜ)
    def _on_arrow_down(self, event):
        """ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿ≥ŸÅŸÑ - ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÅŸÇÿ∑ (ŸÖŸèÿπÿ∑ŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ)"""
        if self.debug_mode:
            print("‚ö†Ô∏è ÿ™ŸÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° _on_arrow_down ÿßŸÑŸÖŸÉÿ±ÿ± (ŸÖŸèÿ™ÿ¨ÿßŸáŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿÆÿ∑Ÿä)")
        # ŸÑÿß ŸÜŸÅÿπŸÑ ÿ¥Ÿäÿ¶ÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
        return "break"

    def _on_arrow_up(self, event):
        """ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿπŸÑŸâ - ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÅŸÇÿ∑ (ŸÖŸèÿπÿ∑ŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ)"""
        if self.debug_mode:
            print("‚ö†Ô∏è ÿ™ŸÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° _on_arrow_up ÿßŸÑŸÖŸÉÿ±ÿ± (ŸÖŸèÿ™ÿ¨ÿßŸáŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿÆÿ∑Ÿä)")
        # ŸÑÿß ŸÜŸÅÿπŸÑ ÿ¥Ÿäÿ¶ÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
        return "break"

    def _on_enter(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Enter - ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÅŸÇÿ∑ (ŸÖŸèÿπÿ∑ŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ)"""
        if self.debug_mode:
            print("‚ö†Ô∏è ÿ™ŸÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° _on_enter ÿßŸÑŸÖŸÉÿ±ÿ± (ŸÖŸèÿ™ÿ¨ÿßŸáŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿÆÿ∑Ÿä)")
        # ŸÑÿß ŸÜŸÅÿπŸÑ ÿ¥Ÿäÿ¶ÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
        return "break"

    def _on_escape(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Escape - ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÅŸÇÿ∑ (ŸÖŸèÿπÿ∑ŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ)"""
        if self.debug_mode:
            print("‚ö†Ô∏è ÿ™ŸÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ° _on_escape ÿßŸÑŸÖŸÉÿ±ÿ± (ŸÖŸèÿ™ÿ¨ÿßŸáŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿÆÿ∑Ÿä)")
        # ŸÑÿß ŸÜŸÅÿπŸÑ ÿ¥Ÿäÿ¶ÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
        return "break"

    # ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿπÿßŸÖÿ©
    def get(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖÿ©"""
        return self.selected_value

    def set(self, value: str):
        """ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ©"""
        if self.debug_mode:
            print(f"üîß ÿ™ÿπŸäŸäŸÜ: '{value}'")

        self._updating_text = True
        try:
            if value and value not in self.values:
                self.add_value(value)

            self.selected_value = value
            self.text_var.set(value)
            self.entry.delete(0, tk.END)
            self.entry.insert(0, value)
        finally:
            self._updating_text = False

    def clear(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑŸÇŸäŸÖÿ©"""
        self._updating_text = True
        try:
            self.selected_value = ""
            self.text_var.set("")
            self.entry.delete(0, tk.END)
            self.filtered_values = self.values.copy()
            if self.is_dropdown_open:
                self._close_dropdown()
        finally:
            self._updating_text = False

    def set_values(self, values: List[str]):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÇŸäŸÖ"""
        self.values = values.copy() if values else []
        self.filtered_values = self.values.copy()
        if self.debug_mode:
            print(f"üìã ÿ™ÿ≠ÿØŸäÿ´: {len(self.values)} ÿπŸÜÿµÿ±")

    def add_value(self, value: str):
        """ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ©"""
        if value and value not in self.values:
            self.values.append(value)
            self.filtered_values = self.values.copy()

    def is_valid_selection(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±"""
        return self.selected_value in self.values

    def focus_set(self):
        """ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ"""
        self.entry.focus_set()
        self._has_focus = True

    def apply_blue_theme(self, theme_manager=None):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ"""
        try:
            blue_colors = {
                'entry_bg': '#F8F9FA',
                'border_color': '#2196F3',
                'text_color': '#1976D2',
                'button_hover': '#E3F2FD'
            }

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÑŸâ ÿ≠ŸÇŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
            if hasattr(self, 'entry'):
                self.entry.configure(
                    fg_color=blue_colors['entry_bg'],
                    border_color=blue_colors['border_color'],
                    text_color=blue_colors['text_color']
                )

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            if hasattr(self, 'dropdown_btn'):
                self.dropdown_btn.configure(
                    hover_color=blue_colors['button_hover'],
                    border_color=blue_colors['border_color']
                )

            if self.debug_mode:
                print("‚úÖ ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ")

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ŸÅÿ¥ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ: {e}")

    def destroy(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿπŸÜÿØ ÿßŸÑÿ≠ÿ∞ŸÅ"""
        try:
            # ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿßŸäŸÖÿ±ÿßÿ™
            if hasattr(self, '_filter_timer') and self._filter_timer:
                self.after_cancel(self._filter_timer)
                self._filter_timer = None

            # ÿ•ŸäŸÇÿßŸÅ ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÖŸàŸÇÿπ
            if self._position_check_id:
                self.after_cancel(self._position_check_id)
                self._position_check_id = None

            # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            if self.is_dropdown_open:
                self._close_dropdown()

            # ÿßÿ≥ÿ™ÿØÿπÿßÿ° destroy ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
            super().destroy()

        except Exception as e:
            if self.debug_mode:
                print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ: {e}")


# ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®ÿØŸäŸÑÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
EnhancedSearchableComboBoxImproved = EnhancedSearchableComboBox
SearchableComboBox = EnhancedSearchableComboBox


def create_enhanced_dropdown_with_improved_click(parent, field_name: str, initial_value: str = "",
                                                values: List[str] = None, themed_window=None,
                                                debug_mode: bool = False, theme_manager=None):
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ ÿ¢ŸÑŸäÿ© ÿßŸÑŸÜŸÇÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© Ÿàÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""

    # ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑŸÇŸäŸÖ
    if not values:
        values = []

    if initial_value and initial_value not in values:
        values = [initial_value] + values

    # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸÉŸàŸÜ
    combo = EnhancedSearchableComboBox(
        parent=parent,
        values=values,
        placeholder=f"ÿßÿ®ÿ≠ÿ´ ŸÅŸä {field_name}...",
        width=300,
        height=35,
        max_results=15,
        debug_mode=debug_mode
    )

    # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ
    if theme_manager:
        try:
            combo.apply_blue_theme(theme_manager)
        except Exception as e:
            print(f"‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ: {e}")

    if themed_window:
        try:
            themed_window.apply_to_widget(combo.entry, 'entry')
            themed_window.apply_to_widget(combo.dropdown_btn, 'button_secondary')
        except Exception as e:
            print(f"ÿ™ÿ≠ÿ∞Ÿäÿ±: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿπÿßÿØŸä: {e}")

    # ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸàŸÑŸäÿ©
    if initial_value:
        combo.set(initial_value)

    # ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ™ÿ∫Ÿäÿ± ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
    var = tk.StringVar(value=initial_value)

    # ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ŸÖÿπ ÿßŸÑŸÖŸÉŸàŸÜ
    def sync_var():
        try:
            current_value = combo.get()
            if var.get() != current_value:
                var.set(current_value)
        except:
            pass

    def sync_combo(*args):
        try:
            current_value = var.get()
            if current_value != combo.get():
                combo.set(current_value)
        except:
            pass

    # ÿ±ÿ®ÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™
    var.trace('w', sync_combo)

    # ÿ™ÿ≠ÿØŸäÿ´ ÿØŸàÿ±Ÿä
    def periodic_sync():
        try:
            sync_var()
            combo.after(2000, periodic_sync)
        except:
            pass

    combo.after(100, periodic_sync)

    return var, combo


def create_airtable_combo_for_field(parent, field_name: str, dropdown_manager=None,
                                   themed_window=None, values: List[str] = None,
                                   debug_mode: bool = False, **kwargs):
    """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ŸÑÿ≠ŸÇŸÑ Airtable ŸÖÿπ ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""

    placeholder_map = {
        "Agency": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸàŸÉÿßŸÑÿ©...",
        "Guide": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ±ÿ¥ÿØ...",
        "Option": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿÆŸäÿßÿ±...",
        "des": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ Ÿàÿ¨Ÿáÿ©...",
        "trip Name": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿ±ÿ≠ŸÑÿ©...",
        "Management Option": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿÆŸäÿßÿ± ÿ•ÿØÿßÿ±ÿ©...",
        "Add-on": "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ•ÿ∂ÿßŸÅÿ©..."
    }

    if not kwargs.get('placeholder'):
        kwargs['placeholder'] = placeholder_map.get(field_name, f"ÿßÿ®ÿ≠ÿ´ ŸÅŸä {field_name}...")

    kwargs.setdefault('max_results', 15)
    kwargs.setdefault('debug_mode', debug_mode)

    if values:
        kwargs['values'] = values

    return EnhancedSearchableComboBox(parent=parent, **kwargs)


# ÿØÿßŸÑÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸèÿ≠ÿØÿ´ÿ© ŸÖÿπ ÿßŸÑÿ™ÿ£ŸÉŸäÿØ ÿπŸÑŸâ ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ£ÿ≥ŸáŸÖ
def test_natural_scroll_navigation():
    """ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿ∑ÿ®ŸäÿπŸä ŸÖÿπ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä ŸàÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""

    app = ctk.CTk()
    app.title("üåä ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸàÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä")
    app.geometry("700x650")

    # ŸÇÿßÿ¶ŸÖÿ© ŸÉÿ®Ÿäÿ±ÿ© ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ± (ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©)
    test_values = [f"ÿßŸÑÿπŸÜÿµÿ± ÿ±ŸÇŸÖ {i+1:02d}" for i in range(25)]

    # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ
    navigation_log = []
    scroll_log = []
    circular_navigation_count = 0

    def log_navigation(action, old_index, new_index):
        """ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ™ŸÜŸÇŸÑ ŸÖÿπ ÿßŸÑÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä"""
        nonlocal circular_navigation_count

        # ÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ
        is_circular = False
        if (old_index == len(test_values) - 1 and new_index == 0):
            is_circular = True
            action = "üîÑ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä (ÿßŸÑŸÜŸáÿßŸäÿ©‚ÜíÿßŸÑÿ®ÿØÿßŸäÿ©)"
            circular_navigation_count += 1
        elif (old_index == 0 and new_index == len(test_values) - 1):
            is_circular = True
            action = "üîÑ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä (ÿßŸÑÿ®ÿØÿßŸäÿ©‚ÜíÿßŸÑŸÜŸáÿßŸäÿ©)"
            circular_navigation_count += 1

        log_entry = f"{action}: {old_index} ‚Üí {new_index}"
        if is_circular:
            log_entry += " ‚ú®"

        navigation_log.append(log_entry)
        log_text.configure(text="\n".join(navigation_log[-6:]))  # ÿ¢ÿÆÿ± 6 ÿ≠ÿ±ŸÉÿßÿ™

        # ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
        circular_count_label.configure(text=f"ÿ™ŸÜŸÇŸÑÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©: {circular_navigation_count} üîÑ")

    def log_scroll(action):
        """ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±"""
        scroll_log.append(action)
        scroll_text.configure(text="\n".join(scroll_log[-4:]))  # ÿ¢ÿÆÿ± 4 ÿ£ÿ≠ÿØÿßÿ´ ÿ™ŸÖÿ±Ÿäÿ±

    # ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿ´ÿ©
    instructions = ctk.CTkLabel(
        app,
        text="üåä ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸàÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä:\n\n" +
             "‚ú® ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©:\n" +
             "‚Ä¢ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä: ŸÖŸÜ ÿßŸÑŸÜŸáÿßŸäÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ© ŸàÿßŸÑÿπŸÉÿ≥ üîÑ\n" +
             "‚Ä¢ ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä Ÿàÿ≥ŸÑÿ≥ ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä\n" +
             "‚Ä¢ ÿπÿ±ÿ∂ ÿ∑ÿ®ŸäÿπŸä ŸÖÿ´ŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ©\n\n" +
             "üß™ ÿ¨ÿ±ÿ® ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÜŸáÿßŸäÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ´ŸÖ ÿßÿ∂ÿ∫ÿ∑ ‚Üì:",
        font=ctk.CTkFont(size=12, weight="bold"),
        justify="center"
    )
    instructions.pack(pady=15)

    # ComboBox ŸÖŸèÿ≠ÿ≥ŸÜ ŸÖÿπ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
    class CircularNavigationComboBox(EnhancedSearchableComboBox):
        def _highlight_option(self, index: int):
            """ÿ™ŸÖŸäŸäÿ≤ ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä"""
            old_index = self.selected_index
            super()._highlight_option(index)
            new_index = self.selected_index

            if old_index != new_index:
                action = "ÿ™ŸÜŸÇŸÑ ÿ®ÿßŸÑÿ£ÿ≥ŸáŸÖ"
                log_navigation(action, old_index, new_index)

                if new_index < len(self.filtered_values):
                    value = self.filtered_values[new_index]
                    position_info = ""
                    if new_index == 0:
                        position_info = " (ÿßŸÑÿ®ÿØÿßŸäÿ© ‚¨ÜÔ∏è)"
                    elif new_index == len(self.filtered_values) - 1:
                        position_info = " (ÿßŸÑŸÜŸáÿßŸäÿ© ‚¨áÔ∏è)"

                    current_selection.configure(text=f"ŸÖÿ≠ÿØÿØ: {value} (ŸÅŸáÿ±ÿ≥: {new_index}){position_info}")

        def _scroll_to_top_smooth(self):
            """ÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑÿ£ÿπŸÑŸâ ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ"""
            log_scroll("üîÑ‚¨ÜÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ÿØÿßÿ¶ÿ±Ÿä ŸÑŸÑÿ£ÿπŸÑŸâ")
            super()._scroll_to_top_smooth()

        def _scroll_to_bottom_smooth(self):
            """ÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑÿ£ÿ≥ŸÅŸÑ ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ"""
            log_scroll("üîÑ‚¨áÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ÿØÿßÿ¶ÿ±Ÿä ŸÑŸÑÿ£ÿ≥ŸÅŸÑ")
            super()._scroll_to_bottom_smooth()

        def _smart_scroll_down(self, canvas, index, item_height, total_height, canvas_height):
            """ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ"""
            log_scroll(f"‚¨áÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ÿπÿßÿØŸä ŸÑŸÑÿπŸÜÿµÿ± {index}")
            super()._smart_scroll_down(canvas, index, item_height, total_height, canvas_height)

        def _smart_scroll_up(self, canvas, index, item_height, total_height, canvas_height):
            """ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ"""
            log_scroll(f"‚¨ÜÔ∏è ÿ™ŸÖÿ±Ÿäÿ± ÿπÿßÿØŸä ŸÑŸÑÿπŸÜÿµÿ± {index}")
            super()._smart_scroll_up(canvas, index, item_height, total_height, canvas_height)

    # ÿ•ŸÜÿ¥ÿßÿ° ComboBox ŸÖÿ≠ÿ≥ŸÜ
    combo_frame = ctk.CTkFrame(app)
    combo_frame.pack(pady=20, padx=20, fill="x")

    combo_label = ctk.CTkLabel(
        combo_frame,
        text="üìã ŸÇÿßÿ¶ŸÖÿ© ÿ∑ŸàŸäŸÑÿ© (25 ÿπŸÜÿµÿ±) - ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä:",
        font=ctk.CTkFont(size=12, weight="bold")
    )
    combo_label.pack(pady=(10, 5))

    combo = CircularNavigationComboBox(
        parent=combo_frame,
        values=test_values,
        placeholder="ÿßŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸàÿßÿÆÿ™ÿ®ÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä...",
        width=500,
        height=40,
        max_results=25,  # ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ±
        debug_mode=True
    )
    combo.pack(pady=10)

    # ÿπÿ±ÿ∂ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÖÿ≠ÿØÿØ ÿ≠ÿßŸÑŸäÿßŸã
    current_selection = ctk.CTkLabel(
        app,
        text="ŸÖÿ≠ÿØÿØ ÿ≠ÿßŸÑŸäÿßŸã: ŸÑÿß ÿ¥Ÿäÿ°",
        font=ctk.CTkFont(size=14, weight="bold"),
        text_color=("#2196F3", "#64B5F6")
    )
    current_selection.pack(pady=10)

    # ÿπÿØÿßÿØ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
    circular_count_label = ctk.CTkLabel(
        app,
        text="ÿ™ŸÜŸÇŸÑÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©: 0 üîÑ",
        font=ctk.CTkFont(size=12, weight="bold"),
        text_color=("#FF9800", "#FFA726")
    )
    circular_count_label.pack(pady=5)

    # ÿ•ÿ∑ÿßÿ± ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
    logs_frame = ctk.CTkFrame(app)
    logs_frame.pack(pady=20, padx=20, fill="both", expand=True)

    # ÿ≥ÿ¨ŸÑ ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ™ŸÜŸÇŸÑ
    nav_frame = ctk.CTkFrame(logs_frame)
    nav_frame.pack(side="left", fill="both", expand=True, padx=(0, 10))

    nav_title = ctk.CTkLabel(
        nav_frame,
        text="üìã ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ŸÜŸÇŸÑ (ÿ¢ÿÆÿ± 6 ÿ≠ÿ±ŸÉÿßÿ™):",
        font=ctk.CTkFont(size=11, weight="bold")
    )
    nav_title.pack(pady=(10, 5))

    log_text = ctk.CTkLabel(
        nav_frame,
        text="ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ÿπÿØ...",
        font=ctk.CTkFont(size=10, family="monospace"),
        justify="left",
        anchor="w"
    )
    log_text.pack(pady=10, padx=10, fill="both", expand=True)

    # ÿ≥ÿ¨ŸÑ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
    scroll_frame = ctk.CTkFrame(logs_frame)
    scroll_frame.pack(side="right", fill="both", expand=True, padx=(10, 0))

    scroll_title = ctk.CTkLabel(
        scroll_frame,
        text="üìú ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± (ÿ¢ÿÆÿ± 4 ÿ£ÿ≠ÿØÿßÿ´):",
        font=ctk.CTkFont(size=11, weight="bold")
    )
    scroll_title.pack(pady=(10, 5))

    scroll_text = ctk.CTkLabel(
        scroll_frame,
        text="ŸÑŸÖ Ÿäÿ≠ÿØÿ´ ÿ™ŸÖÿ±Ÿäÿ± ÿ®ÿπÿØ...",
        font=ctk.CTkFont(size=10, family="monospace"),
        justify="left",
        anchor="w"
    )
    scroll_text.pack(pady=10, padx=10, fill="both", expand=True)

    # ÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿ´ÿ©
    test_guide = ctk.CTkFrame(app)
    test_guide.pack(pady=10, padx=20, fill="x")

    guide_text = [
        "üß™ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ:",
        "‚Ä¢ ÿßŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© Ÿàÿßÿ≥ÿ™ÿÆÿØŸÖ ‚Üì ŸÑŸÑŸàÿµŸàŸÑ ŸÑŸÜŸáÿßŸäÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ©",
        "‚Ä¢ ÿπŸÜÿØ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑÿπŸÜÿµÿ± ÿßŸÑÿ£ÿÆŸäÿ±ÿå ÿßÿ∂ÿ∫ÿ∑ ‚Üì ‚Üí ÿ≥ŸäŸÜÿ™ŸÇŸÑ ŸÑŸÑÿ£ŸàŸÑ üîÑ",
        "‚Ä¢ ŸÖŸÜ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ£ŸàŸÑÿå ÿßÿ∂ÿ∫ÿ∑ ‚Üë ‚Üí ÿ≥ŸäŸÜÿ™ŸÇŸÑ ŸÑŸÑÿ£ÿÆŸäÿ± üîÑ",
        "‚Ä¢ ÿ±ÿßŸÇÿ® ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ≥ŸÑÿ≥ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä",
        "‚Ä¢ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸÖŸÖŸäÿ≤ ÿ®ŸÄ ‚ú® ŸÅŸä ÿßŸÑÿ≥ÿ¨ŸÑ"
    ]

    for i, text in enumerate(guide_text):
        label = ctk.CTkLabel(
            test_guide,
            text=text,
            font=ctk.CTkFont(size=10, weight="bold" if i == 0 else "normal"),
            text_color=("#2196F3", "#64B5F6") if i == 0 else ("gray", "lightgray"),
            anchor="e"
        )
        label.pack(pady=1, padx=10, anchor="e")

    # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ≠ÿØÿ´ÿ©
    button_frame = ctk.CTkFrame(app)
    button_frame.pack(pady=10)

    def open_and_select_first():
        combo._open_dropdown()
        if combo.option_buttons:
            combo._highlight_option(0)

    def open_and_select_last():
        combo._open_dropdown()
        if combo.option_buttons:
            last_index = len(combo.option_buttons) - 1
            combo._highlight_option(last_index)
            combo._scroll_to_bottom_smooth()

    def test_circular_down():
        """ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸÑÿ£ÿ≥ŸÅŸÑ"""
        if not combo.is_dropdown_open:
            combo._open_dropdown()
        if combo.option_buttons:
            last_index = len(combo.option_buttons) - 1
            combo._highlight_option(last_index)
            combo._scroll_to_bottom_smooth()
            combo.after(1000, lambda: combo._handle_arrow_down_enhanced())

    def test_circular_up():
        """ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸÑÿ£ÿπŸÑŸâ"""
        if not combo.is_dropdown_open:
            combo._open_dropdown()
        if combo.option_buttons:
            combo._highlight_option(0)
            combo._scroll_to_top_smooth()
            combo.after(1000, lambda: combo._handle_arrow_up_enhanced())

    def clear_logs():
        nonlocal circular_navigation_count
        navigation_log.clear()
        scroll_log.clear()
        circular_navigation_count = 0
        log_text.configure(text="ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ŸÜŸÇŸÑ...")
        scroll_text.configure(text="ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±...")
        circular_count_label.configure(text="ÿ™ŸÜŸÇŸÑÿßÿ™ ÿØÿßÿ¶ÿ±Ÿäÿ©: 0 üîÑ")
        current_selection.configure(text="ŸÖÿ≠ÿØÿØ ÿ≠ÿßŸÑŸäÿßŸã: ŸÑÿß ÿ¥Ÿäÿ°")

    ctk.CTkButton(button_frame, text="ŸÅÿ™ÿ≠ + ÿßŸÑÿ£ŸàŸÑ",
                  command=open_and_select_first).pack(side="left", padx=2)
    ctk.CTkButton(button_frame, text="ŸÅÿ™ÿ≠ + ÿßŸÑÿ£ÿÆŸäÿ±",
                  command=open_and_select_last).pack(side="left", padx=2)
    ctk.CTkButton(button_frame, text="ÿßÿÆÿ™ÿ®ÿßÿ± ‚Üì ÿØÿßÿ¶ÿ±Ÿä",
                  command=test_circular_down,
                  text_color=("#FF9800", "#FFA726")).pack(side="left", padx=2)
    ctk.CTkButton(button_frame, text="ÿßÿÆÿ™ÿ®ÿßÿ± ‚Üë ÿØÿßÿ¶ÿ±Ÿä",
                  command=test_circular_up,
                  text_color=("#FF9800", "#FFA726")).pack(side="left", padx=2)
    ctk.CTkButton(button_frame, text="ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™",
                  command=clear_logs).pack(side="left", padx=2)
    ctk.CTkButton(button_frame, text="ÿ•ÿ∫ŸÑÿßŸÇ",
                  command=combo._close_dropdown).pack(side="left", padx=2)

    print("üåä ÿ®ÿØÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸàÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä")
    print("‚ú® ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©:")
    print("  üîÑ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä - ŸÖŸÜ ÿßŸÑŸÜŸáÿßŸäÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ© ŸàÿßŸÑÿπŸÉÿ≥")
    print("  üéØ ÿ™ŸÖÿ±Ÿäÿ± ÿ∞ŸÉŸä - Ÿäÿ≠ÿØÿ´ ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ© ŸÅŸÇÿ∑")
    print("  üì± ÿ≥ŸÑŸàŸÉ ÿ∑ÿ®ŸäÿπŸä - ŸÖÿ´ŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ©")
    print("  üí´ ÿ™ŸÖÿ±Ÿäÿ± ÿ≥ŸÑÿ≥ ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä")
    print("=" * 60)

    app.mainloop()


# ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿØŸàÿßŸÑ ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
def test_enhanced_combobox_arrow_fix():
    """ÿØÿßŸÑÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ - ÿ™ÿ≥ÿ™ÿØÿπŸä ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä"""
    print("üìå ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ...")
    return test_natural_scroll_navigation()

def test_enhanced_combobox_with_live_filtering():
    """ÿØÿßŸÑÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ≥ÿßÿ®ŸÇ"""
    print("üìå ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä...")
    return test_natural_scroll_navigation()

def test_enhanced_combobox_with_tracking():
    """ÿØÿßŸÑÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ≥ÿßÿ®ŸÇ"""
    print("üìå ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä...")
    return test_natural_scroll_navigation()

def test_enhanced_combobox():
    """ÿØÿßŸÑÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ÿ®ÿ≥Ÿäÿ∑ÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿ•ÿµÿØÿßÿ± ÿßŸÑÿ≥ÿßÿ®ŸÇ"""
    print("üìå ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä...")
    return test_natural_scroll_navigation()


if __name__ == "__main__":
    test_natural_scroll_navigation()


# ‚úÖ ŸÖŸÑÿÆÿµ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ÿßÿ™ ŸàÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ÿ®ŸÇÿ©:
#
# üîß ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ£ÿ≥ŸáŸÖ:
#   1. ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑŸÖŸÉÿ±ÿ±ÿ© ŸÅŸä _setup_events()
#   2. ŸÖÿπÿßŸÑÿ¨ Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑: _on_key_release_enhanced()
#   3. ÿ™ÿ≠ÿ≥ŸäŸÜ _highlight_option() ŸÑÿ∂ŸÖÿßŸÜ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅŸáÿ±ÿ≥
#   4. ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖŸÉÿ±ÿ±ÿ© ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿØÿßÿÆŸÑ
#
# üîÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ:
#   1. ŸÖŸÜ ÿßŸÑŸÜŸáÿßŸäÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ© ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ‚Üì
#   2. ŸÖŸÜ ÿßŸÑÿ®ÿØÿßŸäÿ© ŸÑŸÑŸÜŸáÿßŸäÿ© ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ‚Üë
#   3. ÿ™ŸÖÿ±Ÿäÿ± ÿ≥ŸÑÿ≥ ŸàŸÖÿ™ÿ≠ÿ±ŸÉ ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
#   4. ŸÉÿ¥ŸÅ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä ŸÖÿπ ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖŸÖŸäÿ≤
#
# üåä ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä:
#   1. _scroll_to_option() ÿßŸÑÿ¢ŸÜ ÿ∞ŸÉŸä - ŸäŸÅÿ≠ÿµ ÿßŸÑÿ±ÿ§Ÿäÿ© ÿ£ŸàŸÑÿßŸã
#   2. ÿ™ŸÖÿ±Ÿäÿ± ÿ™ÿØÿ±Ÿäÿ¨Ÿä ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑŸÇŸÅÿ≤ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±
#   3. _smart_scroll_down() Ÿà _smart_scroll_up() ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä
#   4. _scroll_to_top_smooth() Ÿà _scroll_to_bottom_smooth() ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
#   5. ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± Ÿäÿ≠ÿØÿ´ ŸÅŸÇÿ∑ ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ© (ŸàÿµŸàŸÑ ŸÑÿ≠ÿßŸÅÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ©)
#
# üéØ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨:
#   ‚úÖ ÿ™ŸÜŸÇŸÑ ÿµÿ≠Ÿäÿ≠ ÿπŸÜÿµÿ± Ÿàÿßÿ≠ÿØ ÿ®ŸÉŸÑ ÿ∂ÿ∫ÿ∑ÿ© ÿ≥ŸáŸÖ
#   ‚úÖ ÿ™ŸÜŸÇŸÑ ÿØÿßÿ¶ÿ±Ÿä ÿ≥ŸÑÿ≥ ŸÖŸÜ ÿßŸÑŸÜŸáÿßŸäÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ© ŸàÿßŸÑÿπŸÉÿ≥ üîÑ
#   ‚úÖ ÿ™ŸÖÿ±Ÿäÿ± ÿ∑ÿ®ŸäÿπŸä Ÿàÿ∞ŸÉŸä ŸÖÿ´ŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ©
#   ‚úÖ ŸÑÿß ŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑŸÇŸÅÿ≤ÿßÿ™ ÿßŸÑŸÖŸÅÿßÿ¨ÿ¶ÿ© ŸÅŸä ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
#   ‚úÖ ÿ≥ŸÑŸàŸÉ ÿ®ÿØŸäŸáŸä ŸàŸÖÿ£ŸÑŸàŸÅ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
#   ‚úÖ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ÿ≥ŸÑÿ≥ÿ© ŸÑŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿØÿßÿ¶ÿ±Ÿä
#
# üß™ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±: python combobox.py

============================================================
FILE: views\components\data_table.py
SIZE: 20968 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/data_table.py

ŸÖŸÉŸàŸÜ ÿ¨ÿØŸàŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖÿπ ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
"""

import customtkinter as ctk
import tkinter as tk
from tkinter import ttk
from typing import Callable, List, Dict, Any
from datetime import datetime

from core.language_manager import LanguageManager


class DataTableComponent(ctk.CTkFrame):
    """ŸÖŸÉŸàŸÜ ÿ¨ÿØŸàŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""

    def __init__(
        self,
        parent,
        lang_manager: LanguageManager,
        on_row_double_click: Callable = None,
        on_selection_change: Callable = None,
        **kwargs
    ):
        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑÿ•ÿ∑ÿßÿ±
        kwargs.setdefault('corner_radius', 8)
        kwargs.setdefault('fg_color', ("#ffffff", "#2b2b2b"))
        super().__init__(parent, **kwargs)

        self.lang_manager = lang_manager
        self.on_row_double_click = on_row_double_click
        self.on_selection_change = on_selection_change

        self.selected_records = []
        self.all_records = []

        self._build_ui()
        self._apply_professional_style()

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ¨ÿØŸàŸÑ ŸÖÿπ padding ŸÖÿ≠ÿ≥ŸÜ
        table_container = ctk.CTkFrame(
            self,
            corner_radius=0,
            fg_color="transparent"
        )
        table_container.pack(fill="both", expand=True, padx=2, pady=2)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¨ÿØŸàŸÑ
        self._create_treeview(table_container)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
        self._create_scrollbars(table_container)

    def _create_treeview(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿØŸàŸÑ TreeView ŸÖÿ≠ÿ≥ŸÜ"""
        # ÿßŸÑÿ£ÿπŸÖÿØÿ©
        columns = self._get_column_names()

        # ÿ•ŸÜÿ¥ÿßÿ° TreeView ŸÖÿπ ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖÿ≠ÿ≥ŸÜÿ©
        self.tree = ttk.Treeview(
            parent,
            columns=columns,
            show="tree headings",
            selectmode="extended",
            height=15  # ÿπÿØÿØ ÿßŸÑÿµŸÅŸàŸÅ ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©
        )

        # ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿπŸÖÿØÿ© ŸÖÿπ ÿπÿ±ÿ∂ ŸÖÿ≠ÿ≥ŸÜ
        self.tree.column("#0", width=50, stretch=False)

        column_configs = [
            ("booking_nr", 130, "center"),
            ("date_trip", 110, "center"),
            ("customer_name", 180, "w"),
            ("hotel_name", 180, "w"),
            ("pickup_time", 100, "center"),
            ("price", 120, "e"),
            ("status", 120, "center")
        ]

        for i, (col, width, anchor) in enumerate(column_configs):
            if i < len(columns):
                self.tree.column(columns[i], width=width, anchor=anchor, minwidth=80)
                self.tree.heading(
                    columns[i],
                    text=col,
                    command=lambda c=columns[i]: self._sort_by_column(c)
                )

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÜŸÖÿ∑ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
        self._apply_treeview_style()

        # ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        self.tree.bind("<Double-1>", self._on_double_click)
        self.tree.bind("<<TreeviewSelect>>", self._on_selection_change)
        self.tree.bind("<Button-3>", self._on_right_click)  # ŸÇÿßÿ¶ŸÖÿ© ÿ≥ŸäÿßŸÇ

        # Ÿàÿ∂ÿπ ÿßŸÑÿ¨ÿØŸàŸÑ
        self.tree.grid(row=0, column=0, sticky="nsew")
        parent.grid_rowconfigure(0, weight=1)
        parent.grid_columnconfigure(0, weight=1)

        # ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜÿßŸàŸäŸÜ ÿßŸÑÿ£ÿπŸÖÿØÿ©
        self._update_column_headers()

    def _apply_treeview_style(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÜŸÖÿ∑ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÑŸÑÿ¨ÿØŸàŸÑ"""
        style = ttk.Style()

        # ŸÅÿ±ÿ∂ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜŸÖÿ∑
        try:
            style.theme_use("clam")
        except:
            pass

        # ÿ£ŸÑŸàÿßŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠ ŸàÿßŸÑÿØÿßŸÉŸÜ
        if ctk.get_appearance_mode() == "Dark":
            # ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ
            bg_color = "#2b2b2b"
            fg_color = "#ffffff"
            selected_bg = "#1976d2"
            selected_fg = "#ffffff"
            header_bg = "#1e1e1e"
            header_fg = "#ffffff"
            row_hover = "#3a3a3a"
            alt_row_bg = "#323232"
        else:
            # ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠
            bg_color = "#ffffff"
            fg_color = "#333333"
            selected_bg = "#e3f2fd"
            selected_fg = "#1976d2"
            header_bg = "#f8f9fa"
            header_fg = "#333333"
            row_hover = "#f5f5f5"
            alt_row_bg = "#f9f9f9"

        # ÿ™ŸÉŸàŸäŸÜ Treeview
        style.configure(
            "Treeview",
            background=bg_color,
            foreground=fg_color,
            rowheight=35,
            fieldbackground=bg_color,
            borderwidth=0,
            relief="flat",
            font=('Segoe UI', 10)
        )

        # ÿ™ŸÉŸàŸäŸÜ ÿ±ÿ£ÿ≥ ÿßŸÑÿ¨ÿØŸàŸÑ
        style.configure(
            "Treeview.Heading",
            background=header_bg,
            foreground=header_fg,
            relief="flat",
            borderwidth=0,
            font=('Segoe UI', 11, 'bold')
        )

        # ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ŸàÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
        style.map(
            "Treeview",
            background=[
                ('selected', selected_bg),
                ('active', row_hover)
            ],
            foreground=[
                ('selected', selected_fg),
                ('active', fg_color)
            ]
        )

        # ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ±ÿ£ÿ≥ ÿßŸÑÿ¨ÿØŸàŸÑ ÿπŸÜÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
        style.map(
            "Treeview.Heading",
            background=[
                ('active', selected_bg),
                ('pressed', selected_bg)
            ],
            foreground=[
                ('active', selected_fg),
                ('pressed', selected_fg)
            ]
        )

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿµŸÅŸàŸÅ ÿßŸÑŸÖÿ™ŸÜÿßŸàÿ®ÿ©
        self.tree.tag_configure('oddrow', background=bg_color)
        self.tree.tag_configure('evenrow', background=alt_row_bg)

        # ŸÅÿ±ÿ∂ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¨ÿØŸàŸÑ
        self.tree.update_idletasks()

    def _create_scrollbars(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ¥ÿ±ÿ∑ÿ© ÿ™ŸÖÿ±Ÿäÿ± ŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿ¥ÿ±Ÿäÿ∑ ÿ™ŸÖÿ±Ÿäÿ± ÿπŸÖŸàÿØŸä ŸÖÿ≠ÿ≥ŸÜ
        vsb_frame = ctk.CTkFrame(parent, width=16, fg_color="transparent")
        vsb_frame.grid(row=0, column=1, sticky="ns", padx=(2, 0))

        vsb = ttk.Scrollbar(
            vsb_frame,
            orient="vertical",
            command=self.tree.yview,
            style="Vertical.TScrollbar"
        )
        vsb.pack(fill="y", expand=True)
        self.tree.configure(yscrollcommand=vsb.set)

        # ÿ¥ÿ±Ÿäÿ∑ ÿ™ŸÖÿ±Ÿäÿ± ÿ£ŸÅŸÇŸä ŸÖÿ≠ÿ≥ŸÜ
        hsb_frame = ctk.CTkFrame(parent, height=16, fg_color="transparent")
        hsb_frame.grid(row=1, column=0, sticky="ew", pady=(2, 0))

        hsb = ttk.Scrollbar(
            hsb_frame,
            orient="horizontal",
            command=self.tree.xview,
            style="Horizontal.TScrollbar"
        )
        hsb.pack(fill="x", expand=True)
        self.tree.configure(xscrollcommand=hsb.set)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ŸÜŸÖÿ∑ ÿ£ÿ¥ÿ±ÿ∑ÿ© ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
        self._style_scrollbars()

    def _style_scrollbars(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ŸÜŸÖÿ∑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÑÿ£ÿ¥ÿ±ÿ∑ÿ© ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±"""
        style = ttk.Style()

        if ctk.get_appearance_mode() == "Dark":
            bg_color = "#2b2b2b"
            thumb_color = "#555555"
            thumb_hover = "#666666"
            arrow_color = "#999999"
        else:
            bg_color = "#f0f0f0"
            thumb_color = "#cccccc"
            thumb_hover = "#aaaaaa"
            arrow_color = "#666666"

        # ŸÜŸÖÿ∑ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿπŸÖŸàÿØŸä
        style.configure(
            "Vertical.TScrollbar",
            gripcount=0,
            background=thumb_color,
            darkcolor=bg_color,
            lightcolor=bg_color,
            troughcolor=bg_color,
            bordercolor=bg_color,
            arrowcolor=arrow_color,
            arrowsize=14
        )

        style.map(
            "Vertical.TScrollbar",
            background=[
                ('active', thumb_hover),
                ('pressed', thumb_hover),
                ('!active', thumb_color)
            ]
        )

        # ŸÜŸÖÿ∑ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿ£ŸÅŸÇŸä
        style.configure(
            "Horizontal.TScrollbar",
            gripcount=0,
            background=thumb_color,
            darkcolor=bg_color,
            lightcolor=bg_color,
            troughcolor=bg_color,
            bordercolor=bg_color,
            arrowcolor=arrow_color,
            arrowsize=14
        )

        style.map(
            "Horizontal.TScrollbar",
            background=[
                ('active', thumb_hover),
                ('pressed', thumb_hover),
                ('!active', thumb_color)
            ]
        )

    def display_data(self, records: List[Dict[str, Any]]):
        """ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ ŸÖÿπ ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©"""
        # ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
        self.all_records = records

        # ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ÿØŸàŸÑ
        if not hasattr(self, 'tree') or not self.tree.winfo_exists():
            return
        for item in self.tree.get_children():
            self.tree.delete(item)

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÖÿπ ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
        for idx, record in enumerate(records):
            fields = record.get('fields', {})

            # ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            values = (
                fields.get('Booking Nr.', ''),
                self._format_date(fields.get('Date Trip', '')),
                fields.get('Customer Name', ''),
                fields.get('Hotel Name', ''),
                self._format_time(fields.get('pickup time', '')),
                self._format_currency(fields.get('Net Rate', 0)),
                self._translate_status(fields.get('Booking Status', ''))
            )

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ™ÿßÿ¨ÿßÿ™
            tags = []

            # ÿ™ÿßÿ¨ ÿßŸÑÿµŸÅ (ÿ≤Ÿàÿ¨Ÿä/ŸÅÿ±ÿØŸä)
            if idx % 2 == 0:
                tags.append('evenrow')
            else:
                tags.append('oddrow')

            # ÿ™ÿßÿ¨ ÿßŸÑÿ≠ÿßŸÑÿ©
            status = fields.get('Booking Status', '').lower()
            if status == 'confirmed':
                tags.append('confirmed')
            elif status == 'pending':
                tags.append('pending')
            elif status == 'cancelled':
                tags.append('cancelled')
            elif status == 'completed':
                tags.append('completed')

            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿµŸÅ
            item = self.tree.insert("", "end", values=values, tags=tags)

        # ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
        self._apply_status_colors()

    def _apply_status_colors(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÑŸàÿßŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑÿ≠ÿßŸÑÿßÿ™"""
        if ctk.get_appearance_mode() == "Dark":
            # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ
            self.tree.tag_configure('confirmed', background='#1b5e20', foreground='#ffffff')
            self.tree.tag_configure('pending', background='#f57c00', foreground='#ffffff')
            self.tree.tag_configure('cancelled', background='#b71c1c', foreground='#ffffff')
            self.tree.tag_configure('completed', background='#0d47a1', foreground='#ffffff')
        else:
            # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠
            self.tree.tag_configure('confirmed', background='#d4edda', foreground='#155724')
            self.tree.tag_configure('pending', background='#fff3cd', foreground='#856404')
            self.tree.tag_configure('cancelled', background='#f8d7da', foreground='#721c24')
            self.tree.tag_configure('completed', background='#cce5ff', foreground='#004085')

    def _format_date(self, date_str):
        """ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ®ÿ¥ŸÉŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        if not date_str:
            return ""
        try:
            date = datetime.fromisoformat(date_str[:10])
            if self.lang_manager and self.lang_manager.current_lang == "ar":
                # ÿ™ŸÜÿ≥ŸäŸÇ ÿπÿ±ÿ®Ÿä ŸÖÿπ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ŸäÿßŸÖ
                days_ar = ['ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ', 'ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', 'ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', 'ÿßŸÑÿÆŸÖŸäÿ≥', 'ÿßŸÑÿ¨ŸÖÿπÿ©', 'ÿßŸÑÿ≥ÿ®ÿ™', 'ÿßŸÑÿ£ÿ≠ÿØ']
                day_name = days_ar[date.weekday()]
                return f"{day_name} {date.strftime('%d/%m/%Y')}"
            else:
                # ÿ™ŸÜÿ≥ŸäŸÇ ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä
                return date.strftime("%a %d %b %Y")
        except:
            return date_str

    def _format_time(self, time_str):
        """ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸàŸÇÿ™ ÿ®ÿ¥ŸÉŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        if not time_str:
            return ""
        try:
            # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸàŸÇÿ™
            if ":" in time_str:
                time_parts = time_str.split(":")
                hour = int(time_parts[0])
                minute = int(time_parts[1]) if len(time_parts) > 1 else 0

                # ÿ™ŸÜÿ≥ŸäŸÇ 12 ÿ≥ÿßÿπÿ©
                period = "PM" if hour >= 12 else "AM"
                if self.lang_manager and self.lang_manager.current_lang == "ar":
                    period = "ŸÖ" if hour >= 12 else "ÿµ"

                hour_12 = hour % 12
                if hour_12 == 0:
                    hour_12 = 12

                return f"{hour_12:02d}:{minute:02d} {period}"
            return time_str
        except:
            return time_str

    def _format_currency(self, amount):
        """ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿπŸÖŸÑÿ© ÿ®ÿ¥ŸÉŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        try:
            formatted = f"{float(amount):,.2f}"
            if self.lang_manager and self.lang_manager.current_lang == "ar":
                # ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑŸÅÿßÿµŸÑÿ© ÿ®ÿßŸÑŸÅÿßÿµŸÑÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                formatted = formatted.replace(",", "ÿå")
                return f"{formatted} $"
            else:
                return f"${formatted}"
        except:
            return "$0.00"

    def _translate_status(self, status):
        """ÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ŸÖÿπ ÿ£ŸäŸÇŸàŸÜÿ©"""
        if not self.lang_manager:
            return status

        # ŸÇÿßŸÖŸàÿ≥ ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ŸÖÿπ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿßÿ™
        status_map = {
            'confirmed': ('‚úì', 'status_confirmed', 'Confirmed'),
            'pending': ('‚è≥', 'status_pending', 'Pending'),
            'cancelled': ('‚úó', 'status_cancelled', 'Cancelled'),
            'completed': ('‚úî', 'status_completed', 'Completed')
        }

        status_lower = status.lower()
        if status_lower in status_map:
            icon, key, default = status_map[status_lower]
            translated = self.lang_manager.get(key, default)
            return f"{icon} {translated}"

        return status

    def _on_right_click(self, event):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑŸÜŸÇÿ± ÿ®ÿßŸÑÿ≤ÿ± ÿßŸÑÿ£ŸäŸÖŸÜ (ŸÇÿßÿ¶ŸÖÿ© ÿ≥ŸäÿßŸÇ)"""
        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿµŸÅ ÿßŸÑŸÖŸÜŸÇŸàÿ±
        item = self.tree.identify('item', event.x, event.y)
        if item:
            self.tree.selection_set(item)

            # ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿ≥ŸäÿßŸÇ
            context_menu = tk.Menu(self, tearoff=0)
            context_menu.configure(
                bg=("#ffffff" if ctk.get_appearance_mode() == "Light" else "#2b2b2b"),
                fg=("#000000" if ctk.get_appearance_mode() == "Light" else "#ffffff"),
                activebackground=("#e3f2fd" if ctk.get_appearance_mode() == "Light" else "#1976d2"),
                activeforeground=("#1976d2" if ctk.get_appearance_mode() == "Light" else "#ffffff"),
                font=('Segoe UI', 10)
            )

            # ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            context_menu.add_command(
                label=f"‚úèÔ∏è {self.lang_manager.get('edit', 'Edit')}",
                command=lambda: self._context_edit(item)
            )
            context_menu.add_command(
                label=f"üìã {self.lang_manager.get('copy', 'Copy')}",
                command=lambda: self._context_copy(item)
            )
            context_menu.add_separator()
            context_menu.add_command(
                label=f"üóëÔ∏è {self.lang_manager.get('delete', 'Delete')}",
                command=lambda: self._context_delete(item)
            )

            # ÿπÿ±ÿ∂ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            context_menu.tk_popup(event.x_root, event.y_root)

    def _context_edit(self, item):
        """ÿ™ÿπÿØŸäŸÑ ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≥ŸäÿßŸÇŸäÿ©"""
        index = self.tree.index(item)
        if 0 <= index < len(self.all_records):
            record = self.all_records[index]
            if self.on_row_double_click:
                self.on_row_double_click(record)

    def _context_copy(self, item):
        """ŸÜÿ≥ÿÆ ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≥ŸäÿßŸÇŸäÿ©"""
        values = self.tree.item(item)['values']
        if values:
            # ŸÜÿ≥ÿÆ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤
            self.clipboard_clear()
            self.clipboard_append(str(values[0]))

    def _context_delete(self, item):
        """ÿ≠ÿ∞ŸÅ ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≥ŸäÿßŸÇŸäÿ©"""
        # ŸäŸÖŸÉŸÜ ÿ™ŸÜŸÅŸäÿ∞ ŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ≠ÿ∞ŸÅ ŸáŸÜÿß
        pass

    def _sort_by_column(self, column):
        """ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑÿπŸÖŸàÿØ ŸÖÿπ ŸÖÿ§ÿ¥ÿ± ÿ®ÿµÿ±Ÿä"""
        # TODO: ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ŸÖÿπ ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ŸáŸÖ ŸÑŸÑÿ•ÿ¥ÿßÿ±ÿ© ŸÑÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
        pass

    def _apply_professional_style(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑŸÖÿ∏Ÿáÿ± ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© ŸáŸÜÿß
        pass

    def _get_column_names(self):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑÿØÿßÿÆŸÑŸäÿ©"""
        return ["booking_nr", "date_trip", "customer_name", "hotel_name",
                "pickup_time", "price", "status"]

    def _on_double_click(self, event):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑŸÜŸÇÿ± ÿßŸÑŸÖÿ≤ÿØŸàÿ¨ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        selection = self.tree.selection()
        if selection and self.on_row_double_click:
            item = selection[0]
            index = self.tree.index(item)
            if 0 <= index < len(self.all_records):
                record = self.all_records[index]
                self.on_row_double_click(record)

    def _on_selection_change(self, event):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        selection = self.tree.selection()
        self.selected_records = []

        for item in selection:
            index = self.tree.index(item)
            if 0 <= index < len(self.all_records):
                self.selected_records.append(self.all_records[index])

        if self.on_selection_change:
            self.on_selection_change(self.selected_records)

    def get_selected_records(self):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ©"""
        return self.selected_records

    def clear_selection(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ"""
        self.tree.selection_remove(self.tree.selection())
        self.selected_records = []

    def update_texts(self, lang_manager: LanguageManager):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿµŸàÿµ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"""
        self.lang_manager = lang_manager

        # ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜÿßŸàŸäŸÜ ÿßŸÑÿ£ÿπŸÖÿØÿ©
        self._update_column_headers()

        # ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™
        if self.all_records:
            self.display_data(self.all_records)

    def _update_column_headers(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜÿßŸàŸäŸÜ ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©"""
        if not hasattr(self, 'tree') or not self.tree.winfo_exists():
            return

        # ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿ£ÿπŸÖÿØÿ© ŸÖÿπ ŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©
        columns_map = [
            ("booking_number", "Booking Nr.", "ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤"),
            ("trip_date", "Trip Date", "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ±ÿ≠ŸÑÿ©"),
            ("customer_name", "Customer Name", "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ"),
            ("hotel", "Hotel", "ÿßŸÑŸÅŸÜÿØŸÇ"),
            ("pickup_time", "Pickup Time", "ŸàŸÇÿ™ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ"),
            ("price", "Price", "ÿßŸÑÿ≥ÿπÿ±"),
            ("status", "Status", "ÿßŸÑÿ≠ÿßŸÑÿ©")
        ]

        # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        current_lang = self.lang_manager.current_lang if self.lang_manager else "ar"

        # ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜÿßŸàŸäŸÜ ÿßŸÑÿ£ÿπŸÖÿØÿ©
        columns = self.tree["columns"]
        for i, (trans_key, en_name, ar_name) in enumerate(columns_map):
            if i < len(columns):
                # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖ
                if self.lang_manager:
                    translated_text = self.lang_manager.get(trans_key, en_name if current_lang == "en" else ar_name)
                else:
                    translated_text = en_name if current_lang == "en" else ar_name

                # ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿπŸÖŸàÿØ
                self.tree.heading(columns[i], text=translated_text)

    def set_loading(self, is_loading: bool):
        """ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ"""
        if is_loading:
            # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ§ÿ¥ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ŸáŸÜÿß
            pass
        else:
            # ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            pass

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ±Ÿá"""
        # ÿ•ÿπÿßÿØÿ© ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÜŸÖÿßÿ∑ TreeView
        self._apply_treeview_style()

        # ÿ•ÿπÿßÿØÿ© ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÜŸÖÿßÿ∑ ÿ£ÿ¥ÿ±ÿ∑ÿ© ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
        self._style_scrollbars()

        # ÿ•ÿπÿßÿØÿ© ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑÿßÿ™
        self._apply_status_colors()

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ¨ÿØŸàŸÑ
        self.configure(fg_color=("#ffffff", "#2b2b2b"))

        # ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        if self.all_records:
            # ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ≠ÿßŸÑŸä
            current_selection = self.tree.selection()

            # ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            self.display_data(self.all_records)

            # ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
            if current_selection:
                try:
                    for item in current_selection:
                        self.tree.selection_add(item)
                except:
                    pass

============================================================
FILE: views\components\dropdown_dialogs.py
SIZE: 54108 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/dropdown_dialogs.py

ŸÜŸàÿßŸÅÿ∞ ÿ≠Ÿàÿßÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿßŸÑŸÖÿ≠ÿØÿ´ÿ© ŸàÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑÿ© ŸÖÿπ ÿ®ŸÜŸäÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
"""

import customtkinter as ctk
from typing import Dict, Any, Callable, Optional, List
import webbrowser
from datetime import datetime
import json
import os
from tkinter import messagebox, filedialog

from core.language_manager import LanguageManager
from core.theme_manager import ThemeManager
from core.config_manager import ConfigManager
from core.logger import logger


class ProfileWindow(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿπÿ±ÿ∂ Ÿàÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä - ŸÖÿ≠ÿØÿ´ÿ© ŸÑÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Airtable"""

    def __init__(self, parent, controller, lang_manager):
        super().__init__(parent)

        self.controller = controller
        self.lang_manager = lang_manager

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.title(lang_manager.get("profile_title", "User Profile"))
        self.geometry("450x600")
        self.resizable(False, False)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
        self.transient(parent)
        self.grab_set()

        # ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        self._load_user_data()

        # ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self._build_ui()

        # ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self._center_window()

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        self.update_idletasks()
        width = self.winfo_width()
        height = self.winfo_height()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")

    def _load_user_data(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÜ Airtable"""
        try:
            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
            current_username = self.controller.current_username

            if current_username and self.controller.airtable_users:
                # ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
                users = self.controller.airtable_users.fetch_records()

                # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
                for user in users:
                    fields = user.get('fields', {})
                    if fields.get('Username', '').lower() == current_username.lower():
                        self.user_data = fields
                        self.user_record_id = user.get('id')
                        logger.info(f"ÿ™ŸÖ ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {current_username}")
                        return

            # ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©
            self.user_data = self.controller.current_user_info or {}
            self.user_record_id = self.user_data.get('record_id')

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: {e}")
            self.user_data = {}
            self.user_record_id = None

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä"""
        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖÿπ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
        main_frame = ctk.CTkScrollableFrame(self, width=400, height=500)
        main_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        title_frame.pack(fill="x", pady=(0, 20))

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        user_icon = ctk.CTkLabel(
            title_frame,
            text="üë§",
            font=ctk.CTkFont(size=48)
        )
        user_icon.pack()

        # ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        username = self.user_data.get('Username', 'Unknown')
        username_label = ctk.CTkLabel(
            title_frame,
            text=username,
            font=ctk.CTkFont(size=24, weight="bold")
        )
        username_label.pack(pady=(10, 5))

        # ÿßŸÑÿØŸàÿ±
        role = self.user_data.get('Role', 'User')
        role_text = self._translate_role(role)
        role_label = ctk.CTkLabel(
            title_frame,
            text=role_text,
            font=ctk.CTkFont(size=14),
            text_color=("gray60", "gray40")
        )
        role_label.pack()

        # ÿÆÿ∑ ŸÅÿßÿµŸÑ
        separator = ctk.CTkFrame(main_frame, height=2, fg_color=("gray70", "gray30"))
        separator.pack(fill="x", pady=20)

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        self._create_info_section(main_frame)

        # ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ
        self._create_stats_section(main_frame)

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        self._create_action_buttons(main_frame)

        # ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
        close_btn = ctk.CTkButton(
            self,
            text=self.lang_manager.get("close", "Close"),
            command=self.destroy,
            width=120
        )
        close_btn.pack(pady=(0, 20))

    def _create_info_section(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿ≥ŸÖ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©"""
        info_frame = ctk.CTkFrame(parent)
        info_frame.pack(fill="x", pady=(0, 20))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿ≥ŸÖ
        section_title = ctk.CTkLabel(
            info_frame,
            text=self.lang_manager.get("basic_info", "Basic Information"),
            font=ctk.CTkFont(size=16, weight="bold")
        )
        section_title.pack(anchor="w", padx=15, pady=(15, 10))

        # ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™
        info_items = [
            ("email", "Email", self.user_data.get('Email', 'Not provided')),
            ("phone", "Phone", self.user_data.get('Phone', 'Not provided')),
            ("department", "Department", self.user_data.get('Department', 'Not specified')),
            ("airtable_view", "Assigned View", self.user_data.get('Airtable View', 'Default')),
            ("status", "Status", "Active" if self.user_data.get('Active', True) else "Inactive")
        ]

        for key, label, value in info_items:
            self._create_info_row(info_frame, self.lang_manager.get(key, label), value)

    def _create_stats_section(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿ≥ŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™"""
        stats_frame = ctk.CTkFrame(parent)
        stats_frame.pack(fill="x", pady=(0, 20))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿ≥ŸÖ
        section_title = ctk.CTkLabel(
            stats_frame,
            text=self.lang_manager.get("usage_stats", "Usage Statistics"),
            font=ctk.CTkFont(size=16, weight="bold")
        )
        section_title.pack(anchor="w", padx=15, pady=(15, 10))

        # ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        last_login = self.user_data.get('Last Login', '')
        if last_login:
            try:
                dt = datetime.fromisoformat(last_login.replace('Z', '+00:00'))
                last_login = dt.strftime("%Y-%m-%d %H:%M")
            except:
                pass

        login_count = self.user_data.get('Login Count', 0)
        created_date = self.user_data.get('Created Date', '')
        if created_date:
            try:
                dt = datetime.fromisoformat(created_date.replace('Z', '+00:00'))
                created_date = dt.strftime("%Y-%m-%d")
            except:
                pass

        stats_items = [
            ("last_login", "Last Login", last_login or 'Never'),
            ("login_count", "Login Count", str(login_count)),
            ("created_date", "Member Since", created_date or 'Unknown')
        ]

        for key, label, value in stats_items:
            self._create_info_row(stats_frame, self.lang_manager.get(key, label), value)

    def _create_info_row(self, parent, label, value):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿµŸÅ ŸÖÿπŸÑŸàŸÖÿßÿ™"""
        row_frame = ctk.CTkFrame(parent, fg_color="transparent")
        row_frame.pack(fill="x", padx=20, pady=3)

        # ÿßŸÑÿ™ÿ≥ŸÖŸäÿ©
        label_widget = ctk.CTkLabel(
            row_frame,
            text=f"{label}:",
            font=ctk.CTkFont(size=13),
            anchor="w",
            width=120
        )
        label_widget.pack(side="left")

        # ÿßŸÑŸÇŸäŸÖÿ©
        value_widget = ctk.CTkLabel(
            row_frame,
            text=str(value),
            font=ctk.CTkFont(size=13, weight="bold"),
            anchor="w"
        )
        value_widget.pack(side="left", padx=(10, 0))

    def _create_action_buttons(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™"""
        actions_frame = ctk.CTkFrame(parent)
        actions_frame.pack(fill="x", pady=(0, 20))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿ≥ŸÖ
        section_title = ctk.CTkLabel(
            actions_frame,
            text=self.lang_manager.get("actions", "Actions"),
            font=ctk.CTkFont(size=16, weight="bold")
        )
        section_title.pack(anchor="w", padx=15, pady=(15, 10))

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        buttons_frame = ctk.CTkFrame(actions_frame, fg_color="transparent")
        buttons_frame.pack(fill="x", padx=20, pady=10)

        # ÿ≤ÿ± ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        change_pwd_btn = ctk.CTkButton(
            buttons_frame,
            text=self.lang_manager.get("change_password", "Change Password"),
            command=self._change_password,
            width=180
        )
        change_pwd_btn.pack(pady=5)

        # ÿ≤ÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä
        update_email_btn = ctk.CTkButton(
            buttons_frame,
            text=self.lang_manager.get("update_email", "Update Email"),
            command=self._update_email,
            width=180,
            fg_color="transparent",
            border_width=2
        )
        update_email_btn.pack(pady=5)

    def _translate_role(self, role):
        """ÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑÿØŸàÿ±"""
        role_translations = {
            'admin': self.lang_manager.get("role_admin", "Administrator"),
            'manager': self.lang_manager.get("role_manager", "Manager"),
            'editor': self.lang_manager.get("role_editor", "Editor"),
            'viewer': self.lang_manager.get("role_viewer", "Viewer")
        }
        return role_translations.get(role.lower(), role)

    def _change_password(self):
        """ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"""
        dialog = ChangePasswordDialog(self, self.controller, self.lang_manager)

    def _update_email(self):
        """ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"""
        dialog = UpdateEmailDialog(self, self.controller, self.lang_manager, self.user_data.get('Email', ''))


class ChangePasswordDialog(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±"""

    def __init__(self, parent, controller, lang_manager):
        super().__init__(parent)

        self.controller = controller
        self.lang_manager = lang_manager

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.title(lang_manager.get("change_password", "Change Password"))
        self.geometry("400x350")
        self.resizable(False, False)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
        self.transient(parent)
        self.grab_set()

        self._build_ui()
        self._center_window()

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.update_idletasks()
        width = self.winfo_width()
        height = self.winfo_height()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©"""
        main_frame = ctk.CTkFrame(self)
        main_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title_label = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get("change_password", "Change Password"),
            font=ctk.CTkFont(size=20, weight="bold")
        )
        title_label.pack(pady=(0, 20))

        # ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        current_label = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get("current_password", "Current Password"),
            anchor="w"
        )
        current_label.pack(fill="x", pady=(0, 5))

        self.current_entry = ctk.CTkEntry(
            main_frame,
            show="‚Ä¢",
            height=40
        )
        self.current_entry.pack(fill="x", pady=(0, 15))

        # ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©
        new_label = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get("new_password", "New Password"),
            anchor="w"
        )
        new_label.pack(fill="x", pady=(0, 5))

        self.new_entry = ctk.CTkEntry(
            main_frame,
            show="‚Ä¢",
            height=40
        )
        self.new_entry.pack(fill="x", pady=(0, 15))

        # ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        confirm_label = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get("confirm_password", "Confirm Password"),
            anchor="w"
        )
        confirm_label.pack(fill="x", pady=(0, 5))

        self.confirm_entry = ctk.CTkEntry(
            main_frame,
            show="‚Ä¢",
            height=40
        )
        self.confirm_entry.pack(fill="x", pady=(0, 20))

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        button_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        button_frame.pack(fill="x")

        save_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("save", "Save"),
            command=self._save_password,
            width=100
        )
        save_btn.pack(side="left", padx=(0, 10))

        cancel_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self.destroy,
            width=100,
            fg_color="gray"
        )
        cancel_btn.pack(side="left")

    def _save_password(self):
        """ÿ≠ŸÅÿ∏ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©"""
        current = self.current_entry.get()
        new = self.new_entry.get()
        confirm = self.confirm_entry.get()

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
        if not all([current, new, confirm]):
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                self.lang_manager.get("fill_all_fields", "Please fill all fields")
            )
            return

        if new != confirm:
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                self.lang_manager.get("passwords_dont_match", "Passwords do not match")
            )
            return

        if len(new) < 8:
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                self.lang_manager.get("password_too_short", "Password must be at least 8 characters")
            )
            return

        # ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
        try:
            if hasattr(self.controller, 'user_mgr') and self.controller.user_mgr:
                success = self.controller.user_mgr.change_password(
                    self.controller.current_username,
                    current,
                    new
                )

                if success:
                    messagebox.showinfo(
                        self.lang_manager.get("success", "Success"),
                        self.lang_manager.get("password_changed", "Password changed successfully")
                    )
                    self.destroy()
                else:
                    messagebox.showerror(
                        self.lang_manager.get("error", "Error"),
                        self.lang_manager.get("incorrect_password", "Current password is incorrect")
                    )
            else:
                messagebox.showerror(
                    self.lang_manager.get("error", "Error"),
                    self.lang_manager.get("feature_not_available", "This feature is not available")
                )
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±: {e}")
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                str(e)
            )


class UpdateEmailDialog(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿ≠Ÿàÿßÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä"""

    def __init__(self, parent, controller, lang_manager, current_email):
        super().__init__(parent)

        self.controller = controller
        self.lang_manager = lang_manager
        self.current_email = current_email

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.title(lang_manager.get("update_email", "Update Email"))
        self.geometry("400x250")
        self.resizable(False, False)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
        self.transient(parent)
        self.grab_set()

        self._build_ui()
        self._center_window()

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.update_idletasks()
        width = self.winfo_width()
        height = self.winfo_height()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©"""
        main_frame = ctk.CTkFrame(self)
        main_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title_label = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get("update_email", "Update Email"),
            font=ctk.CTkFont(size=20, weight="bold")
        )
        title_label.pack(pady=(0, 20))

        # ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ≠ÿßŸÑŸä
        current_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        current_frame.pack(fill="x", pady=(0, 15))

        current_label = ctk.CTkLabel(
            current_frame,
            text=self.lang_manager.get("current_email", "Current Email:"),
            anchor="w"
        )
        current_label.pack(side="left")

        current_value = ctk.CTkLabel(
            current_frame,
            text=self.current_email or "Not set",
            font=ctk.CTkFont(weight="bold"),
            anchor="w"
        )
        current_value.pack(side="left", padx=(10, 0))

        # ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ¨ÿØŸäÿØ
        new_label = ctk.CTkLabel(
            main_frame,
            text=self.lang_manager.get("new_email", "New Email"),
            anchor="w"
        )
        new_label.pack(fill="x", pady=(0, 5))

        self.email_entry = ctk.CTkEntry(
            main_frame,
            height=40,
            placeholder_text="example@email.com"
        )
        self.email_entry.pack(fill="x", pady=(0, 20))

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        button_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        button_frame.pack(fill="x")

        save_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("save", "Save"),
            command=self._save_email,
            width=100
        )
        save_btn.pack(side="left", padx=(0, 10))

        cancel_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self.destroy,
            width=100,
            fg_color="gray"
        )
        cancel_btn.pack(side="left")

    def _save_email(self):
        """ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿßŸÑÿ¨ÿØŸäÿØ"""
        new_email = self.email_entry.get().strip()

        if not new_email:
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                self.lang_manager.get("enter_email", "Please enter an email address")
            )
            return

        # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä
        if '@' not in new_email or '.' not in new_email:
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                self.lang_manager.get("invalid_email", "Please enter a valid email address")
            )
            return

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ±ŸäÿØ ŸÅŸä Airtable
        messagebox.showinfo(
            self.lang_manager.get("info", "Information"),
            self.lang_manager.get("email_update_request", "Email update request has been sent to administrator")
        )
        self.destroy()


class SettingsWindow(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""

    def __init__(self, parent, lang_manager, config_manager, theme_manager):
        super().__init__(parent)

        self.lang_manager = lang_manager
        self.config_manager = config_manager
        self.theme_manager = theme_manager

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.title(lang_manager.get("settings_title", "Settings"))
        self.geometry("600x500")
        self.resizable(False, False)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
        self.transient(parent)
        self.grab_set()

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        self.settings_changed = False
        self.temp_settings = {}

        self._build_ui()
        self._center_window()
        self._load_current_settings()

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.update_idletasks()
        width = self.winfo_width()
        height = self.winfo_height()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        main_container = ctk.CTkFrame(self)
        main_container.pack(fill="both", expand=True)

        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title_frame = ctk.CTkFrame(main_container, height=60)
        title_frame.pack(fill="x")
        title_frame.pack_propagate(False)

        title_label = ctk.CTkLabel(
            title_frame,
            text=self.lang_manager.get("settings_title", "Settings"),
            font=ctk.CTkFont(size=24, weight="bold")
        )
        title_label.pack(expand=True)

        # ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        self.tabview = ctk.CTkTabview(main_container, width=550, height=350)
        self.tabview.pack(fill="both", expand=True, padx=20, pady=(0, 20))

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        self.tabview.add(self.lang_manager.get("appearance", "Appearance"))
        self.tabview.add(self.lang_manager.get("performance", "Performance"))
        self.tabview.add(self.lang_manager.get("advanced", "Advanced"))

        # ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        self._create_appearance_tab()
        self._create_performance_tab()
        self._create_advanced_tab()

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        self._create_action_buttons(main_container)

    def _create_appearance_tab(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ∏Ÿáÿ±"""
        tab = self.tabview.tab(self.lang_manager.get("appearance", "Appearance"))

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        content_frame = ctk.CTkScrollableFrame(tab, height=300)
        content_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # 1. ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÖÿ∏Ÿáÿ±
        appearance_section = self._create_section(
            content_frame,
            self.lang_manager.get("theme_mode", "Theme Mode")
        )

        self.appearance_var = ctk.StringVar(value=ctk.get_appearance_mode())
        appearance_menu = ctk.CTkOptionMenu(
            appearance_section,
            values=["Light", "Dark", "System"],
            variable=self.appearance_var,
            command=self._on_appearance_change
        )
        appearance_menu.pack(fill="x", pady=5)

        # 2. ÿßŸÑŸÑŸàŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä - ÿπÿ±ÿ∂ ŸÅŸÇÿ∑
        color_section = self._create_section(
            content_frame,
            self.lang_manager.get("primary_color", "Primary Color")
        )

        # ÿπÿ±ÿ∂ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÅŸÇÿ∑
        current_theme = self.config_manager.get("color_theme", "blue")
        # ÿ™ÿµÿ≠Ÿäÿ≠ dark-blue ÿ•ÿ∞ÿß Ÿàÿ¨ÿØ
        if current_theme == "dark-blue":
            current_theme = "blue"

        theme_info_frame = ctk.CTkFrame(color_section, fg_color="transparent")
        theme_info_frame.pack(fill="x", pady=5)

        theme_label = ctk.CTkLabel(
            theme_info_frame,
            text=f"{self.lang_manager.get('current_theme', 'Current Theme')}: ",
            font=ctk.CTkFont(size=13)
        )
        theme_label.pack(side="left")

        theme_value = ctk.CTkLabel(
            theme_info_frame,
            text=current_theme.title(),
            font=ctk.CTkFont(size=13, weight="bold"),
            text_color=("#1976d2", "#64b5f6")
        )
        theme_value.pack(side="left")

        # ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™
        info_msg = ctk.CTkLabel(
            color_section,
            text=self.lang_manager.get(
                "theme_info",
                "‚ÑπÔ∏è ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÑŸàŸÜŸäÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿπŸÑŸàŸä"
            ),
            font=ctk.CTkFont(size=11),
            text_color=("gray60", "gray40"),
            wraplength=400
        )
        info_msg.pack(fill="x", pady=(10, 0))

        # 3. ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑
        font_section = self._create_section(
            content_frame,
            self.lang_manager.get("font_size", "Font Size")
        )

        self.font_size_var = ctk.DoubleVar(value=self.config_manager.get("font_size", 14))

        # ÿ•ÿ∑ÿßÿ± ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑
        font_frame = ctk.CTkFrame(font_section, fg_color="transparent")
        font_frame.pack(fill="x", pady=5)

        font_slider = ctk.CTkSlider(
            font_frame,
            from_=10,
            to=20,
            variable=self.font_size_var,
            command=self._on_font_size_change
        )
        font_slider.pack(side="left", fill="x", expand=True)

        self.font_size_label = ctk.CTkLabel(
            font_frame,
            text=f"{int(self.font_size_var.get())}px",
            width=50
        )
        self.font_size_label.pack(side="left", padx=(10, 0))

        # 4. ŸÖÿπÿßŸäŸÜÿ©
        preview_section = self._create_section(
            content_frame,
            self.lang_manager.get("preview", "Preview")
        )

        self.preview_frame = ctk.CTkFrame(preview_section, height=100)
        self.preview_frame.pack(fill="x", pady=5)

        preview_content = ctk.CTkFrame(self.preview_frame, fg_color="transparent")
        preview_content.pack(expand=True)

        self.preview_label = ctk.CTkLabel(
            preview_content,
            text=self.lang_manager.get("preview_text", "This is a preview of your settings"),
            font=ctk.CTkFont(size=int(self.font_size_var.get()))
        )
        self.preview_label.pack(pady=10)

        # ÿ£ŸÖÿ´ŸÑÿ© ÿ£ÿ≤ÿ±ÿßÿ± ŸÑŸÑŸÖÿπÿßŸäŸÜÿ©
        preview_buttons = ctk.CTkFrame(preview_content, fg_color="transparent")
        preview_buttons.pack()

        preview_btn1 = ctk.CTkButton(
            preview_buttons,
            text=self.lang_manager.get("sample_button", "Sample Button"),
            width=120,
            height=32
        )
        preview_btn1.pack(side="left", padx=5)

        preview_btn2 = ctk.CTkButton(
            preview_buttons,
            text=self.lang_manager.get("secondary", "Secondary"),
            width=120,
            height=32,
            fg_color="transparent",
            border_width=2
        )
        preview_btn2.pack(side="left", padx=5)

    def _create_performance_tab(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ£ÿØÿßÿ°"""
        tab = self.tabview.tab(self.lang_manager.get("performance", "Performance"))

        content_frame = ctk.CTkScrollableFrame(tab, height=300)
        content_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # 1. ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
        auto_refresh_section = self._create_section(
            content_frame,
            self.lang_manager.get("auto_refresh", "Auto Refresh")
        )

        self.auto_refresh_var = ctk.BooleanVar(
            value=self.config_manager.get("auto_refresh", True)
        )
        auto_refresh_switch = ctk.CTkSwitch(
            auto_refresh_section,
            text=self.lang_manager.get("enable_auto_refresh", "Enable automatic data refresh"),
            variable=self.auto_refresh_var,
            command=self._on_setting_change
        )
        auto_refresh_switch.pack(anchor="w", pady=5)

        # 2. ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
        refresh_interval_section = self._create_section(
            content_frame,
            self.lang_manager.get("refresh_interval", "Refresh Interval")
        )

        self.refresh_interval_var = ctk.IntVar(
            value=self.config_manager.get("refresh_interval", 300)
        )

        interval_frame = ctk.CTkFrame(refresh_interval_section, fg_color="transparent")
        interval_frame.pack(fill="x", pady=5)

        interval_slider = ctk.CTkSlider(
            interval_frame,
            from_=60,
            to=600,
            variable=self.refresh_interval_var,
            command=self._on_interval_change
        )
        interval_slider.pack(side="left", fill="x", expand=True)

        self.interval_label = ctk.CTkLabel(
            interval_frame,
            text="5 min",
            width=60
        )
        self.interval_label.pack(side="left", padx=(10, 0))

        # 3. ÿπÿØÿØ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ©
        page_size_section = self._create_section(
            content_frame,
            self.lang_manager.get("records_per_page", "Records per Page")
        )

        self.page_size_var = ctk.StringVar(
            value=str(self.config_manager.get("records_per_page", 100))
        )
        page_sizes = ["50", "100", "200", "500"]
        page_size_menu = ctk.CTkOptionMenu(
            page_size_section,
            values=page_sizes,
            variable=self.page_size_var,
            command=self._on_setting_change
        )
        page_size_menu.pack(fill="x", pady=5)

        # 4. ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÉÿ≥ŸàŸÑ
        lazy_loading_section = self._create_section(
            content_frame,
            self.lang_manager.get("lazy_loading", "Lazy Loading")
        )

        self.lazy_loading_var = ctk.BooleanVar(
            value=self.config_manager.get("enable_lazy_loading", True)
        )
        lazy_loading_switch = ctk.CTkSwitch(
            lazy_loading_section,
            text=self.lang_manager.get("enable_lazy_loading", "Load data on demand"),
            variable=self.lazy_loading_var,
            command=self._on_setting_change
        )
        lazy_loading_switch.pack(anchor="w", pady=5)

    def _create_advanced_tab(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©"""
        tab = self.tabview.tab(self.lang_manager.get("advanced", "Advanced"))

        content_frame = ctk.CTkScrollableFrame(tab, height=300)
        content_frame.pack(fill="both", expand=True, padx=10, pady=10)

        # 1. Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ∑Ÿàÿ±
        dev_section = self._create_section(
            content_frame,
            self.lang_manager.get("developer_mode", "Developer Mode")
        )

        self.dev_mode_var = ctk.BooleanVar(
            value=self.config_manager.get("developer_mode", False)
        )
        dev_mode_switch = ctk.CTkSwitch(
            dev_section,
            text=self.lang_manager.get("enable_dev_mode", "Show debug information"),
            variable=self.dev_mode_var,
            command=self._on_setting_change
        )
        dev_mode_switch.pack(anchor="w", pady=5)

        # 2. ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        export_section = self._create_section(
            content_frame,
            self.lang_manager.get("export_settings", "Export Settings")
        )

        export_btn = ctk.CTkButton(
            export_section,
            text=self.lang_manager.get("export_to_file", "Export to File"),
            command=self._export_settings,
            width=150
        )
        export_btn.pack(pady=5)

        # 3. ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        import_section = self._create_section(
            content_frame,
            self.lang_manager.get("import_settings", "Import Settings")
        )

        import_btn = ctk.CTkButton(
            import_section,
            text=self.lang_manager.get("import_from_file", "Import from File"),
            command=self._import_settings,
            width=150,
            fg_color="transparent",
            border_width=2
        )
        import_btn.pack(pady=5)

        # 4. ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        reset_section = self._create_section(
            content_frame,
            self.lang_manager.get("reset_settings", "Reset Settings")
        )

        reset_btn = ctk.CTkButton(
            reset_section,
            text=self.lang_manager.get("reset_to_default", "Reset to Default"),
            command=self._reset_settings,
            width=150,
            fg_color="red",
            hover_color="darkred"
        )
        reset_btn.pack(pady=5)

    def _create_section(self, parent, title):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿ≥ŸÖ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
        section_frame = ctk.CTkFrame(parent)
        section_frame.pack(fill="x", pady=(0, 15))

        title_label = ctk.CTkLabel(
            section_frame,
            text=title,
            font=ctk.CTkFont(size=14, weight="bold"),
            anchor="w"
        )
        title_label.pack(fill="x", padx=15, pady=(10, 5))

        content_frame = ctk.CTkFrame(section_frame, fg_color="transparent")
        content_frame.pack(fill="x", padx=15, pady=(0, 10))

        return content_frame

    def _create_action_buttons(self, parent):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™"""
        button_frame = ctk.CTkFrame(parent, fg_color="transparent", height=50)
        button_frame.pack(fill="x", side="bottom", padx=20, pady=(0, 20))

        # ÿ≤ÿ± ÿßŸÑÿ≠ŸÅÿ∏
        save_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("save_settings", "Save Settings"),
            command=self._save_settings,
            width=120
        )
        save_btn.pack(side="left", padx=(0, 10))

        # ÿ≤ÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        apply_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("apply", "Apply"),
            command=self._apply_settings,
            width=120,
            fg_color="green"
        )
        apply_btn.pack(side="left", padx=(0, 10))

        # ÿ≤ÿ± ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°
        cancel_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self._cancel_settings,
            width=120,
            fg_color="gray"
        )
        cancel_btn.pack(side="left")

    def _load_current_settings(self):
        """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©"""
        # ÿßŸÑŸÖÿ∏Ÿáÿ±
        current_mode = self.theme_manager.get_current_appearance_mode()
        self.appearance_var.set(current_mode.capitalize())

        # ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑
        font_size = self.config_manager.get("font_size", 14)
        self.font_size_var.set(font_size)
        self._update_font_preview(font_size)

        # ÿßŸÑÿ£ÿØÿßÿ°
        self.auto_refresh_var.set(self.config_manager.get("auto_refresh", True))
        self.refresh_interval_var.set(self.config_manager.get("refresh_interval", 300))
        self._update_interval_label(self.refresh_interval_var.get())
        self.page_size_var.set(str(self.config_manager.get("records_per_page", 100)))
        self.lazy_loading_var.set(self.config_manager.get("enable_lazy_loading", True))

        # ŸÖÿ™ŸÇÿØŸÖ
        self.dev_mode_var.set(self.config_manager.get("developer_mode", False))

    def _on_appearance_change(self, choice):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÖÿ∏Ÿáÿ±"""
        self.settings_changed = True
        # ŸÖÿπÿßŸäŸÜÿ© ŸÅŸàÿ±Ÿäÿ© ÿ¢ŸÖŸÜÿ© ŸÑŸÑŸÄ appearance mode ŸÅŸÇÿ∑
        try:
            ctk.set_appearance_mode(choice.lower())
        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ∏Ÿáÿ±: {e}")

    def _on_color_change(self, choice):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑŸàŸÜ"""
        self.settings_changed = True

        # ŸÑÿß ÿ™ÿ∑ÿ®ŸÇ ÿßŸÑÿ´ŸäŸÖ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        # ŸÅŸÇÿ∑ ÿ£ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ÿ∞Ÿäÿ±Ÿäÿ©
        if hasattr(self, 'theme_warning_label'):
            self.theme_warning_label.configure(
                text=self.lang_manager.get(
                    "theme_will_apply_on_restart",
                    "‚ö†Ô∏è ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿ®ÿπÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ"
                )
            )

    def _on_font_size_change(self, value):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑"""
        self.settings_changed = True
        self._update_font_preview(int(value))

    def _on_interval_change(self, value):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´"""
        self.settings_changed = True
        self._update_interval_label(int(value))

    def _on_setting_change(self, *args):
        """ŸÖÿπÿßŸÑÿ¨ ÿπÿßŸÖ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
        self.settings_changed = True

    def _update_font_preview(self, size):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿπÿßŸäŸÜÿ© ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑"""
        self.font_size_label.configure(text=f"{int(size)}px")
        self.preview_label.configure(font=ctk.CTkFont(size=int(size)))

    def _update_interval_label(self, seconds):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ™ÿ≥ŸÖŸäÿ© ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´"""
        minutes = seconds // 60
        self.interval_label.configure(text=f"{minutes} min")

    def _save_settings(self):
        """ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
        try:
            # ÿ™ÿ∞ŸÉÿ± ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÇÿØŸäŸÖ ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
            old_theme = self.config_manager.get("color_theme", "blue")

            # ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ∏Ÿáÿ±
            self.config_manager.set("appearance_mode", self.appearance_var.get().lower())
            self.config_manager.set("font_size", int(self.font_size_var.get()))

            # ŸÑÿß ŸÜÿ∫Ÿäÿ± ÿßŸÑÿ´ŸäŸÖ ŸÖŸÜ ŸáŸÜÿß ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿ¨ŸÖÿØ
            # new_theme = self.color_var.get()
            # self.config_manager.set("color_theme", new_theme)

            # ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿØÿßÿ°
            self.config_manager.set("auto_refresh", self.auto_refresh_var.get())
            self.config_manager.set("refresh_interval", self.refresh_interval_var.get())
            self.config_manager.set("records_per_page", int(self.page_size_var.get()))
            self.config_manager.set("enable_lazy_loading", self.lazy_loading_var.get())

            # ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ
            self.config_manager.set("developer_mode", self.dev_mode_var.get())

            # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ¢ŸÖŸÜÿ© ŸÅŸÇÿ∑
            self.theme_manager.apply_appearance_mode(self.appearance_var.get().lower())

            # ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
            messagebox.showinfo(
                self.lang_manager.get("success", "Success"),
                self.lang_manager.get("settings_saved", "Settings saved successfully")
            )

            self.settings_changed = False
            self.destroy()

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™: {e}")
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                str(e)
            )

    def _apply_settings(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ÿØŸàŸÜ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self._save_settings()
        self.settings_changed = False

    def _cancel_settings(self):
        """ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™"""
        if self.settings_changed:
            if messagebox.askyesno(
                self.lang_manager.get("confirm", "Confirm"),
                self.lang_manager.get("discard_changes", "Discard unsaved changes?")
            ):
                # ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÑŸÑŸÄ appearance mode ŸÅŸÇÿ∑
                original_mode = self.config_manager.get("appearance_mode", "light")
                try:
                    self.theme_manager.apply_appearance_mode(original_mode)
                except Exception as e:
                    logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿßÿØÿ© Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ∏Ÿáÿ±: {e}")
                self.destroy()
        else:
            self.destroy()

    def _export_settings(self):
        """ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ•ŸÑŸâ ŸÖŸÑŸÅ"""
        file_path = filedialog.asksaveasfilename(
            defaultextension=".json",
            filetypes=[("JSON files", "*.json"), ("All files", "*.*")]
        )

        if file_path:
            try:
                settings = self.config_manager.get_all_settings()
                with open(file_path, 'w', encoding='utf-8') as f:
                    json.dump(settings, f, indent=2, ensure_ascii=False)

                messagebox.showinfo(
                    self.lang_manager.get("success", "Success"),
                    self.lang_manager.get("settings_exported", "Settings exported successfully")
                )
            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™: {e}")
                messagebox.showerror(
                    self.lang_manager.get("error", "Error"),
                    str(e)
                )

    def _import_settings(self):
        """ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÜ ŸÖŸÑŸÅ"""
        file_path = filedialog.askopenfilename(
            filetypes=[("JSON files", "*.json"), ("All files", "*.*")]
        )

        if file_path:
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    settings = json.load(f)

                # ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                for key, value in settings.items():
                    self.config_manager.set(key, value)

                messagebox.showinfo(
                    self.lang_manager.get("success", "Success"),
                    self.lang_manager.get("settings_imported", "Settings imported successfully")
                )

                # ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÅŸä ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
                self._load_current_settings()

            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™: {e}")
                messagebox.showerror(
                    self.lang_manager.get("error", "Error"),
                    str(e)
                )

    def _reset_settings(self):
        """ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ•ŸÑŸâ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©"""
        if messagebox.askyesno(
            self.lang_manager.get("confirm", "Confirm"),
            self.lang_manager.get("confirm_reset", "Reset all settings to default values?")
        ):
            try:
                # ÿ≠ÿ∞ŸÅ ŸÖŸÑŸÅ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                if os.path.exists("config/settings.yaml"):
                    os.remove("config/settings.yaml")

                # ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
                self.config_manager.reload()

                messagebox.showinfo(
                    self.lang_manager.get("success", "Success"),
                    self.lang_manager.get("settings_reset", "Settings reset to default")
                )

                self.destroy()

            except Exception as e:
                logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™: {e}")
                messagebox.showerror(
                    self.lang_manager.get("error", "Error"),
                    str(e)
                )


class LanguageWindow(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""

    def __init__(self, parent, lang_manager, language_callback):
        super().__init__(parent)

        self.lang_manager = lang_manager
        self.language_callback = language_callback

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.title(lang_manager.get("language_title", "Select Language"))
        self.geometry("350x500")
        self.resizable(False, False)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
        self.transient(parent)
        self.grab_set()

        self._build_ui()
        self._center_window()

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.update_idletasks()
        width = self.winfo_width()
        height = self.winfo_height()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÑÿ∫ÿ©"""
        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title_frame = ctk.CTkFrame(self, height=80)
        title_frame.pack(fill="x")
        title_frame.pack_propagate(False)

        title_label = ctk.CTkLabel(
            title_frame,
            text=self.lang_manager.get("language_title", "Select Language"),
            font=ctk.CTkFont(size=22, weight="bold")
        )
        title_label.pack(expand=True)

        # ÿßŸÑŸàÿµŸÅ
        desc_label = ctk.CTkLabel(
            self,
            text=self.lang_manager.get("language_desc", "Choose your preferred language"),
            font=ctk.CTkFont(size=12),
            text_color=("gray60", "gray40")
        )
        desc_label.pack(pady=(0, 20))

        # ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÖŸÜ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©
        languages = self._get_available_languages()

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÑÿ∫ÿßÿ™
        lang_frame = ctk.CTkScrollableFrame(self, height=280)
        lang_frame.pack(fill="both", expand=True, padx=20, pady=(0, 20))

        self.selected_lang = ctk.StringVar(value=self.lang_manager.current_lang)

        for code, name, flag, native_name in languages:
            self._create_language_option(lang_frame, code, name, flag, native_name)

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        button_frame = ctk.CTkFrame(self, fg_color="transparent", height=60)
        button_frame.pack(fill="x", side="bottom", padx=20, pady=(0, 20))

        apply_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("apply", "Apply"),
            command=self._apply_language,
            width=100
        )
        apply_btn.pack(side="left", padx=(0, 10))

        cancel_btn = ctk.CTkButton(
            button_frame,
            text=self.lang_manager.get("cancel", "Cancel"),
            command=self.destroy,
            width=100,
            fg_color="gray"
        )
        cancel_btn.pack(side="left")

    def _get_available_languages(self):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÖŸÜ ŸÖÿ¨ŸÑÿØ locales"""
        languages = []

        # ÿßŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        default_languages = [
            ("ar", "Arabic", "üá∏üá¶", "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"),
            ("en", "English", "üá¨üáß", "English")
        ]

        # ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ŸÖÿ¨ŸÑÿØ locales
        locales_dir = "locales"
        if os.path.exists(locales_dir):
            for file in os.listdir(locales_dir):
                if file.endswith('.yaml'):
                    lang_code = file.replace('.yaml', '')

                    # ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÑÿ∫ÿ© ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
                    for code, name, flag, native in default_languages:
                        if code == lang_code:
                            languages.append((code, name, flag, native))
                            break

        # ÿ•ÿ∞ÿß ŸÑŸÖ ŸÜÿ¨ÿØ ÿ£Ÿä ŸÑÿ∫ÿßÿ™ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
        if not languages:
            languages = default_languages[:2]  # ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸàÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ŸÅŸÇÿ∑

        return languages

    def _create_language_option(self, parent, code, name, flag, native_name):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿÆŸäÿßÿ± ŸÑÿ∫ÿ©"""
        option_frame = ctk.CTkFrame(parent, height=60)
        option_frame.pack(fill="x", pady=5)

        # ÿ≤ÿ± ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
        radio_btn = ctk.CTkRadioButton(
            option_frame,
            text="",
            variable=self.selected_lang,
            value=code,
            width=20
        )
        radio_btn.pack(side="left", padx=(15, 10))

        # ÿßŸÑÿπŸÑŸÖ
        flag_label = ctk.CTkLabel(
            option_frame,
            text=flag,
            font=ctk.CTkFont(size=24)
        )
        flag_label.pack(side="left", padx=(0, 10))

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÑÿ∫ÿ©
        info_frame = ctk.CTkFrame(option_frame, fg_color="transparent")
        info_frame.pack(side="left", fill="both", expand=True)

        # ÿßÿ≥ŸÖ ÿßŸÑŸÑÿ∫ÿ© ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©
        name_label = ctk.CTkLabel(
            info_frame,
            text=name,
            font=ctk.CTkFont(size=14, weight="bold"),
            anchor="w"
        )
        name_label.pack(fill="x", pady=(10, 2))

        # ÿßÿ≥ŸÖ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ£ÿµŸÑŸä
        native_label = ctk.CTkLabel(
            info_frame,
            text=native_name,
            font=ctk.CTkFont(size=12),
            text_color=("gray60", "gray40"),
            anchor="w"
        )
        native_label.pack(fill="x", pady=(0, 10))

        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
        if code == self.lang_manager.current_lang:
            current_label = ctk.CTkLabel(
                option_frame,
                text=self.lang_manager.get("current", "Current"),
                font=ctk.CTkFont(size=11),
                text_color="green"
            )
            current_label.pack(side="right", padx=15)

    def _apply_language(self):
        """ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ©"""
        new_lang = self.selected_lang.get()
        if new_lang != self.lang_manager.current_lang:
            self.language_callback(new_lang)
        self.destroy()


class AboutWindow(ctk.CTkToplevel):
    """ŸÜÿßŸÅÿ∞ÿ© ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""

    def __init__(self, parent, lang_manager):
        super().__init__(parent)

        self.lang_manager = lang_manager

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.title(lang_manager.get("about", "About"))
        self.geometry("450x550")
        self.resizable(False, False)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ¥ÿ±Ÿàÿ∑ÿ©
        self.transient(parent)
        self.grab_set()

        self._build_ui()
        self._center_window()

    def _center_window(self):
        """ÿ™Ÿàÿ≥Ÿäÿ∑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        self.update_idletasks()
        width = self.winfo_width()
        height = self.winfo_height()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        main_frame = ctk.CTkFrame(self)
        main_frame.pack(fill="both", expand=True)

        # ÿßŸÑÿ¥ÿπÿßÿ± ŸàÿßŸÑÿπŸÜŸàÿßŸÜ
        logo_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        logo_frame.pack(pady=30)

        # ÿÆŸÑŸÅŸäÿ© ÿØÿßÿ¶ÿ±Ÿäÿ© ŸÑŸÑÿ¥ÿπÿßÿ±
        logo_bg = ctk.CTkFrame(
            logo_frame,
            width=100,
            height=100,
            corner_radius=50,
            fg_color=("#1f538d", "#4a9eff")
        )
        logo_bg.pack()
        logo_bg.pack_propagate(False)

        logo_text = ctk.CTkLabel(
            logo_bg,
            text="FTS",
            font=ctk.CTkFont(size=36, weight="bold"),
            text_color="white"
        )
        logo_text.place(relx=0.5, rely=0.5, anchor="center")

        # ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        app_name = ctk.CTkLabel(
            main_frame,
            text="FTS TRAVELS",
            font=ctk.CTkFont(size=28, weight="bold"),
            text_color=("#1f538d", "#4a9eff")
        )
        app_name.pack()

        app_subtitle = ctk.CTkLabel(
            main_frame,
            text="Sales Manager",
            font=ctk.CTkFont(size=16),
            text_color=("gray60", "gray40")
        )
        app_subtitle.pack(pady=(0, 20))

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ•ÿµÿØÿßÿ±
        version_frame = ctk.CTkFrame(main_frame)
        version_frame.pack(fill="x", padx=40, pady=10)

        info_items = [
            ("version", "Version", "2.0.0"),
            ("build", "Build", "2024.01.15"),
            ("developer", "Developer", "FTS Development Team"),
            ("license", "License", "Proprietary")
        ]

        for key, label, value in info_items:
            row_frame = ctk.CTkFrame(version_frame, fg_color="transparent")
            row_frame.pack(fill="x", pady=5)

            label_widget = ctk.CTkLabel(
                row_frame,
                text=f"{self.lang_manager.get(key, label)}:",
                font=ctk.CTkFont(weight="bold"),
                anchor="w",
                width=100
            )
            label_widget.pack(side="left", padx=(20, 10))

            value_widget = ctk.CTkLabel(
                row_frame,
                text=value,
                anchor="w"
            )
            value_widget.pack(side="left")

        # ÿßŸÑŸàÿµŸÅ
        desc_frame = ctk.CTkFrame(main_frame)
        desc_frame.pack(fill="x", padx=40, pady=20)

        description = self.lang_manager.get(
            "app_description",
            "FTS Travels Sales Manager is an integrated system for managing tourism sales and bookings.\n\n"
            "The system provides powerful tools for managing customers, bookings, and financial reports."
        )

        desc_label = ctk.CTkLabel(
            desc_frame,
            text=description,
            justify="center",
            wraplength=350,
            font=ctk.CTkFont(size=12)
        )
        desc_label.pack(pady=20)

        # ÿ±Ÿàÿßÿ®ÿ∑
        links_frame = ctk.CTkFrame(main_frame, fg_color="transparent")
        links_frame.pack(pady=10)

        website_btn = ctk.CTkButton(
            links_frame,
            text="üåê " + self.lang_manager.get("website", "Website"),
            width=120,
            command=lambda: webbrowser.open("https://www.ftstravels.com")
        )
        website_btn.pack(side="left", padx=5)

        support_btn = ctk.CTkButton(
            links_frame,
            text="üìß " + self.lang_manager.get("support", "Support"),
            width=120,
            command=lambda: webbrowser.open("mailto:support@ftstravels.com")
        )
        support_btn.pack(side="left", padx=5)

        # ÿ≠ŸÇŸàŸÇ ÿßŸÑŸÜÿ¥ÿ±
        copyright_label = ctk.CTkLabel(
            main_frame,
            text="¬© 2024 FTS - All Rights Reserved",
            font=ctk.CTkFont(size=10),
            text_color=("gray60", "gray40")
        )
        copyright_label.pack(pady=(20, 0))

        # ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
        close_btn = ctk.CTkButton(
            main_frame,
            text=self.lang_manager.get("close", "Close"),
            command=self.destroy,
            width=120
        )
        close_btn.pack(pady=20)

============================================================
FILE: views\components\header.py
SIZE: 28565 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/header.py

ŸÖŸÉŸàŸÜ ÿßŸÑŸáŸäÿØÿ± ÿßŸÑÿπŸÑŸàŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
"""

import customtkinter as ctk
import tkinter as tk
from typing import Callable, Dict, Any, Optional
import webbrowser
from datetime import datetime
import weakref

from core.language_manager import LanguageManager
from core.logger import logger

# ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ≠Ÿàÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿ´ÿ©
from .dropdown_dialogs import (
    ProfileWindow,
    SettingsWindow,
    LanguageWindow,
    AboutWindow
)


class DropdownMenu(ctk.CTkToplevel):
    """ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© Ÿàÿ•ÿØÿßÿ±ÿ© ŸÖÿ≠ÿ≥ŸëŸÜÿ© ŸÑŸÑÿ∞ÿßŸÉÿ±ÿ©"""

    def __init__(self, parent, x, y, lang_manager, header_component, **kwargs):
        super().__init__(parent, **kwargs)

        self.lang_manager = lang_manager
        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ weakref ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑŸÖÿ±ÿßÿ¨ÿπ ÿßŸÑÿØÿßÿ¶ÿ±Ÿäÿ©
        self.header_component_ref = weakref.ref(header_component)
        self._after_ids = []  # ŸÑÿ™ÿ™ÿ®ÿπ ÿ¨ŸÖŸäÿπ after callbacks
        self._fade_out_id = None

        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.overrideredirect(True)
        self.attributes("-topmost", True)

        # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ©
        self.attributes("-alpha", 0.0)

        # ÿßŸÑŸÖŸàÿ∂ÿπ
        self.geometry(f"+{x}+{y}")

        # ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÖÿπ ÿ∏ŸÑ
        self.shadow_frame = ctk.CTkFrame(
            self,
            corner_radius=12,
            fg_color=("#000000", "#000000"),
            bg_color="transparent"
        )
        self.shadow_frame.pack(fill="both", expand=True, padx=2, pady=2)

        # ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        self.main_frame = ctk.CTkFrame(
            self.shadow_frame,
            corner_radius=10,
            fg_color=("#ffffff", "#2b2b2b"),
            border_width=1,
            border_color=("#e0e0e0", "#444444")
        )
        self.main_frame.pack(fill="both", expand=True, padx=1, pady=1)

        # ÿ®ŸÜÿßÿ° ÿßŸÑÿπŸÜÿßÿµÿ±
        self._build_items()

        # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä
        self._fade_in()

        # ÿ±ÿ®ÿ∑ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÑÿ•ÿ∫ŸÑÿßŸÇŸáÿß
        self.bind("<FocusOut>", lambda e: self._start_fade_out())

        # ÿ±ÿ®ÿ∑ ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸàÿ≥ ŸÑŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™
        self.bind("<Leave>", lambda e: self._start_fade_out())
        self.bind("<Enter>", lambda e: self._cancel_fade_out())

        # ÿ™ÿ≥ÿ¨ŸäŸÑ callback ŸÑŸÑÿ™ŸÜÿ∏ŸäŸÅ ÿπŸÜÿØ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
        self.protocol("WM_DELETE_WINDOW", self._cleanup_and_destroy)

    def _fade_in(self):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä"""
        try:
            if not self.winfo_exists():
                return

            alpha = float(self.attributes("-alpha"))
            if alpha < 0.95:
                self.attributes("-alpha", alpha + 0.1)
                after_id = self.after(10, self._fade_in)
                self._after_ids.append(after_id)
        except (tk.TclError, AttributeError):
            # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÖ ÿ•ÿ∫ŸÑÿßŸÇŸáÿß
            pass

    def _fade_out(self):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßÿÆÿ™ŸÅÿßÿ° ÿßŸÑÿ™ÿØÿ±Ÿäÿ¨Ÿä"""
        try:
            if not self.winfo_exists():
                return

            alpha = float(self.attributes("-alpha"))
            if alpha > 0.1:
                self.attributes("-alpha", alpha - 0.1)
                after_id = self.after(10, self._fade_out)
                self._after_ids.append(after_id)
            else:
                self._cleanup_and_destroy()
        except (tk.TclError, AttributeError):
            # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÖ ÿ•ÿ∫ŸÑÿßŸÇŸáÿß
            self._cleanup_and_destroy()

    def _start_fade_out(self):
        """ÿ®ÿØÿ° ÿßŸÑÿßÿÆÿ™ŸÅÿßÿ° ÿ®ÿπÿØ ÿ™ÿ£ÿÆŸäÿ±"""
        try:
            if self._fade_out_id:
                self.after_cancel(self._fade_out_id)

            self._fade_out_id = self.after(200, self._check_mouse_position)
            self._after_ids.append(self._fade_out_id)
        except tk.TclError:
            pass

    def _cancel_fade_out(self):
        """ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿßÿÆÿ™ŸÅÿßÿ°"""
        try:
            if self._fade_out_id:
                self.after_cancel(self._fade_out_id)
                self._fade_out_id = None
        except tk.TclError:
            pass

    def _check_mouse_position(self):
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿßŸàÿ≥"""
        try:
            if not self.winfo_exists():
                return

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸàÿ∂ÿπ ÿßŸÑŸÖÿßŸàÿ≥
            x = self.winfo_pointerx()
            y = self.winfo_pointery()

            # ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≠ÿØŸàÿØ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            x1 = self.winfo_rootx()
            y1 = self.winfo_rooty()
            x2 = x1 + self.winfo_width()
            y2 = y1 + self.winfo_height()

            # ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖŸàÿ∂ÿπ
            if not (x1 <= x <= x2 and y1 <= y <= y2):
                self._fade_out()
            else:
                self._start_fade_out()

        except (tk.TclError, AttributeError):
            # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÖ ÿ•ÿ∫ŸÑÿßŸÇŸáÿß
            self._cleanup_and_destroy()

    def _cleanup_and_destroy(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ Ÿàÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©"""
        try:
            # ÿ•ŸÑÿ∫ÿßÿ° ÿ¨ŸÖŸäÿπ after callbacks
            for after_id in self._after_ids:
                try:
                    self.after_cancel(after_id)
                except:
                    pass

            # ÿ•ŸÑÿ∫ÿßÿ° fade_out_id ÿ•ŸÜ Ÿàÿ¨ÿØ
            if self._fade_out_id:
                try:
                    self.after_cancel(self._fade_out_id)
                except:
                    pass

            # ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            if self.winfo_exists():
                self.destroy()

        except:
            # ÿ™ÿ¨ÿßŸáŸÑ ÿ£Ÿä ÿ£ÿÆÿ∑ÿßÿ° ŸÅŸä ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ
            pass

    def _build_items(self):
        """ÿ®ŸÜÿßÿ° ÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        header_component = self.header_component_ref()
        if not header_component:
            return

        # ÿ±ÿ£ÿ≥ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖÿπ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        header_frame = ctk.CTkFrame(
            self.main_frame,
            fg_color=("#f8f9fa", "#1e1e1e"),
            corner_radius=10
        )
        header_frame.pack(fill="x", padx=10, pady=10)

        # ÿµŸàÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (placeholder)
        user_avatar = ctk.CTkLabel(
            header_frame,
            text="üë§",
            font=ctk.CTkFont(size=40),
            width=60,
            height=60,
            fg_color=("#e0e0e0", "#3a3a3a"),
            corner_radius=30
        )
        user_avatar.pack(pady=10)

        # ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        username = header_component.user_record.get('fields', {}).get('Username', 'User')
        user_label = ctk.CTkLabel(
            header_frame,
            text=username,
            font=ctk.CTkFont(size=16, weight="bold")
        )
        user_label.pack()

        # ÿßŸÑÿØŸàÿ±
        role = header_component.user_record.get('fields', {}).get('Role', '')
        if role:
            role_label = ctk.CTkLabel(
                header_frame,
                text=header_component._translate_role(role),
                font=ctk.CTkFont(size=12),
                text_color=("#666666", "#999999")
            )
            role_label.pack(pady=(0, 10))

        # ÿÆÿ∑ ŸÅÿßÿµŸÑ ÿ£ŸÜŸäŸÇ
        separator = ctk.CTkFrame(
            self.main_frame,
            height=1,
            fg_color=("#e0e0e0", "#444444")
        )
        separator.pack(fill="x", padx=15, pady=5)

        # ÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        items = [
            ("üë§", "profile", self._on_profile, "primary"),
            ("‚öôÔ∏è", "settings", self._on_settings, "default"),
            ("üåê", "language", self._on_language, "default"),
            ("‚ÑπÔ∏è", "about", self._on_about, "default"),
            ("separator", None, None, None),
            ("üö™", "logout", self._on_logout, "danger")
        ]

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿπŸÜÿßÿµÿ±
        items_frame = ctk.CTkFrame(
            self.main_frame,
            fg_color="transparent"
        )
        items_frame.pack(fill="both", expand=True, padx=5, pady=5)

        for icon, key, command, style in items:
            if icon == "separator":
                separator = ctk.CTkFrame(
                    items_frame,
                    height=1,
                    fg_color=("#e0e0e0", "#444444")
                )
                separator.pack(fill="x", padx=10, pady=8)
            else:
                self._create_menu_item(items_frame, icon, key, command, style)

    def _create_menu_item(self, parent, icon, key, command, style):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÜÿµÿ± ŸÇÿßÿ¶ŸÖÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        text = self.lang_manager.get(f"menu_{key}", key.title())

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿπŸÜÿµÿ±
        item_frame = ctk.CTkFrame(
            parent,
            height=40,
            fg_color="transparent",
            corner_radius=8
        )
        item_frame.pack(fill="x", padx=5, pady=2)

        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÖÿ∑
        if style == "primary":
            hover_color = ("#e3f2fd", "#1976d2")
            text_color = ("#1976d2", "#90caf9")
        elif style == "danger":
            hover_color = ("#ffebee", "#b71c1c")
            text_color = ("#d32f2f", "#ff5252")
        else:
            hover_color = ("#f5f5f5", "#3a3a3a")
            text_color = ("#333333", "#ffffff")

        # ÿßŸÑÿ≤ÿ±
        btn = ctk.CTkButton(
            item_frame,
            text=f"{icon}  {text}",
            anchor="w",
            height=36,
            fg_color="transparent",
            hover_color=hover_color,
            text_color=text_color,
            font=ctk.CTkFont(size=13),
            command=command,
            corner_radius=8
        )
        btn.pack(fill="both", expand=True)

        # ÿ™ÿ£ÿ´Ÿäÿ± hover ÿ•ÿ∂ÿßŸÅŸä
        def on_enter(e):
            btn.configure(font=ctk.CTkFont(size=13, weight="bold"))

        def on_leave(e):
            btn.configure(font=ctk.CTkFont(size=13))

        btn.bind("<Enter>", on_enter)
        btn.bind("<Leave>", on_leave)

    def _on_profile(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä"""
        self._cleanup_and_destroy()
        header_component = self.header_component_ref()
        if not header_component:
            return

        controller = header_component.controller
        if controller:
            profile_window = ProfileWindow(
                header_component.winfo_toplevel(),
                controller,
                self.lang_manager
            )
        else:
            logger.error("ŸÑÿß ŸäŸÖŸÉŸÜ ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä - ÿßŸÑŸÖÿ™ÿ≠ŸÉŸÖ ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠")

    def _on_settings(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™"""
        self._cleanup_and_destroy()
        header_component = self.header_component_ref()
        if not header_component:
            return

        controller = header_component.controller
        if controller and hasattr(controller, 'config_mgr') and hasattr(controller, 'theme_manager'):
            settings_window = SettingsWindow(
                header_component.winfo_toplevel(),
                self.lang_manager,
                controller.config_mgr,
                controller.theme_manager
            )
        else:
            logger.error("ŸÑÿß ŸäŸÖŸÉŸÜ ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ - ÿßŸÑŸÖÿ™ÿ≠ŸÉŸÖ ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠")

    def _on_language(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"""
        self._cleanup_and_destroy()
        header_component = self.header_component_ref()
        if not header_component:
            return

        def change_language(new_lang):
            if hasattr(header_component, 'on_language_change'):
                header_component.on_language_change(new_lang)
            else:
                self.lang_manager.set_language(new_lang)
                header_component.update_texts(self.lang_manager)

        language_window = LanguageWindow(
            header_component.winfo_toplevel(),
            self.lang_manager,
            change_language
        )

    def _on_about(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿ≠ŸàŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
        self._cleanup_and_destroy()
        header_component = self.header_component_ref()
        if not header_component:
            return

        about_window = AboutWindow(
            header_component.winfo_toplevel(),
            self.lang_manager
        )

    def _on_logout(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨"""
        self._cleanup_and_destroy()
        header_component = self.header_component_ref()
        if not header_component:
            return

        from tkinter import messagebox
        if messagebox.askyesno(
            self.lang_manager.get("confirm", "Confirm"),
            self.lang_manager.get("confirm_logout", "Are you sure you want to logout?")
        ):
            logger.info("ÿ®ÿØÿ° ÿπŸÖŸÑŸäÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨...")

            controller = header_component.controller
            if controller:
                try:
                    if hasattr(controller, 'save_current_state'):
                        controller.save_current_state()

                    if hasattr(controller, 'cleanup'):
                        controller.cleanup()

                    if hasattr(controller, 'on_logout'):
                        controller.on_logout()

                    main_window = header_component.winfo_toplevel()
                    main_window.destroy()

                    if hasattr(controller, 'run'):
                        controller.run()

                except Exception as e:
                    logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨: {e}")
                    messagebox.showerror(
                        self.lang_manager.get("error", "Error"),
                        self.lang_manager.get("logout_error", "An error occurred during logout")
                    )
            else:
                header_component.winfo_toplevel().destroy()


class HeaderComponent(ctk.CTkFrame):
    """ŸÖŸÉŸàŸÜ ÿßŸÑŸáŸäÿØÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""

    def __init__(
        self,
        parent,
        lang_manager: LanguageManager,
        user_record: Dict[str, Any],
        on_search: Callable = None,
        on_refresh: Callable = None,
        on_menu_click: Callable = None,
        on_language_change: Callable = None,
        on_theme_change: Callable = None,
        controller: Any = None,
        **kwargs
    ):
        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑÿ•ÿ∑ÿßÿ±
        kwargs.setdefault('height', 80)
        kwargs.setdefault('corner_radius', 0)
        kwargs.setdefault('fg_color', ("#ffffff", "#2b2b2b"))

        super().__init__(parent, **kwargs)
        self.pack_propagate(False)

        self.lang_manager = lang_manager
        self.user_record = user_record
        self.on_search = on_search
        self.on_refresh = on_refresh
        self.on_language_change = on_language_change
        self.on_theme_change = on_theme_change
        self.controller = controller

        # ŸÖÿ™ÿ∫Ÿäÿ± ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        self.dropdown_menu: Optional[DropdownMenu] = None

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ¨ÿßŸÜÿ® ÿßŸÑÿ£ŸäŸÖŸÜ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©
        self.right_frame = ctk.CTkFrame(self, fg_color="transparent")
        self.right_frame.pack(side="right", fill="y", padx=20)

        self._build_ui()

    def change_theme_with_restart(self, new_theme):
        """ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ ŸÖÿπ ÿ∑ŸÑÿ® ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ"""
        try:
            # ÿ≠ŸÅÿ∏ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ¨ÿØŸäÿØ
            self.controller.config_mgr.set("color_theme", new_theme)

            # ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ©
            result = messagebox.askyesno(
                self.lang_manager.get("restart_required", "Restart Required"),
                self.lang_manager.get(
                    "restart_to_apply_theme",
                    f"ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ´ŸäŸÖ '{new_theme}'.\n\n"
                    "Ÿäÿ¨ÿ® ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™.\n"
                    "ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ¢ŸÜÿü"
                )
            )

            if result:
                # ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
                import sys
                import os
                python = sys.executable
                os.execl(python, python, *sys.argv)

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ´ŸäŸÖ: {e}")
            messagebox.showerror(
                self.lang_manager.get("error", "Error"),
                str(e)
            )

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿßŸÑÿ¥ÿπÿßÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
        self._create_enhanced_logo()

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
        self._create_enhanced_search_bar()

        # ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
        self._create_enhanced_user_area()

    def _create_enhanced_logo(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿπÿßÿ± ŸÖÿ≠ÿ≥ŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ¥ÿπÿßÿ±
        logo_frame = ctk.CTkFrame(
            self,
            width=200,
            fg_color="transparent"
        )
        logo_frame.pack(side="left", fill="y", padx=(20, 10))
        logo_frame.pack_propagate(False)

        # ÿ•ÿ∑ÿßÿ± ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ¥ÿπÿßÿ±
        logo_content = ctk.CTkFrame(logo_frame, fg_color="transparent")
        logo_content.pack(expand=True)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© ŸàÿßŸÑŸÜÿµ
        logo_inner = ctk.CTkFrame(logo_content, fg_color="transparent")
        logo_inner.pack()

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ¥ÿ±ŸÉÿ©
        logo_icon_bg = ctk.CTkFrame(
            logo_inner,
            width=50,
            height=50,
            corner_radius=25,
            fg_color=("#1976d2", "#2196f3")
        )
        logo_icon_bg.pack(side="left", padx=(0, 10))
        logo_icon_bg.pack_propagate(False)

        logo_icon = ctk.CTkLabel(
            logo_icon_bg,
            text="FTS",
            font=ctk.CTkFont(size=18, weight="bold"),
            text_color="white"
        )
        logo_icon.place(relx=0.5, rely=0.5, anchor="center")

        # ŸÜÿµŸàÿµ ÿßŸÑÿ¥ÿπÿßÿ±
        text_frame = ctk.CTkFrame(logo_inner, fg_color="transparent")
        text_frame.pack(side="left")

        # ÿßŸÑŸÜÿµ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        main_text = ctk.CTkLabel(
            text_frame,
            text="FTS TRAVELS",
            font=ctk.CTkFont(size=22, weight="bold"),
            text_color=("#1976d2", "#2196f3")
        )
        main_text.pack(anchor="w")

        # ÿßŸÑŸÜÿµ ÿßŸÑŸÅÿ±ÿπŸä
        sub_text = ctk.CTkLabel(
            text_frame,
            text="Sales Manager Pro",
            font=ctk.CTkFont(size=11),
            text_color=("#666666", "#999999")
        )
        sub_text.pack(anchor="w", pady=(0, 2))

    def _create_enhanced_search_bar(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿ®ÿ≠ÿ´ ŸÖÿ≠ÿ≥ŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        search_container = ctk.CTkFrame(self, fg_color="transparent")
        search_container.pack(side="left", fill="both", expand=True, padx=20)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        search_frame = ctk.CTkFrame(
            search_container,
            height=45,
            fg_color=("#f5f5f5", "#333333"),
            corner_radius=25,
            border_width=2,
            border_color=("#e0e0e0", "#444444")
        )
        search_frame.pack(expand=True, fill="x", pady=15)
        search_frame.pack_propagate(False)

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ®ÿ≠ÿ´
        search_icon = ctk.CTkLabel(
            search_frame,
            text="üîç",
            font=ctk.CTkFont(size=18),
            text_color=("#666666", "#999999")
        )
        search_icon.pack(side="left", padx=(15, 5))

        # ÿ≠ŸÇŸÑ ÿßŸÑÿ®ÿ≠ÿ´
        self.search_var = ctk.StringVar()
        self.search_entry = ctk.CTkEntry(
            search_frame,
            textvariable=self.search_var,
            placeholder_text=self.lang_manager.get("search_placeholder", "Search bookings..."),
            border_width=0,
            fg_color="transparent",
            font=ctk.CTkFont(size=14),
            height=40
        )
        self.search_entry.pack(side="left", fill="both", expand=True, padx=(5, 10))

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        actions_frame = ctk.CTkFrame(search_frame, fg_color="transparent")
        actions_frame.pack(side="right", padx=(0, 10))

        # ÿ≤ÿ± ÿßŸÑÿ®ÿ≠ÿ´
        search_btn = ctk.CTkButton(
            actions_frame,
            text="",
            image=None,  # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸäŸÇŸàŸÜÿ© ŸáŸÜÿß
            width=35,
            height=35,
            corner_radius=17,
            fg_color=("#1976d2", "#2196f3"),
            hover_color=("#1565c0", "#1e88e5"),
            command=self._on_search
        )
        search_btn.pack(side="left", padx=2)

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ®ÿ≠ÿ´ ŸÑŸÑÿ≤ÿ±
        search_btn_icon = ctk.CTkLabel(
            search_btn,
            text="‚Üí",
            font=ctk.CTkFont(size=16, weight="bold"),
            text_color="white"
        )
        search_btn_icon.place(relx=0.5, rely=0.5, anchor="center")

        # ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠
        if self.search_var.get():
            clear_btn = ctk.CTkButton(
                actions_frame,
                text="‚úï",
                width=30,
                height=30,
                corner_radius=15,
                fg_color="transparent",
                hover_color=("#e0e0e0", "#444444"),
                text_color=("#666666", "#999999"),
                command=self.clear_search
            )
            clear_btn.pack(side="left", padx=2)

        # ÿ≤ÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
        if self.on_refresh:
            refresh_btn = ctk.CTkButton(
                actions_frame,
                text="‚Üª",
                width=35,
                height=35,
                corner_radius=17,
                fg_color="transparent",
                hover_color=("#e0e0e0", "#444444"),
                text_color=("#666666", "#999999"),
                font=ctk.CTkFont(size=18),
                command=self.on_refresh
            )
            refresh_btn.pack(side="left", padx=2)

        # ÿ±ÿ®ÿ∑ Enter ÿ®ÿßŸÑÿ®ÿ≠ÿ´
        self.search_entry.bind("<Return>", lambda e: self._on_search())

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠ ÿπŸÜÿØ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
        self.search_var.trace("w", self._update_clear_button)

    def _update_clear_button(self, *args):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ∏ŸáŸàÿ± ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠"""
        # ŸäŸÖŸÉŸÜ ÿ™ŸÜŸÅŸäÿ∞ ŸÖŸÜÿ∑ŸÇ ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑŸÖÿ≥ÿ≠ ŸáŸÜÿß
        pass

    def _create_enhanced_user_area(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÜÿ∑ŸÇÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ≠ÿ≥ŸÜÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©"""
        user_container = ctk.CTkFrame(self.right_frame, fg_color="transparent")
        user_container.pack(side="left", fill="y")

        # ÿ•ÿ∑ÿßÿ± ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        user_info_frame = ctk.CTkFrame(
            user_container,
            fg_color=("#f8f9fa", "#1e1e1e"),
            corner_radius=25,
            border_width=1,
            border_color=("#e0e0e0", "#444444")
        )
        user_info_frame.pack(side="left", padx=10, pady=15)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        content_frame = ctk.CTkFrame(user_info_frame, fg_color="transparent")
        content_frame.pack(padx=15, pady=8)

        # ÿµŸàÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        avatar_frame = ctk.CTkFrame(
            content_frame,
            width=40,
            height=40,
            corner_radius=20,
            fg_color=("#e0e0e0", "#3a3a3a")
        )
        avatar_frame.pack(side="left", padx=(0, 10))
        avatar_frame.pack_propagate(False)

        avatar_label = ctk.CTkLabel(
            avatar_frame,
            text="üë§",
            font=ctk.CTkFont(size=20)
        )
        avatar_label.place(relx=0.5, rely=0.5, anchor="center")

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        info_frame = ctk.CTkFrame(content_frame, fg_color="transparent")
        info_frame.pack(side="left", padx=(0, 10))

        # ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        username = self.user_record.get('fields', {}).get('Username', 'User')
        username_label = ctk.CTkLabel(
            info_frame,
            text=username,
            font=ctk.CTkFont(size=14, weight="bold"),
            text_color=("#333333", "#ffffff")
        )
        username_label.pack(anchor="w")

        # ÿßŸÑÿØŸàÿ±
        role = self.user_record.get('fields', {}).get('Role', '')
        if role:
            role_text = self._translate_role(role)
            self.role_label = ctk.CTkLabel(
                info_frame,
                text=role_text,
                font=ctk.CTkFont(size=11),
                text_color=("#666666", "#999999")
            )
            self.role_label.pack(anchor="w")

        # ÿ≤ÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
        self.menu_btn = ctk.CTkButton(
            content_frame,
            text="‚ñº",
            width=30,
            height=30,
            corner_radius=15,
            fg_color="transparent",
            hover_color=("#e0e0e0", "#444444"),
            text_color=("#666666", "#999999"),
            font=ctk.CTkFont(size=12),
            command=self._toggle_dropdown_menu
        )
        self.menu_btn.pack(side="left")

        # ÿ™ÿ£ÿ´Ÿäÿ± hover ŸÑŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑŸÉÿßŸÖŸÑ
        def on_enter(e):
            user_info_frame.configure(border_color=("#1976d2", "#2196f3"))

        def on_leave(e):
            user_info_frame.configure(border_color=("#e0e0e0", "#444444"))

        user_info_frame.bind("<Enter>", on_enter)
        user_info_frame.bind("<Leave>", on_leave)

        # ÿ¨ÿπŸÑ ÿßŸÑÿ•ÿ∑ÿßÿ± ŸÉŸÑŸá ŸÇÿßÿ®ŸÑ ŸÑŸÑŸÜŸÇÿ±
        for widget in [user_info_frame, content_frame, info_frame, username_label]:
            widget.bind("<Button-1>", lambda e: self._toggle_dropdown_menu())

    def _toggle_dropdown_menu(self):
        """ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.dropdown_menu and hasattr(self.dropdown_menu, 'winfo_exists'):
            try:
                if self.dropdown_menu.winfo_exists():
                    self.dropdown_menu._cleanup_and_destroy()
                    self.dropdown_menu = None
                    return
            except:
                self.dropdown_menu = None

        # ÿ≠ÿ≥ÿßÿ® ŸÖŸàÿ∂ÿπ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        x = self.menu_btn.winfo_rootx() - 150
        y = self.menu_btn.winfo_rooty() + self.menu_btn.winfo_height() + 10

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        self.dropdown_menu = DropdownMenu(
            self,
            x,
            y,
            self.lang_manager,
            self
        )

    def _translate_role(self, role):
        """ÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑÿØŸàÿ±"""
        return self.lang_manager.get(f"role_{role.lower()}", role)

    def _on_search(self):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ®ÿ≠ÿ´"""
        if self.on_search:
            search_text = self.search_var.get().strip()
            self.on_search(search_text)

    def clear_search(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿ≠ÿ´"""
        self.search_var.set("")
        if self.on_search:
            self.on_search("")

    def update_texts(self, lang_manager):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµŸàÿµ ÿßŸÑŸÖŸÉŸàŸÜ"""
        self.lang_manager = lang_manager

        # ÿ™ÿ≠ÿØŸäÿ´ placeholder ÿßŸÑÿ®ÿ≠ÿ´
        if hasattr(self, 'search_entry'):
            self.search_entry.configure(
                placeholder_text=lang_manager.get("search_placeholder", "Search bookings...")
            )

        # ÿ™ÿ≠ÿØŸäÿ´ ÿØŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        if hasattr(self, 'role_label'):
            role = self.user_record.get('fields', {}).get('Role', '')
            if role:
                role_text = self._translate_role(role)
                self.role_label.configure(text=role_text)

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ"""
        # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        self.configure(fg_color=("#ffffff", "#2b2b2b"))

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ®ÿ≠ÿ´
        if hasattr(self, 'search_frame'):
            search_frame = self.search_entry.master
            if search_frame:
                search_frame.configure(
                    fg_color=("#f5f5f5", "#333333"),
                    border_color=("#e0e0e0", "#444444")
                )

        # ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        if hasattr(self, 'user_info_frame'):
            for widget in self.right_frame.winfo_children():
                if isinstance(widget, ctk.CTkFrame):
                    widget.configure(
                        fg_color=("#f8f9fa", "#1e1e1e"),
                        border_color=("#e0e0e0", "#444444")
                    )

        # ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
        if self.dropdown_menu and self.dropdown_menu.winfo_exists():
            self.dropdown_menu.destroy()
            self.dropdown_menu = None

    def _cleanup(self):
        """ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ"""
        if self.dropdown_menu:
            try:
                self.dropdown_menu._cleanup_and_destroy()
            except:
                pass
            self.dropdown_menu = None

    def destroy(self):
        """ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÖŸÉŸàŸÜ"""
        self._cleanup()
        super().destroy()

============================================================
FILE: views\components\menu_bar.py
SIZE: 11466 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/menu_bar.py

ŸÖŸÉŸàŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
"""

import tkinter as tk
from tkinter import messagebox
from typing import Callable, Optional, Dict, Any

from core.language_manager import LanguageManager
from core.logger import logger


class MenuBarComponent:
    """ŸÖŸÉŸàŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"""

    def __init__(
        self,
        parent_window,
        lang_manager: LanguageManager,
        user_record: Dict[str, Any],
        callbacks: Dict[str, Callable]
    ):
        """
        ÿ™ŸáŸäÿ¶ÿ© ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ

        Args:
            parent_window: ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
            lang_manager: ŸÖÿØŸäÿ± ÿßŸÑŸÑÿ∫ÿ©
            user_record: ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            callbacks: ŸÇÿßŸÖŸàÿ≥ ÿ®ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖÿ±ÿ¨ÿπŸäÿ©
        """
        self.parent = parent_window
        self.lang_manager = lang_manager
        self.user_record = user_record
        self.callbacks = callbacks

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
        self.dark_mode_var = tk.BooleanVar()
        self.fullscreen_var = tk.BooleanVar(value=False)
        self.performance_mode_var = tk.BooleanVar(value=False)
        self.lang_var = tk.StringVar(value=self.lang_manager.current_lang)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
        self._create_menu()

    def _create_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"""
        try:
            # ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
            self.menubar = tk.Menu(self.parent)
            self.parent.config(menu=self.menubar)

            # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
            self._create_file_menu()
            self._create_edit_menu()
            self._create_view_menu()
            self._create_tools_menu()

            # ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ (ŸÑŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜ ŸÅŸÇÿ∑)
            if self._is_admin():
                self._create_admin_menu()

            self._create_help_menu()

            logger.info("ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠")

        except Exception as e:
            logger.error(f"ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ: {e}")

    def _create_file_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÑŸÅ"""
        file_menu = tk.Menu(self.menubar, tearoff=0)

        # ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨
        file_menu.add_command(
            label=self.lang_manager.get("logout", "Logout"),
            command=self._get_callback('logout'),
            accelerator="Ctrl+Shift+L"
        )

        file_menu.add_separator()

        # ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        file_menu.add_command(
            label=self.lang_manager.get("export_data", "Export Data"),
            command=self._get_callback('export'),
            accelerator="Ctrl+S"
        )

        file_menu.add_separator()

        # ÿ•ÿ∫ŸÑÿßŸÇ
        file_menu.add_command(
            label=self.lang_manager.get("close", "Close"),
            command=self._get_callback('close'),
            accelerator="Alt+F4"
        )

        self.menubar.add_cascade(
            label=self.lang_manager.get("file_menu", "File"),
            menu=file_menu
        )

    def _create_edit_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿ™ÿ≠ÿ±Ÿäÿ±"""
        edit_menu = tk.Menu(self.menubar, tearoff=0)

        # ÿ•ÿ∂ÿßŸÅÿ©
        edit_menu.add_command(
            label=self.lang_manager.get("add", "Add"),
            command=self._get_callback('add'),
            accelerator="Ctrl+N"
        )

        # ÿ™ÿπÿØŸäŸÑ
        edit_menu.add_command(
            label=self.lang_manager.get("edit", "Edit"),
            command=self._get_callback('edit'),
            accelerator="Ctrl+E"
        )

        # ÿ≠ÿ∞ŸÅ
        edit_menu.add_command(
            label=self.lang_manager.get("delete", "Delete"),
            command=self._get_callback('delete'),
            accelerator="Delete"
        )

        edit_menu.add_separator()

        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ
        edit_menu.add_command(
            label=self.lang_manager.get("select_all", "Select All"),
            command=self._get_callback('select_all'),
            accelerator="Ctrl+A"
        )

        # ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
        edit_menu.add_command(
            label=self.lang_manager.get("clear_selection", "Clear Selection"),
            command=self._get_callback('clear_selection'),
            accelerator="Escape"
        )

        self.menubar.add_cascade(
            label=self.lang_manager.get("edit_menu", "Edit"),
            menu=edit_menu
        )

    def _create_view_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿπÿ±ÿ∂"""
        view_menu = tk.Menu(self.menubar, tearoff=0)

        # ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ
        view_menu.add_checkbutton(
            label=self.lang_manager.get("dark_mode", "Dark Mode"),
            variable=self.dark_mode_var,
            command=self._toggle_dark_mode,
            accelerator="Ctrl+T"
        )

        view_menu.add_separator()

        # ŸÇÿßÿ¶ŸÖÿ© ŸÑÿ∫ÿ© ŸÅÿ±ÿπŸäÿ©
        self._create_language_submenu(view_menu)

        view_menu.add_separator()

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        view_menu.add_command(
            label=self.lang_manager.get("refresh", "Refresh"),
            command=self._get_callback('refresh'),
            accelerator="F5"
        )

        # Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
        view_menu.add_checkbutton(
            label=self.lang_manager.get("fullscreen", "Fullscreen"),
            variable=self.fullscreen_var,
            command=self._toggle_fullscreen,
            accelerator="F11"
        )

        # Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä
        view_menu.add_checkbutton(
            label=self.lang_manager.get("performance_mode", "Performance Mode"),
            variable=self.performance_mode_var,
            command=self._toggle_performance_mode
        )

        self.menubar.add_cascade(
            label=self.lang_manager.get("view_menu", "View"),
            menu=view_menu
        )

    def _create_language_submenu(self, parent_menu):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ©"""
        lang_menu = tk.Menu(parent_menu, tearoff=0)

        # ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
        lang_menu.add_radiobutton(
            label=self.lang_manager.get("arabic", "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"),
            command=lambda: self._change_language("ar"),
            value="ar",
            variable=self.lang_var
        )

        # English
        lang_menu.add_radiobutton(
            label=self.lang_manager.get("english", "English"),
            command=lambda: self._change_language("en"),
            value="en",
            variable=self.lang_var
        )

        parent_menu.add_cascade(
            label=self.lang_manager.get("language_menu", "Language"),
            menu=lang_menu
        )

    def _create_tools_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿ£ÿØŸàÿßÿ™"""
        tools_menu = tk.Menu(self.menubar, tearoff=0)

        # ÿßŸÑÿ®ÿ≠ÿ´
        tools_menu.add_command(
            label=self.lang_manager.get("search", "Search"),
            command=self._get_callback('search'),
            accelerator="Ctrl+F"
        )

        tools_menu.add_separator()

        # ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        tools_menu.add_command(
            label=self.lang_manager.get("statistics", "Statistics"),
            command=self._get_callback('statistics')
        )

        # ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±
        tools_menu.add_command(
            label=self.lang_manager.get("reports", "Reports"),
            command=self._get_callback('reports')
        )

        self.menubar.add_cascade(
            label=self.lang_manager.get("tools_menu", "Tools"),
            menu=tools_menu
        )

    def _create_admin_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ"""
        admin_menu = tk.Menu(self.menubar, tearoff=0)

        # ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
        admin_menu.add_command(
            label=self.lang_manager.get("user_management", "User Management"),
            command=self._get_callback('user_management')
        )

        # ŸÖÿ≠ÿ±ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        admin_menu.add_command(
            label=self.lang_manager.get("config_editor", "Configuration Editor"),
            command=self._get_callback('config_editor')
        )

        admin_menu.add_separator()

        # ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©
        admin_menu.add_command(
            label=self.lang_manager.get("clear_cache", "Clear Cache"),
            command=self._get_callback('clear_cache')
        )

        # ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
        admin_menu.add_command(
            label=self.lang_manager.get("view_logs", "View Logs"),
            command=self._get_callback('view_logs')
        )

        self.menubar.add_cascade(
            label=self.lang_manager.get("admin_menu", "Admin"),
            menu=admin_menu
        )

    def _create_help_menu(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©"""
        help_menu = tk.Menu(self.menubar, tearoff=0)

        # ÿßŸÑÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™
        help_menu.add_command(
            label=self.lang_manager.get("shortcuts", "Keyboard Shortcuts"),
            command=self._get_callback('shortcuts'),
            accelerator="F1"
        )

        help_menu.add_separator()

        # ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        help_menu.add_command(
            label=self.lang_manager.get("user_guide", "User Guide"),
            command=self._get_callback('user_guide')
        )

        # ÿ≠ŸàŸÑ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨
        help_menu.add_command(
            label=self.lang_manager.get("about", "About"),
            command=self._get_callback('about')
        )

        self.menubar.add_cascade(
            label=self.lang_manager.get("help_menu", "Help"),
            menu=help_menu
        )

    def _is_admin(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ"""
        return self.user_record.get('fields', {}).get('Role', '').lower() == 'admin'

    def _get_callback(self, action: str) -> Callable:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖÿ±ÿ¨ÿπŸäÿ©"""
        return self.callbacks.get(action, lambda: logger.warning(f"No callback for action: {action}"))

    def _toggle_dark_mode(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ"""
        if 'toggle_theme' in self.callbacks:
            self.callbacks['toggle_theme']()

    def _toggle_fullscreen(self):
        """ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©"""
        if self.fullscreen_var.get():
            self.parent.attributes("-fullscreen", True)
        else:
            self.parent.attributes("-fullscreen", False)

        if 'fullscreen_changed' in self.callbacks:
            self.callbacks['fullscreen_changed'](self.fullscreen_var.get())

    def _toggle_performance_mode(self):
        """ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä"""
        if 'performance_mode' in self.callbacks:
            self.callbacks['performance_mode'](self.performance_mode_var.get())

    def _change_language(self, lang_code: str):
        """ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"""
        if 'change_language' in self.callbacks:
            self.callbacks['change_language'](lang_code)
            self.lang_var.set(lang_code)

    def update_texts(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµŸàÿµ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©"""
        # ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
        self._create_menu()

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™
        self.lang_var.set(self.lang_manager.current_lang)

    def update_dark_mode(self, is_dark: bool):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ"""
        self.dark_mode_var.set(is_dark)

    def destroy(self):
        """ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÖŸÉŸàŸÜ"""
        try:
            if hasattr(self, 'menubar'):
                self.menubar.destroy()
        except:
            pass

============================================================
FILE: views\components\quick_test.py
SIZE: 2201 characters
============================================================

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ÿßÿÆÿ™ÿ®ÿßÿ± ÿ≥ÿ±Ÿäÿπ ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© - ŸÑÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ≥ÿ±Ÿäÿπ
"""

import customtkinter as ctk
from enhanced_searchable_combobox import EnhancedSearchableComboBox

def test_fixed_dropdown():
    """ÿßÿÆÿ™ÿ®ÿßÿ± ÿ≥ÿ±Ÿäÿπ ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿµÿ≠ÿ≠ÿ©"""

    app = ctk.CTk()
    app.title("üîß ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿµÿ≠ÿ≠ÿ© - ŸÑÿß ÿ™ÿÆÿ™ŸÅŸä ÿ®ÿ≥ÿ±ÿπÿ©")
    app.geometry("600x500")

    # ÿ™ÿπŸÑŸäŸÖÿßÿ™
    instructions = ctk.CTkLabel(
        app,
        text="""üîß ÿßÿÆÿ™ÿ®ÿßÿ± ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ≥ÿ±Ÿäÿπ:

1. ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ≤ÿ± ‚ñº - Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© Ÿàÿ™ÿ®ŸÇŸâ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
2. ÿ≠ÿ±ŸÉ ÿßŸÑŸÖÿßŸàÿ≥ ŸÅŸàŸÇ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ - Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ®ŸÇŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖŸÅÿ™Ÿàÿ≠ÿ©
3. ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿÆŸäÿßÿ± - Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ±Ÿá
4. ÿ±ÿßŸÇÿ® ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ¥ÿÆŸäÿµ ŸÅŸä Console

ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÑÿß ÿ™ÿ≤ÿßŸÑ ÿ™ÿÆÿ™ŸÅŸäÿå ÿ≥ŸÜÿ≠ÿ™ÿßÿ¨ ŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™.""",
        font=ctk.CTkFont(size=12),
        justify="left"
    )
    instructions.pack(pady=20, padx=20)

    # ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
    test_values = [
        "Cairo", "Alexandria", "Luxor", "Aswan",
        "Hurghada", "Sharm El Sheikh", "Giza"
    ]

    combo = EnhancedSearchableComboBox(
        app,
        values=test_values,
        placeholder="ÿßÿÆÿ™ÿ®ÿ± ŸáŸÜÿß - Ÿäÿ¨ÿ® ÿ£ŸÑÿß ÿ™ÿÆÿ™ŸÅŸä ÿ®ÿ≥ÿ±ÿπÿ©",
        width=500,
        height=40,
        debug_mode=True,  # ŸÖŸáŸÖ ŸÑŸÑÿ™ÿ¥ÿÆŸäÿµ
        on_select=lambda v: print(f"üéØ ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ±: {v}")
    )
    combo.pack(pady=30)

    # ÿ≤ÿ± ÿßÿÆÿ™ÿ®ÿßÿ± ŸäÿØŸàŸä
    def manual_test():
        print("\nüß™ ÿßÿÆÿ™ÿ®ÿßÿ± ŸäÿØŸàŸä ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©:")
        combo._show_all_results()
        combo._open_dropdown()
        print("üìù ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸäÿØŸàŸäÿßŸã - Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ®ŸÇŸâ ŸÖŸÅÿ™Ÿàÿ≠ÿ©")

    test_btn = ctk.CTkButton(
        app,
        text="üß™ ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸäÿØŸàŸäÿßŸã",
        command=manual_test,
        height=40
    )
    test_btn.pack(pady=10)

    # ŸÜÿµÿßÿ¶ÿ≠
    tips = ctk.CTkLabel(
        app,
        text="""üí° ŸÜÿµÿßÿ¶ÿ≠ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±:
‚Ä¢ ÿ•ÿ∞ÿß ÿßÿÆÿ™ŸÅÿ™ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ≥ÿ±ÿπÿ©ÿå ÿ±ÿßÿ¨ÿπ ÿ±ÿ≥ÿßÿ¶ŸÑ Console
‚Ä¢ ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ±ÿ≥ÿßÿ¶ŸÑ "‚ùå ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©" ŸÅŸä Console
‚Ä¢ ÿ¨ÿ±ÿ® ÿßŸÑŸÜŸÇÿ± ÿ®ÿ®ÿ∑ÿ° ÿπŸÑŸâ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™
‚Ä¢ ŸÑÿß ÿ™ÿ≠ÿ±ŸÉ ÿßŸÑŸÖÿßŸàÿ≥ ÿ®ÿ≥ÿ±ÿπÿ© ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©""",
        font=ctk.CTkFont(size=11),
        justify="left"
    )
    tips.pack(pady=20)

    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿµÿ≠ÿ≠ÿ©")
    print("üìã ÿ±ÿßŸÇÿ® Ÿáÿ∞Ÿá ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÑŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ¥ÿÆŸäÿµŸäÿ©")

    app.mainloop()

if __name__ == "__main__":
    test_fixed_dropdown()

============================================================
FILE: views\components\searchable_combobox.py
SIZE: 20729 characters
============================================================

# -*- coding: utf-8 -*-
"""
components/enhanced_searchable_combobox.py - ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ®ÿ≥ÿ∑ÿ© ŸàÿßŸÑŸÖÿ´ÿ®ÿ™ÿ©

ÿßŸÑÿ•ÿµŸÑÿßÿ≠ÿßÿ™ ÿßŸÑŸÖÿ∑ÿ®ŸÇÿ©:
‚úÖ ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑ Ÿàÿ£ŸÉÿ´ÿ± ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ±ÿßŸã
‚úÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿ≠ÿØÿßÿ´ ŸÖÿ≠ÿ≥ŸÜÿ©
‚úÖ ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ ŸÅÿπÿßŸÑ
‚úÖ ÿ£ÿØÿßÿ° ŸÖÿ≠ÿ≥ŸÜ
‚úÖ ÿ≥ŸáŸàŸÑÿ© ŸÅŸä ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ
"""

import customtkinter as ctk
import tkinter as tk
from typing import List, Callable, Optional, Any
import threading
import time


class EnhancedSearchableComboBox(ctk.CTkFrame):
    """ŸÇÿßÿ¶ŸÖÿ© ŸÖŸÜÿ≥ÿØŸÑÿ© ŸÖÿØÿπŸàŸÖÿ© ÿ®ÿßŸÑÿ®ÿ≠ÿ´ - ŸÜÿ≥ÿÆÿ© ŸÖÿ®ÿ≥ÿ∑ÿ© ŸàŸÖÿ≠ÿ≥ŸÜÿ©"""

    def __init__(self,
                 parent,
                 values: List[str] = None,
                 placeholder: str = "ÿßŸÉÿ™ÿ® ŸÑŸÑÿ®ÿ≠ÿ´...",
                 width: int = 300,
                 height: int = 35,
                 max_results: int = 10,
                 enable_fuzzy: bool = True,
                 fuzzy_threshold: float = 0.6,
                 on_select: Callable[[str], None] = None,
                 **kwargs):

        super().__init__(parent, width=width, height=height, **kwargs)

        # ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        self.values = values or []
        self.placeholder = placeholder
        self.max_results = max_results
        self.enable_fuzzy = enable_fuzzy
        self.fuzzy_threshold = fuzzy_threshold
        self.on_select = on_select

        # ÿßŸÑÿ≠ÿßŸÑÿ©
        self.filtered_values = self.values.copy()
        self.selected_value = ""
        self.selected_index = -1
        self.is_dropdown_open = False

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        self.text_var = tk.StringVar()
        self.text_var.trace_add('write', self._on_text_change)

        # ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ©
        self._build_ui()
        self._setup_bindings()

        # ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©
        self.dropdown_window = None
        self.option_buttons = []

        # ÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ§ŸÇÿ™ ŸÑŸÑÿ®ÿ≠ÿ´
        self._search_cache = {}

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿ≥Ÿäÿ∑ÿ© ŸàŸÅÿπÿßŸÑÿ©"""
        # ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        self.main_frame = ctk.CTkFrame(self, fg_color="transparent")
        self.main_frame.pack(fill="both", expand=True, padx=2, pady=2)

        # ÿ≠ŸÇŸÑ ÿßŸÑŸÜÿµ
        self.entry = ctk.CTkEntry(
            self.main_frame,
            textvariable=self.text_var,
            placeholder_text=self.placeholder,
            height=self.cget("height") - 4
        )
        self.entry.pack(side="left", fill="both", expand=True, padx=(2, 1))

        # ÿ≤ÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        self.dropdown_btn = ctk.CTkButton(
            self.main_frame,
            text="‚ñº",
            width=30,
            height=self.cget("height") - 4,
            command=self._toggle_dropdown
        )
        self.dropdown_btn.pack(side="right", padx=(1, 2))

    def _setup_bindings(self):
        """ÿ•ÿπÿØÿßÿØ ÿ£ÿ≠ÿØÿßÿ´ ÿ®ÿ≥Ÿäÿ∑ÿ© ŸàŸÖÿ≥ÿ™ŸÇÿ±ÿ©"""
        # ÿ£ÿ≠ÿØÿßÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠
        self.entry.bind('<Down>', self._on_arrow_down)
        self.entry.bind('<Up>', self._on_arrow_up)
        self.entry.bind('<Return>', self._on_enter)
        self.entry.bind('<Escape>', self._on_escape)
        self.entry.bind('<Tab>', self._on_tab)

        # ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ - ŸÖÿ®ÿ≥ÿ∑ÿ©
        self.entry.bind('<FocusIn>', self._on_focus_in)

        # ŸÅÿ≠ÿµ ÿØŸàÿ±Ÿä ŸÑŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖŸÉŸàŸÜ
        self._check_outside_click()

    def _check_outside_click(self):
        """ŸÅÿ≠ÿµ ÿØŸàÿ±Ÿä ŸÑŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖŸÉŸàŸÜ"""
        def check():
            try:
                if self.is_dropdown_open:
                    focused = self.focus_get()
                    if not self._is_focus_inside(focused):
                        self._close_dropdown()
            except:
                pass

            # ÿ•ÿπÿßÿØÿ© ÿ¨ÿØŸàŸÑÿ© ÿßŸÑŸÅÿ≠ÿµ
            self.after(200, check)

        self.after(200, check)

    def _is_focus_inside(self, widget) -> bool:
        """ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿØÿßÿÆŸÑ ÿßŸÑŸÖŸÉŸàŸÜ"""
        if not widget:
            return False

        # ŸÅÿ≠ÿµ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        main_widgets = [self, self.entry, self.dropdown_btn, self.main_frame]
        if widget in main_widgets:
            return True

        # ŸÅÿ≠ÿµ ÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        if widget in self.option_buttons:
            return True

        return False

    def _on_text_change(self, *args):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ - ŸÖÿ®ÿ≥ÿ∑ ŸàŸÅÿπÿßŸÑ"""
        text = self.text_var.get()

        # ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÅŸàÿ±Ÿä
        self._perform_search(text)

    def _perform_search(self, query: str):
        """ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        if not query:
            self.filtered_values = self.values.copy()
        else:
            # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
            if query in self._search_cache:
                self.filtered_values = self._search_cache[query]
            else:
                self.filtered_values = self._search_values(query)
                # ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
                if len(self._search_cache) < 50:
                    self._search_cache[query] = self.filtered_values.copy()

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
        if self.is_dropdown_open:
            self._update_dropdown()
        elif self.filtered_values and query:
            self._open_dropdown()

    def _search_values(self, query: str) -> List[str]:
        """ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÇŸäŸÖ ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ±ŸÜ"""
        if not query:
            return self.values.copy()

        query_lower = query.lower()
        results = []

        # ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©
        for value in self.values:
            value_lower = value.lower()

            # ÿ™ÿ∑ÿßÿ®ŸÇ ÿ™ÿßŸÖ
            if query_lower == value_lower:
                results.append((value, 1.0))
            # Ÿäÿ®ÿØÿ£ ÿ®ÿßŸÑÿßÿ≥ÿ™ÿπŸÑÿßŸÖ
            elif value_lower.startswith(query_lower):
                results.append((value, 0.9))
            # Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿßŸÑÿßÿ≥ÿ™ÿπŸÑÿßŸÖ
            elif query_lower in value_lower:
                results.append((value, 0.7))
            # ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ
            elif self.enable_fuzzy:
                similarity = self._calculate_similarity(query_lower, value_lower)
                if similarity >= self.fuzzy_threshold:
                    results.append((value, similarity * 0.6))

        # ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
        results.sort(key=lambda x: -x[1])

        # ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ (ÿ®ÿØŸàŸÜ ÿßŸÑŸÜŸÇÿßÿ∑)
        return [value for value, score in results[:self.max_results]]

    def _calculate_similarity(self, text1: str, text2: str) -> float:
        """ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ¥ÿßÿ®Ÿá ÿ®ÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ© Ÿàÿ≥ÿ±Ÿäÿπÿ©"""
        if not text1 or not text2:
            return 0.0

        # ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ≠ÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©
        common_chars = sum(1 for c in text1 if c in text2)
        max_len = max(len(text1), len(text2))

        return common_chars / max_len if max_len > 0 else 0.0

    def _toggle_dropdown(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.is_dropdown_open:
            self._close_dropdown()
        else:
            self._open_dropdown()

    def _open_dropdown(self):
        """ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.is_dropdown_open:
            return

        try:
            self._create_dropdown()
            self.is_dropdown_open = True
            self.dropdown_btn.configure(text="‚ñ≤")

        except Exception as e:
            print(f"ÿÆÿ∑ÿ£ ŸÅŸä ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©: {e}")

    def _create_dropdown(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        # ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÇÿØŸäŸÖÿ©
        if self.dropdown_window:
            try:
                self.dropdown_window.destroy()
            except:
                pass

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàŸÇÿπ ŸàÿßŸÑÿ≠ÿ¨ŸÖ
        x = self.winfo_rootx()
        y = self.winfo_rooty() + self.winfo_height()
        width = self.winfo_width()
        height = min(200, len(self.filtered_values) * 35 + 10)

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        self.dropdown_window = ctk.CTkToplevel(self)
        self.dropdown_window.wm_overrideredirect(True)
        self.dropdown_window.geometry(f"{width}x{height}+{x}+{y}")

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        self.list_frame = ctk.CTkScrollableFrame(
            self.dropdown_window,
            width=width-10,
            height=height-10
        )
        self.list_frame.pack(fill="both", expand=True, padx=5, pady=5)

        self._populate_dropdown()

    def _populate_dropdown(self):
        """ŸÖŸÑÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        # ŸÖÿ≥ÿ≠ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
        for btn in self.option_buttons:
            try:
                btn.destroy()
            except:
                pass

        self.option_buttons.clear()

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        for i, value in enumerate(self.filtered_values):
            btn = ctk.CTkButton(
                self.list_frame,
                text=value,
                height=30,
                anchor="w",
                command=lambda v=value: self._select_value(v)
            )
            btn.pack(fill="x", pady=1)

            # ÿ±ÿ®ÿ∑ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÖÿßŸàÿ≥
            btn.bind('<Enter>', lambda e, idx=i: self._highlight_option(idx))

            self.option_buttons.append(btn)

    def _update_dropdown(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.dropdown_window and self.dropdown_window.winfo_exists():
            self._populate_dropdown()

    def _close_dropdown(self):
        """ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©"""
        if self.dropdown_window:
            try:
                self.dropdown_window.destroy()
            except:
                pass
            finally:
                self.dropdown_window = None

        self.is_dropdown_open = False
        self.selected_index = -1
        self.dropdown_btn.configure(text="‚ñº")

    def _select_value(self, value: str):
        """ÿßÿÆÿ™Ÿäÿßÿ± ŸÇŸäŸÖÿ©"""
        self.selected_value = value
        self.text_var.set(value)
        self._close_dropdown()

        # ÿßÿ≥ÿ™ÿØÿπÿßÿ° callback
        if self.on_select:
            try:
                self.on_select(value)
            except Exception as e:
                print(f"ÿÆÿ∑ÿ£ ŸÅŸä callback: {e}")

    def _highlight_option(self, index: int):
        """ÿ™ŸÖŸäŸäÿ≤ ÿÆŸäÿßÿ±"""
        self.selected_index = index

        # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ŸÖŸäŸäÿ≤ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        for btn in self.option_buttons:
            btn.configure(fg_color=["gray75", "gray25"])

        # ÿ™ŸÖŸäŸäÿ≤ ÿßŸÑÿ≤ÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
        if 0 <= index < len(self.option_buttons):
            self.option_buttons[index].configure(fg_color=["gray65", "gray35"])

    # ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
    def _on_arrow_down(self, event):
        """ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿ≥ŸÅŸÑ"""
        if not self.is_dropdown_open:
            self._open_dropdown()
            return "break"

        if self.option_buttons:
            if self.selected_index < len(self.option_buttons) - 1:
                self.selected_index += 1
            else:
                self.selected_index = 0

            self._highlight_option(self.selected_index)

        return "break"

    def _on_arrow_up(self, event):
        """ÿßŸÑÿ≥ŸáŸÖ ŸÑÿ£ÿπŸÑŸâ"""
        if not self.is_dropdown_open:
            return "break"

        if self.option_buttons:
            if self.selected_index > 0:
                self.selected_index -= 1
            else:
                self.selected_index = len(self.option_buttons) - 1

            self._highlight_option(self.selected_index)

        return "break"

    def _on_enter(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Enter"""
        if self.is_dropdown_open and 0 <= self.selected_index < len(self.filtered_values):
            self._select_value(self.filtered_values[self.selected_index])
        return "break"

    def _on_escape(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Escape"""
        if self.is_dropdown_open:
            self._close_dropdown()
        else:
            self.clear()
        return "break"

    def _on_tab(self, event):
        """ŸÖŸÅÿ™ÿßÿ≠ Tab"""
        if self.is_dropdown_open and 0 <= self.selected_index < len(self.filtered_values):
            self._select_value(self.filtered_values[self.selected_index])
            return "break"

    def _on_focus_in(self, event):
        """ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ"""
        text = self.text_var.get()
        if text:
            self._perform_search(text)

    # ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿπÿßŸÖÿ©
    def get(self) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©"""
        return self.selected_value

    def set(self, value: str):
        """ÿ™ÿπŸäŸäŸÜ ŸÇŸäŸÖÿ©"""
        if value in self.values:
            self.selected_value = value
            self.text_var.set(value)
        else:
            # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
            self.add_value(value)
            self.selected_value = value
            self.text_var.set(value)

    def clear(self):
        """ŸÖÿ≥ÿ≠ ÿßŸÑŸÇŸäŸÖÿ©"""
        self.selected_value = ""
        self.text_var.set("")
        self.filtered_values = self.values.copy()
        self._close_dropdown()

    def set_values(self, values: List[str]):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÇŸäŸÖ"""
        self.values = values.copy()
        self.filtered_values = values.copy()
        self._search_cache.clear()

    def add_value(self, value: str):
        """ÿ•ÿ∂ÿßŸÅÿ© ŸÇŸäŸÖÿ© ÿ¨ÿØŸäÿØÿ©"""
        if value and value not in self.values:
            self.values.append(value)
            self.filtered_values = self.values.copy()
            self._search_cache.clear()

    def remove_value(self, value: str):
        """ÿ≠ÿ∞ŸÅ ŸÇŸäŸÖÿ©"""
        if value in self.values:
            self.values.remove(value)
            self.filtered_values = self.values.copy()
            self._search_cache.clear()

            if self.selected_value == value:
                self.clear()

    def is_valid_selection(self) -> bool:
        """ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±"""
        return self.selected_value in self.values

    def focus_set(self):
        """ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÇŸÑ"""
        self.entry.focus_set()


# ŸÖÿ´ÿßŸÑ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
if __name__ == "__main__":
    import customtkinter as ctk

    class TestApp:
        def __init__(self):
            ctk.set_appearance_mode("dark")
            ctk.set_default_color_theme("blue")

            self.root = ctk.CTk()
            self.root.title("Enhanced SearchableComboBox - Test")
            self.root.geometry("700x500")

            # ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©
            self.cities = [
                "ÿßŸÑŸÇÿßŸáÿ±ÿ©", "ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©", "ÿßŸÑÿ¨Ÿäÿ≤ÿ©", "ÿ¥ÿ±ŸÖ ÿßŸÑÿ¥ŸäÿÆ", "ÿßŸÑÿ∫ÿ±ÿØŸÇÿ©",
                "ÿ£ÿ≥ŸàÿßŸÜ", "ÿßŸÑÿ£ŸÇÿµÿ±", "ŸÖÿ±ÿ≥Ÿâ ŸÖÿ∑ÿ±Ÿàÿ≠", "ÿ∑ÿßÿ®ÿß", "ÿØŸáÿ®", "ÿ≥ŸÅÿßÿ¨ÿß",
                "Cairo", "Alexandria", "Giza", "Sharm El Sheikh", "Hurghada",
                "Aswan", "Luxor", "Marsa Matrouh", "Taba", "Dahab", "Safaga",
                "New York", "Los Angeles", "Chicago", "Houston", "Philadelphia",
                "London", "Paris", "Berlin", "Rome", "Madrid", "Barcelona",
                "Tokyo", "Sydney", "Toronto", "Dubai", "Kuwait", "Riyadh"
            ]

            self.setup_ui()

        def setup_ui(self):
            """ÿ•ÿπÿØÿßÿØ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±"""
            # ÿßŸÑÿπŸÜŸàÿßŸÜ
            title = ctk.CTkLabel(
                self.root,
                text="üîΩ Enhanced SearchableComboBox",
                font=ctk.CTkFont(size=24, weight="bold")
            )
            title.pack(pady=20)

            # ŸàÿµŸÅ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
            improvements = """
‚úÖ ŸÉŸàÿØ ŸÖÿ®ÿ≥ÿ∑ ŸàŸÖÿ≥ÿ™ŸÇÿ±
‚úÖ ÿ£ÿØÿßÿ° ŸÖÿ≠ÿ≥ŸÜ Ÿàÿ≥ÿ±Ÿäÿπ
‚úÖ ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ ŸÅÿπÿßŸÑ
‚úÖ Ÿàÿßÿ¨Ÿáÿ© ÿ≥ŸáŸÑÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ
‚úÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿ≠ÿØÿßÿ´ ŸÖÿ≠ÿ≥ŸÜÿ©
            """

            desc_label = ctk.CTkLabel(
                self.root,
                text=improvements,
                font=ctk.CTkFont(size=12),
                justify="left"
            )
            desc_label.pack(pady=10)

            # ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ŸàŸÑ - ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿØŸÜ
            label1 = ctk.CTkLabel(
                self.root,
                text="üåç ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿØŸäŸÜÿ©:",
                font=ctk.CTkFont(size=14, weight="bold")
            )
            label1.pack(pady=(20, 5))

            self.combo1 = EnhancedSearchableComboBox(
                self.root,
                values=self.cities,
                placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿØŸäŸÜÿ©...",
                width=500,
                enable_fuzzy=True,
                on_select=self.on_city_select
            )
            self.combo1.pack(pady=5)

            # ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ´ÿßŸÜŸä - ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿØŸàŸÜ ÿ®ÿ≠ÿ´ ŸÖÿ±ŸÜ
            label2 = ctk.CTkLabel(
                self.root,
                text="üìã ÿ®ÿ≠ÿ´ ÿØŸÇŸäŸÇ (ÿ®ÿØŸàŸÜ ŸÖÿ±ŸàŸÜÿ©):",
                font=ctk.CTkFont(size=14, weight="bold")
            )
            label2.pack(pady=(20, 5))

            self.combo2 = EnhancedSearchableComboBox(
                self.root,
                values=self.cities[:10],  # ŸÇÿßÿ¶ŸÖÿ© ÿ£ÿµÿ∫ÿ±
                placeholder="ÿ®ÿ≠ÿ´ ÿØŸÇŸäŸÇ ŸÅŸÇÿ∑...",
                width=500,
                enable_fuzzy=False,
                on_select=self.on_exact_select
            )
            self.combo2.pack(pady=5)

            # ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
            self.result_label = ctk.CTkLabel(
                self.root,
                text="üéØ ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿ®ÿπÿØ",
                font=ctk.CTkFont(size=16)
            )
            self.result_label.pack(pady=20)

            # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
            controls_frame = ctk.CTkFrame(self.root)
            controls_frame.pack(pady=20)

            buttons = [
                ("üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸÑ", self.clear_all),
                ("üìä ÿπÿ±ÿ∂ ÿßŸÑŸÇŸäŸÖ", self.show_values),
                ("‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿØŸäŸÜÿ©", self.add_city),
                ("üîÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ", self.refresh_lists),
                ("üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´", self.test_search)
            ]

            for i, (text, command) in enumerate(buttons):
                btn = ctk.CTkButton(
                    controls_frame,
                    text=text,
                    command=command,
                    width=140,
                    height=35
                )
                btn.grid(row=i//3, column=i%3, padx=5, pady=5)

        def on_city_select(self, value):
            """ŸÖÿπÿßŸÑÿ¨ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿØŸäŸÜÿ©"""
            self.result_label.configure(
                text=f"üåç ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ©: {value}",
                text_color="green"
            )

        def on_exact_select(self, value):
            """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿØŸÇŸäŸÇ"""
            self.result_label.configure(
                text=f"üìã ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿØŸÇŸäŸÇ: {value}",
                text_color="blue"
            )

        def clear_all(self):
            """ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™"""
            self.combo1.clear()
            self.combo2.clear()
            self.result_label.configure(
                text="üóëÔ∏è ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™",
                text_color="orange"
            )

        def show_values(self):
            """ÿπÿ±ÿ∂ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÖÿ≠ÿØÿØÿ©"""
            value1 = self.combo1.get() or "ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ"
            value2 = self.combo2.get() or "ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ"

            self.result_label.configure(
                text=f"üìä ÿßŸÑŸÇŸäŸÖ: ŸÖÿØŸÜ({value1}) | ÿØŸÇŸäŸÇ({value2})",
                text_color="purple"
            )

        def add_city(self):
            """ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿØŸäŸÜÿ© ÿ¨ÿØŸäÿØÿ©"""
            import random
            new_cities = ["ÿ£ÿ®Ÿà ÿ∏ÿ®Ÿä", "ÿßŸÑÿØŸàÿ≠ÿ©", "ÿ®Ÿäÿ±Ÿàÿ™", "ÿπŸÖÿßŸÜ", "ÿßŸÑŸÉŸàŸäÿ™", "ÿßŸÑŸÖŸÜÿßŸÖÿ©"]
            new_city = random.choice(new_cities)

            self.combo1.add_value(new_city)
            self.combo2.add_value(new_city)

            self.result_label.configure(
                text=f"‚ûï ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ©: {new_city}",
                text_color="green"
            )

        def refresh_lists(self):
            """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ"""
            # ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿπÿ∂ ÿßŸÑŸÖÿØŸÜ ÿßŸÑÿ¨ÿØŸäÿØÿ©
            additional_cities = ["ÿ£ÿ∫ÿßÿØŸäÿ±", "ŸÅÿßÿ≥", "ÿßŸÑÿ±ÿ®ÿßÿ∑", "ÿßŸÑÿØÿßÿ± ÿßŸÑÿ®Ÿäÿ∂ÿßÿ°"]

            current_cities = self.combo1.values + additional_cities
            self.combo1.set_values(list(set(current_cities)))
            self.combo2.set_values(current_cities[:15])

            self.result_label.configure(
                text="üîÑ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ",
                text_color="blue"
            )

        def test_search(self):
            """ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´"""
            import random
            test_terms = ["Cair", "Alex", "ŸÇÿßŸáÿ±", "ÿßÿ≥ŸÉŸÜÿØ", "Lond", "ÿ®ÿßÿ±Ÿä"]
            test_term = random.choice(test_terms)

            self.combo1.clear()
            self.combo1.text_var.set(test_term)

            self.result_label.configure(
                text=f"üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ: '{test_term}'",
                text_color="purple"
            )

        def run(self):
            """ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ"""
            self.root.mainloop()

    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±
    app = TestApp()
    app.run()


============================================================
FILE: views\components\sidebar.py
SIZE: 19652 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/sidebar.py

ŸÖŸÉŸàŸÜ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
"""

import customtkinter as ctk
from typing import Callable, Dict, Any, Optional

from core.language_manager import LanguageManager


class SidebarComponent(ctk.CTkFrame):
    """ŸÖŸÉŸàŸÜ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""

    def __init__(
        self,
        parent,
        lang_manager: LanguageManager,
        theme_manager: Optional[Any] = None,
        on_navigate: Callable = None,
        **kwargs
    ):
        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑÿ•ÿ∑ÿßÿ±
        kwargs.setdefault('width', 280)
        kwargs.setdefault('corner_radius', 0)
        kwargs.setdefault('fg_color', ("#f8f9fa", "#1e1e1e"))

        super().__init__(parent, **kwargs)
        self.pack_propagate(False)

        self.lang_manager = lang_manager
        self.theme_manager = theme_manager
        self.on_navigate = on_navigate
        self.is_collapsed = False
        self.nav_buttons = []
        self.active_button = None

        self._build_ui()

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿ±ÿ£ÿ≥ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä
        self._create_header()

        # ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ŸÜŸÇŸÑ
        self._create_navigation_section()

        # ŸÇÿ≥ŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        self._create_stats_section()

        # ŸÇÿ≥ŸÖ ÿßŸÑÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©
        self._create_quick_actions()

        # ÿ™ÿ∞ŸäŸäŸÑ ŸÖÿπ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©
        self._create_footer()

    def _create_header(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ£ÿ≥ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä"""
        header_frame = ctk.CTkFrame(
            self,
            height=60,
            fg_color=("#e9ecef", "#252525"),
            corner_radius=0
        )
        header_frame.pack(fill="x")
        header_frame.pack_propagate(False)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        content_frame = ctk.CTkFrame(header_frame, fg_color="transparent")
        content_frame.pack(expand=True)

        # ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÖÿπ ÿ£ŸäŸÇŸàŸÜÿ©
        title_frame = ctk.CTkFrame(content_frame, fg_color="transparent")
        title_frame.pack()

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        menu_icon = ctk.CTkLabel(
            title_frame,
            text="üìä",
            font=ctk.CTkFont(size=20)
        )
        menu_icon.pack(side="left", padx=(0, 8))

        # ÿßŸÑÿπŸÜŸàÿßŸÜ
        title_label = ctk.CTkLabel(
            title_frame,
            text=self.lang_manager.get("dashboard", "Dashboard"),
            font=ctk.CTkFont(size=18, weight="bold"),
            text_color=("#1976d2", "#2196f3")
        )
        title_label.pack(side="left")

        # ÿ≤ÿ± ÿßŸÑÿ™ÿ®ÿØŸäŸÑ
        self.toggle_btn = ctk.CTkButton(
            header_frame,
            text="‚óÄ",
            width=30,
            height=30,
            corner_radius=15,
            command=self._toggle_sidebar,
            fg_color="transparent",
            hover_color=("#dee2e6", "#343a40"),
            text_color=("#666666", "#999999"),
            font=ctk.CTkFont(size=14)
        )
        self.toggle_btn.pack(side="right", padx=10)

    def _create_navigation_section(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿ≥ŸÖ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿ≥ŸÖ
        nav_section = ctk.CTkFrame(self, fg_color="transparent")
        nav_section.pack(fill="x", padx=15, pady=(15, 0))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿ≥ŸÖ
        self.nav_title = ctk.CTkLabel(
            nav_section,
            text=self.lang_manager.get("quick_navigation", "Quick Navigation"),
            font=ctk.CTkFont(size=12, weight="bold"),
            text_color=("#666666", "#999999")
        )
        self.nav_title.pack(anchor="w", pady=(0, 10))

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        self.nav_frame = ctk.CTkFrame(nav_section, fg_color="transparent")
        self.nav_frame.pack(fill="x")

        # ÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ
        nav_items = [
            ("üè†", "home", "Home", "primary"),
            ("üìÖ", "today", "Today's Bookings", "info"),
            ("‚è≥", "pending", "Pending Bookings", "warning"),
            ("‚úÖ", "confirmed", "Confirmed Bookings", "success"),
            ("üìä", "reports", "Reports", "secondary"),
        ]

        for icon, key, default_text, style in nav_items:
            text = self.lang_manager.get(f"nav_{key}", default_text)
            btn = self._create_nav_button(self.nav_frame, icon, key, text, style)
            self.nav_buttons.append((btn, icon, key, default_text, style))

    def _create_nav_button(self, parent, icon, key, text, style="default"):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ÿ™ŸÜŸÇŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≤ÿ±
        button_frame = ctk.CTkFrame(
            parent,
            height=45,
            fg_color="transparent",
            corner_radius=10
        )
        button_frame.pack(fill="x", pady=3)

        # ÿßŸÑÿ≤ÿ±
        btn = ctk.CTkButton(
            button_frame,
            text=f"{icon}  {text}",
            anchor="w",
            height=40,
            fg_color="transparent",
            hover_color=("#e9ecef", "#2d3436"),
            text_color=("#495057", "#e9ecef"),
            font=ctk.CTkFont(size=14),
            command=lambda: self._on_navigate(key, button_frame),
            corner_radius=8
        )
        btn.pack(fill="both", expand=True, padx=2, pady=2)

        # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
        button_frame.is_active = False
        button_frame.key = key
        button_frame.button = btn
        button_frame.style = style

        # ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ŸÜŸÖÿßÿ∑
        style_colors = {
            "primary": ("#1976d2", "#2196f3"),
            "info": ("#0288d1", "#03a9f4"),
            "warning": ("#f57c00", "#ff9800"),
            "success": ("#388e3c", "#4caf50"),
            "secondary": ("#616161", "#757575")
        }
        button_frame.accent_color = style_colors.get(style, style_colors["primary"])

        # ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ hover
        def on_enter(e):
            if not button_frame.is_active:
                color = button_frame.accent_color[1 if ctk.get_appearance_mode() == "Dark" else 0]
                btn.configure(text_color=color)

        def on_leave(e):
            if not button_frame.is_active:
                btn.configure(text_color=("#495057", "#e9ecef"))

        btn.bind("<Enter>", on_enter)
        btn.bind("<Leave>", on_leave)

        return button_frame

    def _on_navigate(self, key, button_frame):
        """ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ™ŸÜŸÇŸÑ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©"""
        # ÿ•ŸÑÿ∫ÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ± ÿßŸÑÿ≥ÿßÿ®ŸÇ
        if self.active_button:
            self.active_button.is_active = False
            self.active_button.button.configure(
                fg_color="transparent",
                text_color=("#495057", "#e9ecef")
            )

        # ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ± ÿßŸÑÿ≠ÿßŸÑŸä
        button_frame.is_active = True
        self.active_button = button_frame

        # ÿ™ÿ∑ÿ®ŸäŸÇ ŸÑŸàŸÜ ÿßŸÑÿ™ŸÅÿπŸäŸÑ
        accent = button_frame.accent_color[1 if ctk.get_appearance_mode() == "Dark" else 0]
        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÑŸàŸÜ ÿ£ŸÅÿ™ÿ≠ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ©
        light_accent = self._get_lighter_color(accent, 0.1)
        button_frame.button.configure(
            fg_color=light_accent,
            text_color=accent
        )

        # ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿØÿßŸÑÿ© ÿßŸÑÿ™ŸÜŸÇŸÑ
        if self.on_navigate:
            self.on_navigate(key)

    def _create_stats_section(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿ≥ŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿ≥ŸÖ
        stats_section = ctk.CTkFrame(self, fg_color="transparent")
        stats_section.pack(fill="x", padx=15, pady=(25, 0))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿ≥ŸÖ
        self.stats_title = ctk.CTkLabel(
            stats_section,
            text=self.lang_manager.get("quick_stats", "Quick Stats"),
            font=ctk.CTkFont(size=12, weight="bold"),
            text_color=("#666666", "#999999")
        )
        self.stats_title.pack(anchor="w", pady=(0, 10))

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™
        self.stats_frame = ctk.CTkFrame(stats_section, fg_color="transparent")
        self.stats_frame.pack(fill="x")

        # ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        self.stats_cards = {}
        self.stats_info = []

        stats_items = [
            ("total", "üìä", "Total Bookings", "#1976d2"),
            ("today", "üìÖ", "Today's Bookings", "#388e3c"),
            ("pending", "‚è≥", "Pending", "#f57c00")
        ]

        for key, icon, default_label, color in stats_items:
            label = self.lang_manager.get(f"stats_{key}", default_label)
            card_frame, value_label = self._create_enhanced_stat_card(
                self.stats_frame, icon, label, color
            )
            self.stats_cards[key] = value_label
            self.stats_info.append((key, icon, default_label, card_frame, color))

    def _create_enhanced_stat_card(self, parent, icon, label, color):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ®ÿ∑ÿßŸÇÿ© ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿ© ŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©
        card = ctk.CTkFrame(
            parent,
            height=80,
            corner_radius=12,
            fg_color=("#ffffff", "#2b2b2b"),
            border_width=1,
            border_color=("#e0e0e0", "#444444")
        )
        card.pack(fill="x", pady=5)

        # ÿ™ÿ£ÿ´Ÿäÿ± hover
        def on_enter(e):
            card.configure(border_color=color)

        def on_leave(e):
            card.configure(border_color=("#e0e0e0", "#444444"))

        card.bind("<Enter>", on_enter)
        card.bind("<Leave>", on_leave)

        # ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©
        content_frame = ctk.CTkFrame(card, fg_color="transparent")
        content_frame.pack(expand=True, padx=15)

        # ÿßŸÑÿµŸÅ ÿßŸÑÿπŸÑŸàŸä
        top_row = ctk.CTkFrame(content_frame, fg_color="transparent")
        top_row.pack(fill="x")

        # ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© ŸÖÿπ ÿÆŸÑŸÅŸäÿ© ŸÖŸÑŸàŸÜÿ©
        # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ£ŸÑŸàÿßŸÜ ÿ£ŸÅÿ™ÿ≠ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ©
        light_color = self._get_lighter_color(color, 0.2)
        dark_color = self._get_lighter_color(color, 0.3)

        icon_bg = ctk.CTkFrame(
            top_row,
            width=40,
            height=40,
            corner_radius=20,
            fg_color=(light_color, dark_color)
        )
        icon_bg.pack(side="left")
        icon_bg.pack_propagate(False)

        icon_label = ctk.CTkLabel(
            icon_bg,
            text=icon,
            font=ctk.CTkFont(size=20),
            text_color=color
        )
        icon_label.place(relx=0.5, rely=0.5, anchor="center")

        # ÿßŸÑŸÇŸäŸÖÿ©
        value_label = ctk.CTkLabel(
            top_row,
            text="0",
            font=ctk.CTkFont(size=24, weight="bold"),
            text_color=color
        )
        value_label.pack(side="right")

        # ÿßŸÑÿ™ÿ≥ŸÖŸäÿ©
        label_widget = ctk.CTkLabel(
            content_frame,
            text=label,
            font=ctk.CTkFont(size=12),
            text_color=("#666666", "#999999")
        )
        label_widget.pack(anchor="w", pady=(5, 0))

        # ÿ≠ŸÅÿ∏ ŸÖÿ±ÿ¨ÿπ ÿßŸÑÿ™ÿ≥ŸÖŸäÿ©
        card.label_widget = label_widget
        card.color = color

        return card, value_label

    def _create_quick_actions(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿ≥ŸÖ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©"""
        # ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÇÿ≥ŸÖ
        actions_section = ctk.CTkFrame(self, fg_color="transparent")
        actions_section.pack(fill="x", padx=15, pady=(25, 0))

        # ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿ≥ŸÖ
        actions_title = ctk.CTkLabel(
            actions_section,
            text=self.lang_manager.get("quick_actions", "Quick Actions"),
            font=ctk.CTkFont(size=12, weight="bold"),
            text_color=("#666666", "#999999")
        )
        actions_title.pack(anchor="w", pady=(0, 10))

        # ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        actions_frame = ctk.CTkFrame(actions_section, fg_color="transparent")
        actions_frame.pack(fill="x")

        # ÿ≤ÿ± ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ±Ÿäÿπ
        add_btn = ctk.CTkButton(
            actions_frame,
            text=f"‚ûï {self.lang_manager.get('quick_add', 'Quick Add')}",
            height=35,
            corner_radius=8,
            fg_color=("#4caf50", "#2e7d32"),
            hover_color=("#45a049", "#1b5e20"),
            font=ctk.CTkFont(size=13, weight="bold"),
            command=lambda: self.on_navigate and self.on_navigate("add")
        )
        add_btn.pack(fill="x", pady=3)

        # ÿ≤ÿ± ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ≥ÿ±Ÿäÿπ
        search_btn = ctk.CTkButton(
            actions_frame,
            text=f"üîç {self.lang_manager.get('quick_search', 'Quick Search')}",
            height=35,
            corner_radius=8,
            fg_color=("#2196f3", "#1976d2"),
            hover_color=("#1976d2", "#1565c0"),
            font=ctk.CTkFont(size=13, weight="bold"),
            command=lambda: self.on_navigate and self.on_navigate("search")
        )
        search_btn.pack(fill="x", pady=3)

    def _create_footer(self):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ∞ŸäŸäŸÑ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä"""
        # ŸÖÿ≥ÿßÿ≠ÿ© ŸÖÿ±ŸÜÿ©
        spacer = ctk.CTkFrame(self, fg_color="transparent")
        spacer.pack(fill="both", expand=True)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ™ÿ∞ŸäŸäŸÑ
        footer_frame = ctk.CTkFrame(
            self,
            height=60,
            fg_color=("#e9ecef", "#252525"),
            corner_radius=0
        )
        footer_frame.pack(fill="x", side="bottom")

        # ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿ∞ŸäŸäŸÑ
        footer_content = ctk.CTkFrame(footer_frame, fg_color="transparent")
        footer_content.pack(expand=True)

        # ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ
        system_info = ctk.CTkLabel(
            footer_content,
            text="FTS System v2.0",
            font=ctk.CTkFont(size=11),
            text_color=("#666666", "#999999")
        )
        system_info.pack()

        # ÿ≠ŸÇŸàŸÇ ÿßŸÑŸÜÿ¥ÿ±
        copyright_label = ctk.CTkLabel(
            footer_content,
            text="¬© 2024 FTS",
            font=ctk.CTkFont(size=10),
            text_color=("#999999", "#666666")
        )
        copyright_label.pack()

    def _toggle_sidebar(self):
        """ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ≥ŸÑÿ≥ÿ©"""
        if self.is_collapsed:
            # ÿ™Ÿàÿ≥Ÿäÿπ ÿßŸÑÿ¥ÿ±Ÿäÿ∑
            self._expand_sidebar()
        else:
            # ÿ∑Ÿä ÿßŸÑÿ¥ÿ±Ÿäÿ∑
            self._collapse_sidebar()

        self.is_collapsed = not self.is_collapsed

    def _collapse_sidebar(self):
        """ÿ∑Ÿä ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä"""
        # ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿπÿ±ÿ∂ ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã
        target_width = 60
        current_width = self.winfo_width()

        while current_width > target_width:
            current_width = max(current_width - 20, target_width)
            self.configure(width=current_width)
            self.update()
            self.after(10)

        # ÿ™ÿ∫ŸäŸäÿ± ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ™ÿ®ÿØŸäŸÑ
        self.toggle_btn.configure(text="‚ñ∂")

        # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿµŸàÿµ
        for widget in [self.nav_title, self.stats_title]:
            widget.pack_forget()

        # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™
        for _, _, _, card, _ in self.stats_info:
            card.pack_forget()

    def _expand_sidebar(self):
        """ÿ™Ÿàÿ≥Ÿäÿπ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä"""
        # ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿπÿ±ÿ∂ ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã
        target_width = 280
        current_width = self.winfo_width()

        while current_width < target_width:
            current_width = min(current_width + 20, target_width)
            self.configure(width=current_width)
            self.update()
            self.after(10)

        # ÿ™ÿ∫ŸäŸäÿ± ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ™ÿ®ÿØŸäŸÑ
        self.toggle_btn.configure(text="‚óÄ")

        # ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿµŸàÿµ
        self.nav_title.pack(anchor="w", pady=(0, 10))
        self.stats_title.pack(anchor="w", pady=(0, 10))

        # ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™
        for _, _, _, card, _ in self.stats_info:
            card.pack(fill="x", pady=5)

    def update_stats(self, stats: Dict[str, int]):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™"""
        for key, value in stats.items():
            if key in self.stats_cards:
                label = self.stats_cards[key]
                # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸäŸÖÿ© ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±
                self._animate_value_change(label, int(label.cget("text")), value)

    def _animate_value_change(self, label, start, end):
        """ÿ™ÿ≠ÿ±ŸäŸÉ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÇŸäŸÖÿ©"""
        if start == end:
            return

        # ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿÆÿ∑Ÿàÿ©
        diff = end - start
        steps = 20
        step = diff / steps

        def update_value(current, target, step_count):
            if step_count <= 0:
                label.configure(text=str(int(target)))
                return

            new_value = current + step
            label.configure(text=str(int(new_value)))

            self.after(50, lambda: update_value(new_value, target, step_count - 1))

        update_value(start, end, steps)

    def update_texts(self, lang_manager):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµŸàÿµ ÿßŸÑŸÖŸÉŸàŸÜ"""
        self.lang_manager = lang_manager

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπŸÜÿßŸàŸäŸÜ
        if hasattr(self, 'nav_title'):
            self.nav_title.configure(
                text=lang_manager.get("quick_navigation", "Quick Navigation")
            )

        if hasattr(self, 'stats_title'):
            self.stats_title.configure(
                text=lang_manager.get("quick_stats", "Quick Stats")
            )

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÜŸÇŸÑ
        for btn_frame, icon, key, default_text, style in self.nav_buttons:
            translated_text = lang_manager.get(f"nav_{key}", default_text)
            btn_frame.button.configure(text=f"{icon}  {translated_text}")

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        for key, icon, default_label, card_frame, color in self.stats_info:
            translated_label = lang_manager.get(f"stats_{key}", default_label)
            if hasattr(card_frame, 'label_widget'):
                card_frame.label_widget.configure(text=translated_label)

    def set_active_nav(self, key: str):
        """ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÜÿ¥ÿ∑ ŸÅŸä ÿßŸÑÿ™ŸÜŸÇŸÑ"""
        for btn_frame, _, btn_key, _, _ in self.nav_buttons:
            if btn_key == key:
                self._on_navigate(key, btn_frame)
                break

    def add_navigation_button(self, text, icon=None, command=None, style="default"):
        """ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ÿ™ŸÜŸÇŸÑ ŸÖÿÆÿµÿµ"""
        if not hasattr(self, 'nav_frame'):
            return None

        display_text = f"{icon}  {text}" if icon else text

        # ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≤ÿ±
        btn_frame = self._create_nav_button(
            self.nav_frame,
            icon or "‚Ä¢",
            text.lower().replace(" ", "_"),
            display_text,
            style
        )

        # ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ£ŸÖÿ± ÿßŸÑŸÖÿÆÿµÿµ
        if command:
            btn_frame.button.configure(command=command)

        # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©
        self.nav_buttons.append((btn_frame, icon or "", text, text, style))

        return btn_frame

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ±Ÿá"""
        # ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        for widget in self.winfo_children():
            widget.destroy()
        self._build_ui()

    def _get_lighter_color(self, hex_color: str, factor: float = 0.2) -> str:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÑŸàŸÜ ÿ£ŸÅÿ™ÿ≠ ŸÖŸÜ ÿßŸÑŸÑŸàŸÜ ÿßŸÑŸÖÿπÿ∑Ÿâ"""
        # ÿ•ÿ≤ÿßŸÑÿ© # ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
        hex_color = hex_color.lstrip('#')

        # ÿ™ÿ≠ŸàŸäŸÑ hex ÿ•ŸÑŸâ RGB
        r = int(hex_color[0:2], 16)
        g = int(hex_color[2:4], 16)
        b = int(hex_color[4:6], 16)

        # ÿ¨ÿπŸÑ ÿßŸÑŸÑŸàŸÜ ÿ£ŸÅÿ™ÿ≠
        r = int(r + (255 - r) * factor)
        g = int(g + (255 - g) * factor)
        b = int(b + (255 - b) * factor)

        # ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ ÿ™ÿ¨ÿßŸàÿ≤ 255
        r = min(255, r)
        g = min(255, g)
        b = min(255, b)

        # ÿ™ÿ≠ŸàŸäŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ÿ•ŸÑŸâ hex
        return f"#{r:02x}{g:02x}{b:02x}"


# ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿ£ŸÉŸàÿßÿØ ÿßŸÑŸÇÿØŸäŸÖÿ©
Sidebar = SidebarComponent

============================================================
FILE: views\components\status_bar.py
SIZE: 20837 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/status_bar.py

ŸÖŸÉŸàŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°
"""

import customtkinter as ctk
from datetime import datetime
from typing import Optional, Tuple
import threading

from core.language_manager import LanguageManager


class StatusBarComponent(ctk.CTkFrame):
    """ŸÖŸÉŸàŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""

    def __init__(
        self,
        parent,
        lang_manager: LanguageManager,
        **kwargs
    ):
        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑÿ•ÿ∑ÿßÿ±
        kwargs.setdefault('height', 35)
        kwargs.setdefault('corner_radius', 0)
        kwargs.setdefault('fg_color', ("#f8f9fa", "#1e1e1e"))
        kwargs.setdefault('border_width', 1)
        kwargs.setdefault('border_color', ("#e0e0e0", "#444444"))

        super().__init__(parent, **kwargs)
        self.pack_propagate(False)

        self.lang_manager = lang_manager

        # ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑÿ©
        self.current_status = ""
        self.status_type = "info"
        self.progress_active = False

        # ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ™ÿ™ÿ®ÿπ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿØŸÖŸäÿ±
        self._destroyed = False
        self._time_update_running = False

        self._build_ui()
        self._start_time_update()

        # ÿ±ÿ®ÿ∑ ÿ≠ÿØÿ´ ÿßŸÑÿ™ÿØŸÖŸäÿ±
        self.bind("<Destroy>", self._on_destroy)

    def _on_destroy(self, event=None):
        """ŸÖÿπÿßŸÑÿ¨ ÿ™ÿØŸÖŸäÿ± ÿßŸÑŸÖŸÉŸàŸÜ"""
        if event and event.widget == self:
            self._destroyed = True
            self._time_update_running = False

    def _is_valid(self):
        """ŸÅÿ≠ÿµ ÿµÿ≠ÿ© ÿßŸÑŸÖŸÉŸàŸÜ ŸÇÿ®ŸÑ ÿ£Ÿä ÿπŸÖŸÑŸäÿ©"""
        try:
            return not self._destroyed and self.winfo_exists()
        except:
            self._destroyed = True
            return False

    def _safe_configure(self, widget, **kwargs):
        """ÿ™ŸÉŸàŸäŸÜ ÿ¢ŸÖŸÜ ŸÑŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸÖÿπ ŸÅÿ≠ÿµ ÿßŸÑÿµÿ≠ÿ©"""
        try:
            if self._is_valid() and widget and hasattr(widget, 'configure'):
                if hasattr(widget, 'winfo_exists'):
                    if widget.winfo_exists():
                        widget.configure(**kwargs)
                        return True
                else:
                    widget.configure(**kwargs)
                    return True
        except Exception as e:
            # ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ∑ÿ£ ÿ®ŸáÿØŸàÿ° ÿØŸàŸÜ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨
            pass
        return False

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        main_container = ctk.CTkFrame(self, fg_color="transparent")
        main_container.pack(fill="both", expand=True, padx=10)

        # ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ£Ÿäÿ≥ÿ± - ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ©
        left_section = ctk.CTkFrame(main_container, fg_color="transparent")
        left_section.pack(side="left", fill="x", expand=True)

        # ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ≠ÿßŸÑÿ©
        self.status_icon = ctk.CTkLabel(
            left_section,
            text="‚ÑπÔ∏è",
            font=ctk.CTkFont(size=14),
            width=20
        )
        self.status_icon.pack(side="left", padx=(0, 5))

        # ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ©
        self.status_label = ctk.CTkLabel(
            left_section,
            text=self.lang_manager.get("ready", "Ready"),
            anchor="w",
            font=ctk.CTkFont(size=12)
        )
        self.status_label.pack(side="left", fill="x", expand=True)

        # ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ (ŸÖÿÆŸÅŸä ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã)
        self.progress_bar = ctk.CTkProgressBar(
            left_section,
            width=150,
            height=8,
            corner_radius=4,
            progress_color=("#2196f3", "#1976d2")
        )

        # ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ£Ÿàÿ≥ÿ∑ - ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©
        middle_section = ctk.CTkFrame(main_container, fg_color="transparent")
        middle_section.pack(side="left", padx=20)

        # ÿπÿØÿßÿØ ÿßŸÑÿπŸÜÿßÿµÿ±
        self.items_frame = ctk.CTkFrame(middle_section, fg_color="transparent")
        self.items_frame.pack(side="left", padx=10)

        self.items_icon = ctk.CTkLabel(
            self.items_frame,
            text="üìÑ",
            font=ctk.CTkFont(size=12)
        )

        self.items_label = ctk.CTkLabel(
            self.items_frame,
            text="",
            font=ctk.CTkFont(size=11),
            text_color=("#666666", "#999999")
        )

        # ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ£ŸäŸÖŸÜ - ÿßŸÑŸÖÿ§ÿ¥ÿ±ÿßÿ™
        right_section = ctk.CTkFrame(main_container, fg_color="transparent")
        right_section.pack(side="right")

        # ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ
        self.connection_frame = ctk.CTkFrame(right_section, fg_color="transparent")
        self.connection_frame.pack(side="left", padx=10)

        self.connection_indicator = ctk.CTkLabel(
            self.connection_frame,
            text="‚óè",
            font=ctk.CTkFont(size=10),
            text_color=("#4caf50", "#2e7d32")
        )
        self.connection_indicator.pack(side="left", padx=(0, 3))

        self.connection_label = ctk.CTkLabel(
            self.connection_frame,
            text=self.lang_manager.get("connected", "Connected"),
            font=ctk.CTkFont(size=11),
            text_color=("#4caf50", "#2e7d32")
        )
        self.connection_label.pack(side="left")

        # ÿÆÿ∑ ŸÅÿßÿµŸÑ
        separator = ctk.CTkFrame(
            right_section,
            width=1,
            fg_color=("#e0e0e0", "#444444")
        )
        separator.pack(side="left", fill="y", padx=10)

        # ÿßŸÑŸàŸÇÿ™ ŸàÿßŸÑÿ™ÿßÿ±ŸäÿÆ
        self.datetime_frame = ctk.CTkFrame(right_section, fg_color="transparent")
        self.datetime_frame.pack(side="left", padx=10)

        self.time_label = ctk.CTkLabel(
            self.datetime_frame,
            text="",
            font=ctk.CTkFont(size=12, weight="bold"),
            text_color=("#1976d2", "#2196f3")
        )
        self.time_label.pack()

        self.date_label = ctk.CTkLabel(
            self.datetime_frame,
            text="",
            font=ctk.CTkFont(size=10),
            text_color=("#666666", "#999999")
        )
        self.date_label.pack()

    def set_status(self, message: str, status_type: str = "info", duration: int = None):
        """ÿ™ÿπŸäŸäŸÜ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ŸÖÿπ ŸÜŸàÿπ Ÿàÿ£ŸäŸÇŸàŸÜÿ© - ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            self.current_status = message
            self.status_type = status_type

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©
            if not self._safe_configure(self.status_label, text=message):
                return

            # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ© ŸàÿßŸÑŸÑŸàŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ
            status_config = self._get_status_config(status_type)

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©
            self._safe_configure(
                self.status_icon,
                text=status_config["icon"],
                text_color=status_config["color"]
            )

            # ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàŸÜ ÿßŸÑŸÜÿµ
            self._safe_configure(self.status_label, text_color=status_config["color"])

            # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
            self._animate_status_change()

            # ÿ•ÿÆŸÅÿßÿ° ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ®ÿπÿØ ŸÖÿØÿ© ŸÖÿπŸäŸÜÿ©
            if duration and self._is_valid():
                self.after(duration * 1000, lambda: self._delayed_status_reset())

        except Exception as e:
            # ŸÅŸä ÿ≠ÿßŸÑÿ© ÿ≠ÿØŸàÿ´ ÿÆÿ∑ÿ£ÿå ŸÜÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆŸäÿ±ÿ© ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©
            pass

    def _delayed_status_reset(self):
        """ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ÿßŸÑÿ© ÿ®ÿπÿØ ÿ™ÿ£ÿÆŸäÿ± ŸÖÿπ ŸÅÿ≠ÿµ ÿßŸÑÿµÿ≠ÿ©"""
        if self._is_valid():
            self.set_status(self.lang_manager.get("ready", "Ready"), "info")

    def _get_status_config(self, status_type: str) -> dict:
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿ≠ÿßŸÑÿ©"""
        is_dark = ctk.get_appearance_mode() == "Dark"

        status_configs = {
            "info": {
                "icon": "‚ÑπÔ∏è",
                "color": ("#2196f3", "#1976d2")
            },
            "success": {
                "icon": "‚úÖ",
                "color": ("#4caf50", "#2e7d32")
            },
            "warning": {
                "icon": "‚ö†Ô∏è",
                "color": ("#ff9800", "#f57c00")
            },
            "error": {
                "icon": "‚ùå",
                "color": ("#f44336", "#d32f2f")
            },
            "loading": {
                "icon": "‚è≥",
                "color": ("#9c27b0", "#7b1fa2")
            }
        }

        config = status_configs.get(status_type, status_configs["info"])
        # ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÑŸàŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸàÿ∂ÿπ
        config["color"] = config["color"][1 if is_dark else 0]

        return config

    def _animate_status_change(self):
        """ÿ™ÿ£ÿ´Ÿäÿ± ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸàŸÖŸäÿ∂ ŸÑŸÑŸÅÿ™ ÿßŸÑÿßŸÜÿ™ÿ®ÿßŸá
            if self.status_type in ["error", "warning"]:
                for i in range(2):
                    if not self._is_valid():
                        break

                    self._safe_configure(self.status_label, text_color="transparent")
                    if self._is_valid():
                        self.update()
                        self.after(100)

                    color = self._get_status_config(self.status_type)["color"]
                    self._safe_configure(self.status_label, text_color=color)
                    if self._is_valid():
                        self.update()
                        self.after(100)
        except:
            pass

    def set_connection_status(self, connected: bool, details: str = None):
        """ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÖÿπ ÿ™ŸÅÿßÿµŸäŸÑ - ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            if connected:
                self._safe_configure(self.connection_indicator, text_color=("#4caf50", "#2e7d32"))
                text = self.lang_manager.get("connected", "Connected")
                if details:
                    text += f" ‚Ä¢ {details}"
                self._safe_configure(
                    self.connection_label,
                    text=text,
                    text_color=("#4caf50", "#2e7d32")
                )

                # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ®ÿ∂ ŸÑŸÑÿßÿ™ÿµÿßŸÑ ÿßŸÑŸÜÿ¥ÿ∑
                self._pulse_connection_indicator()
            else:
                self._safe_configure(self.connection_indicator, text_color=("#f44336", "#d32f2f"))
                text = self.lang_manager.get("disconnected", "Disconnected")
                if details:
                    text += f" ‚Ä¢ {details}"
                self._safe_configure(
                    self.connection_label,
                    text=text,
                    text_color=("#f44336", "#d32f2f")
                )
        except:
            pass

    def _pulse_connection_indicator(self):
        """ÿ™ÿ£ÿ´Ÿäÿ± ŸÜÿ®ÿ∂ ŸÑŸÖÿ§ÿ¥ÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        def pulse():
            if self._is_valid():
                # ÿ™ŸÉÿ®Ÿäÿ±
                self._safe_configure(self.connection_indicator, font=ctk.CTkFont(size=12))
                if self._is_valid():
                    self.after(200, lambda: self._safe_configure(self.connection_indicator, font=ctk.CTkFont(size=10)) if self._is_valid() else None)

        try:
            pulse()
        except:
            pass

    def show_progress(self, value: float = None, text: str = None):
        """ÿπÿ±ÿ∂ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            if not self.progress_active:
                self.progress_active = True
                if hasattr(self.progress_bar, 'pack') and self._is_valid():
                    self.progress_bar.pack(side="left", padx=(10, 0))
                    if hasattr(self.progress_bar, 'set'):
                        self.progress_bar.set(0)

            if value is not None and hasattr(self.progress_bar, 'set'):
                self.progress_bar.set(value)

            if text:
                self.set_status(text, "loading")

            # ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ™ŸÇÿØŸÖ ÿπŸÜÿØ ÿßŸÑÿßŸÉÿ™ŸÖÿßŸÑ
            if value and value >= 1.0 and self._is_valid():
                self.after(500, self.hide_progress)
        except:
            pass

    def hide_progress(self):
        """ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            self.progress_active = False
            if hasattr(self.progress_bar, 'pack_forget'):
                self.progress_bar.pack_forget()
            self.set_status(self.lang_manager.get("ready", "Ready"), "info")
        except:
            pass

    def show_items_count(self, total: int, filtered: int = None):
        """ÿπÿ±ÿ∂ ÿπÿØÿßÿØ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            if total > 0:
                if hasattr(self.items_icon, 'pack') and self._is_valid():
                    self.items_icon.pack(side="left", padx=(0, 3))

                if filtered is not None and filtered < total:
                    text = self.lang_manager.get(
                        "showing_filtered",
                        f"Showing {filtered} of {total}"
                    )
                else:
                    text = self.lang_manager.get(
                        "total_items",
                        f"{total} items"
                    )

                self._safe_configure(self.items_label, text=text)
                if hasattr(self.items_label, 'pack') and self._is_valid():
                    self.items_label.pack(side="left")
            else:
                if hasattr(self.items_icon, 'pack_forget'):
                    self.items_icon.pack_forget()
                if hasattr(self.items_label, 'pack_forget'):
                    self.items_label.pack_forget()
        except:
            pass

    def _update_time(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàŸÇÿ™ ŸàÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid() or not self._time_update_running:
            return

        try:
            now = datetime.now()

            # ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸàŸÇÿ™
            time_format = "%I:%M:%S %p" if self.lang_manager.current_lang == "en" else "%H:%M:%S"
            time_str = now.strftime(time_format)
            self._safe_configure(self.time_label, text=time_str)

            # ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            if self.lang_manager.current_lang == "ar":
                # ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                months_ar = [
                    "ŸäŸÜÿßŸäÿ±", "ŸÅÿ®ÿ±ÿßŸäÿ±", "ŸÖÿßÿ±ÿ≥", "ÿ£ÿ®ÿ±ŸäŸÑ", "ŸÖÿßŸäŸà", "ŸäŸàŸÜŸäŸà",
                    "ŸäŸàŸÑŸäŸà", "ÿ£ÿ∫ÿ≥ÿ∑ÿ≥", "ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±", "ÿ£ŸÉÿ™Ÿàÿ®ÿ±", "ŸÜŸàŸÅŸÖÿ®ÿ±", "ÿØŸäÿ≥ŸÖÿ®ÿ±"
                ]
                days_ar = [
                    "ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ", "ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°", "ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°", "ÿßŸÑÿÆŸÖŸäÿ≥",
                    "ÿßŸÑÿ¨ŸÖÿπÿ©", "ÿßŸÑÿ≥ÿ®ÿ™", "ÿßŸÑÿ£ÿ≠ÿØ"
                ]

                day = days_ar[now.weekday()]
                month = months_ar[now.month - 1]
                date_str = f"{day}ÿå {now.day} {month} {now.year}"
            else:
                # ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©
                date_str = now.strftime("%A, %d %B %Y")

            self._safe_configure(self.date_label, text=date_str)

            # ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿßŸÑŸä
            if self._is_valid() and self._time_update_running:
                self.after(1000, self._update_time)

        except Exception as e:
            # ÿ•ÿ∞ÿß ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ÿå ÿ™ŸàŸÇŸÅ ÿπŸÜ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
            self._time_update_running = False

    def _start_time_update(self):
        """ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàŸÇÿ™ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if self._is_valid():
            self._time_update_running = True
            self._update_time()

    def show_notification(self, title: str, message: str, type: str = "info"):
        """ÿπÿ±ÿ∂ ÿ•ÿ¥ÿπÿßÿ± ŸÖÿ§ŸÇÿ™ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            # ÿ•ŸÜÿ¥ÿßÿ° ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
            top_window = self.winfo_toplevel()
            if not top_window or not hasattr(top_window, 'winfo_exists') or not top_window.winfo_exists():
                return

            notif_frame = ctk.CTkFrame(
                top_window,
                corner_radius=8,
                fg_color=("#ffffff", "#2b2b2b"),
                border_width=2,
                border_color=self._get_status_config(type)["color"]
            )

            # Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÅŸàŸÇ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ©
            notif_frame.place(
                in_=self,
                x=10,
                y=-80,
                width=300,
                height=70
            )

            # ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
            content_frame = ctk.CTkFrame(notif_frame, fg_color="transparent")
            content_frame.pack(expand=True, padx=15, pady=10)

            # ÿßŸÑÿπŸÜŸàÿßŸÜ
            title_label = ctk.CTkLabel(
                content_frame,
                text=title,
                font=ctk.CTkFont(size=13, weight="bold"),
                anchor="w"
            )
            title_label.pack(fill="x")

            # ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
            msg_label = ctk.CTkLabel(
                content_frame,
                text=message,
                font=ctk.CTkFont(size=11),
                anchor="w",
                text_color=("#666666", "#999999")
            )
            msg_label.pack(fill="x")

            # ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
            notif_frame.lift()

            # ÿ•ÿÆŸÅÿßÿ° ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
            if self._is_valid():
                self.after(3000, lambda: self._safe_destroy_notification(notif_frame))

        except Exception as e:
            pass

    def _safe_destroy_notification(self, notification_frame):
        """ÿ™ÿØŸÖŸäÿ± ÿ¢ŸÖŸÜ ŸÑŸÑÿ•ÿ¥ÿπÿßÿ±"""
        try:
            if notification_frame and hasattr(notification_frame, 'winfo_exists'):
                if notification_frame.winfo_exists():
                    notification_frame.destroy()
        except:
            pass

    def update_texts(self, lang_manager: LanguageManager):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµŸàÿµ ÿßŸÑŸÖŸÉŸàŸÜ ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            self.lang_manager = lang_manager

            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
            if self.current_status == "" or self.status_type == "info":
                self._safe_configure(self.status_label, text=lang_manager.get("ready", "Ready"))

            # ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµ ÿßŸÑÿßÿ™ÿµÿßŸÑ
            current_connection_text = ""
            try:
                if hasattr(self.connection_label, 'cget'):
                    current_connection_text = self.connection_label.cget("text")
            except:
                pass

            if "Connected" in current_connection_text or "ŸÖÿ™ÿµŸÑ" in current_connection_text:
                self._safe_configure(
                    self.connection_label,
                    text=lang_manager.get("connected", "Connected")
                )
            elif current_connection_text:  # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÜÿµ
                self._safe_configure(
                    self.connection_label,
                    text=lang_manager.get("disconnected", "Disconnected")
                )
        except Exception as e:
            pass

    def set_user_info(self, username: str, role: str = None):
        """ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ©"""
        if not self._is_valid():
            return

        try:
            user_text = f"üë§ {username}"
            if role:
                user_text += f" ({role})"

            # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿ∑ÿßÿ± ŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
            pass
        except:
            pass

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ±Ÿá ŸÖÿπ ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°"""
        if not self._is_valid():
            return

        try:
            # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿ¨ÿØŸäÿØ
            if self.current_status:
                self.set_status(self.current_status, self.status_type)

            # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ
            current_connection_text = ""
            try:
                if hasattr(self.connection_label, 'cget'):
                    current_connection_text = self.connection_label.cget("text")
            except:
                pass

            if self.lang_manager.get("connected", "Connected") in current_connection_text:
                self.set_connection_status(True)
            elif current_connection_text:  # ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÜÿµ
                self.set_connection_status(False)
        except Exception as e:
            pass

============================================================
FILE: views\components\toolbar.py
SIZE: 18926 characters
============================================================

# -*- coding: utf-8 -*-
"""
views/components/toolbar.py

ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ£ÿØŸàÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
"""

import customtkinter as ctk
from typing import Callable, Optional
from core.language_manager import LanguageManager


class ToolbarComponent(ctk.CTkFrame):
    """ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ£ÿØŸàÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ÿ®ÿ™ÿµŸÖŸäŸÖ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä"""

    def __init__(
        self,
        parent,
        lang_manager: LanguageManager,
        theme_manager=None,
        on_add=None,
        on_edit=None,
        on_delete=None,
        on_refresh=None,
        on_export=None,
        on_import=None,  # ÿ•ÿ∂ÿßŸÅÿ© ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ
        on_print=None,   # ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿ®ÿßÿπÿ©
        on_language_toggle=None
    ):
        # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÑŸÑÿ•ÿ∑ÿßÿ±
        super().__init__(parent, height=60, corner_radius=0, fg_color="transparent")

        self.lang_manager = lang_manager
        self.theme_manager = theme_manager
        self.on_add = on_add
        self.on_edit = on_edit
        self.on_delete = on_delete
        self.on_refresh = on_refresh
        self.on_export = on_export
        self.on_import = on_import
        self.on_print = on_print
        self.on_language_toggle = on_language_toggle

        # ÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        self.is_loading = False

        self._build_ui()

    def _build_ui(self):
        """ÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ£ÿØŸàÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©"""
        # ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        main_container = ctk.CTkFrame(
            self,
            corner_radius=10,
            fg_color=("#f8f9fa", "#1e1e1e"),
            border_width=1,
            border_color=("#e0e0e0", "#444444")
        )
        main_container.pack(fill="both", expand=True)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© (Ÿäÿ≥ÿßÿ±)
        left_frame = ctk.CTkFrame(main_container, fg_color="transparent")
        left_frame.pack(side="left", fill="y", padx=10, pady=8)

        # ŸÖÿ¨ŸÖŸàÿπÿ© ÿ£ÿ≤ÿ±ÿßÿ± CRUD
        crud_frame = ctk.CTkFrame(left_frame, fg_color="transparent")
        crud_frame.pack(side="left", padx=(0, 20))

        # ÿ≤ÿ± ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
        self.add_button = self._create_action_button(
            crud_frame,
            icon="‚ûï",
            text=self.lang_manager.get('add_button', 'Add'),
            command=self.on_add,
            style="primary",
            tooltip=self.lang_manager.get('add_tooltip', 'Add new booking (Ctrl+N)')
        )
        self.add_button.pack(side="left", padx=3)

        # ÿ≤ÿ± ÿßŸÑÿ™ÿπÿØŸäŸÑ
        self.edit_button = self._create_action_button(
            crud_frame,
            icon="‚úèÔ∏è",
            text=self.lang_manager.get('edit_button', 'Edit'),
            command=self.on_edit,
            style="info",
            state="disabled",
            tooltip=self.lang_manager.get('edit_tooltip', 'Edit selected booking (Ctrl+E)')
        )
        self.edit_button.pack(side="left", padx=3)

        # ÿ≤ÿ± ÿßŸÑÿ≠ÿ∞ŸÅ
        self.delete_button = self._create_action_button(
            crud_frame,
            icon="üóëÔ∏è",
            text=self.lang_manager.get('delete_button', 'Delete'),
            command=self.on_delete,
            style="danger",
            state="disabled",
            tooltip=self.lang_manager.get('delete_tooltip', 'Delete selected bookings (Delete)')
        )
        self.delete_button.pack(side="left", padx=3)

        # ÿÆÿ∑ ŸÅÿßÿµŸÑ
        separator1 = ctk.CTkFrame(
            left_frame,
            width=1,
            fg_color=("#e0e0e0", "#444444")
        )
        separator1.pack(side="left", fill="y", padx=10)

        # ŸÖÿ¨ŸÖŸàÿπÿ© ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿπŸÖŸÑŸäÿßÿ™
        operations_frame = ctk.CTkFrame(left_frame, fg_color="transparent")
        operations_frame.pack(side="left")

        # ÿ≤ÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
        self.refresh_button = self._create_action_button(
            operations_frame,
            icon="üîÑ",
            text=self.lang_manager.get('refresh', 'Refresh'),
            command=self.on_refresh,
            style="secondary",
            tooltip=self.lang_manager.get('refresh_tooltip', 'Refresh data (F5)')
        )
        self.refresh_button.pack(side="left", padx=3)

        # ÿ≤ÿ± ÿßŸÑÿ™ÿµÿØŸäÿ±
        self.export_button = self._create_action_button(
            operations_frame,
            icon="üì§",
            text=self.lang_manager.get('export', 'Export'),
            command=self.on_export,
            style="secondary",
            tooltip=self.lang_manager.get('export_tooltip', 'Export to Excel (Ctrl+S)')
        )
        self.export_button.pack(side="left", padx=3)

        # ÿ≤ÿ± ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ
        if self.on_import:
            self.import_button = self._create_action_button(
                operations_frame,
                icon="üì•",
                text=self.lang_manager.get('import', 'Import'),
                command=self.on_import,
                style="secondary",
                tooltip=self.lang_manager.get('import_tooltip', 'Import from Excel')
            )
            self.import_button.pack(side="left", padx=3)

        # ÿ≤ÿ± ÿßŸÑÿ∑ÿ®ÿßÿπÿ©
        if self.on_print:
            self.print_button = self._create_action_button(
                operations_frame,
                icon="üñ®Ô∏è",
                text=self.lang_manager.get('print', 'Print'),
                command=self.on_print,
                style="secondary",
                tooltip=self.lang_manager.get('print_tooltip', 'Print selected (Ctrl+P)')
            )
            self.print_button.pack(side="left", padx=3)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ¨ÿßŸÜÿ® ÿßŸÑÿ£ŸäŸÖŸÜ
        right_frame = ctk.CTkFrame(main_container, fg_color="transparent")
        right_frame.pack(side="right", fill="y", padx=10, pady=8)

        # ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        self.loading_frame = ctk.CTkFrame(right_frame, fg_color="transparent")
        self.loading_frame.pack(side="right", padx=10)

        self.loading_spinner = ctk.CTkLabel(
            self.loading_frame,
            text="",
            font=ctk.CTkFont(size=16)
        )
        self.loading_spinner.pack(side="left", padx=(0, 5))

        self.loading_label = ctk.CTkLabel(
            self.loading_frame,
            text="",
            font=ctk.CTkFont(size=13),
            text_color=("#666666", "#999999")
        )
        self.loading_label.pack(side="left")

        # ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
        self.selection_frame = ctk.CTkFrame(right_frame, fg_color="transparent")
        self.selection_frame.pack(side="right", padx=10)

        self.selection_icon = ctk.CTkLabel(
            self.selection_frame,
            text="‚òëÔ∏è",
            font=ctk.CTkFont(size=14)
        )

        self.selection_label = ctk.CTkLabel(
            self.selection_frame,
            text="",
            font=ctk.CTkFont(size=13),
            text_color=("#666666", "#999999")
        )

        # ÿ≤ÿ± ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ© (ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ∑ŸÑŸàÿ®ÿßŸã)
        if self.on_language_toggle:
            separator2 = ctk.CTkFrame(
                right_frame,
                width=1,
                fg_color=("#e0e0e0", "#444444")
            )
            separator2.pack(side="right", fill="y", padx=10)

            current_lang = self.lang_manager.current_lang
            button_text = "üåê EN" if current_lang == "ar" else "üåê AR"

            self.language_button = self._create_action_button(
                right_frame,
                icon="",
                text=button_text,
                command=self.on_language_toggle,
                style="accent",
                tooltip=self.lang_manager.get('change_language', 'Change Language (Ctrl+L)')
            )
            self.language_button.pack(side="right", padx=3)

    def _create_action_button(self, parent, icon, text, command, style="default", state="normal", tooltip=None):
        """ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ÿ•ÿ¨ÿ±ÿßÿ° ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™"""
        # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÖÿ∑
        colors = self._get_button_colors(style)

        # ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≤ÿ±
        button_frame = ctk.CTkFrame(parent, fg_color="transparent")

        # ÿßŸÑÿ≤ÿ±
        btn = ctk.CTkButton(
            button_frame,
            text=f"{icon} {text}" if icon else text,
            width=120,
            height=40,
            corner_radius=8,
            fg_color=colors["bg"],
            hover_color=colors["hover"],
            text_color=colors["text"],
            font=ctk.CTkFont(size=14, weight="bold"),
            command=command,
            state=state,
            border_width=2,
            border_color=colors["border"]
        )
        btn.pack()

        # ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ hover ŸÖÿ™ŸÇÿØŸÖÿ©
        def on_enter(e):
            if btn.cget("state") != "disabled":
                btn.configure(border_color=colors["border_hover"])
                # ÿπÿ±ÿ∂ tooltip
                if tooltip and hasattr(self, '_show_tooltip'):
                    self._show_tooltip(btn, tooltip)

        def on_leave(e):
            if btn.cget("state") != "disabled":
                btn.configure(border_color=colors["border"])
                # ÿ•ÿÆŸÅÿßÿ° tooltip
                if hasattr(self, '_hide_tooltip'):
                    self._hide_tooltip()

        btn.bind("<Enter>", on_enter)
        btn.bind("<Leave>", on_leave)

        # ÿ≠ŸÅÿ∏ ŸÖÿ±ÿ¨ÿπ ŸÑŸÑÿ≤ÿ±
        button_frame.button = btn

        return button_frame

    def _get_button_colors(self, style):
        """ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≤ÿ± ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÖÿ∑"""
        is_dark = ctk.get_appearance_mode() == "Dark"

        color_schemes = {
            "primary": {
                "bg": ("#4caf50", "#2e7d32"),
                "hover": ("#45a049", "#1b5e20"),
                "text": ("white", "white"),
                "border": ("#4caf50", "#2e7d32"),
                "border_hover": ("#388e3c", "#1b5e20")
            },
            "info": {
                "bg": ("#2196f3", "#1976d2"),
                "hover": ("#1976d2", "#1565c0"),
                "text": ("white", "white"),
                "border": ("#2196f3", "#1976d2"),
                "border_hover": ("#1565c0", "#0d47a1")
            },
            "danger": {
                "bg": ("#f44336", "#d32f2f"),
                "hover": ("#d32f2f", "#c62828"),
                "text": ("white", "white"),
                "border": ("#f44336", "#d32f2f"),
                "border_hover": ("#c62828", "#b71c1c")
            },
            "secondary": {
                "bg": ("#9e9e9e", "#616161"),
                "hover": ("#757575", "#424242"),
                "text": ("white", "white"),
                "border": ("#9e9e9e", "#616161"),
                "border_hover": ("#616161", "#424242")
            },
            "accent": {
                "bg": ("#9c27b0", "#7b1fa2"),
                "hover": ("#7b1fa2", "#6a1b9a"),
                "text": ("white", "white"),
                "border": ("#9c27b0", "#7b1fa2"),
                "border_hover": ("#6a1b9a", "#4a148c")
            },
            "default": {
                "bg": ("#e0e0e0", "#424242"),
                "hover": ("#d5d5d5", "#616161"),
                "text": ("#333333", "#ffffff"),
                "border": ("#e0e0e0", "#424242"),
                "border_hover": ("#bdbdbd", "#616161")
            }
        }

        scheme = color_schemes.get(style, color_schemes["default"])

        return {
            "bg": scheme["bg"][1 if is_dark else 0],
            "hover": scheme["hover"][1 if is_dark else 0],
            "text": scheme["text"][1 if is_dark else 0],
            "border": scheme["border"][1 if is_dark else 0],
            "border_hover": scheme["border_hover"][1 if is_dark else 0]
        }

    def update_selection(self, count: int):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± Ÿàÿπÿ±ÿ∂ ÿπÿØÿØ ÿßŸÑŸÖÿ≠ÿØÿØ"""
        # ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        if count == 0:
            self.edit_button.button.configure(state="disabled")
            self.delete_button.button.configure(state="disabled")
            # ÿ•ÿÆŸÅÿßÿ° ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
            self.selection_icon.pack_forget()
            self.selection_label.pack_forget()
        else:
            # ÿπÿ±ÿ∂ ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ
            self.selection_icon.pack(side="left", padx=(0, 5))
            self.selection_label.pack(side="left")

            if count == 1:
                self.edit_button.button.configure(state="normal")
                self.delete_button.button.configure(state="normal")
                self.selection_label.configure(
                    text=self.lang_manager.get("selected_one", "1 selected")
                )
            else:
                self.edit_button.button.configure(state="disabled")
                self.delete_button.button.configure(state="normal")
                self.selection_label.configure(
                    text=self.lang_manager.get("selected_multiple", f"{count} selected")
                )

    def set_loading(self, is_loading: bool, message: str = None):
        """ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ©"""
        self.is_loading = is_loading

        if is_loading:
            # ÿπÿ±ÿ∂ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            self.loading_spinner.configure(text="‚ü≥")
            self.loading_label.configure(
                text=message or self.lang_manager.get("loading", "Loading...")
            )

            # ÿ™ÿØŸàŸäÿ± ÿßŸÑŸÖÿ§ÿ¥ÿ±
            self._animate_spinner()

            # ÿ™ÿπÿ∑ŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
            self.refresh_button.button.configure(state="disabled")
        else:
            # ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            self.loading_spinner.configure(text="")
            self.loading_label.configure(text="")

            # ÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´
            self.refresh_button.button.configure(state="normal")

    def _animate_spinner(self):
        """ÿ™ÿ≠ÿ±ŸäŸÉ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ"""
        if self.is_loading:
            current = self.loading_spinner.cget("text")
            # ÿØŸàÿ±ÿßŸÜ ÿßŸÑŸÖÿ§ÿ¥ÿ±
            spinners = ["‚ü≥", "‚ü≤", "‚ü±", "‚ü∞"]
            try:
                idx = spinners.index(current)
                next_idx = (idx + 1) % len(spinners)
                self.loading_spinner.configure(text=spinners[next_idx])
            except:
                self.loading_spinner.configure(text=spinners[0])

            # ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ™ÿßŸÑŸä
            self.after(200, self._animate_spinner)

    def update_texts(self, lang_manager):
        """ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµŸàÿµ ÿßŸÑŸÖŸÉŸàŸÜ"""
        self.lang_manager = lang_manager

        # ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµŸàÿµ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        button_updates = [
            (self.add_button, 'add_button', 'Add', '‚ûï'),
            (self.edit_button, 'edit_button', 'Edit', '‚úèÔ∏è'),
            (self.delete_button, 'delete_button', 'Delete', 'üóëÔ∏è'),
            (self.refresh_button, 'refresh', 'Refresh', 'üîÑ'),
            (self.export_button, 'export', 'Export', 'üì§')
        ]

        for button_frame, key, default, icon in button_updates:
            if hasattr(button_frame, 'button'):
                text = lang_manager.get(key, default)
                button_frame.button.configure(text=f"{icon} {text}")

        # ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ©
        if hasattr(self, 'import_button'):
            self.import_button.button.configure(
                text=f"üì• {lang_manager.get('import', 'Import')}"
            )

        if hasattr(self, 'print_button'):
            self.print_button.button.configure(
                text=f"üñ®Ô∏è {lang_manager.get('print', 'Print')}"
            )

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑŸÑÿ∫ÿ©
        if hasattr(self, 'language_button'):
            current_lang = lang_manager.current_lang
            button_text = "üåê EN" if current_lang == "ar" else "üåê AR"
            self.language_button.button.configure(text=button_text)

        # ÿ™ÿ≠ÿØŸäÿ´ ŸÜÿµ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ∏ÿßŸáÿ±ÿßŸã
        if self.is_loading:
            self.loading_label.configure(
                text=lang_manager.get("loading", "Loading...")
            )

        # ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ∏ÿßŸáÿ±ÿßŸã
        if hasattr(self, 'selection_label'):
            current_text = self.selection_label.cget("text")
            if current_text:
                # ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿπÿØÿØ ŸÖŸÜ ÿßŸÑŸÜÿµ ÿßŸÑÿ≠ÿßŸÑŸä
                try:
                    count = int(''.join(filter(str.isdigit, current_text)))
                    if count == 1:
                        self.selection_label.configure(
                            text=lang_manager.get("selected_one", "1 selected")
                        )
                    else:
                        self.selection_label.configure(
                            text=lang_manager.get("selected_multiple", f"{count} selected")
                        )
                except:
                    pass

    def refresh_theme(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ´ŸäŸÖ ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ±Ÿá"""
        # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ•ÿ∑ÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
        main_container = self.winfo_children()[0] if self.winfo_children() else None
        if main_container and isinstance(main_container, ctk.CTkFrame):
            main_container.configure(
                fg_color=("#f8f9fa", "#1e1e1e"),
                border_color=("#e0e0e0", "#444444")
            )

        # ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        self._update_button_colors()

        # ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ÿØŸäÿØ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÜÿ¥ÿ∑ÿ©
        if self.is_loading:
            current_text = self.loading_label.cget("text")
            self.set_loading(True, current_text)

    def _update_button_colors(self):
        """ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿ≠ÿ≥ÿ® ÿßŸÑÿ´ŸäŸÖ ÿßŸÑÿ¨ÿØŸäÿØ"""
        # ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÖÿπ ÿ£ŸÜŸÖÿßÿ∑Ÿáÿß
        button_configs = [
            (self.add_button, "primary"),
            (self.edit_button, "info"),
            (self.delete_button, "danger"),
            (self.refresh_button, "secondary"),
            (self.export_button, "secondary")
        ]

        # ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
        if hasattr(self, 'import_button'):
            button_configs.append((self.import_button, "secondary"))
        if hasattr(self, 'print_button'):
            button_configs.append((self.print_button, "secondary"))
        if hasattr(self, 'language_button'):
            button_configs.append((self.language_button, "accent"))

        # ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ ÿ≤ÿ±
        for button_frame, style in button_configs:
            if hasattr(button_frame, 'button'):
                colors = self._get_button_colors(style)
                button_frame.button.configure(
                    fg_color=colors["bg"],
                    hover_color=colors["hover"],
                    text_color=colors["text"],
                    border_color=colors["border"]
                )

    def show_success_feedback(self, message: str):
        """ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠ ŸÖÿ§ŸÇÿ™ÿ©"""
        # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ∑ŸÇ ŸÑÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠ ŸÖÿ§ŸÇÿ™ÿ©
        pass

    def show_error_feedback(self, message: str):
        """ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸÖÿ§ŸÇÿ™ÿ©"""
        # ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ∑ŸÇ ŸÑÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸÖÿ§ŸÇÿ™ÿ©
        pass


# ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ
class Toolbar(ToolbarComponent):
    """ÿµŸÜŸÅ ÿ®ÿØŸäŸÑ ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿ£ŸÉŸàÿßÿØ ÿßŸÑŸÇÿØŸäŸÖÿ©"""
    pass

================================================================================
EXPORT SUMMARY
================================================================================
Total files read: 55
Errors encountered: 0
Export date: 2025-07-03 04:28:57
